<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xgh-user.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
<meta property="og:type" content="website">
<meta property="og:title" content="_little-star_">
<meta property="og:url" content="http://xgh-user.github.io/page/2/index.html">
<meta property="og:site_name" content="_little-star_">
<meta property="og:description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="_little-star_">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://xgh-user.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>_little-star_</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="_little-star_" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">_little-star_</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学习的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2021/03/15/springcloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/15/springcloud/" class="post-title-link" itemprop="url">SpringCloud</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-15 00:30:19" itemprop="dateCreated datePublished" datetime="2021-03-15T00:30:19+08:00">2021-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-24 21:14:00" itemprop="dateModified" datetime="2021-05-24T21:14:00+08:00">2021-05-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%90%8E%E5%8F%B0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">java后台学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%90%8E%E5%8F%B0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/springcloud/" itemprop="url" rel="index"><span itemprop="name">springcloud</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h1><h2 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h2><h3 id="1、微服务架构概述"><a href="#1、微服务架构概述" class="headerlink" title="1、微服务架构概述"></a>1、微服务架构概述</h3><p>微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务。服务之间互相协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务与服务间采用轻量级的通信机制互相协作(通常是基于HTTP协议的RESTful API)。每个服务都围绕着具体业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应当尽量避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建。</p>
<h3 id="2、微服务架构编码构建"><a href="#2、微服务架构编码构建" class="headerlink" title="2、微服务架构编码构建"></a>2、微服务架构编码构建</h3><p>Rest微服务工程搭建：</p>
<ol>
<li><p>约定&gt;配置&gt;编码</p>
</li>
<li><p>IDEA新建project工作空间</p>
<ul>
<li>微服务cloud整体聚合工程<ul>
<li>父工程步骤<ul>
<li>New Project</li>
<li>聚合总父工程名字</li>
<li>Maven选版本</li>
<li>工程名字</li>
<li>字符编码</li>
<li>注解生效激活</li>
<li>java编译版本选8</li>
<li>File Type过滤</li>
</ul>
</li>
<li>父工程POM<ul>
<li>DependencyManagement(版本统一管理)</li>
<li>maven中跳过单元测试</li>
</ul>
</li>
<li>父工程创建完成执行mvn:insall将父工程发布到仓库方便子工程继承</li>
</ul>
</li>
</ul>
</li>
<li><p>Rest微服务工程搭建</p>
<ul>
<li><p>创建公共的模块</p>
<ul>
<li>实体类emtities<ul>
<li>主实体</li>
<li>Json封装体</li>
</ul>
</li>
<li>常量类</li>
<li>枚举类</li>
<li>创建步骤<ul>
<li>建module</li>
<li>改pom</li>
<li>编写</li>
<li>执行mvn:insall将公共工程发布到仓库方便需要的工程继承</li>
</ul>
</li>
</ul>
</li>
<li><p>微服务提供者Module模块</p>
<ul>
<li>建module</li>
<li>改POM</li>
<li>写YML</li>
<li>主启动</li>
<li>业务类<ul>
<li>建表sql</li>
<li>dao<ul>
<li>接口</li>
<li>mybatis的映射文件(src\main\resources\mapper\XxxxxMapper.xml)</li>
</ul>
</li>
<li>service<ul>
<li>接口</li>
<li>实现类</li>
</ul>
</li>
<li>controller</li>
</ul>
</li>
<li>测试（postman）</li>
</ul>
</li>
<li><p>热部署Devtools</p>
</li>
<li><p>微服务消费者订单Module模块</p>
<ul>
<li>建module</li>
<li>改POM</li>
<li>写YML</li>
<li>主启动</li>
<li>业务类<ul>
<li>config配置类</li>
<li>controller</li>
</ul>
</li>
<li>测试</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="3、SpringCloud简介"><a href="#3、SpringCloud简介" class="headerlink" title="3、SpringCloud简介"></a>3、SpringCloud简介</h3><p>SpringCloud：分布式微服务架构的一站式解决方案，是多种微服务架构落</p>
<p>地技术的集合体，俗称微服务全家桶。</p>
<p><img src="/2021/03/15/springcloud/1.jpg" alt="1"></p>
<p><img src="/2021/03/15/springcloud/2.jpg" alt="2"></p>
<h3 id="4、SpringCloud技术栈"><a href="#4、SpringCloud技术栈" class="headerlink" title="4、SpringCloud技术栈"></a>4、SpringCloud技术栈</h3><p><img src="/2021/03/15/springcloud/206.png" alt="image-20210305205540848"></p>
<p><img src="/2021/03/15/springcloud/207.png" alt="image-20210305205647548"></p>
<p><img src="/2021/03/15/springcloud/3.jpg" alt="3"></p>
<h3 id="5、版本选择"><a href="#5、版本选择" class="headerlink" title="5、版本选择"></a>5、版本选择</h3><p>springboot：2.2.RELEASE</p>
<p>springcloud：Hoxton.SR1</p>
<p>springcloud Alibaba：2.1.0.RELEASE</p>
<p>java：8</p>
<p>Maven：3.5及以上</p>
<p>Mysql：5.7及以上</p>
<h3 id="6、访问方式"><a href="#6、访问方式" class="headerlink" title="6、访问方式"></a>6、访问方式</h3><ul>
<li>网页</li>
<li>postman</li>
<li>dos窗口 + crul<ul>
<li>加入curl返回中文乱码（<a target="_blank" rel="noopener" href="https://blog.csdn.net/leedee/article/details/82685636%EF%BC%89">https://blog.csdn.net/leedee/article/details/82685636）</a></li>
</ul>
</li>
</ul>
<h2 id="注册中心"><a href="#注册中心" class="headerlink" title="注册中心"></a>注册中心</h2><h3 id="7、Eureka注册中心"><a href="#7、Eureka注册中心" class="headerlink" title="7、Eureka注册中心"></a>7、Eureka注册中心</h3><h4 id="7-1、Eureka基础知识："><a href="#7-1、Eureka基础知识：" class="headerlink" title="7.1、Eureka基础知识："></a>7.1、Eureka基础知识：</h4><ul>
<li><p>服务治理：SpringCloud封装了Netflix公司开发的Eureka模块来实现服</p>
<p>务治理。</p>
<p>在传统的rpc远程调用框架中，管理每个服务与服务之间的依赖关系比</p>
<p>较复杂，管理比较复杂，所以需要使用服务治理，管理服务与服务之间</p>
<p>的依赖关系，可以实现服务调用、负载均衡、容错等，实现服务的发现</p>
<p>与注册。</p>
</li>
<li><p>服务发现与注册：Eureka采用了CS的设计架构，Eureka Server作为服</p>
<p>务注册功能的服务器，它是服务注册中心。而系统中的其他微服务，使</p>
<p>用Eureka的客户端连接到Eureka Server并维持心跳连接。这样系统的</p>
<p>维护人员就可以通过Eureka Server来监控系统中各个微服务是否正常</p>
<p>运行。</p>
<p>在服务注册与发现中，有一个注册中心。但服务器启动的时候，会把当</p>
<p>前自己的服务的信息。比如：服务地址、通讯地址等以别名方式注册到</p>
<p>注册中心上。另一方（消费者|服务提供者），以该别名的方式去注册</p>
<p>中心上获取到实际的服务通讯地址，然后在实现本地的RPC调用。远程</p>
<p>RPC调用的框架核心设计思想：在于注册中心，因为使用注册中心管理</p>
<p>每个服务与服务之间的一个依赖关系（服务治理概念）。在任何远程</p>
<p>RPC框架中，都会有一个注册中心（存放服务地址相关信息（接口地</p>
<p>址））</p>
</li>
<li><p>Eureka系统架构与Dubbo架构的对比</p>
<p><img src="/2021/03/15/springcloud/4.png" alt="image-20210309193119872"></p>
<p><img src="/2021/03/15/springcloud/5.png" alt="image-20210309193236970"></p>
</li>
<li><p>Eureka的两大组件</p>
<ul>
<li><p>Eureka Server：提供服务注册服务</p>
<p>各个微服务结点通过配置启动后，会在Eureka Server中进行注</p>
<p>册，这样Eureka Server中的服务注册表中将会存储所有可用服务</p>
<p>注册节点的信息，服务节点的信息可以在界面中直观看到。</p>
<p>主启动加注解：@EnableEurekaServer</p>
<p>pom:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Eureka Client：通过注册中心进行访问</p>
<p>是一个java客户端，用于简化Eureka Server的交互，客户端同时也</p>
<p>具备一个内置的，使用轮询（round-robin）负载算法的负载均衡</p>
<p>器。在启动应用后，将会向Eureka Server发送心跳（默认周期</p>
<p>30s）。如果Eureka Server在多个心跳周期内没有接收到某个节点</p>
<p>的心跳，Eureka Server将会从访问注册表中把这个服务节点移除</p>
<p>（默认90s）</p>
<p>主启动加注解：@EnableEurekaClient</p>
<p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="7-2、工作流程："><a href="#7-2、工作流程：" class="headerlink" title="7.2、工作流程："></a>7.2、工作流程：</h4><p><img src="/2021/03/15/springcloud/springcloud%5C6.png" alt="img"></p>
<p> 解决办法: 搭建Eureka注册中心集群,实现负载均衡+故障容错</p>
<h4 id="7-3、集群搭建"><a href="#7-3、集群搭建" class="headerlink" title="7.3、集群搭建"></a>7.3、集群搭建</h4><p>相互依赖，相互守望（在application.yml中配置文件互相配置）</p>
<h4 id="7-4、eureka自我保护"><a href="#7-4、eureka自我保护" class="headerlink" title="7.4、eureka自我保护"></a>7.4、eureka自我保护</h4><p>概述：保护模式主要用于一组客户端和Eureka Server之间存在网络分区场</p>
<p>景下的保护。一旦进入保护模式，Eureka Server将会尝试保护其服务注册</p>
<p>表中的信息，不在删除服务注册表中的数据，也就是不会注销任何微服务。</p>
<p><img src="/2021/03/15/springcloud/7.png" alt="image-20210309203401792"></p>
<p>导致原因：</p>
<p><img src="/2021/03/15/springcloud/8.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/9.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/10.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/11.png" alt="img"> </p>
<p>一句话总结:某时刻 一个微服务不可用了,Eureka不会立刻清理,依旧会对该</p>
<p>服务的信息进行保存。属于CAP里面的AP分支</p>
<p>如何禁用Eureka的保护模式：</p>
<p>在Eureka服务端（Eureka Server）：</p>
<p>使用eureka.server.enable-self-preservation=false 可以禁用自我保护模式</p>
<p>在Eureka客户端（Eureka Client）（修改时间）：</p>
<ul>
<li><p>eureka.instance.lease-renewal-interval-in-seconds=1</p>
<p>Eureka客户端向服务端发送心跳的时间间隔,单位为秒。默认是30秒</p>
</li>
<li><p>eureka.instance.lease-expiration-duration-in-seconds=90</p>
<p>Eureka服务端在收到最后一次心跳后等待时间上限 ,单位为秒(默认是90</p>
<p>秒),超时删除服务</p>
</li>
</ul>
<h3 id="8、Zookeeper注册中心"><a href="#8、Zookeeper注册中心" class="headerlink" title="8、Zookeeper注册中心"></a>8、Zookeeper注册中心</h3><p>Zookeeper是一个分布式协调工具,可以实现注册中心功能。</p>
<p>依赖导入：</p>
<p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>思考：</p>
<p>服务节点是临时节点还是持久节点？</p>
<p>临时节点。所以Zookeeper属于CAP中里的CP分支。</p>
<p><img src="/2021/03/15/springcloud/springcloud%5C12.png" alt="img"> </p>
<h3 id="9、Consul注册中心"><a href="#9、Consul注册中心" class="headerlink" title="9、Consul注册中心"></a>9、Consul注册中心</h3><h4 id="9-1、什么是consul"><a href="#9-1、什么是consul" class="headerlink" title="9.1、什么是consul"></a>9.1、什么是consul</h4><p>Consul是一套开源的分布式服务发现和配置管理系统，由HashiCorp公司用</p>
<p>Go语言开发。Consul提供了微服务系统中的服务治理、配置中心、控制总</p>
<p>线等功能。这些功能中的每一个都可以根据需要单独使用，也可以一起使用</p>
<p>以构建全方位的服务网络，总之Consul提供了一种完整服务网络解决方</p>
<p>案。</p>
<p>优点：</p>
<ul>
<li>基于raft协议，比较简洁</li>
<li>支持健康检查，同时支持HTTP和DNS协议支持跨数据中心的WAN集群</li>
<li>提供图形界面</li>
<li>跨平台</li>
<li>支持Linux、Mac、Windows</li>
</ul>
<p><img src="/2021/03/15/springcloud/13.png" alt="image-20210309210438031">  </p>
<h4 id="9-2、功能"><a href="#9-2、功能" class="headerlink" title="9.2、功能"></a>9.2、功能</h4><ul>
<li>服务发现：提供HTTP/DNS两种发现方式</li>
<li>健康检测：支持多种方式,HTTP、TCP、Docker、shell脚本定制化</li>
<li>KV存储：Key、Value的存储方式</li>
<li>多数据中心：Consul支持多数据中心</li>
<li>可视化界面</li>
</ul>
<h4 id="9-3、依赖导入"><a href="#9-3、依赖导入" class="headerlink" title="9.3、依赖导入"></a>9.3、依赖导入</h4><p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="10、三个注册中心异同点"><a href="#10、三个注册中心异同点" class="headerlink" title="10、三个注册中心异同点"></a>10、三个注册中心异同点</h3><p><img src="/2021/03/15/springcloud/14.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/15.png" alt="img"> </p>
<p>CP(Zookeeper/Consul)：</p>
<p>当网络分区出现后,为了保证一致性,就必须拒绝请求,否则无法保证一致性</p>
<p>结论:违背了可用性A的要求,只满足一致性和分区容错,即CP。</p>
<p><img src="/2021/03/15/springcloud/16.png" alt="image-20210307031636572"></p>
<p>AP(Eureka):</p>
<p><img src="/2021/03/15/springcloud/19.png" alt="img"> </p>
<p>CAP（分区容错性要保证,所以要么是CP,要么是AP）：</p>
<ul>
<li>C: Consistency(强一致性)</li>
<li>A: Availability(可用性)</li>
<li>P: Parttition tolerance(分区容错性)</li>
</ul>
<p>CAP理论关注粒度是否是数据,而不是整体系统设计的策略</p>
<p>经典CAP图：</p>
<p><img src="/2021/03/15/springcloud/17.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/18.png" alt="img"> </p>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><h3 id="11、Ribbon负载均衡调用"><a href="#11、Ribbon负载均衡调用" class="headerlink" title="11、Ribbon负载均衡调用"></a>11、Ribbon负载均衡调用</h3><h4 id="11-1、是什么"><a href="#11-1、是什么" class="headerlink" title="11.1、是什么"></a>11.1、是什么</h4><p>Spring Cloud Ribbon是基于Netflix Ribbon实现的一套客户端负载均衡的</p>
<p>工具。</p>
<p>简单的说，Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软</p>
<p>件负载均衡算法和服务调用。Ribbon客户端组件提供一系列完善的配置项</p>
<p>如连接超时，重试等。简单的说，就是在配置文件中列出Load </p>
<p>Balancer（LB）后面所有机器，Ribbon会自动的帮助你基于某种规则(如简</p>
<p>单轮询，随机连接等)去连接这些机器。我们很容易使用Ribbon实现自定义</p>
<p>的负载均衡算法。 </p>
<p>总结: Ribbon其实就是一个软负载均衡的客户端组件,  他可以和其他所需请</p>
<p>求的客户端结合使用,和eureka结合只是其中一个实例.</p>
<h4 id="11-2、作用（负载均衡-RestTemplate调用）"><a href="#11-2、作用（负载均衡-RestTemplate调用）" class="headerlink" title="11.2、作用（负载均衡+RestTemplate调用）"></a>11.2、作用（负载均衡+RestTemplate调用）</h4><p>LB(负载均衡)：</p>
<p>简单的说就是将用户的请求平摊的分配到多个服务上，从而达到系统的</p>
<p>HA（高可用）。</p>
<p>常见的负载均衡有软件Nginx，LVS，硬件F5等。</p>
<p>Ribbon本地负载均衡客户端 VS Nginx服务端负载均衡的区别：</p>
<ul>
<li><p>Nginx是服务器负载均衡，客户端所有请求都会交给nginx，然后由</p>
<p>nginx实现转发请求。即负载均衡是由服务端实的。</p>
</li>
<li><p>Ribbon本地负载均衡，在调用微服务接口的时候，会在注册中心上获</p>
<p>取注册信息服务列表之后缓存到JVM本地，从而在本地实现RPC远程服务调用技术。 </p>
</li>
</ul>
<p>LB(负载均衡)可分为：</p>
<ul>
<li><p>集中式LB</p>
<p>即在服务的消费方和提供方之间提供独立的LB设施(可以是硬件如F5，</p>
<p>也可以是软件，如nginx)，由该设施负责把访问请求通过某种策略转发</p>
<p>至服务的提供方。</p>
</li>
<li><p>进程内LB</p>
<p>将LB逻辑集成到消费方，消费方从服务注册中心获知有哪些地址可用，</p>
<p>然后自己再从这些地址中选择出一台合适的服务器。Ribbon就属于进</p>
<p>程内LB，它只是一个类库，集成与消费方进程，消费方通过它来获取服</p>
<p>务提供方的地址。 </p>
</li>
</ul>
<h4 id="11-3、框架说明"><a href="#11-3、框架说明" class="headerlink" title="11.3、框架说明"></a>11.3、框架说明</h4><p><img src="/2021/03/15/springcloud/20.png" alt="img"> </p>
<p>Ribbon在工作时分成两步：</p>
<ul>
<li><p>第一步：</p>
<p>先选择Eureka Server，它优先选择在同一区域内负载较少的server</p>
</li>
<li><p>第二步：</p>
<p>再根据用户指定的策略，再从server取到的服务注册列表中选择一个地</p>
<p>址。其中Ribbon提供了多种策略:比如轮询、随机和根据响应时间加</p>
<p>权。</p>
</li>
</ul>
<p>RestTemplate的使用：</p>
<ul>
<li><p>getForObject(String url,class)方法:返回对象为响应体中数据转化成的</p>
<p>对象，基本上可以理解成Json</p>
</li>
<li><p>getForEntity(String url,class)方法：返回对象为ResponseEntity对象，</p>
<p>包含响应中的一些重要信息，比如响应头、响应状态码、响应体等。  </p>
</li>
</ul>
<h4 id="11-4、Ribbon核心组件IRule"><a href="#11-4、Ribbon核心组件IRule" class="headerlink" title="11.4、Ribbon核心组件IRule"></a>11.4、Ribbon核心组件IRule</h4><h5 id="11-4-1、IRule是什么"><a href="#11-4-1、IRule是什么" class="headerlink" title="11.4.1、IRule是什么"></a>11.4.1、IRule是什么</h5><p>IRule:根据特定算法从服务列表中选取一个要访问的服务</p>
<p><img src="/2021/03/15/springcloud/21.png" alt="img"> </p>
<ul>
<li><p>com.netflix.loadbalancer.RoundRobinRule：轮询（默认）</p>
</li>
<li><p>com.netflix.loadbalancer.RandomRule：随机</p>
</li>
<li><p>com.netflix.loadbalancer.RetryRule：先按照RoundRobinRule的策略</p>
<p>获取服务,如果获取服务失败则在指定时间内进行重试,获取可用的服务</p>
</li>
<li><p>WeightedResponseTimeRule：对RoundRobinRule的扩展,响应速度</p>
<p>越快的实例选择权重越多大,越容易被选择</p>
</li>
<li><p>BestAvailableRule：会先过滤掉由于多次访问故障而处于断路器跳闸</p>
<p>状态的服务,然后选择一个并发量最小的服务</p>
</li>
<li><p>AvailabilityFilteringRule：先过滤掉故障实例,再选择并发较小的实例</p>
</li>
<li><p>ZoneAvoidanceRule：默认规则,复合判断server所在区域的性能和</p>
<p>server的可用性选择服务器</p>
</li>
</ul>
<h5 id="11-4-2、替换："><a href="#11-4-2、替换：" class="headerlink" title="11.4.2、替换："></a>11.4.2、替换：</h5><p>注意配置细节</p>
<p>官方文档明确给出了警告：</p>
<p>这个自定义配置类不能放在@ComponentScan所扫描的当前包以及子包</p>
<p>下，否则我们自定义的这个配置类就会被所有的Ribbon客户端所共享，达</p>
<p>不到特殊化定制的目的了。 </p>
<p><img src="/2021/03/15/springcloud/22.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/23.png" alt="img"> </p>
<p>@ComponentScan所扫描的当前包以及子包：因为</p>
<p>@SpringBootApplication注解包含了@ComponentScan注解，所以该自定</p>
<p>义配置类不能放在当前包（springcloud）下。</p>
<p>新建package：com.atguigu.myrule</p>
<p>上面包下新建MySelfRule规则类</p>
<p>主启动类添加@RibbonClient</p>
<h5 id="11-4-3、Ribbon负载均衡算法"><a href="#11-4-3、Ribbon负载均衡算法" class="headerlink" title="11.4.3、Ribbon负载均衡算法"></a>11.4.3、Ribbon负载均衡算法</h5><p>RoundRobinRule：轮询的算法思想</p>
<p><img src="/2021/03/15/springcloud/24.png" alt="img"> </p>
<h3 id="12、OenFeign"><a href="#12、OenFeign" class="headerlink" title="12、OenFeign"></a>12、OenFeign</h3><h4 id="12-1、是什么？"><a href="#12-1、是什么？" class="headerlink" title="12.1、是什么？"></a>12.1、是什么？</h4><p>官方解释：<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign">https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign</a></p>
<p>Feign是一个声明式WebService客户端。使用Feign能让编写Web Service客</p>
<p>户端更加简单。它的使用方法是<strong>定义一个服务接口然后在上面添加注解</strong>。</p>
<p>Feign也支持可拔插式的编码器和解码器。Spring Cloud对Feign进行了封</p>
<p>装，使其支持了Spring MVC标准注解和HTTPMessageConverters。Feign</p>
<p>可以与Eureka和Ribbon组合使用以支持负载均衡。</p>
<h4 id="12-2、作用："><a href="#12-2、作用：" class="headerlink" title="12.2、作用："></a>12.2、作用：</h4><p>Feign旨在使编写Java Http客户端变得更容易。</p>
<p>前面在使用Ribbon+RestTemplate时，利用RestTemplate对http请求的封装处</p>
<p>理，形成了一套模版化的调用方法。但是在实际开发中，由于对服务依赖的调用</p>
<p>可能不止一处，<strong>往往一个接口会被多处调用，所以通常都会针对每个微服务自行</strong></p>
<p><strong>封装一些客户端类来包装这些依赖服务的调用</strong>。所以，Feign在此基础上做了进</p>
<p>一步封装，由他来帮助我们定义和实现依赖服务接口的定义。在Feign的实现下</p>
<p><strong>我们只需创建一个接口并使用注解的方式来配置它(以前是Dao接口上面标</strong></p>
<p><strong>注Mapper注解，现在是一个微服务接口上面标注一个Feign注解即可)，即可完</strong></p>
<p>成对服务提供方的接口绑定，简化了使用Spring cloud Ribbon时，自动封装服</p>
<p>务调用客户端的开发量。</p>
<p>Feign集成了Ribbon</p>
<p>利用Ribbon维护了Payment的服务列表信息，并且通过轮询实现了客户端的负</p>
<p>载均衡。而与Ribbon不同的是，<strong>通过feign只需要定义服务绑定接口且以声明式</strong></p>
<p><strong>的方法</strong>，优雅而简单的实现了服务调用。</p>
<h4 id="12-3、Feign和OpenFeign两者区别"><a href="#12-3、Feign和OpenFeign两者区别" class="headerlink" title="12.3、Feign和OpenFeign两者区别"></a>12.3、Feign和OpenFeign两者区别</h4><p><img src="/2021/03/15/springcloud/25.png" alt="img"> </p>
<h4 id="12-4、使用步骤"><a href="#12-4、使用步骤" class="headerlink" title="12.4、使用步骤"></a>12.4、使用步骤</h4><ul>
<li><p>接口+注解：微服务调用接口+@FeignClient</p>
</li>
<li><p>Feign在消费端使用</p>
</li>
<li><p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动加上@EnableFeignClients注解开启Feign</p>
</li>
<li><p>业务逻辑接口+@FeignClient配置调用provider服务</p>
<p>@FeignClient(value = “xxx-xxx-xxx”)value的值要写服务提供方在Eureka注册的名称</p>
</li>
<li><p>控制层Controller</p>
</li>
</ul>
<p><img src="/2021/03/15/springcloud/26.png" alt="img"> </p>
<h4 id="12-5、OpenFeign超时控制"><a href="#12-5、OpenFeign超时控制" class="headerlink" title="12.5、OpenFeign超时控制"></a>12.5、OpenFeign超时控制</h4><h5 id="12-5-1、是什么？"><a href="#12-5-1、是什么？" class="headerlink" title="12.5.1、是什么？"></a>12.5.1、是什么？</h5><p>默认Feign客户端<strong>只等待1秒钟</strong>，但是服务端处理需要超过1秒钟，导致Feign客</p>
<p>户端不想等待了，直接返回报错。</p>
<h5 id="12-5-2、解决方法-OpenFeign默认支持Ribbon"><a href="#12-5-2、解决方法-OpenFeign默认支持Ribbon" class="headerlink" title="12.5.2、解决方法(OpenFeign默认支持Ribbon)"></a>12.5.2、解决方法(OpenFeign默认支持Ribbon)</h5><p>为了避免这样的情况，有时候我们需要设置Feign客户端的超时控制。</p>
<p>yml文件中开启配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置feign客户端超时时间(OpenFeign默认支持ribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line"><span class="comment">#指的是建立连接所用的时间，适用于网络状况正常的情况下,两端连接所用的时间</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line"><span class="comment">#指的是建立连接后从服务器读取到可用资源所用的时间</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<h4 id="12-6、OpenFeign日志打印功能"><a href="#12-6、OpenFeign日志打印功能" class="headerlink" title="12.6、OpenFeign日志打印功能"></a>12.6、OpenFeign日志打印功能</h4><h5 id="12-6-1、是什么？"><a href="#12-6-1、是什么？" class="headerlink" title="12.6.1、是什么？"></a>12.6.1、是什么？</h5><p>Feign提供了日志打印功能，我们可以通过配置来调整日志级别，从而了解</p>
<p>Feign中Http请求的细节。说白了就是<strong>对Feign接口的调用情况进行监控和</strong></p>
<p><strong>输出。</strong></p>
<h2 id="熔断器"><a href="#熔断器" class="headerlink" title="熔断器"></a>熔断器</h2><h3 id="13、Hystrix熔断器（豪猪哥）"><a href="#13、Hystrix熔断器（豪猪哥）" class="headerlink" title="13、Hystrix熔断器（豪猪哥）"></a>13、Hystrix熔断器（豪猪哥）</h3><h4 id="13-1、分布式系统面临的问题"><a href="#13-1、分布式系统面临的问题" class="headerlink" title="13.1、分布式系统面临的问题"></a>13.1、分布式系统面临的问题</h4><p><strong>复杂分布式体系结构中的应用程序 ，有数10个依赖关系，每个依赖关系在某些时候将不可避免地失败。</strong></p>
<p><img src="/2021/03/15/springcloud/27.png" alt="img"></p>
<p>服务雪崩：</p>
<p>多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务B和</p>
<p>微服务C又调用其它的微服务，这就是所谓的“<strong>扇出</strong>”。如果扇出的链路上某个微</p>
<p>服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系</p>
<p>统资源，进而引起系统崩溃，所谓的“雪崩效应”。</p>
<p>对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都</p>
<p>在几秒钟内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟</p>
<p>增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故</p>
<p>障。这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，</p>
<p>不能取消整个应用程序或系统。所以，通常当你发现一个模块下的某个实例失败</p>
<p>后，这时候这个模块依然还会接收流量，然后这个有问题的模块还调用了其他的</p>
<p>模块，这样就会发生级联故障，或者叫雪崩。</p>
<h4 id="13-2、Hystrix是什么"><a href="#13-2、Hystrix是什么" class="headerlink" title="13.2、Hystrix是什么"></a>13.2、Hystrix是什么</h4><p>Hystrix是一个用于处理分布式系统的<strong>延迟</strong>和<strong>容错</strong>的开源库，在分布式系统里，</p>
<p>许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix能够保证在一个</p>
<p>依赖出问题的情况下，<strong>不会导致整体服务失败，避免级联故障，以提高分布式系</strong></p>
<p><strong>统的弹性</strong>。</p>
<p>“断路器”本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故</p>
<p>障监控(类似熔断保险丝)，<strong>向调用方返回一个符合预期的、可处理的备选响应</strong></p>
<p><strong>(FallBack)，而不是长时间的等待或者抛出调用方无法处理的异常</strong>，这样就保证</p>
<p>了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系</p>
<p>统中的蔓延，乃至雪崩。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://github.com/Netflix/hystrix/wiki">https://github.com/Netflix/hystrix/wiki</a></p>
<h4 id="13-3、作用"><a href="#13-3、作用" class="headerlink" title="13.3、作用"></a>13.3、作用</h4><ul>
<li>服务降级</li>
<li>服务熔断</li>
<li>接近实时的监控</li>
</ul>
<h4 id="13-4、HyStrix重要概念"><a href="#13-4、HyStrix重要概念" class="headerlink" title="13.4、HyStrix重要概念"></a>13.4、HyStrix重要概念</h4><h5 id="13-4-1、服务降级"><a href="#13-4-1、服务降级" class="headerlink" title="13.4.1、服务降级"></a>13.4.1、服务降级</h5><p>服务器忙,请稍后再试,不让客户端等待并立刻返回一个友好提示,fallback</p>
<p>哪些情况会发出降级：</p>
<ul>
<li>程序运行异常</li>
<li>超时</li>
<li>服务熔断触发服务降级</li>
<li>线程池/信号量也会导致服务降级</li>
</ul>
<h5 id="13-4-2、服务熔断"><a href="#13-4-2、服务熔断" class="headerlink" title="13.4.2、服务熔断"></a>13.4.2、服务熔断</h5><p>类比保险丝达到最大服务访问后,直接拒绝访问,拉闸限电,然后调用服务降级的方</p>
<p>法并返回友好提示</p>
<p>服务熔断的过程：</p>
<p>服务的降级-&gt;进而熔断-&gt;恢复调用链路</p>
<h5 id="12-4-3、服务限流"><a href="#12-4-3、服务限流" class="headerlink" title="12.4.3、服务限流"></a>12.4.3、服务限流</h5><p>秒杀高并发等操作,严禁一窝蜂的过来拥挤,大家排队,一秒钟N个,有序进行</p>
<h4 id="13-5、依赖"><a href="#13-5、依赖" class="headerlink" title="13.5、依赖"></a>13.5、依赖</h4><p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="13-6、高压访问的解决方法"><a href="#13-6、高压访问的解决方法" class="headerlink" title="13.6、高压访问的解决方法"></a>13.6、高压访问的解决方法</h4><p>超时导致服务器变慢(转圈)：超时不再等待</p>
<p>出错(宕机或程序运行出错)：出错要有兜底</p>
<h4 id="13-7、访问降级"><a href="#13-7、访问降级" class="headerlink" title="13.7、访问降级"></a>13.7、访问降级</h4><p>降级配置@HystrixCommand</p>
<h5 id="13-7-1、对于服务提供方："><a href="#13-7-1、对于服务提供方：" class="headerlink" title="13.7.1、对于服务提供方："></a>13.7.1、对于服务提供方：</h5><p>设置自身调用超时时间的峰值,峰值内可以正常运行,  超过了需要有兜底的方法处</p>
<p>理,做服务降级fallback</p>
<p>一旦调用服务方法失败并抛出了错误信息后,会自动调用@HystrixCommand标‘</p>
<p>注好的fallbckMethod调用类中的指定方法</p>
<p>主启动类激活@EnableCircuitBreaker</p>
<p>下图故意制造两个异常：</p>
<ul>
<li>int age = 10/0;计算异常</li>
<li>我们能接受3秒钟，它运行5秒钟，超时异常。</li>
</ul>
<p>当前服务不可用了，做服务降级，兜底的方案都是paymentInfo_TimeOutHandler</p>
<p><img src="/2021/03/15/springcloud/28.png" alt="img"></p>
<h5 id="13-7-2、对于服务消费方："><a href="#13-7-2、对于服务消费方：" class="headerlink" title="13.7.2、对于服务消费方："></a>13.7.2、对于服务消费方：</h5><p>主启动类激活@EnableHystrix</p>
<p>业务类</p>
<p><img src="/2021/03/15/springcloud/29.png" alt="img"></p>
<h5 id="13-7-3、目前问题"><a href="#13-7-3、目前问题" class="headerlink" title="13.7.3、目前问题"></a>13.7.3、目前问题</h5><ul>
<li>每个业务方法对应一个兜底的方法,代码膨胀</li>
<li>统一和自定义的分开</li>
</ul>
<p>解决方法：</p>
<ul>
<li><p>解决第一个问题：代码膨胀</p>
<p>feign接口系列</p>
<p>@DefaultProperties(defaultFallback=””)</p>
<p>每个方法配置一个服务降级方法，技术上可以，实际上导致代码膨胀。</p>
<p>除了个别重要核心业务有专属，其它普通的可以通过</p>
<p>@DefaultProperties(defaultFallback =”)统一跳转到统一处理结果页面</p>
<p><strong>通用的和独享的各自分开，避免了代码膨胀，合理减少了代码量</strong>。</p>
<p><img src="/2021/03/15/springcloud/30.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/31.png" alt="img"> </p>
</li>
<li><p>解决第二个问题：和业务逻辑混在一起</p>
<p>服务降级,客户端去调用服务端,碰上服务端宕机或关闭。只需要为Feign客户</p>
<p>端定义的接口添加一个服务降级处理的实现类即可实现解耦。</p>
<p>我们可能面临的异常：</p>
<ul>
<li>运行</li>
<li>超时</li>
<li>宕机</li>
</ul>
<p>重新新建一个类(PaymentFallbackService)实现PaymentHystrixService接</p>
<p>口（OpenFeign的服务接口）,<strong>统一为接口里面的方法进行异常处理</strong></p>
<p><img src="/2021/03/15/springcloud/32.png" alt="img"> </p>
<p>PaymentHystrixService接口:</p>
<p><img src="/2021/03/15/springcloud/springcloud%5C211.png" alt="image-20210315011150047"></p>
</li>
</ul>
<h4 id="13-8、服务熔断"><a href="#13-8、服务熔断" class="headerlink" title="13.8、服务熔断"></a>13.8、服务熔断</h4><h5 id="13-8-1、是什么？"><a href="#13-8-1、是什么？" class="headerlink" title="13.8.1、是什么？"></a>13.8.1、是什么？</h5><p><a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/CircuitBreaker.html">https://martinfowler.com/bliki/CircuitBreaker.html</a></p>
<p>熔断机制概述</p>
<p>熔断机制是应对雪崩效应的一种微服务链路保护机制。当扇出链路的某个微服务</p>
<p>出错不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的</p>
<p>调用，快速返回错误的响应信息。</p>
<p>当<strong>检测到该节点微服务调用响应正常后，恢复调用链路</strong>。</p>
<p>在Spring Cloud框架里，熔断机制通过Hystrix实现。Hystrix会监控微服务间调</p>
<p>用的状况，当失败的调用到一定國值，缺省是5秒内20次调用失败，就会启动熔</p>
<p>断机制。熔断机制的注解是@HystrixCommand。</p>
<h5 id="12-8-2、服务熔断的注解-HystrixCommand-Service层"><a href="#12-8-2、服务熔断的注解-HystrixCommand-Service层" class="headerlink" title="12.8.2、服务熔断的注解@HystrixCommand(Service层)"></a>12.8.2、服务熔断的注解@HystrixCommand(Service层)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),// 是否开启断路器</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),// 请求次数</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;), // 时间窗口期</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;),// 失败率达到多少后跳闸</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br></pre></td></tr></table></figure>

<h5 id="12-8-3、大神结论"><a href="#12-8-3、大神结论" class="headerlink" title="12.8.3、大神结论"></a>12.8.3、大神结论</h5><p><img src="/2021/03/15/springcloud/33.png" alt="img"> </p>
<p>熔断类型：</p>
<ul>
<li><p>熔断打开（Open）：</p>
<p>请求不再调用当前服务,内部设置一般为MTTR(平均故障处理时间),当打开长达导所设时钟则进入半熔断状态</p>
</li>
<li><p>熔断关闭（Closed）：</p>
<p>熔断关闭后不会对服务进行熔断</p>
</li>
<li><p>熔断半开（Half Open）：</p>
<p>部分请求根据规则调用当前服务,如果请求成功且符合规则则认为当前服务恢复正常,关闭熔断</p>
</li>
</ul>
<h5 id="12-8-4、断路流程图"><a href="#12-8-4、断路流程图" class="headerlink" title="12.8.4、断路流程图"></a>12.8.4、断路流程图</h5><p><img src="/2021/03/15/springcloud/34.png" alt="img"> </p>
<p>步骤：</p>
<p><img src="/2021/03/15/springcloud/35.png" alt="img"> </p>
<p>断路器在什么情况下开始起作用 </p>
<p><img src="/2021/03/15/springcloud/36.png" alt="image-20210310003224243"></p>
<p>涉及到断路器的三个重要参数：<strong>快照时间窗、请求总数阀值、错误百分比</strong></p>
<p><strong>阀值</strong></p>
<ul>
<li><p>快照时间窗：断路器确定是否打开需要统计一些请求和错误数据，而统</p>
<p>计的时间范围就是快照时间窗，默认为最近的10秒。</p>
</li>
<li><p>请求总数阀值：在快照时间窗内，必须满足请求总数阀值才有资格熔</p>
<p>断。默认为20，意味着在10秒内，如果该hystrix命令的调用次数不足</p>
<p>20次，即使所有的请求都超时或其他原因失败，断路器都不会打开。</p>
</li>
<li><p>错误百分比阀值：当请求总数在快照时间窗内超过了阀值，比如发生了</p>
<p>30次调用，如果在这30次调用中，有15次发生了超时异常，也就是超</p>
<p>过50%的错误百分比，在默认设定50%阀值情况下，这时候就会将断路</p>
<p>器打开。</p>
</li>
</ul>
<p>断路器开启或者关闭的条件:</p>
<ol>
<li><p>当满足一定的阈值的时候(默认10秒钟超过20个请求次数)</p>
</li>
<li><p>当失败率达到一定的时候(默认10秒内超过50%的请求次数)</p>
</li>
<li><p>到达以上阈值,断路器将会开启</p>
</li>
<li><p>当开启的时候,所有请求都不会进行转发</p>
</li>
<li><p>一段时间之后(默认5秒),这个时候断路器是半开状态,会让其他一个请求</p>
<p>进行转发. 如果成功,断路器会关闭,若失败,继续开启.重复4和5</p>
</li>
</ol>
<p>断路器打开之后:</p>
<ol>
<li><p>再有请求调用的时候，将不会调用主逻辑，而是直接调用降级</p>
<p>fallback。通过断路器，实现了自动地发现错误并将降级逻辑切换为主</p>
<p>逻辑，减少响应延迟的效果。</p>
</li>
<li><p>原来的主逻辑要如何恢复呢？</p>
<p>对于这一问题，hystrix也为我们实现了自动恢复功能。</p>
<p>当断路器打开，对主逻辑进行熔断之后，hystrix会启动一个休眠时间</p>
<p>窗，在这个时间窗内，降级逻辑是临时的成为主逻辑，当休眠时间窗到</p>
<p>期，断路器将进入半开状态，释放一次请求到原来的主逻辑上，如果此</p>
<p>次请求正常返回，那么断路器将继续闭合，主逻辑恢复，如果这次请求</p>
<p>依然有问题，断路器继续进入打开状态，休眠时间窗重新计时。 </p>
</li>
</ol>
<p>ALL配置：</p>
<p><img src="/2021/03/15/springcloud/37.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/38.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/39.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/40.png" alt="img"> </p>
<h4 id="13-9、服务限流"><a href="#13-9、服务限流" class="headerlink" title="13.9、服务限流"></a>13.9、服务限流</h4><p>alibaba的Sentinel说明</p>
<h4 id="13-10、Hystrix的工作流程"><a href="#13-10、Hystrix的工作流程" class="headerlink" title="13.10、Hystrix的工作流程"></a>13.10、Hystrix的工作流程</h4><p><a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix/wiki/How-it-Works">https://github.com/Netflix/Hystrix/wiki/How-it-Works</a></p>
<p>官网图例</p>
<p><img src="/2021/03/15/springcloud/41.png" alt="img"> </p>
<p>步骤说明</p>
<p><img src="/2021/03/15/springcloud/42.png" alt="img"> </p>
<h4 id="13-11、服务监控hystrixDashboard"><a href="#13-11、服务监控hystrixDashboard" class="headerlink" title="13.11、服务监控hystrixDashboard"></a>13.11、服务监控hystrixDashboard</h4><h5 id="13-11-1、概述"><a href="#13-11-1、概述" class="headerlink" title="13.11.1、概述"></a>13.11.1、概述</h5><p> 除了隔离依赖服务的调用以外，Hystrix还提供了<strong>准实时的调用监控</strong></p>
<p>**(Hystrix Dashboard)**，Hystrix会持续地记录所有通过Hystrix发起的请求</p>
<p>的执行信息，并以统计报表和图形的形式展示给用户，包括每秒执行多少</p>
<p>请求多少成功，多少失败等。Netflix通过hystrix-metrics-event-stream项</p>
<p>目实现了对以上指标的监控。Spring Cloud也提供了Hystrix Dashboard的</p>
<p>整合，对监控内容转化成可视化界面。</p>
<h5 id="13-11-2、依赖"><a href="#13-11-2、依赖" class="headerlink" title="13.11.2、依赖"></a>13.11.2、依赖</h5><p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="13-11-3、步骤"><a href="#13-11-3、步骤" class="headerlink" title="13.11.3、步骤"></a>13.11.3、步骤</h5><ol>
<li><p>主启动类加注解激活@EnableHystrixDashboard</p>
</li>
<li><p>所有Provider微服务提供类都需要监控依赖部署</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>
</li>
<li><p>访问网址<a target="_blank" rel="noopener" href="http://localhost:9001/hystrix%EF%BC%889001%E4%B8%BA%E7%AB%AF%E5%8F%A3%E5%90%8D%EF%BC%89">http://localhost:9001/hystrix（9001为端口名）</a></p>
</li>
</ol>
<h5 id="13-11-4、断路器演示-服务监控hystrixDashboard"><a href="#13-11-4、断路器演示-服务监控hystrixDashboard" class="headerlink" title="13.11.4、断路器演示(服务监控hystrixDashboard)"></a>13.11.4、断路器演示(服务监控hystrixDashboard)</h5><p>新版本Hystrix需要在主启动MainAppHystrix8001（微服务提供方）中指</p>
<p>定监控路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentHystrixMain8001</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *此配置是为了服务监控而配置，与服务容错本身无关，springcloud升级后的坑</span></span><br><span class="line"><span class="comment">     *ServletRegistrationBean因为springboot的默认路径不是&quot;/hystrix.stream&quot;，</span></span><br><span class="line"><span class="comment">     *只要在自己的项目里配置上下面的servlet就可以了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">getServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HystrixMetricsStreamServlet streamServlet = <span class="keyword">new</span> HystrixMetricsStreamServlet();</span><br><span class="line">        ServletRegistrationBean registrationBean = <span class="keyword">new</span> ServletRegistrationBean(streamServlet);</span><br><span class="line">        registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        registrationBean.addUrlMappings(<span class="string">&quot;/hystrix.stream&quot;</span>);</span><br><span class="line">        registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动一个eureka或者3个eureka集群进行监控测试</p>
<p>填写监控地址<a target="_blank" rel="noopener" href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a></p>
<p><img src="/2021/03/15/springcloud/43.png" alt="img"> </p>
<h5 id="13-11-5、如何看hystrixDashboard服务监控图"><a href="#13-11-5、如何看hystrixDashboard服务监控图" class="headerlink" title="13.11.5、如何看hystrixDashboard服务监控图"></a>13.11.5、如何看hystrixDashboard服务监控图</h5><ul>
<li><p>七色</p>
<p><img src="/2021/03/15/springcloud/44.png" alt="img"> </p>
</li>
<li><p>一圈：</p>
<p>实心圆：共有两种含义。它通过颜色的变化代表了实例的健康程度，它</p>
<p>的健康度从绿色&lt;黄色&lt;橙色&lt;红色递减。</p>
<p>该实心圆除了颜色的变化之外，它的大小也会根据实例的请求流量发生</p>
<p>变化，流量越大该实心圆就越大。所以通过该实心圆的展示，就可以在</p>
<p>大量的实例中快速的发现<strong>故障实例和高压力实例</strong>。 </p>
</li>
<li><p>一线：</p>
<p>曲线：用来记录2分钟内流量的相对变化，可以通过它来观察到流量的上升与下降趋势 </p>
</li>
<li><p>整图说明：</p>
<p><img src="/2021/03/15/springcloud/45.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/Users/风间&琉璃/AppData/Local/Temp/mindmaster/1223393c341/bin/DF646587-C4E1-40BF-9FFD-7D10773D9637.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/46.png" alt="img"> </p>
</li>
<li><p>搞懂一个才能看懂复杂的</p>
<p><img src="/2021/03/15/springcloud/47.png" alt="img"> </p>
</li>
</ul>
<h2 id="路由网关"><a href="#路由网关" class="headerlink" title="路由网关"></a>路由网关</h2><h3 id="14、Gateway新一代网关"><a href="#14、Gateway新一代网关" class="headerlink" title="14、Gateway新一代网关"></a>14、Gateway新一代网关</h3><h4 id="14-1、是什么？"><a href="#14-1、是什么？" class="headerlink" title="14.1、是什么？"></a>14.1、是什么？</h4><p>一句话：</p>
<p>SpringCloud Gateway使用的是Webflux中的reactor-netty响应式编程组</p>
<p>件,底层使用了Netty通讯框架。</p>
<p><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</a></p>
<p>Cloud全家桶中有个很重要的组件就是网关，在1.x版本中都是采用的Zuul</p>
<p>网关；但在2.x版本中，zuul的升级一直跳票，SpringCloud最后自己研发</p>
<p>了一个网关替代Zuul，那就是SpringCloud Gateway一句话：</p>
<p><strong>gateway是原zuul1.x版的替代</strong> </p>
<p><img src="/2021/03/15/springcloud/48.png" alt="img"> </p>
<p>Gateway是在Spring生态系统之上构建的API网关服务，基于Spring </p>
<p>5,Spring Boot 2和Project Reactor等技术。</p>
<p>Gateway旨在提供一种简单而有效的方式来对API进行路由，以及提供一些</p>
<p>强大的过滤器功能，例如：熔断、限流、重试等</p>
<p><img src="/2021/03/15/springcloud/49.png" alt="image-20210310010754927"></p>
<p>SpringCloud Gateway 是 Spring Cloud 的一个全新项目，基于 Spring </p>
<p>5.0+Spring Boot 2.0 和 Project Reactor 等技术开发的网关，它旨在为微</p>
<p>服务架构提供一种简单有效的统一的API路由管理方式。 </p>
<p>SpringCloud Gateway 作为 Spring Cloud 生态系统中的网关，目标是替代 </p>
<p>Zuul，在Spring Cloud 2.0以上版本中，没有对新版本的Zuul 2.0以上最新</p>
<p>高性能版本进行集成，仍然还是使用的Zuul 1.x非Reactor模式的老版本。</p>
<p>而为了提升网关的性能，SpringCloud Gateway是基于WebFlux框架实现</p>
<p>的，而WebFlux框架底层则使用了高性能的Reactor模式通信框架Netty。</p>
<p>Spring Cloud Gateway的目标提供统一的路由方式且基于 Filter 链的方式</p>
<p>提供了网关基本的功能，例如：安全，监控/指标，和限流。</p>
<p> 源码架构：</p>
<p><img src="/2021/03/15/springcloud/50.png" alt="img"> </p>
<h4 id="14-2、作用"><a href="#14-2、作用" class="headerlink" title="14.2、作用"></a>14.2、作用</h4><ul>
<li>反向代理</li>
<li>鉴权</li>
<li>流量控制</li>
<li>熔断</li>
<li>日志监控</li>
<li>……</li>
</ul>
<h4 id="14-3、微服务架构中网关在哪里"><a href="#14-3、微服务架构中网关在哪里" class="headerlink" title="14.3、微服务架构中网关在哪里"></a>14.3、微服务架构中网关在哪里</h4><p><img src="/2021/03/15/springcloud/51.png" alt="img"> </p>
<h4 id="14-4、Zool与Gateway"><a href="#14-4、Zool与Gateway" class="headerlink" title="14.4、Zool与Gateway"></a>14.4、Zool与Gateway</h4><ol>
<li><p>一方面因为Zuul1.0已经进入了维护阶段，而且Gateway是</p>
<p>Spring Cloud团队研发的，是亲儿子产品，值得信赖。而且很多功能</p>
<p>Zuul都没有用起来也非常的简单便捷。</p>
</li>
</ol>
<p>   Gateway是基于异步非阻塞模型上进行开发的，性能方面不需要担</p>
<p>   心。虽然Netfix早就发布了最新的Zuul 2.x，但 Spring Cloud貌似没有</p>
<p>   整合计划。而且Netflix相关组件都宣布进入维护期；不知前景如何？</p>
<p>   多方面综合考虑Gateway是很理想的网关选择。</p>
<ol start="2">
<li><p>Spring Cloud Gateway 具有如下特性：</p>
<p><strong>基于Spring Framework 5,Project Reactor和 Spring Boot 2.0 进行构建</strong>； </p>
<ul>
<li>动态路由：能够匹配任何请求属性；</li>
<li>可以对路由指定 Predicate (断言)和 Filter (过滤器)；</li>
<li>集成Hystrix的断路器功能；</li>
<li>集成 Spring Cloud 服务发现功能；</li>
<li>易于编写的Predicate (断言)和Filter (过滤器)；</li>
<li>请求限流功能；</li>
<li>支持路径重写。</li>
</ul>
</li>
<li><p>Spring Cloud Gateway 与 Zuul的区别:</p>
<p>在SpringCloud <strong>F</strong>inchley正式版之前，Spring Cloud 推荐的网关是 </p>
<p>Netflix 提供的Zuul:</p>
<ul>
<li><p>Zuul 1.x，是一个基于阻塞I/O的API Gateway</p>
</li>
<li><p>Zuul 1.x 基于<strong>Servlet 2.5</strong>使用阻塞架构，它不支持任何长连接(如 </p>
<p>WebSocket)。 Zuul 的设计模式和Nginx较像，每次I/ O 操作都</p>
<p>是<strong>从工作线程中选择一个执行</strong>，请求线程<strong>被阻塞到工作线程完成</strong>，</p>
<p>但是差别是:Nginx 用C++ 实现，Zuul 用 Java 实现，而 JVM 本身</p>
<p>会有第一次加载较慢的情况，使得Zuul的性能相对较差。</p>
</li>
<li><p>Zuul 2.x理念更先进，想<strong>基于Netty非阻塞和支持长连接</strong>，但</p>
<p>SpringCloud目前还没有整合。Zuul 2.x的性能较 Zuul 1.x有较大提升。在性能方面，根据官方提供的基准测试，Spring Cloud Gateway的RPS(每秒请求数)是Zuul的1.6倍。</p>
</li>
<li><p>Spring Cloud Gateway 建立在 <strong>Spring Framework 5、Project</strong> </p>
<p><strong>Reactor和 Spring Boot 2</strong>之上，使用<strong>非阻塞API</strong>。</p>
</li>
<li><p>Spring Cloud Gateway 还支持WebSocket，并且与Spring紧密集</p>
<p>成拥有更好的开发体验。</p>
</li>
</ul>
</li>
<li><p>springcloud中所集成的Zuul版本，采用的是Tomcat容器，使用的是传</p>
<p>统的Servlet IO处理模型。</p>
<p>Servlet的生命周期：servlet由servlet container进行生命周期管理。</p>
<ul>
<li><p>container启动时构造servlet对象并调用servlet init()进行初始化；</p>
</li>
<li><p>container运行时接受请求，并为每个请求分配一个线程(一般从线</p>
<p>程池中获取空闲线程)然后调用service();</p>
</li>
<li><p>container关闭时调用servlet destory()销毁servlet;</p>
</li>
</ul>
<p><img src="/2021/03/15/springcloud/52.png" alt="image-20210310012934921"></p>
</li>
<li><p>上述模式的缺点：</p>
<p>servlet是一个<strong>简单的网络IO模型</strong>，当请求进入servlet container时，</p>
<p>servlet container就会为其绑定一个线程，在<strong>并发不高的场景</strong>下这种模</p>
<p>型是适用的。但是一旦高并发(比如抽风用jemeter压)，线程数量就会</p>
<p>上涨，而线程资源代价是昂贵的(<strong>上线文切换，内存消耗大</strong>)严重影响请</p>
<p>求的处理时间。在一些简单业务场景下，不希望为每个request分配一</p>
<p>个线程，只需要1个或几个线程就能应对极大并发的请求，这种业务场</p>
<p>景下servlet模型没有优势。</p>
<p>而Zuul 1.X是<strong>基于servlet之上的一个阻塞式处理模型</strong>，即spring实现</p>
<p>了处理所有request请求的一个servlet(DispatcherServlet)并由该</p>
<p>servlet阻塞式处理处理。所以Springcloud Zuul无法摆脱servlet模型</p>
<p>的弊端。</p>
</li>
<li><p>WebFlux：</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#spring-webflux">https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#spring-webflux</a></p>
<p><img src="/2021/03/15/springcloud/53.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/54.png" alt="img"> </p>
<p>传统的Web框架，此如说：struts2，springmvc等都是基于Servlet </p>
<p>API与Servlet容器基础之上运行的。</p>
<p>但是，<strong>在Servlet3.1之后有了异步非阻赛的支持</strong>。而WebFlux是一个典</p>
<p>型非阻塞异步的框架，它的核心是基于Reactor的相关API实现的。相</p>
<p>对于传统的web框架来说，它可以运行在诸如Netty，Undertow及支</p>
<p>持Servlet3.1的容器上。非阻塞式+函数式编程(Spring5必须让你使用</p>
<p>java8)</p>
<p>Spring WebFlux 是Spring 5.0 引入的新的响应式框架，区别于 Spring </p>
<p>MVC，它不需要依赖Servlet API，它是<strong>完全异步非阻塞的</strong>，并且<strong>基于</strong> </p>
<p><strong>Reactor 来实现响应式流规范</strong>。</p>
<h4 id="14-5、三大核心概念"><a href="#14-5、三大核心概念" class="headerlink" title="14.5、三大核心概念"></a>14.5、三大核心概念</h4></li>
</ol>
<ul>
<li><p>Route(路由)：</p>
<p>路由是构建网关的基本模块,它由ID,目标URI,一系列的断言和过滤器组</p>
<p>成,如断言为true则匹配该路由。</p>
</li>
<li><p>Predicate(断言)：</p>
<p>参考的是Java8的java.util.function.Predicate</p>
<p>开发人员可以匹配HTTP请求中的所有内容(例如请求头或请求参数),如</p>
<p>果请求与断言相匹配则进行路由。</p>
</li>
<li><p>Filter(过滤)：</p>
<p>指的是Spring框架中GatewayFilter的实例,使用过滤器,可以在请求被路</p>
<p>由前或者之后对请求进行修改。</p>
</li>
</ul>
<p>web请求，通过一些匹配条件，定位到真正的服务节点。并在这个转发过</p>
<p>程的前后，进行一些精细化控制。</p>
<p>predicate就是我们的匹配条件；而filter，就可以理解为一个无所不能的拦截器。有了这两个元素，再加上目标uri，就可以实现一个具体的路由了。</p>
<p><img src="/2021/03/15/springcloud/55.png" alt="image-20210310014051292"> </p>
<h4 id="14-6、Gateway工作流程（路由转发-执行过滤器链）"><a href="#14-6、Gateway工作流程（路由转发-执行过滤器链）" class="headerlink" title="14.6、Gateway工作流程（路由转发+执行过滤器链）"></a>14.6、Gateway工作流程（路由转发+执行过滤器链）</h4><p>官网总结</p>
<p><img src="/2021/03/15/springcloud/56.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/Users/风间&琉璃/AppData/Local/Temp/mindmaster/1223393c341/bin/3008859F-0E2E-4542-92C5-A049333E2AC6.png" alt="img"> </p>
<p>客户端向Spring Cloud Gateway发出请求。然后在Gateway Handler </p>
<p>Mapping中找到与请求相匹配的路由，将其发送到Gateway Web </p>
<p>Handler。</p>
<p>Handler 再通过指定的过滤器链来将请求发送到我们实际的服务执行业务</p>
<p>逻辑，然后返回。</p>
<p>过滤器之间用虚线分开是因为过滤器可能会在发送代理请求之前(“pre”)或之</p>
<p>后(“post”)执行业务逻辑。</p>
<p>Filter在“pre”类型的过滤器可以做参数校验、权限校验、流量监控、日志输</p>
<p>出、协议转换等，</p>
<p>在“post”类型的过滤器中可以做响应内容、响应头的修改，日志的输出，流</p>
<p>量监控等有着非常重要的作用。</p>
<h4 id="14-7、依赖"><a href="#14-7、依赖" class="headerlink" title="14.7、依赖"></a>14.7、依赖</h4><p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.yml配置：</p>
<p><img src="/2021/03/15/springcloud/57.png" alt="img"></p>
<p>访问：</p>
<p>添加网关前：<a target="_blank" rel="noopener" href="http://localhost:8001/payment/get/31">http://localhost:8001/payment/get/31</a></p>
<p>添加网关后：<a target="_blank" rel="noopener" href="http://localhost:9527/payment/get/31">http://localhost:9527/payment/get/31</a></p>
<h4 id="14-8、Gateway网关路由有两种配置方式"><a href="#14-8、Gateway网关路由有两种配置方式" class="headerlink" title="14.8、Gateway网关路由有两种配置方式"></a>14.8、Gateway网关路由有两种配置方式</h4><p>1、在配置文件yml中配置</p>
<p>2、代码中注入RouteLocator的Bean</p>
<p>示例：</p>
<p>百度国内新闻网站,需要外网<a target="_blank" rel="noopener" href="https://news.baidu.com/guonei">https://news.baidu.com/guonei</a></p>
<p>业务需求：通过9527网关访问到外网的百度新闻网址</p>
<p>实现：在cloud-gateway-gateway9527编写配置类</p>
<p><img src="/2021/03/15/springcloud/58.png" alt="img"> </p>
<p><img src="/2021/03/15/springcloud/59.png" alt="img"> </p>
<h4 id="14-9、通过服务名实现动态"><a href="#14-9、通过服务名实现动态" class="headerlink" title="14.9、通过服务名实现动态"></a>14.9、通过服务名实现动态</h4><p>默认情况下Gatway会根据注册中心注册的服务列表,  以注册中心上微服务</p>
<p>名为路径<strong>创建动态路由进行转发,从而实现动态路由的功能</strong>。</p>
<p>启动：一个eureka+两个服务提供者</p>
<p>application.yml配置：</p>
<p>需要注意的是uri的协议lb,表示启用Gateway的负载均衡功能。</p>
<p>lb://serverName是spring cloud  gatway在微服务中自动为我们创建的负载均衡uri</p>
<p><img src="/2021/03/15/springcloud/209.png" alt="img"> </p>
<h4 id="14-10、Predicate（断言）"><a href="#14-10、Predicate（断言）" class="headerlink" title="14.10、Predicate（断言）"></a>14.10、Predicate（断言）</h4><p>说白了,Predicate就是为了实现一组匹配规则,  让请求过来找到对应的</p>
<p>Route进行处理。</p>
<p>Spring Cloud Gateway将路由匹配作为Spring WebFlux HandlerMapping</p>
<p>基础架构的一部分。</p>
<p>Spring Cloud Gateway包括许多内置的Route PredicateI工厂。所有这些</p>
<p>Predicate都与HTTP请求的不同属性匹配。多个RoutePredicate工厂可以</p>
<p>进行组合。</p>
<p>Spring Cloud Gateway 创建 Route 对象时，使用 RoutePredicateFactory</p>
<p>创建 Predicate 对象，Predicate 对象可以赋值给Route。Spring Cloud </p>
<p>Gateway 包含许多内置的Route Predicate Factories。</p>
<p>所有这些谓词都匹配HTTP请求的不同属性。多种谓词工厂可以组合，并通</p>
<p>过逻辑and。</p>
<p><img src="/2021/03/15/springcloud/60.png" alt="img">  </p>
<p>常用的Route Predicate</p>
<p><img src="/2021/03/15/springcloud/61.png" alt="img"> </p>
<ul>
<li><p>After Route Predicate：在设置时间之后</p>
</li>
<li><p>Before Route Predicate：在设置时间之前</p>
</li>
<li><p>Between Route Predicate：在设置时间中间</p>
</li>
<li><p>Cookie Route Predicate：请求要带有cookie</p>
</li>
<li><p>Header Route Predicate：请求要带有请求头，且请求头的值要符合要求</p>
</li>
<li><p>Host Route Predicate：要使用符合要求的主机进行访问</p>
</li>
<li><p>Method Route Predicate：请求方式要是符合要求</p>
</li>
<li><p>Path Route Predicate：路径相匹配的进行路由</p>
</li>
<li><p>Query Route Predicate：要有参数名并且值还要是符合要求的才能路由</p>
</li>
<li><p>RemoteAddr Route Predicate：通过无类别域间路由(IPv4 or IPv6)列</p>
<p>表匹配路由（- RemoteAddr=192.168.1.1/24）(不常用)</p>
</li>
<li><p>Weight Route Predicate：接收一个[组名,权重], 然后对于同一个组内</p>
<p>的路由按照权重转发（-Weight= group3, 9）（不常用）</p>
</li>
</ul>
<p>application.yml配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#开启从注册中心动态创建路由的功能，利用微服务名进行路由</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment">#payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名</span></span><br><span class="line">          <span class="comment">#uri: http://localhost:8001          #匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span> <span class="comment">#匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span>         <span class="comment"># 断言，路径相匹配的进行路由</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span> <span class="comment">#payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名</span></span><br><span class="line">          <span class="comment">#uri: http://localhost:8001          #匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span> <span class="comment">#匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>         <span class="comment"># 断言，路径相匹配的进行路由</span></span><br><span class="line">            <span class="comment">#- After=2021-03-09T01:19:24.226+08:00[Asia/Shanghai]</span></span><br><span class="line">            <span class="comment">#- Before=2021-03-09T01:19:24.226+08:00[Asia/Shanghai]</span></span><br><span class="line">            <span class="comment">#- Between=2021-03-09T01:19:24.226+08:00[Asia/Shanghai],2022-03-09T01:19:24.226+08:00[Asia/Shanghai]</span></span><br><span class="line">            <span class="comment">#- Cookie=username,xgh #请求要带有cookie（URL + -- cookie &quot;username=xgh&quot;）</span></span><br><span class="line">            <span class="comment">#- Header=X-Request-Id, \d+  # 请求头要有X-Request-Id属性并且值为整数的正则表达式（URL + --H &quot;X-Request-Id:123&quot;）</span></span><br><span class="line">            <span class="comment">#- Host=**.atguigu.com #主机要带有atguigu.com</span></span><br><span class="line">            <span class="comment">#- Method=GET #请求方式要是get</span></span><br><span class="line">            <span class="comment">#- Query=username,\d+ #要有参数名并且值还要是整数的才能路由</span></span><br><span class="line">          <span class="comment">#filters:</span></span><br><span class="line">            <span class="comment">#- AddRequestHeader=X-Request-Id,1024 #过滤器工厂会在匹配的请求头上加上一对请求头，名称为X-Request-Id，值为1024</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">gateway9527</span></span><br><span class="line">    <span class="comment">#访问路径可以显示IP地址</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#服务提供者provider注册进eureka服务列表内</span></span><br><span class="line">    <span class="comment">#表示是否将自己注册进EurekaServer默认为true。</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#单机版</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">      <span class="comment"># 集群版</span></span><br><span class="line">      <span class="comment">#defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="14-11、Filter（过滤器）"><a href="#14-11、Filter（过滤器）" class="headerlink" title="14.11、Filter（过滤器）"></a>14.11、Filter（过滤器）</h4><h5 id="14-11-1、是什么？"><a href="#14-11-1、是什么？" class="headerlink" title="14.11.1、是什么？"></a>14.11.1、是什么？</h5><p>路由过滤器可用于修改进入的HTTP请求和返回的HTTP响应，路由过滤器</p>
<p>只能指定路由进行使用。</p>
<p>Spring Cloud Gateway内置了多种路由过滤器，他们都由GatewayFilter的</p>
<p>工厂类来产生。</p>
<p><img src="/2021/03/15/springcloud/62.png" alt="image-20210310021404546"> </p>
<h5 id="14-11-2、生命周期"><a href="#14-11-2、生命周期" class="headerlink" title="14.11.2、生命周期"></a>14.11.2、生命周期</h5><ul>
<li>post</li>
<li>pre</li>
</ul>
<h5 id="14-11-3、种类"><a href="#14-11-3、种类" class="headerlink" title="14.11.3、种类"></a>14.11.3、种类</h5><ul>
<li>GatewayFilter（31种）：<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories</a></li>
<li>GlobalFilter（10种）：<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#global-filters">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#global-filters</a></li>
</ul>
<p>常用的GatewayFilter：</p>
<p>在yml里面配置：</p>
<p><img src="/2021/03/15/springcloud/63.png" alt="img"> </p>
<p>自定义过滤器：</p>
<p>自定义全局GlobalFilter</p>
<p>两个主要接口</p>
<ul>
<li><p>GlobalFilter</p>
</li>
<li><p>Ordered</p>
</li>
</ul>
<p>作用：</p>
<ul>
<li>全局日志记录</li>
<li>统一网关鉴权</li>
</ul>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyGateWayFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;**************come in MylogGateWayGilter:  &quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">        String uname = exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (uname == <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;********用户名为空，非法用户。&quot;</span>);</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截的级别，值越小，级别越大</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分布式配置中心"><a href="#分布式配置中心" class="headerlink" title="分布式配置中心"></a>分布式配置中心</h2><h3 id="15、SpringCloud-config"><a href="#15、SpringCloud-config" class="headerlink" title="15、SpringCloud config"></a>15、SpringCloud config</h3><h4 id="15-1、分布式系统面临的问题"><a href="#15-1、分布式系统面临的问题" class="headerlink" title="15.1、分布式系统面临的问题"></a>15.1、分布式系统面临的问题</h4><p>配置问题：</p>
<p>到目前为止，我们对 Eureka、Robbin、OpenFeign、Hystrix、Gateway</p>
<p>等有了相应的了解，每个微服务都是单独一个模块，微服务彼此还支持集群</p>
<p>环境。</p>
<p>但是在微服务项目的开发中，还面临着一个严重的配置问题。每一个微服务</p>
<p>都需要一个配置文件，如果有几个微服务需要连接数据库，name就需要进</p>
<p>行 4 次数据库的配置。当数据库发生改变，那么就需要同时修改 4 个微服</p>
<p>务的配置文件才可以。那么如果有40台呢？如果是集群模式呢？？</p>
<p>如果能够做到：一处修改、处处生效，这样就可以减轻修改配置压力，从而</p>
<p>增强配置管理方面的功能，此时就需要 Spring Cloud Config 和 Spring </p>
<p>Cloud Bus 上场了。</p>
<p>使用 Config + Bus，可以实现 ：</p>
<ul>
<li><p>一处修改、处处生效</p>
</li>
<li><p>灵活的对版本(dev/test/prod)进行切换，这样就足够方便了</p>
</li>
</ul>
<p><img src="/2021/03/15/springcloud/64.png" alt="img"></p>
<h4 id="15-2、是什么："><a href="#15-2、是什么：" class="headerlink" title="15.2、是什么："></a>15.2、是什么：</h4><p><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/</a></p>
<p>Springcloud config为微服务架构中的微服务提供集中化的外部配置支持，</p>
<p>配置服务器为各个不同微服务应用的所有环境提供一个中心化的外部配</p>
<p>置。各个不同微服务应用 Springcloud config为微服务架构中的微服务提</p>
<p>供集中化的外部配置支持，配置服务器为各个不同微服务应用的所有环境</p>
<p>提供一个中心化的外部配置。中心化的外部配置。</p>
<h4 id="15-3、怎么用："><a href="#15-3、怎么用：" class="headerlink" title="15.3、怎么用："></a>15.3、怎么用：</h4><p>Springcloud Config分为<strong>服务端</strong>和<strong>客户端</strong>两部分。</p>
<ul>
<li><p>服务端（Config Server）：也称分布式配置中心，它是一个独立的微服</p>
<p>务应用，用来连接配置服务器并未客户端提供获取配置信息，加密、解</p>
<p>密信息等访问接口。</p>
</li>
<li><p>客户端：通过指定的 <strong>配置中心(Config Server)</strong> 来管理应用资源，以及与业务相关的配置内容，并在启动的时候从 <strong>配置中心</strong> 获取和加载配置信息。</p>
</li>
</ul>
<h4 id="15-4、作用"><a href="#15-4、作用" class="headerlink" title="15.4、作用"></a>15.4、作用</h4><ul>
<li><p>集中管理配置文件</p>
</li>
<li><p>不同环境不同配置，动态化的配置更新，分环境部署比如</p>
<p>dev/test/prod/beta/release</p>
</li>
<li><p>运行期间动态调整配置，不再需要字啊每个服务器的机器上编写配置文</p>
<p>件，服务会向配置中心同意拉去配置自己的信息</p>
</li>
<li><p>当配置发生变动时，服务不需要重启即可感知到配置的变化并应用新的</p>
<p>配置</p>
</li>
<li><p>将配置信息以REST接口的形式暴露</p>
<ul>
<li>post,curl访问刷新均可</li>
</ul>
</li>
</ul>
<h4 id="15-5、与GitHub整合配置"><a href="#15-5、与GitHub整合配置" class="headerlink" title="15.5、与GitHub整合配置"></a>15.5、与GitHub整合配置</h4><p>由于SpringCloud Config默认使用Git来存储配置文件（也有其他方式，比</p>
<p>如注册SVN和本地文件），但最推荐的还是Git，而且使用的是http/https服</p>
<p>务的形式。</p>
<p>步骤：</p>
<ol>
<li><p>创建存储 Config 的新 Repository</p>
</li>
<li><p>将新建的GitHub远程仓库克隆到本地</p>
<p>Repository 创建成功，即可获取自己的仓库地址，将项目克隆到本</p>
<p>地，方便对数据的修改。（GitHub 也支持直接修改，你也可以不克</p>
<p>隆，此处克隆只是为了更方便处理数据。）</p>
</li>
<li><p>进入克隆目录，新建三个配置文件，分别是 <strong><code>config-dev.yml</code>**、</strong><code>config-test.yml</code><strong>、</strong><code>config-prod.yml</code>**。然后通过命令将其推送到远程GitHub仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add *.yml(将提交的文件加入暂存区，为git commit做准备)</span><br><span class="line">git commit -m “first commit” (完成对文件内容提交至Git版本库)</span><br><span class="line">git push -u origin master(将本地仓库内容，推送至GitHub远程仓库)</span><br></pre></td></tr></table></figure>
</li>
<li><p>对配置修改后，通过以上三个命令，便可以再次将修改后的内容推送至 GitHub。你也可以使用 IDEA 等工具进行</p>
<p><img src="/2021/03/15/springcloud/69.png" alt="在这里插入图片描述"></p>
</li>
<li><p>Github 远程仓库内容</p>
<p><img src="/2021/03/15/springcloud/70.png" alt="在这里插入图片描述"></p>
</li>
<li><p><strong>服务端</strong>配置测试 (Config 结构图中的 <strong>Config Server</strong>)</p>
<p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入spring-cloud-config-server依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置文件 application.yml：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3344</span>   <span class="comment">#端口号</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-config-center</span>  <span class="comment">#注册进Eureka 服务器的微服务名</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://github.com/Liuzebiao/springcloud-config.git</span>  <span class="comment">#GitHub远程仓库地址</span></span><br><span class="line">          <span class="comment"># 搜索目录</span></span><br><span class="line">          <span class="attr">search-paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">springcloud-config</span></span><br><span class="line">      <span class="comment">#读取分支</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务注册到eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span>  <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure>

<p>主启动类 配置**@EnableConfigServer**注解</p>
<p>启动测试：<a target="_blank" rel="noopener" href="http://localhost:3344/master/config-dev.yml">http://localhost:3344/master/config-dev.yml</a></p>
</li>
<li><p>GitHub配置文件<strong>读取规则</strong>：</p>
<p>远程 GitHub 仓库，配置文件的命名也是有具体规则的。Spring Cloud </p>
<p>Config 官方共支持 5 种方式的配置（<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_quick_start">https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_quick_start</a></p>
<p>参数说明：</p>
<ol>
<li><code>label</code>：GitHub 分支(branch)名称</li>
<li><code>application</code>：服务名</li>
<li><code>profile</code>：环境(<code>dev/test/prod</code>)</li>
</ol>
<ul>
<li><p>/{application}/{profile}/{label}：</p>
<p>返回的是 Json 对象，需要自己解析所要的内容</p>
<p><img src="/2021/03/15/springcloud/71.png" alt="在这里插入图片描述"></p>
</li>
<li><p>/{application}-{profile}.yml：</p>
<p>(这种不带label方式，默认使用application.yml 配置)因为 </p>
<p>applicaiton.yml 文件已经有配置过 label，不带label 方式，默认走</p>
<p>的就是 yml 配置的 label，返回的是配置内容</p>
<p><img src="/2021/03/15/springcloud/72.png" alt="在这里插入图片描述"></p>
</li>
<li><p>/{label}/{application}-{profile}.yml：</p>
<p>(推荐使用第三种)这种方式简明扼要，条理清晰，返回的是配置内</p>
<p>容</p>
<p><img src="/2021/03/15/springcloud/73.png" alt="在这里插入图片描述"></p>
</li>
<li><p>/{application}-{profile}.properties：</p>
<p>同第2种</p>
</li>
<li><p>/{label}/{application}-{profile}.properties：</p>
<p>同第3种</p>
</li>
</ul>
</li>
<li><p><strong>客户端</strong>配置测试 (Config 结构图中的 Client A、Client B、Client C)</p>
<p>依赖pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入spring-cloud-starter-config依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置文件 bootstrap.yml：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3355</span> <span class="comment">#端口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span> <span class="comment">#名称</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment">#config客户端配置</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span>  <span class="comment">#分支名称</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span>  <span class="comment">#配置文件名称</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span>   <span class="comment"># 读取后缀名称   上述3个综合：master分支上config-dev.yml 的配置文件被读取(http://config-3344.com:3344/master/fongig-dev.yml)</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:3344</span>   <span class="comment">#配置中心地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务注册到eureka地址</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure>

<p>主启动类 配置**@EnableConfigServer**注解</p>
<p>controller业务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span> <span class="comment">//通过这种方式，可以直接读取ConfigServer中的配置信息</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动测试：<a target="_blank" rel="noopener" href="http://localhost:3355/configInfo">http://localhost:3355/configInfo</a></p>
<h4 id="15-6、bootstrap-yml与application-yml"><a href="#15-6、bootstrap-yml与application-yml" class="headerlink" title="15.6、bootstrap.yml与application.yml"></a>15.6、bootstrap.yml与application.yml</h4></li>
</ol>
<p>applicaiton.yml是用户级的资源配置项</p>
<p>bootstrap.yml是系统级的，<strong>优先级更加高</strong></p>
<p>Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用</p>
<p>的<code>Application Context</code>的<strong>父上下文</strong>。初始化的时候，</p>
<p><code>BootstrapContext</code>负责从<strong>外部源</strong>加载配置属性并解析配置。这两个上下</p>
<p>文共享一个从外部获取的<code>Environment</code>。</p>
<p>“Bootstrap”属性有<strong>高优先级</strong>，默认情况下，它们不会被本地配置覆</p>
<p>盖。<code>Bootstrap context</code>和<code>Application Context</code>有着不同的约定，所</p>
<p>以新增了一个bootstrap.yml’文件，保证<code>Bootstrap Context</code>和</p>
<p><code>Application Context</code>配置的分离。</p>
<p><strong>要将Client模块下的application.yml文件改为bootstrap.yml,这是很关</strong></p>
<p><strong>键的</strong>，因为bootstrap.yml是比application.yml先加载的。bootstrap.yml</p>
<p>优先级高于application.yml。 </p>
<h4 id="15-7、分布式配置的动态刷新问题"><a href="#15-7、分布式配置的动态刷新问题" class="headerlink" title="15.7、分布式配置的动态刷新问题"></a>15.7、分布式配置的动态刷新问题</h4><ol>
<li><p>POM引入actuator监控</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入actuator监控--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改YML,暴露监控接口</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span> </span><br><span class="line">	<span class="attr">endpoints:</span> </span><br><span class="line">		<span class="attr">web:</span> </span><br><span class="line">			<span class="attr">exposure:</span> </span><br><span class="line">				<span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>@RefreshScope业务类Controller修改</p>
</li>
<li><p>需要运维人员发送Post请求刷新3355客户端</p>
<ul>
<li>必须是POST请求</li>
<li>curl  -X POST “<a target="_blank" rel="noopener" href="http://localhost:3355/actuator/refresh&quot;">http://localhost:3355/actuator/refresh&quot;</a></li>
</ul>
</li>
</ol>
<h4 id="15-8、残留问题"><a href="#15-8、残留问题" class="headerlink" title="15.8、残留问题"></a>15.8、残留问题</h4><ul>
<li><p>假如有 N 多个台，就需要 N 多次的curl的手动刷新</p>
<p>解决想法：</p>
<p>大规模 <strong><code>微服务/集群模式</code>**，</strong>我们可以采用广播的方式，一次通知，处处生效。<strong>类似于 **<code>消息队列的 Topic</code></strong> ，**<code>微信公众号</code>** 的概念，一次订阅，所有订阅者都能接收到新消息。</p>
</li>
<li><p>无法实现精确通知,只通知集群中的某些服务(精确通知，比如有100台机器，只通知前98台)</p>
</li>
</ul>
<p>解决以上两个问题的方法：bus消息总线</p>
<h2 id="消息总线"><a href="#消息总线" class="headerlink" title="消息总线"></a>消息总线</h2><h3 id="16、SpringCloud-Bus"><a href="#16、SpringCloud-Bus" class="headerlink" title="16、SpringCloud Bus"></a>16、SpringCloud Bus</h3><h4 id="16-1、是什么"><a href="#16-1、是什么" class="headerlink" title="16.1、是什么"></a>16.1、是什么</h4><p><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.1.RELEASE/reference/html/</a></p>
<p>在微服务架构的系统中，通常会使用<strong>轻量级的消息代理</strong>来构建一个<strong>共用的消</strong></p>
<p><strong>息主题</strong>，并让系统中所有的微服务实例都连接上来。由于<strong>该主题中产生的消</strong></p>
<p><strong>息会被所有实例监听和消费，所以称它为消息总线</strong>在总线上的各个实例，都</p>
<p>可以方便的广播一些需要让其他链接在该主题上的实例都知道的消息。</p>
<p>Spring Cloud Bus 是用来将 <strong>分布式系统的节点</strong>与 <strong>轻量级消息系统</strong>连接起来</p>
<p>的框架，它整合了 Java 的<strong>事件处理机制</strong>和<strong>消息中间件</strong>的功能。Spring </p>
<p>Cloud Bus 目前仅支持<code>RabbitMQ</code>和<code>Kafka</code>。</p>
<h4 id="16-2、作用"><a href="#16-2、作用" class="headerlink" title="16.2、作用"></a>16.2、作用</h4><p>Spring Cloud Bus能管理和传播分布式系统间的消息，就像一个分布式执行</p>
<p>器，可用于广播状态更改，事件推送等，也可以作为微服务的通信通道。</p>
<p><img src="/2021/03/15/springcloud/65.png" alt="img"></p>
<h4 id="16-3、基本原理与执行流程"><a href="#16-3、基本原理与执行流程" class="headerlink" title="16.3、基本原理与执行流程"></a>16.3、基本原理与执行流程</h4><p>ConfigClient实例都监听MQ中的同一个topic(默认是<strong>SpringcloudBus</strong>)。</p>
<p>当一个服务刷新数据的时候，它会把这个信息放入到topic中，这样其它监</p>
<p>听同一个topic的服务就能得到通知，然后去更新自身的配置。其实就是<strong>通</strong></p>
<p><strong>过 MQ 消息队列的 Topic 机制，达到广播的效果。</strong></p>
<p><img src="/2021/03/15/springcloud/66.png" alt="img"></p>
<h4 id="16-4、Bus的两种设计思想"><a href="#16-4、Bus的两种设计思想" class="headerlink" title="16.4、Bus的两种设计思想"></a>16.4、Bus的两种设计思想</h4><ol>
<li><p>触发<strong>客户端</strong>：</p>
<p>利用消息总线触发一个<strong>客户端</strong>的<code>/bus/refresh</code>,而刷新所有客户端的配置</p>
<p><img src="/2021/03/15/springcloud/67.png" alt="img"></p>
</li>
<li><p>触发<strong>服务端</strong>：</p>
<p>利用消息总线触发一个<strong>服务端</strong>ConfigServer的<code>/bus/refresh</code>端点，而</p>
<p>刷新所有客户端的配置</p>
<p><img src="/2021/03/15/springcloud/68.png" alt="img"></p>
</li>
</ol>
<p>如何选型：</p>
<p>根据架构图显然<strong>第二种</strong>更加合适，所以推荐使用<strong>触发服务端 Config Server</strong> </p>
<p>的方式。第一种触发客户端方式 不适合的原因如下：</p>
<ol>
<li><p>利用消息总线触发客户端方式，<strong>打破了微服务的职责单一性</strong>，因为微服</p>
<p>务本身是业务模块，它本不应该承担配置刷新的职责；</p>
</li>
<li><p>触发客户端方式，<strong>破坏了微服务各个节点之间的对等性</strong>（比如说：</p>
<p>3355/3366/3377 集群方式提供服务，此时 3355 还需要消息通知，影</p>
<p>响节点的对等性）</p>
</li>
<li><p><strong>有一定的局限性</strong>。当微服务迁移时，网络地址会经常发生变化，如果此</p>
<p>时需要做到自动刷新，则会增加更多的修改。</p>
</li>
</ol>
<h4 id="16-5、Bus-动态刷新全局广播配置"><a href="#16-5、Bus-动态刷新全局广播配置" class="headerlink" title="16.5、Bus 动态刷新全局广播配置"></a>16.5、Bus 动态刷新全局广播配置</h4><ul>
<li><p>集群版客户端组建（搭建两个或多个客户端）</p>
</li>
<li><p><strong>服务端</strong>配置中心/<strong>客户端</strong> pom 引入Bus总线依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--添加消息总线支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>服务端配置中心 application.yml 修改 (添加 rabbitmq 相关配置)</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加rabbitmq相关支持（新加）</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rabbitmq相关配置，暴露bus舒心配置的端点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;bus-refresh&#x27;</span>  <span class="comment">#为什么配置 bus-refresh，看传染病那张图</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端 application.yml 修改 (同样添加 rabbitmq 相关配置)</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加rabbitmq相关支持</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露监控端点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span>  <span class="comment">#此处有很多选项可以配置，为了省事 ,直接配置 *</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动模块，开始测试</p>
<p>启动：服务端配置中心 Config Server (3344)、客户端集群</p>
<p>(3355/3366)、Eureka Server(7001)。修改 GitHub 参数配置，然后向 </p>
<p>服务端 发送 Post 请求，命令：<code>curl -X POST &quot;http://localhost:3344/actuator/bus-refresh&quot;</code>，</p>
<p>当向 Config Server 发送 Post 请求后，总线上的各个实例(客户端 </p>
<p>3355/3366 )都能够及时 <strong><code>监听和消费</code></strong> 配置的变更。使用广播的方式，真</p>
<p>正的实现 **<code>一处通知，处处生效</code>**。</p>
<p>使用 MQ 广播的方式，实现<code>一处通知，处处生效</code>的效果。此时我们登陆 </p>
<p>Rabbit MQ 客户端，在<code>Exchanges</code>模块，就能够看到一个叫做 </p>
<p><code>springCloudBus</code>的<code>Topic</code>。</p>
<p>与本文 2.2 Bus 原理 中介绍吻合：<strong>Config 客户端示例，都去监听 MQ</strong> </p>
<p><strong>中的同一个 topic（默认是 springCloudBus）。当一个服务刷新数据</strong></p>
<p>**的时候，它会把这个消息放入到 Topic 中，这样其他监听同一 Topic **</p>
<p><strong>的服务就能够得到通知，然后去更新自身的配置</strong>。</p>
</li>
</ul>
<h4 id="16-6、Bus-动态刷新定点通知配置"><a href="#16-6、Bus-动态刷新定点通知配置" class="headerlink" title="16.6、Bus 动态刷新定点通知配置"></a>16.6、Bus 动态刷新定点通知配置</h4><p>如果需要<strong>差异化通知</strong>，并不想进行全局广播，此时就用到了 Bus 的<strong>定点通</strong></p>
<p><strong>知</strong>功能。</p>
<p>此次我们通过客户端集群(3344/3355)演示。GitHub 远程配置修改后 ，进</p>
<p>行差异化定点通知，只通知 3355，不通知 3366。此处命令和全局广播有点</p>
<p>不同，命令为：http://配置中心IP:配置中心的端口号/actuator/bus-</p>
<p>refresh/{destination}</p>
<p>通过指定 /bus/refresh请求不再发送到具体的服务实例上，而是发给 </p>
<p>Config Server 并通过 <strong>{destination} 参数</strong>来指定需要更新配置的服务或实</p>
<p>例。</p>
<p><strong>{destination} 参数</strong> = 微服务名 ：端口号。3355 微服务名为：config-</p>
<p>client。此处最终发送的 Post 请求命令为：curl -X POST <a target="_blank" rel="noopener" href="http://localhost:3/">http://localhost:3</a></p>
<p>344/actuator/bus-refresh/config-client:3355，真正的实现<strong>精确通知</strong>功</p>
<p>能。</p>
<h2 id="消息驱动"><a href="#消息驱动" class="headerlink" title="消息驱动"></a>消息驱动</h2><h3 id="17、Spring-Cloud-Stream消息驱动"><a href="#17、Spring-Cloud-Stream消息驱动" class="headerlink" title="17、Spring Cloud Stream消息驱动"></a>17、Spring Cloud Stream消息驱动</h3><h4 id="17-1、目前微服务面临的问题"><a href="#17-1、目前微服务面临的问题" class="headerlink" title="17.1、目前微服务面临的问题"></a>17.1、目前微服务面临的问题</h4><p>在项目开发中，常用的四种消息中间件：<code>ActiveMQ</code>、<code>RabbitMQ</code>、</p>
<p><code>RocketMQ</code>、<code>Kafka</code>。由于每个项目需求的不同，在消息中间件的选型</p>
<p>上也就会不同。</p>
<p>在项目开发中，你会遇到以下一些问题：</p>
<ul>
<li><p>自己学的是 RabbitMQ，公司用的却是 Kafka 。再学 Kafka？学习成本</p>
<p>太高，负担太重；</p>
</li>
<li><p>多部门配合，MQ差异化带来的联调问题。A部门使用 RabbitMQ 进行</p>
<p>消息发送，大数据部门却用 Kafka， MQ 选型的不同，MQ 切换、维</p>
<p>护、开发等困难随之而来。</p>
</li>
</ul>
<p>有没有一种技术，可以让我们不再关注 MQ 的细节，只需要用一种<strong>适配绑</strong></p>
<p><strong>定</strong>的方式，就可以帮助我们自动的在各种 MQ 之间切换呢？答案就是</p>
<p>Spring Cloud Stream 消息驱动。</p>
<p>Spring Cloud Stream 消息驱动，它可以<strong>屏蔽底层 MQ 之间的细节差异</strong>。我</p>
<p>们只需要操作Spring Cloud Stream 就可以操作底层多种多样的MQ。从而</p>
<p>解决我们在 MQ 切换、维护、开发方面的难度问题。</p>
<h4 id="17-2、是什么"><a href="#17-2、是什么" class="headerlink" title="17.2、是什么"></a>17.2、是什么</h4><p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-stream#overview">https://spring.io/projects/spring-cloud-stream#overview</a></p>
<p>Spring Cloud Stream 是一个<strong>构建消息驱动</strong>微服务的框架。应用程序通过 </p>
<p><strong>inputs</strong>或者<strong>outputs</strong>来与 Spring Cloud Stream 中的 <strong>binder</strong> 对象交互。通</p>
<p>过我们的配置来进行 binding(绑定)， 然后 Spring Cloud Stream <strong>通过</strong> </p>
<p><strong>binder 对象与消息中间件交互</strong>。所以，我们只需要搞清楚如何与 Spring </p>
<p>Cloud Stream 交互，就可以方便使用消息驱动的方式。</p>
<p>Spring Cloud Stream 通过使用 <strong>Spring Integration</strong> 来连接消息代理中间</p>
<p>件，以实现消息时间驱动。Spring Cloud Stream 为一些供应商的消息中间</p>
<p>件产品提供了个性化的自动配置发现，引用了<code>发布-订阅</code>、<code>消费组</code>、<code>分区 </code>三</p>
<p>个核心概念。目前仅支持<code>RabbitMQ</code>、<code>Kafka</code>。</p>
<p>一句话总结： Spring Cloud Stream 屏蔽了底层消息中间件的差异，降低</p>
<p>MQ 切换成本，统一消息的编程模型。开发中使用的就是各种<strong>xxxBinder</strong></p>
<p><img src="/2021/03/15/springcloud/74.png" alt="img"></p>
<h4 id="17-3、设计思想"><a href="#17-3、设计思想" class="headerlink" title="17.3、设计思想"></a>17.3、设计思想</h4><h5 id="17-3-1、标志MQ"><a href="#17-3-1、标志MQ" class="headerlink" title="17.3.1、标志MQ"></a>17.3.1、标志MQ</h5><p><strong><code>生产者/消费者</code></strong> 之间通过 <strong><code>消息媒介</code></strong> 传递消息内容</p>
<p>生产者/消费者之间靠消息媒介传递信息内容：Message</p>
<p>消息必须走特定的通道：MessageChannel</p>
<p>消息通道MessageChannel的子接口SubscribeChannel，由</p>
<p>MessageHandler消息处理器所订阅</p>
<p>结构图：</p>
<p><img src="/2021/03/15/springcloud/75.png" alt="在这里插入图片描述"></p>
<h5 id="17-3-2、Spring-Cloud-Stream"><a href="#17-3-2、Spring-Cloud-Stream" class="headerlink" title="17.3.2、Spring Cloud Stream"></a>17.3.2、Spring Cloud Stream</h5><p>比如说我们用到了RabbitMQ和 Kafka，由于这两个消息中间件的架构上的</p>
<p>不同。像RabbitMQ 有<code>exchange</code>、Kafka有<code>Topic</code>和<code>Partions</code>分区的概念。</p>
<p>这些中间件的差异性，给我们实际项目的开发造成了一定的困扰。我们如果</p>
<p>用了两个消息队列中的其中一个，后面的业务需求如果向往另外一种消息队</p>
<p>列进行迁移，这需求简直是灾难性的。<strong>因为它们之间的耦合性过高，导致一</strong></p>
<p><strong>大堆东西都要重新推到来做</strong>，这时候 Spring Cloud Stream 无疑是一个好的</p>
<p>选择，它为我们提供了一种解耦合的方式。</p>
<p>结构图：</p>
<p><img src="/2021/03/15/springcloud/76.png" alt="在这里插入图片描述"></p>
<h4 id="17-4、Spring-Cloud-Stream如何统一底层差异"><a href="#17-4、Spring-Cloud-Stream如何统一底层差异" class="headerlink" title="17.4、Spring Cloud Stream如何统一底层差异"></a>17.4、Spring Cloud Stream如何统一底层差异</h4><p>在没有绑定器这个概念的情况下，我们的 Spring Boot 应用直接与消息中间</p>
<p>件进行信息交互时，由于个消息中间件构建的初衷不同，它们的实现细节上</p>
<p>会有较大的差异性。</p>
<p><strong>通过定义绑定器(Binder)作为中间层，就可以完美的实现应用程序与消息中</strong></p>
<p><strong>间件细节的隔离</strong>。 通过向应用程序暴露统一的 Channel 通道，使得应用程</p>
<p>序不需要在考虑各种不同的消息中间件的实现。</p>
<h4 id="17-5、Binder"><a href="#17-5、Binder" class="headerlink" title="17.5、Binder"></a>17.5、Binder</h4><p>在没有绑定器这个概念的情况下，我们的SpringBoot应用要直接与消息中</p>
<p>间件进行信息交互的时候，由于各消息中间件构建的初衷不同，它们的实现</p>
<p>细节上会有较大的差异性，<strong>通过定义绑定器作为中间层，完美地实现了应用</strong></p>
<p><strong>程序与消息中间件细节之间的隔离</strong>。Stream对消息中间件的进一步封装，</p>
<p>可以做到代码层面对中间件的无感知，甚至于动态的切换中间件(rabbitmq</p>
<p>切换为kafka)，使得微服务开发的高度解耦，服务可以关注更多自己的业务</p>
<p>流程。</p>
<p><img src="/2021/03/15/springcloud/77.png" alt="img"></p>
<ul>
<li>INPUT：适用于消费者</li>
<li>OUTPUT：适用于生产者</li>
</ul>
<p>默认情况下，RabbitMQ Binder实现<strong>将每个目标映射到TopicExchange</strong>。 </p>
<p>对于每个使用者组，队列都绑定到该 TopicExchange。 每个使用者实例在</p>
<p>其组的队列中都有一个对应的 RabbitMQ使用者实例。 对于分区的生产者</p>
<p>和使用者，队列以分区索引为后缀，并使用分区索引作为路由键。 对于匿</p>
<p>名使用者（没有组属性的使用者），将使用自动删除队列（具有随机的唯一</p>
<p>名称）。</p>
<h4 id="17-6、Spring-Cloud-Stream-执行流程"><a href="#17-6、Spring-Cloud-Stream-执行流程" class="headerlink" title="17.6、Spring Cloud Stream 执行流程"></a>17.6、Spring Cloud Stream 执行流程</h4><p><img src="/2021/03/15/springcloud/78.png" alt="在这里插入图片描述"></p>
<p>说明：</p>
<ol>
<li><code>Source/Sink</code>：Source 输入消息，Sink 输出消息</li>
<li><code>Channel</code>：通道，是队列 Queue 的一种抽象，在消息通讯系统中就是实现存储和转发的媒介，通过Channel 对队列进行配置；</li>
<li><code>Binder</code>：很方便的 **<code>连接中间件</code>**，屏蔽 MQ 之间的差异</li>
</ol>
<h4 id="17-7、编码API和常用注解"><a href="#17-7、编码API和常用注解" class="headerlink" title="17.7、编码API和常用注解"></a>17.7、编码API和常用注解</h4><p><img src="/2021/03/15/springcloud/79.png" alt="在这里插入图片描述"></p>
<h4 id="17-8、详细配置与代码"><a href="#17-8、详细配置与代码" class="headerlink" title="17.8、详细配置与代码"></a>17.8、详细配置与代码</h4><p>选用 RabbitMQ，在不需要任何 RabbitMQ 包依赖的基础上，使用 Spring </p>
<p>Cloud Stream 消息驱动来实现消息的发送&amp;接收。</p>
<p>步骤：</p>
<ol>
<li><p>生产者配置</p>
<p>依赖pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入stream-rabbit依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>applicaiton.yml 配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># 在此处配置要绑定的rabbitmq的服务信息；</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># 表示定义的名称，用于binding整合(可以自定义名称)</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># 消息组件类型</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># 设置rabbitmq的相关的环境配置</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># 服务的整合处理</span></span><br><span class="line">        <span class="attr">output:</span> <span class="comment"># 这个名字是一个通道的名称</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># 表示要使用的Exchange名称定义</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># 设置消息类型，本次为json，文本则设置“text/plain”</span></span><br><span class="line">          <span class="attr">default-binder:</span> <span class="string">defaultRabbit</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span>  <span class="comment"># 设置要绑定的消息服务的具体设置(需与自定义名称一致)(飘红：Settings-&gt;Editor-&gt;Inspections-&gt;Spring-&gt;Spring Boot-&gt;Spring Boot application.yml 对勾去掉)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment"># 客户端进行Eureka注册的配置</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># 设置心跳的时间间隔（默认是30秒）</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># 如果现在超过了5秒的间隔（默认是90秒）</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">send-8801.com</span>  <span class="comment"># 在信息列表时显示主机名称</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>     <span class="comment"># 访问的路径变为IP地址</span></span><br></pre></td></tr></table></figure>

<p>业务类：</p>
<ul>
<li><p><strong>controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMessageController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IMessageProvider messageProvider;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/sendMessage&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sendMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> messageProvider.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>interface 接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMessageProvider</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>service</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@EnableBinding 指信道channel和exchange绑定在一起</span></span><br><span class="line"><span class="comment">//@EnableBinding(Source.class) 就是将 Source(源) 放到 Channel 的意思</span></span><br><span class="line"><span class="meta">@EnableBinding(Source.class)</span>  <span class="comment">//定义消息的推送管道</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageProviderImpl</span> <span class="keyword">implements</span> <span class="title">IMessageProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MessageChannel output; <span class="comment">// 消息发送管道</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String serial = UUID.randomUUID().toString();</span><br><span class="line">        output.send(MessageBuilder.withPayload(serial).build());</span><br><span class="line">        System.out.println(<span class="string">&quot;发送消息: &quot;</span>+serial);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>测试启动：<a target="_blank" rel="noopener" href="http://localhost:8801/sendMessage">http://localhost:8801/sendMessage</a></p>
<p>可以看到后台有显示发送消息，进入 RabbitMQ 可视化界面，可以看到</p>
<p>有发送消息波峰出现。</p>
</li>
<li><p>消费者配置</p>
<p>依赖pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入stream-rabbit依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>applicaiton.yml 配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8802</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># 在此处配置要绑定的rabbitmq的服务信息；</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># 表示定义的名称，用于于binding整合(可以自定义名称)</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># 消息组件类型</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># 设置rabbitmq的相关的环境配置</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># 服务的整合处理</span></span><br><span class="line">        <span class="attr">input:</span> <span class="comment"># 这个名字是一个通道的名称</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># 表示要使用的Exchange名称定义</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># 设置消息类型，本次为json，文本则设置“text/plain”</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span>  <span class="comment"># 设置要绑定的消息服务的具体设置(需与自定义名称一致)(飘红：Settings-&gt;Editor-&gt;Inspections-&gt;Spring-&gt;Spring Boot-&gt;Spring Boot application.yml 对勾去掉)</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment"># 客户端进行Eureka注册的配置</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># 设置心跳的时间间隔（默认是30秒）</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># 如果现在超过了5秒的间隔（默认是90秒）</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">receive-8802.com</span>  <span class="comment"># 在信息列表时显示主机名称</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>     <span class="comment"># 访问的路径变为IP地址</span></span><br></pre></td></tr></table></figure>

<p>业务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableBinding(Sink.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiveMessageListenerController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(Sink.INPUT)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">input</span><span class="params">(Message&lt;String&gt; message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1号消费者，接收：&quot;</span>+message.getPayload()+<span class="string">&quot;\t port:&quot;</span>+serverPort);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动测试：启动 RabbitMQ，调用<a target="_blank" rel="noopener" href="http://localhost:880/sendMessage">http://localhost:880/sendMessage</a></p>
<p>进行消息发送，可以看到消费者后台在实时接收消息。</p>
</li>
</ol>
<p>这样，我们并没有引入任何相关 RabbitMQ 包，也并不了解 Rabbit MQ。</p>
<p>便能够使用 Rabbit MQ 进行 **<code>消息发送 &amp; 接收</code>**。这就是Spring Cloud </p>
<p>Stream 消息驱动的优越之处。</p>
<h4 id="17-9、Stream-重复消费-持久化问题"><a href="#17-9、Stream-重复消费-持久化问题" class="headerlink" title="17.9、Stream 重复消费/持久化问题"></a>17.9、Stream 重复消费/持久化问题</h4><h5 id="17-9-1、重复消费问题"><a href="#17-9-1、重复消费问题" class="headerlink" title="17.9.1、重复消费问题"></a>17.9.1、重复消费问题</h5><p>当集群方式进行消息消费时，就会存在消息的重复消费问题。比如支付微服</p>
<p>务，购物支付完成后，消息重复消费就会导致支付多次的问题出现，这显然</p>
<p>是不能接受的。</p>
<p>这是因为<strong>没有进行分组的原因，不同组就会出现重复消费</strong>；<strong>同一组</strong>内会发生</p>
<p><strong>竞争关系</strong>，<strong>只有一个可以消费</strong>。 如果我们不指定(8802、8803)集群分组信</p>
<p>息，它会默认将其当做两个分组来对待。这个时候，如果发送一条消息到 </p>
<p>MQ，不同的组就都会收到消息，就会造成消息的重复消费。</p>
<p><strong>解决方法：</strong></p>
<p>只需要用到 Stream 当中 group 属性对消息进行分组即可。将8802、8803</p>
<p>分到一个组即可。<strong>（项目中，是否分组就视业务情况而定吧）</strong></p>
<p><img src="/2021/03/15/springcloud/80.png" alt="在这里插入图片描述"></p>
<h5 id="17-9-2、持久化问题"><a href="#17-9-2、持久化问题" class="headerlink" title="17.9.2、持久化问题"></a>17.9.2、持久化问题</h5><p>服务端发送消息时，此时客户端断开服务（宕机）：若客户端没有分组，此</p>
<p>时客户端不会接收到服务端发送的消息，导致<strong>消息丢失</strong>。</p>
<p>解决方法：</p>
<p>加一个 group 分组属性就行了。如果有客户端有进行分组，重启之后则可</p>
<p>以消费待消费的消息。特别的，但多个客户端都为同一组时，既使其中有一</p>
<p>个客户端宕机，其同组的<strong>一个客户端</strong>也可以接收到消息，不会导致消息丢失</p>
<p>（无需重启）。</p>
<h2 id="分布式链路追踪"><a href="#分布式链路追踪" class="headerlink" title="分布式链路追踪"></a>分布式链路追踪</h2><h3 id="18、Spring-Cloud-Sleuth-Zipkin-分布式链路追踪"><a href="#18、Spring-Cloud-Sleuth-Zipkin-分布式链路追踪" class="headerlink" title="18、Spring Cloud Sleuth + Zipkin 分布式链路追踪"></a>18、Spring Cloud Sleuth + Zipkin 分布式链路追踪</h3><h4 id="18-1、目前微服务面临的问题"><a href="#18-1、目前微服务面临的问题" class="headerlink" title="18.1、目前微服务面临的问题"></a>18.1、目前微服务面临的问题</h4><p>在微服务框架中，一个由客户端发起的请求，在后端系统中会经过多个不同</p>
<p>的微服务节点调用，协同操作产生最后的请求结果。每一个前端请求都会形</p>
<p>成一条复杂的分布式服务调用链路，链路中的任何一环出现<code>高延时</code>或者<code>错</code></p>
<p><code>误</code>，都会引起整个请求最后的失败。</p>
<h4 id="18-2、是什么？"><a href="#18-2、是什么？" class="headerlink" title="18.2、是什么？"></a>18.2、是什么？</h4><p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-sleuth#overview">https://spring.io/projects/spring-cloud-sleuth#overview</a></p>
<p>Spring Cloud Sleuth 提供了分布式系统中一套完整的服务跟踪的解决方</p>
<p>案，并且兼容支持了zipkin，完美的解决了多个微服务之间链路调用的问</p>
<p>题。</p>
<p>一句话总结： 就是用来处理服务之间调用关系的。</p>
<h4 id="18-3、调用结构图"><a href="#18-3、调用结构图" class="headerlink" title="18.3、调用结构图"></a>18.3、调用结构图</h4><p><img src="/2021/03/15/springcloud/81.png" alt="在这里插入图片描述"></p>
<h4 id="18-4、搭建链路监控步骤"><a href="#18-4、搭建链路监控步骤" class="headerlink" title="18.4、搭建链路监控步骤"></a>18.4、搭建链路监控步骤</h4><h5 id="18-4-1、环境准备"><a href="#18-4-1、环境准备" class="headerlink" title="18.4.1、环境准备"></a>18.4.1、环境准备</h5><p>Zipkin 是 Twitter 的一个开源项目，允许开发者收集 Twitter 各个服务上的</p>
<p>监控数据，并提供查询接口。</p>
<p>我们需要先准备一个 Zipkin 环境。<strong>Spring Cloud 从F版起已不需要自己构</strong></p>
<p><strong>建Zipkin server了</strong>，只需要调用jar包即可。当前使用版本为 H版。我们只</p>
<p>需要下载 Zipkin jar包，在安装目录的路径下使用 java -jar xxx的方式启动</p>
<p>即可。点击链接：<a target="_blank" rel="noopener" href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server</a> ，下载 zipkin-server-2.12.9-exec.jar 。启动就OK了，如</p>
<p>图所示。</p>
<p><img src="/2021/03/15/springcloud/82.png" alt="在这里插入图片描述"></p>
<p>通过 <a target="_blank" rel="noopener" href="http://loclahost:9411/">http://loclahost:9411</a> 就能进入到 Zipkin 为我们提供的可视化界面（中文）</p>
<p><img src="/2021/03/15/springcloud/83.png" alt="在这里插入图片描述"></p>
<p>一次请求完整的调用链路：</p>
<p><img src="/2021/03/15/springcloud/84.png" alt="img"></p>
<p>简单概述上图：</p>
<p><img src="/2021/03/15/springcloud/85.png" alt="img"></p>
<p>术词：</p>
<ul>
<li>Trace：类似于树结构的Span集合，表示一条调用链路，存在唯一标识</li>
<li>span:表示调用链路来源，通俗的理解span就是一次请求信息</li>
</ul>
<h5 id="18-4-2、Sleuth测试环境搭建"><a href="#18-4-2、Sleuth测试环境搭建" class="headerlink" title="18.4.2、Sleuth测试环境搭建"></a>18.4.2、Sleuth测试环境搭建</h5><ol>
<li><p>服务端/客户端 进行相同配置</p>
<p>引入 zipkin + sleuth pom 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入sleuth+zipkin依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 applicaiton.yml 添加 zipkin、sleuth 相同配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># 应用名</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span> <span class="comment">#监控数据要打到9411zipkin上</span></span><br><span class="line">  <span class="attr">sleuth:</span></span><br><span class="line">    <span class="attr">sampler:</span></span><br><span class="line">    <span class="attr">probability:</span> <span class="number">1</span>  <span class="comment">#采样率值介于0到1，1则表示全部采集</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用测试：</p>
<p>通过<code>http://localhost/consumer/payment/get/31</code>进行服务调用，</p>
<p>调用成功后，我们打开 <code>http://localhost:9411</code> Zipkin 控制台就可</p>
<p>以看到具体服务调用情况。</p>
<p>点击相对应请求，还可以看到 <strong><code>模块间调用情况</code>**、</strong><code>调用耗时</code>** 等更详细的</p>
<p>信息。点击导航栏中的 <strong><code>依赖</code></strong> 项，还可以查看模块(调用、被调用)的依</p>
<p>赖关系等，<strong>链路调用关系一目了然。</strong></p>
<p><img src="/2021/03/15/springcloud/springcloud%5C86.png" alt="image-20210311024420119"></p>
<p>点进每个具体的请求：</p>
<p><img src="/2021/03/15/springcloud/87.png" alt="image-20210311024741448"></p>
<p>点进依赖：（查看微服务间的依赖关系）</p>
<p><img src="/2021/03/15/springcloud/88.png" alt="image-20210311024859419"></p>
</li>
</ol>
<h2 id="Spring-Cloud-Alibaba"><a href="#Spring-Cloud-Alibaba" class="headerlink" title="Spring Cloud Alibaba"></a>Spring Cloud Alibaba</h2><h4 id="1、什么是维护模式"><a href="#1、什么是维护模式" class="headerlink" title="1、什么是维护模式"></a>1、什么是维护模式</h4><p>随着 Spring Cloud Netflix 项目进入维护模式（Maintenance Mode），Eureka、Hystrix、Ribbon、Zuul 等项目都进入了维护模式。</p>
<p>将模块置于<code>维护模式</code>意味着 Spring Cloud 团队将不再向该模块添加新功能。我们将修复<code>block</code>级别的<code>bug</code>和安全性问题，还将考虑并审查社区中的小请求。自 Spring Cloud Greenwich 版本发行(2018.12.12)以来，Spring Cloud 打算继续为这些模块提供至少一年的支持。（摘自：官网）</p>
<p>现在针对 Spring Cloud Netflix 相关模块已经不再提供支持。我们都知道 Spring Cloud 版本迭代算是比较快的，因而出现了很多重大ISSUE都还来不及Fix就又推出另一个 Release 版本了。进入维护模式意味着：以后一段时间 Spring Cloud Netflix 提供的服务和功能就这么多了，不再开发新的组件和功能了，这显然无法满足接下来微服务的开发要求。</p>
<p>伴随着 Spring Cloud Netflix 倒下，停更的组件自然就需要寻找替代者来继续下去。Alibaba 为了能够在微服务领域占据一定的话语权，此时便趁虚而入，将其代替，于2018.10.31 Spring Cloud Alibaba 正式入驻 Spring Cloud 官方孵化器，并在 Maven Spring Cloud for Alibaba 0.2.0 released。（附：Spring Cloud Alibaba 官方介绍）</p>
<p><img src="/2021/03/15/springcloud/3.jpg" alt="3"></p>
<h4 id="2、Spring-Cloud-Alibaba"><a href="#2、Spring-Cloud-Alibaba" class="headerlink" title="2、Spring Cloud Alibaba"></a>2、Spring Cloud Alibaba</h4><p>Spring Cloud Alibaba 致力于提供微服务开发的一站式解决方案。此项目包含开发分布式应用微服务的必需组件，方便开发者通过 Spring Cloud 编程模型轻松使用这些组件来开发分布式应用服务。</p>
<p>依托 Spring Cloud Alibaba，您只需要添加一些注解和少量配置，就可以将 Spring Cloud 应用接入阿里微服务解决方案，通过阿里中间件来迅速搭建分布式应用系统。</p>
<h5 id="2-1、Spring-Cloud-Alibaba包含的组件"><a href="#2-1、Spring-Cloud-Alibaba包含的组件" class="headerlink" title="2.1、Spring Cloud Alibaba包含的组件"></a>2.1、Spring Cloud Alibaba包含的组件</h5><ol>
<li>**<code>Sentinel</code>**：阿里巴巴开源产品，把流量作为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</li>
<li>**<code>Nacos</code>**：阿里巴巴开源产品，一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</li>
<li>**<code>RocketMQ</code>**：Apache RocketMQ™ 基于 Java 的高性能、高吞吐量的分布式消息和流计算平台。</li>
<li>**<code>Dubbo</code>**：Apache Dubbo™ 是一款高性能 Java RPC 框架。</li>
<li>**<code>Seata</code>**：阿里巴巴开源产品，一个易于使用的高性能微服务分布式事务解决方案。</li>
<li>**<code>Alibaba Cloud OSS</code>**：阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。您可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li>
<li>**<code>Alibaba Cloud SchedulerX</code>**：阿里中间件团队开发的一款分布式任务调度产品，支持周期性的任务与固定时间点触发任务。</li>
<li>**<code>Alibaba Cloud SMS</code>**：覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</li>
</ol>
<h5 id="2-2、主要功能"><a href="#2-2、主要功能" class="headerlink" title="2.2、主要功能"></a>2.2、主要功能</h5><ol>
<li>**<code>服务限流降级</code>**： 默认支持 WebServlet、WebFlux, OpenFeign、RestTemplate、Spring Cloud Gateway, Zuul, Dubbo 和 RocketMQ 限流降级功能的接入，可以在运行时通过控制台实时修改限流降级规则，还支持查看限流降级 Metrics 监控。</li>
<li>**<code>服务注册与发现</code>**： 适配 Spring Cloud 服务注册与发现标准，默认集成了 Ribbon 的支持。</li>
<li>**<code>分布式配置管理</code>**： 支持分布式系统中的外部化配置，配置更改时自动刷新。</li>
<li>**<code>消息驱动能力</code>**： 基于 Spring Cloud Stream 为微服务应用构建消息驱动能力。</li>
<li>**<code>分布式事务</code>**： 使用 @GlobalTransactional 注解， 高效并且对业务零侵入地解决分布式事务问题。。</li>
<li>**<code>阿里云对象存储</code>**： 阿里云提供的海量、安全、低成本、高可靠的云存储服务。支持在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li>
<li>**<code>分布式任务调度</code>**： 提供秒级、精准、高可靠、高可用的定时（基于 Cron 表达式）任务调度服务。同时提供分布式的任务执行模型，如网格任务。网格任务支持海量子任务均匀分配到所有 Worker（schedulerx-client）上执行。</li>
<li>**<code>阿里云短信服务</code>**： 覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</li>
</ol>
<h4 id="3、学习组件"><a href="#3、学习组件" class="headerlink" title="3、学习组件"></a>3、学习组件</h4><p><strong><code>Alibaba Cloud OSS</code>**、</strong><code>Alibaba Cloud SchedulerX</code><strong>、</strong><code>Alibaba Cloud SMS</code>** 是阿里云相关的付费业务。接下来，我们主要介绍 Nacos、Sentinel、Seata 这三个模块。</p>
<h4 id="4、官网资料"><a href="#4、官网资料" class="headerlink" title="4、官网资料"></a>4、官网资料</h4><ol>
<li><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-alibaba#overview">Spring Cloud Alibaba官网</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba">Github英文文档</a></li>
<li><a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">Spring英文文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">Github中文文档</a></li>
</ol>
<h3 id="19、Spring-Cloud-Alibaba-Nacos服务注册中心与配置中心"><a href="#19、Spring-Cloud-Alibaba-Nacos服务注册中心与配置中心" class="headerlink" title="19、Spring Cloud Alibaba Nacos服务注册中心与配置中心"></a>19、Spring Cloud Alibaba Nacos服务注册中心与配置中心</h3><h4 id="19-1、什么是-Nacos"><a href="#19-1、什么是-Nacos" class="headerlink" title="19.1、什么是 Nacos"></a>19.1、什么是 Nacos</h4><p>Nacos（Dynamic <strong>Na</strong>ming and <strong>Co</strong>nfiguration <strong>S</strong>ervice）：一个更易于构建云原生应用的动态服务发现，配置管理和服务管理中心。</p>
<p>我们可以理解为：<strong>Nacos = 服务注册中心 + 配置中心</strong>；等价于 Nacos = Eureka + Spring Cloud Config + Spring Cloud Bus。</p>
<h4 id="19-2、能干嘛"><a href="#19-2、能干嘛" class="headerlink" title="19.2、能干嘛"></a>19.2、能干嘛</h4><p>Nacos 可以替代 Eureka 来实现<code>服务注册中心</code>、可以替代 Spring Cloud Config 来实现<code>服务配置中心</code>、可以替代 Spring Cloud Bus 来实现<code>配置的全局广播</code>。Nacos 是更强调云原生时代支持 “<strong>服务治理、服务沉淀、共享、持续发展</strong>” 理念的注册中心和配置中心。(附：<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/index.html">Nacos 官网</a>与<a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/en-us/index.html">官方文档</a>)</p>
<p>与各种注册中心比较（粗劣）：</p>
<p><img src="/2021/03/15/springcloud/89.png" alt="img"></p>
<h4 id="19-3、Nacos-安装运行"><a href="#19-3、Nacos-安装运行" class="headerlink" title="19.3、Nacos 安装运行"></a>19.3、Nacos 安装运行</h4><p>本地环境：java8+maven环境</p>
<p>从<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases">官网</a>下载，你也可以选择指定版本下载：<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/tags">选择指定版本下载</a>。此处以 window 版进行演示，后续 Nacos 集群环境会在 Linux 环境配置。</p>
<p>下载完成后，解压缩，直接运行 bin 目录下的<code>startup.cmd</code>，<strong>此处需注意</strong>：若你下载的nacos为<strong>较新版本</strong>，nacos默认是集群方式开启，会出现：<code>nacos is starting with cluster</code>，无法正常启动（此时nacos并未集群）。</p>
<p><img src="/2021/03/15/springcloud/90.png" alt="img"></p>
<p>此时需以单机方式启动，执行以下命令<code>startup.cmd -m standalone</code>即可启动Nacos服务，我们可以看到它使用的是 8848 端口，启动结果如图所示：</p>
<p><img src="/2021/03/15/springcloud/91.png" alt="在这里插入图片描述"></p>
<p>运行成功后，直接访问 <a target="_blank" rel="noopener" href="http://localhost:8848/nacos">http://localhost:8848/nacos</a> 就可以进入 Nacos 的为我们提供的 web 控制台。**<code>用户名、密码默认为 nacos</code>**(1.2.0 版本不需要输入密码)，控制台还是挺清新的哈，还提供中文支持。</p>
<p><img src="/2021/03/15/springcloud/92.png" alt="在这里插入图片描述"></p>
<h4 id="19-4、Nacos与其他注册中心对比"><a href="#19-4、Nacos与其他注册中心对比" class="headerlink" title="19.4、Nacos与其他注册中心对比"></a>19.4、Nacos与其他注册中心对比</h4><p>Nacos和CAP：</p>
<p><img src="/2021/03/15/springcloud/96.png" alt="在这里插入图片描述"></p>
<p>CAP：</p>
<p><code>C</code>一致性<code>A</code>高可用<code>P</code>容错性。参考：<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/CAP%E5%8E%9F%E5%88%99/5712863?fr=aladdin">CAP原则</a>，主流选用的都是 AP 模式，保证系统的高可用。</p>
<p>何时选择使用何种模式？</p>
<p>一般来说，如果<strong>不需要存储服务级别的信息</strong>，且服务实例是通过<code>Nacos-client</code>注册，并能够<strong>保证心跳上报</strong>，那么就可以选择 AP 模式。当前主流的服务如 Spring Cloud 和 Dubbo 服务，都适用于 AP 模式，**AP模式为了服务的可用行而减弱了一致性，因此 AP 模式下只支持注册<code>临时实例</code>**。</p>
<p>如果需要在服务级别<strong>编辑或者存储配置信息</strong>，那么 CP 是必须的，<code>K8S服务</code>和<code>DNS服务</code>则适用于 CP 模式。CP模式下则支持注册**<code>持久化实例</code><strong>，此时则是以<code>Raft协议</code>为集群运行模式，</strong>该模式下注册实例之前必须先注册服务，如果服务不存在，则会返回错误。**</p>
<p>而Nacos支持AP和CP模式的切换：</p>
<p><img src="/2021/03/15/springcloud/97.png" alt="在这里插入图片描述"></p>
<p>Nacos的全景图：</p>
<p><img src="/2021/03/15/springcloud/98.png" alt="img"></p>
<p>Nacos AP/CP模式切换：</p>
<p>Nacos 集群默认支持的是CAP原则中的 AP原则，但是也可切换为CP原则，切换命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &#x27;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP&#x27;</span><br></pre></td></tr></table></figure>

<p>同时微服务的 bootstrap.yml需配置如下选项指明注册为临时/永久实例，<code>AP模式</code>不支持数据一致性，所以只支持服务注册的<code>临时实例</code>，<code>CP模式</code>支持服务注册的<code>永久实例</code>，满足配置文件的一致性。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#false为永久实例，true表示临时实例开启，注册为临时实例</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">cloud:</span> </span><br><span class="line">    <span class="attr">nacos:</span> </span><br><span class="line">	  <span class="attr">discovery:</span> </span><br><span class="line">		<span class="attr">ephemeral:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h4 id="19-5、Nacos用作服务注册中心"><a href="#19-5、Nacos用作服务注册中心" class="headerlink" title="19.5、Nacos用作服务注册中心"></a>19.5、Nacos用作服务注册中心</h4><p>Nacos 可以替代 Eureka 来作为 **<code>服务注册中心</code>**。附：<a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/en-us/index.html#_spring_cloud_alibaba_nacos_discovery">Nacos 服务注册中心官方文档</a></p>
<ul>
<li><p><strong>基于Nacos的服务提供者(provider)</strong></p>
<ol>
<li><p>父pom引入spring-cloud-alibaba 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当前模块pom引入 nacos-discovery 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--引入 nacos-discovery 依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>applicaiton.yml 文件配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9021</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动加上@EnableDiscoveryClient</p>
</li>
<li><p>业务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Alibaba Nacos registry,server &quot;</span>+ serverPort+<span class="string">&quot;----- id:&quot;</span>+id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务模块，查看服务是否注册到 Nacos</p>
<p>启动服务模块，进入 Nacos 控制台，在 <strong><code>服务管理 → 服务列表</code></strong> 中可以看到，我们定义的服务名 <code>nacos-payment-provider</code> 已经成功注册到 Nacos 注册中心。</p>
<p><img src="/2021/03/15/springcloud/93.png" alt="在这里插入图片描述"></p>
</li>
</ol>
</li>
<li><p>可以多来个服务端，与 9021 组成集群（9022、9023等等，做法与上一致）</p>
<p><strong>提示：</strong>9022 和 9023 除端口外，其他配置都相同。在<strong>测试环境</strong>（只能在测试环境里用，可能出现未知的bug）使用时，此处还有个取巧的方法，**<code>可以通过直接拷贝虚拟端口映射，来创建 9002 模块</code>**。我们使用 9021 来创建9022/9023，（实质端口为9021）如下图所示：</p>
<p><img src="/2021/03/15/springcloud/94.png" alt="在这里插入图片描述"></p>
</li>
<li><p><strong>基于Nacos的服务消费者（consumer）</strong></p>
<ol>
<li><p>当前模块pom引入 nacos-discovery 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Nacos 默认支持负载均衡</p>
<p>spring-cloud-starter-alibaba-nacos-discovery包里就整合有ribbon</p>
<p><img src="/2021/03/15/springcloud/95.png" alt="在这里插入图片描述"></p>
<p>也就是说：我们可以使用ribbon的负载均衡与RestTemplate</p>
</li>
<li><p>applicaiton.yml 文件配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-nacos-order</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#消费者将要去访问的微服务名称</span></span><br><span class="line"><span class="attr">server-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动加注解@EnableDiscoveryClient</p>
</li>
<li><p>业务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/consumer/payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderNacosController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server-url.nacos-user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverURL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverURL+<span class="string">&quot;/payment/nacos/&quot;</span>+id,String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>RestTemplate配置类（注意加上@LoadBalanced实现负载均衡）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务消费者，查看服务是否注册到 Nacos</p>
</li>
<li><p>服务调用测试，是否实现负载均衡。通过服务端对客户端服务进行调用：<a target="_blank" rel="noopener" href="http://localhost:83/consumer/payment/nacos/31%E3%80%82%E9%87%87%E7%94%A8%E8%BD%AE%E8%AF%A2%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BA%86%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E3%80%82">http://localhost:83/consumer/payment/nacos/31。采用轮询的方式，实现了负载均衡。</a></p>
</li>
</ol>
</li>
<li><p><strong>也可以用OpenFeign+Nacos实现服务消费者（consumer）</strong></p>
<ol>
<li><p>引入 spring-cloud-openfeign 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 spring-cloud-openfeign 依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>application.yml配置同上（改端口也行）</p>
</li>
<li><p>主启动类加上@EnableDiscoveryClient与@EnableFeignClients两个注解。</p>
</li>
<li><p>编写OpenFeign的服务接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderNacosService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>此处注意：</strong>注解@FeignClient里的服务名”nacos-payment-provider”必须和服务提供端的yml配置一致,大小写敏感(Eureka 大小写不敏感,Nacos 不同,大小写会导致调用失败)</p>
<p>具体可参考<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/issues/2188">ISSUE</a></p>
</li>
<li><p>业务类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/consumer/payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderNacosController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderNacosService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getPayment(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动测试</p>
</li>
</ol>
</li>
</ul>
<h4 id="19-6、Nacos用作服务配置中心"><a href="#19-6、Nacos用作服务配置中心" class="headerlink" title="19.6、Nacos用作服务配置中心"></a>19.6、Nacos用作服务配置中心</h4><h5 id="19-6-1、Nacos作为配置中心–基础配置"><a href="#19-6-1、Nacos作为配置中心–基础配置" class="headerlink" title="19.6.1、Nacos作为配置中心–基础配置"></a>19.6.1、Nacos作为配置中心–基础配置</h5><ol>
<li><p>当前模块 pom 引入 nacos-config 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入nacos-config配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注册到 Nacos，需引入nacos-discovery配置--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入nacos-discovery配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>进行yml配置：</p>
<p>此处需要配置<code>bootstrap.yml</code>和<code>application.yml</code>两个文件<code>bootstrap.yml</code>用作系统级资源配置项，<code>application.yml</code>用作用户级的资源配置项。在项目中两者配合共同生效，<code>bootstrap.yml</code>优先级更高。<br>bootstrap.yml：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacos配置</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacos服务注册中心地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacos作为配置中心地址</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#指定yaml格式的配置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br><span class="line"><span class="comment"># nacos-config-client-dev.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># nacos-config-client-test.yaml   ----&gt; config.info</span></span><br></pre></td></tr></table></figure>

<p>application.yml：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 表示开发环境</span></span><br><span class="line">    <span class="comment">#active: test # 表示测试环境</span></span><br><span class="line">    <span class="comment">#active: info</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动类添加 @EnableDiscoveryClient 注解</p>
</li>
<li><p>业务类：(添加 @RefreshScope 实现配置自动更新)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span><span class="comment">//支持Nacos的动态刷新功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Nacos中添加配置项：</p>
<p>进入 <strong><code>Nacos → 配置管理 → 配置列表 → + 号</code></strong> 添加配置项。Data ID 按规则编写，Group 在接下来的 <strong><code>分类配置</code></strong> 会有介绍。</p>
<p><img src="/2021/03/15/springcloud/99.png" alt="在这里插入图片描述"></p>
<p><img src="/2021/03/15/springcloud/100.png" alt="在这里插入图片描述"></p>
</li>
<li><p>启动测试，是否能够获取Nacos配置：</p>
<p>通过 <a target="_blank" rel="noopener" href="http://localhost:3377/config/info">http://localhost:3377/config/info</a> 测试，发现可以正确获取 Nacos 配置中心的配置信息</p>
<p><img src="/2021/03/15/springcloud/101.png" alt="在这里插入图片描述"></p>
</li>
<li><p>Nacos 自带动态刷新：</p>
<p>在使用 Spring Cloud Config 时，需要配合 Spring Cloud Bus + RabbitMQ 中间件，用<code>curl</code>进行广播方式才能 <strong><code>实现动态刷新</code>**。</strong><code>Nacos则自带动态刷新,修改下Nacos中的yaml配置文件，再次调用查看配置的接口，就会发现配置已经刷新。</code>**</p>
</li>
</ol>
<h5 id="19-6-2、dataId-命名规则"><a href="#19-6-2、dataId-命名规则" class="headerlink" title="19.6.2、dataId 命名规则"></a>19.6.2、dataId 命名规则</h5><p>在 Nacos Spring Cloud 中， <code>dataId</code> 有明确的配置规则，官方也有说明。进入链接查看：<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">官网链接</a>。</p>
<p><code>dataId</code> 的完整格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>prefix 默认为 spring.application.name 的值，也可以通过配置项 spring.cloud.nacos.config.prefix来配置。</li>
<li>spring.profile.active 即为当前环境对应的 profile。注意：当 spring.profile.active 为空时，对应的连接符 - 也将不存在，dataId 的拼接格式变成 ${prefix}.${file-extension}（建议：不要让 spring.profile.active 为空，或许会有一些意外的问题,未知的bug）</li>
<li>file-exetension 为配置内容的数据格式，可以通过配置项 spring.cloud.nacos.config.file-extension 来配置。目前只支持 properties 和 yaml 类型。</li>
</ul>
<p><img src="/2021/03/15/springcloud/102.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/103.png" alt="img"></p>
<p><strong>此处注意：</strong>在Nacos网页中进行添加配置项时，在填写<code>Data ID</code>需要注意,若你采用的是yaml格式的话，如<code>nacos-config-dev.yaml</code>中的yaml不能省略成yml，即<code>nacos-config-dev.yml</code>。若省略，程序启动会报错（找不到配置项config.info）。这是Nacos的一个小坑（bug）。</p>
<h5 id="19-6-3、Nacos作为配置中心–分类配置"><a href="#19-6-3、Nacos作为配置中心–分类配置" class="headerlink" title="19.6.3、Nacos作为配置中心–分类配置"></a>19.6.3、Nacos作为配置中心–分类配置</h5><p>项目开发中，一定会遇到<code>多环境</code>、<code>多项目管理</code>问题。遇到下面问题时，Nacos 基础配置显然无法解决这些问题，接下来就对<code>Nacos 命名空间</code>及<code>Group</code>相关概念的了解。</p>
<ul>
<li>问题1： 实际开发中，通常一个系统会准备<code>dev开发环境</code>、<code>test测试环境</code>、<code>prod生产环境</code>，如何保证指定环境启动时服务能够正确读取到 Nacos 上相应环境的配置文件？</li>
<li>问题2： 一个大型的分布式微服务系统会有很多个微服务<code>子项目</code>，每个微服务项目又都会有相应的<code>dev开发环境</code>、<code>test测试环境</code>、<code>prod生产环境 </code>等，那怎么对这些微服务配置进行管理呢？</li>
</ul>
<p>这是就可以用到Nacos的分类功能了。</p>
<h6 id="19-6-3-1、Nacos的命名规则说明"><a href="#19-6-3-1、Nacos的命名规则说明" class="headerlink" title="19.6.3.1、Nacos的命名规则说明"></a>19.6.3.1、Nacos的命名规则说明</h6><p>Nacos 命名由<code>Namespace(命名空间) </code>+ <code>Group(分组)</code> + <code>Data ID(实例ID)</code> 三部分组成，类似于 Java 中的 package(报名) + class(类名) 方式。最外层 <strong>Namespace 用于区分部署环境</strong>；<strong>Group 和 Data ID 逻辑上用于区分两个目标对象</strong>。</p>
<p><img src="/2021/03/15/springcloud/104.png" alt="在这里插入图片描述"></p>
<p>默认情况下：</p>
<p><strong>Namespace = public，Group = DEFAULT_GROUP，Cluster=DEFAULT</strong></p>
<p><strong><code>Namespace</code>**主要用来实现</strong>隔离**，Nacos 默认的命名空间是<code>public</code>。比方说我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个 Namespace，不同的 Namespace 之间是隔离的；</p>
<p><strong><code>Group</code>**是一组</strong>配置集<strong>，是组织配置的维度之一。默认是<code>DEFAULT_GROUP</code>。通过一个有意义的<code>名称</code>对配置集进行分组，从而区分 Data ID 相同的配置集。</strong>配置分组的常见场景：不同的应用或组件使用了相同的配置类型，就可以把不同的微服务划分到同一个分组里面去，从而解决问题2；如 database_url 配置和 MQ_topic 配置。**</p>
<p><strong><code>Service</code>**微服务；一个 Service 可以包含多个<code>Cluster(集群)</code>，Nacos 默认 Cluster 是<code>DEFAULT</code>，Cluster 是对指定微服务的一个</strong>虚拟划分<strong>。</strong>比方说为了容灾，将 Service 微服务分别部署在了杭州机房和广州机房，这是就可以给杭州机房的 Service 微服务起一个集群名称(HZ)，给广州机房的 Service 微服务起一个集群名称(GZ)，还可以尽量让同一个机房的微服务互相调用，以提升性能。**</p>
<p><strong><code>Instance</code>**，就是一个个</strong>微服务实例**。</p>
<p><img src="/2021/03/15/springcloud/105.png" alt="img"></p>
<p>保留空间public是不能被删除的。。</p>
<p><img src="/2021/03/15/springcloud/106.png" alt="img"></p>
<h6 id="19-6-3-2、新建Namespace"><a href="#19-6-3-2、新建Namespace" class="headerlink" title="19.6.3.2、新建Namespace"></a>19.6.3.2、新建Namespace</h6><p>选择 <strong><code>命名空间 → 新建命名空间</code>**，进行命名空间的设置。在 Nacos 1.1.4 版本，还<code>不支持自定义命名空间ID</code>，Nacos 1.2.0 版本后开始支持自定义命名空间ID 了。</strong>更推荐你使用自定义命名空间**。</p>
<p><img src="/2021/03/15/springcloud/107.png" alt="在这里插入图片描述"></p>
<p><img src="/2021/03/15/springcloud/108.png" alt="在这里插入图片描述"></p>
<h6 id="19-6-3-3、新建-Group"><a href="#19-6-3-3、新建-Group" class="headerlink" title="19.6.3.3、新建 Group"></a>19.6.3.3、新建 Group</h6><p>新建配置自定义Group名称。<strong>Group 就是根据需求的不同，将微服务划分到同一个分组里面去，来解决问题2</strong></p>
<p><img src="/2021/03/15/springcloud/109.png" alt="在这里插入图片描述"></p>
<h6 id="19-6-3-4、将-namespace-和-Group-应用到项目中"><a href="#19-6-3-4、将-namespace-和-Group-应用到项目中" class="headerlink" title="19.6.3.4、将 namespace 和 Group 应用到项目中"></a>19.6.3.4、将 namespace 和 Group 应用到项目中</h6><p>只需要在<code>bootstrap.yml</code>中添加 <code>namespace</code> 和 <code>group</code> 两个属性即可。**<code>namespace</code>** 属性：此处配置为 namespace **<code>命名空间 ID</code>**，自定义namespace时，推荐还是自定义名称，否则就是一串很长的字符串流水号，而且还语意不明。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacos服务注册中心地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacos服务配置中心地址</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#指定yaml格式的配置</span></span><br><span class="line">        <span class="comment"># 指定 namespace 和 group </span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">dev-nsid</span> <span class="comment">#指定Namespace命名空间</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">Group_A</span> <span class="comment">#指定Group分组</span></span><br></pre></td></tr></table></figure>

<h6 id="19-6-3-5、指定-namespace-和-group-后，读取的便是对应配置内容"><a href="#19-6-3-5、指定-namespace-和-group-后，读取的便是对应配置内容" class="headerlink" title="19.6.3.5、指定 namespace 和 group 后，读取的便是对应配置内容"></a>19.6.3.5、指定 namespace 和 group 后，读取的便是对应配置内容</h6><p><img src="/2021/03/15/springcloud/110.png" alt="在这里插入图片描述"></p>
<h4 id="19-7、Nacos-集群搭建和持久化配置-Linux-Mysql"><a href="#19-7、Nacos-集群搭建和持久化配置-Linux-Mysql" class="headerlink" title="19.7、Nacos 集群搭建和持久化配置(Linux + Mysql)"></a>19.7、Nacos 集群搭建和持久化配置(Linux + Mysql)</h4><h5 id="19-7-1、Nacos集群官方架构图"><a href="#19-7-1、Nacos集群官方架构图" class="headerlink" title="19.7.1、Nacos集群官方架构图"></a>19.7.1、Nacos集群官方架构图</h5><p><img src="/2021/03/15/springcloud/111.png" alt="在这里插入图片描述"></p>
<p><strong>VIP</strong>：此处的 VIP 指代的是 <code>Virtual IP</code>（虚拟IP）的意思，通常情况下指代的是<code>Nginx</code>。</p>
<p>说明： 开源时，推荐用户把所有服务列表放到一个vip下面，然后挂到一个域名下面：</p>
<p><a href="http://ip1:port/openAPI">http://ip1:port/openAPI</a> 直连ip模式，机器挂则需要修改ip才可以使用。<br><a href="http://VIP:port/openAPI">http://VIP:port/openAPI</a> 挂载VIP模式，直连vip即可，下面挂server真实ip，可读性不好。<br><strong><a href="http://nacos.com:port/openAPI">http://nacos.com:port/openAPI</a> 域名 + VIP模式，可读性好，而且换ip方便，推荐模式。</strong></p>
<h5 id="19-7-2、Nacos集群真实架构图"><a href="#19-7-2、Nacos集群真实架构图" class="headerlink" title="19.7.2、Nacos集群真实架构图"></a>19.7.2、Nacos集群真实架构图</h5><p><img src="/2021/03/15/springcloud/112.png" alt="在这里插入图片描述"></p>
<h5 id="19-7-3、Nacos在linux下安装下载"><a href="#19-7-3、Nacos在linux下安装下载" class="headerlink" title="19.7.3、Nacos在linux下安装下载"></a>19.7.3、Nacos在linux下安装下载</h5><p>1、在<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases">官网</a>下载xxx.tar.gz文件，并转移进Linux服务器。</p>
<p>2、<strong>nacos 安装目录：<code>/usr/local/nacos/</code></strong></p>
<p>3、使用tar -zxvf 命令解压</p>
<h5 id="19-7-4、Nacos数据库支持（derby-）"><a href="#19-7-4、Nacos数据库支持（derby-）" class="headerlink" title="19.7.4、Nacos数据库支持（derby ）"></a>19.7.4、Nacos数据库支持（derby ）</h5><p>手动将Nacos服务关闭再启动。存储在Nacos中的配置信息并不会丢失。这是因为 Nacos 默认内置<code>DerBy</code>数据库。 嵌入式数据库，nacos pom.xml 有引入<code>derby</code>依赖。以下摘自Nacos的<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/blob/develop/config/pom.xml">github源码</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.derby<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>derby<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Nacos的derby数据库记录的数据放在nacos安装目录下的/conf/nacos-mysql.sql的sql文件里。</p>
<p>在<code>Nacos 0.7</code>版本之前，在单机模式时nacos使用嵌入式数据库(<code>derby</code>)实现数据的存储，不方便观察数据存储的基本情况。<strong>0.7 版本增加了支持 mysql 数据源能力</strong>。 具体的操作步骤：</p>
<ol>
<li>安装数据库，版本要求：5.6.5+</li>
<li>初始化mysql数据库，数据库初始化文件：<code>nacos-mysql.sql</code></li>
<li>修改<code>conf/application.properties</code>文件，增加支持mysql数据源配置（<strong>目前只支持mysql</strong>），添加mysql数据源的url、用户名和密码。</li>
<li>再启动nacos，nacos所有写嵌入式数据库的数据都写到了mysql。</li>
</ol>
<h5 id="19-7-5、Nacos-集群部署搭建"><a href="#19-7-5、Nacos-集群部署搭建" class="headerlink" title="19.7.5、Nacos 集群部署搭建"></a>19.7.5、Nacos 集群部署搭建</h5><p>Nacos支持三种部署模式</p>
<ul>
<li>单机模式 - 用于测试和单机试用。</li>
<li><strong><code>集群模式 - 用于生产环境，确保高可用。</code></strong></li>
<li>多集群模式 - 用于多数据中心场景。</li>
</ul>
<p>  此处附：<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">Nacos集群模式部署官方文档</a></p>
<p>若单机要集群Nacos的话要删除其中的<code>data</code>文件夹。<a target="_blank" rel="noopener" href="https://www.cnblogs.com/to-make-life-better/p/14534539.html">资料</a></p>
<h6 id="19-7-5-1、节点部署情况"><a href="#19-7-5-1、节点部署情况" class="headerlink" title="19.7.5.1、节点部署情况"></a>19.7.5.1、节点部署情况</h6><table>
<thead>
<tr>
<th align="center">服务器IP</th>
<th align="center">部署服务</th>
<th align="center">端口</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">192.168.204.202</td>
<td align="center">MySQL 5.7.28</td>
<td align="center">3306</td>
<td align="center">测试，使用单机 MySQL，高可用参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lzb348110175/article/details/103081631">MySQL 5.7.28 主从复制实现</a></td>
</tr>
<tr>
<td align="center">192.168.204.202</td>
<td align="center">Nginx 1.4.1</td>
<td align="center">8807</td>
<td align="center">测试，使用单机 Nginx，Nginx集群搭建请自行了解(Nginx默认端口为80，此处负载均衡使用8087端口)</td>
</tr>
<tr>
<td align="center">192.168.204.202</td>
<td align="center">nacos</td>
<td align="center">8848</td>
<td align="center">集群节点01：nacos 01</td>
</tr>
<tr>
<td align="center">192.168.204.203</td>
<td align="center">nacos</td>
<td align="center">8848</td>
<td align="center">集群节点02：nacos 02</td>
</tr>
<tr>
<td align="center">192.168.204.204</td>
<td align="center">nacos</td>
<td align="center">8848</td>
<td align="center">集群节点03：nacos 03</td>
</tr>
</tbody></table>
<p>提示： 三台机器配置相同，此处对一台进行配置。使用命令 scp 发送到其他两台机器即可，此处以<code>192.168.204.202</code>为例说明。</p>
<h6 id="19-7-5-2、derby-切换-mysql-数据库配置"><a href="#19-7-5-2、derby-切换-mysql-数据库配置" class="headerlink" title="19.7.5.2、derby 切换 mysql 数据库配置"></a>19.7.5.2、derby 切换 mysql 数据库配置</h6><ol>
<li><p>执行nacos-mysql.sql脚本：</p>
<p>进入 nacos 安装目录 conf 文件下，找到 <code>nacos-mysql.sql 脚本</code>。</p>
<p>创建 nacos_config 数据库，并执行 nacos-mysql.sql 脚本。</p>
<p><img src="/2021/03/15/springcloud/113.png" alt="在这里插入图片描述"></p>
<p><img src="/2021/03/15/springcloud/114.png" alt="在这里插入图片描述"></p>
</li>
<li><p>修改application.properties，添加mysql支持：</p>
<p>进入nacos安装目录 conf 文件下，<code>application.properties</code> 配置文件添加 mysql 支持。</p>
<p>其中：</p>
<ul>
<li><p>在修改所有文件之前建议保存副本</p>
<p><img src="/2021/03/15/springcloud/115.png" alt="img"></p>
</li>
<li><p>db.user与db.password填写本机的用户名与密码</p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">db.url.0</span>=<span class="string">jdbc:mysql://192.168.204.202:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span></span><br><span class="line"><span class="meta">db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">db.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/15/springcloud/116.png" alt="img"></p>
</li>
<li><p>cluster.conf 配置:</p>
<p>进入 conf 目录，使用命令：<code>cp cluster.conf.example cluster.conf</code>拷贝一份，重命名为<code>cluster.conf</code>，在 cluster.conf 中进行配置，说明哪几台机器组成集群（填写的是 nacos 集群3个节点所在 IP:端口号，不要写<code>127.0.0.1</code>，必须是Linux的<strong>真实IP</strong>）,可以通过命令<code>hostname -i</code>查看Linux的真实IP。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.204.202:8848</span><br><span class="line">192.168.204.203:8848</span><br><span class="line">192.168.204.204:8848</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 nacos 启动堆栈大小：</p>
<p>（nacos 启动时，默认 <code>-Xms2g -Xmx2g</code>。如果你是在多台虚拟机测试，配置紧张，这一步就比较重要了。如果服务器配置很优秀，这一步可以绕过。）</p>
<p><strong>配置紧张会导致以下情况的出现：</strong></p>
<ol>
<li><strong>nacos 服务启动很慢很慢的情况；</strong></li>
<li><strong>nacos 服务注册中心，有3个提供服务，你可能只能看到 2个、1个、0个服务节点，还会来回跳动的问题。</strong></li>
<li><strong>反正还是会出现一些意想不到的问题，视情况而配置。</strong></li>
</ol>
<blockquote>
<p><code>Xms 是指设定程序启动时占用内存大小。</code>一般来讲，大点，程序会启动的快一点，但是也可能会导致机器暂时间变慢。<br><code>Xmx 是指设定程序运行期间最大可占用的内存大小。</code>如果程序运行需要占用更多的内存，超出了这个设置值，就会抛出OutOfMemory异常。</p>
</blockquote>
<p>我们进入 bin 目录，使用 <code>vim startup.sh</code> 对其进行修改，将其按照配置修改到指定大小即可。（好像可以通过启动时添加 Xms 参数方式修改，我忘了怎么搞了，此处就直接修改 <code>.sh</code> 启动脚本了）（建议修改之前进行备份）</p>
<p><img src="/2021/03/15/springcloud/117.png" alt="在这里插入图片描述"></p>
</li>
<li><p>使用scp命令，进行nacos配置分发：</p>
<p>192.168.204.202 一台 nacos 集群环境配置完成，使用 scp 命令，将 nacos 目录分发到 203/204两台机器。scp 命令的使用如下：(scp命令使用介绍，请参考：Linux命令—scp)，不使用 scp 命令，你也可以 rz、sz 以打包的方式进行上传。</p>
<blockquote>
<p>scp -r /usr/local/env/nacos <a href="mailto:&#x72;&#111;&#x6f;&#x74;&#x40;&#x31;&#57;&#x32;&#x2e;&#49;&#x36;&#x38;&#46;&#x32;&#x30;&#x34;&#46;&#50;&#x30;&#x33;">&#x72;&#111;&#x6f;&#x74;&#x40;&#x31;&#57;&#x32;&#x2e;&#49;&#x36;&#x38;&#46;&#x32;&#x30;&#x34;&#46;&#50;&#x30;&#x33;</a>:/usr/local/nacos/<br>scp -r /usr/local/env/nacos <a href="mailto:&#114;&#x6f;&#111;&#x74;&#64;&#x31;&#57;&#x32;&#x2e;&#49;&#54;&#56;&#x2e;&#50;&#48;&#52;&#46;&#x32;&#48;&#x34;">&#114;&#x6f;&#111;&#x74;&#64;&#x31;&#57;&#x32;&#x2e;&#49;&#54;&#56;&#x2e;&#50;&#48;&#52;&#46;&#x32;&#48;&#x34;</a>:/usr/local/nacos/</p>
</blockquote>
</li>
<li><p>以上第5步也可以通过编辑Nacos的启动脚本<code>startup.sh</code>,使他能够接受不同的启动端口（建议备份）：</p>
<p><img src="/2021/03/15/springcloud/118.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/119.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/120.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/121.png" alt="img"></p>
<p>之后就可以通过<code>./startup.sh -p 端口号</code>执行：</p>
<p><img src="/2021/03/15/springcloud/122.png" alt="img"></p>
</li>
</ol>
<h6 id="19-7-5-2、Nginx的配置，由他作为负载均衡器"><a href="#19-7-5-2、Nginx的配置，由他作为负载均衡器" class="headerlink" title="19.7.5.2、Nginx的配置，由他作为负载均衡器"></a>19.7.5.2、Nginx的配置，由他作为负载均衡器</h6><p>在此处，已经默认 Nginx 服务已经OK，Nginx 服务跑在<code>192.168.204.202</code>。如需 Nginx 的搭建过程，请自行。</p>
<p>进入<code>nginx/conf</code> 目录，对 <code>nginx.conf</code>添加 nacos 集群配置，配置如下图所示：</p>
<p><img src="/2021/03/15/springcloud/123.png" alt="在这里插入图片描述"></p>
<p>配置完成，进入 sbin 目录，使用<code>./nginx -c /usr/local/nginx/nginx-1.16.0/conf/nginx.conf</code>启动 nginx，使用<code>-c</code>加载指定配置文件，路径为 nginx.conf 所在路径。启动完成，通过命令：<code>ps aux | grep nginx</code>查看 nginx 是否启动。如图已经启动成功。</p>
<p><img src="/2021/03/15/springcloud/124.png" alt="在这里插入图片描述"></p>
<h6 id="19-7-5-3、启动nacos集群"><a href="#19-7-5-3、启动nacos集群" class="headerlink" title="19.7.5.3、启动nacos集群"></a>19.7.5.3、启动nacos集群</h6><p>启动集群中的3台nacos。可以通过命令<code>ps -ef|grep nacos|grep -v grep grep |wc -l</code>查看nacos集群启用的端口数量，也可以通过nacos安装路径logs目录，使用 <code>tail -f nacos.log</code> 查看日志。</p>
<p><strong>启动成功提示：</strong></p>
<p><strong><code>如果虚拟机资源紧张，此处会一直很长时间在 nacos is starting... 状态,一定注意自己服务器的配置。</code></strong></p>
<p><img src="/2021/03/15/springcloud/126.png" alt="在这里插入图片描述"></p>
<h6 id="19-7-5-4、进入Nacos控制台"><a href="#19-7-5-4、进入Nacos控制台" class="headerlink" title="19.7.5.4、进入Nacos控制台"></a>19.7.5.4、进入Nacos控制台</h6><p>已经配置 Nginx 负载均衡，所以我们使用 Nginx 8087 端口进入Nacos 控制台：**<code>http://192.168.204.202:8087/nacos/</code>**</p>
<p><img src="/2021/03/15/springcloud/127.png" alt="在这里插入图片描述"></p>
<h6 id="19-7-5-5、查看集群节点启动情况"><a href="#19-7-5-5、查看集群节点启动情况" class="headerlink" title="19.7.5.5、查看集群节点启动情况"></a>19.7.5.5、查看集群节点启动情况</h6><p><img src="/2021/03/15/springcloud/128.png" alt="在这里插入图片描述"></p>
<h6 id="19-7-5-6、Nacos集群环境，项目application-yml中nacos地址需写-Nginx-地址"><a href="#19-7-5-6、Nacos集群环境，项目application-yml中nacos地址需写-Nginx-地址" class="headerlink" title="19.7.5.6、Nacos集群环境，项目application.yml中nacos地址需写 Nginx 地址"></a>19.7.5.6、Nacos集群环境，项目application.yml中nacos地址需写 Nginx 地址</h6><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.204</span><span class="number">.202</span><span class="string">:8087</span> <span class="comment">#配置Nacos地址(集群使用Nginx，此处需配置Nginx地址)</span></span><br></pre></td></tr></table></figure>

<p>通过访问8087端口（Ngnix）来实际访问三个nacos端口。</p>
<p><img src="/2021/03/15/springcloud/129.png" alt="在这里插入图片描述"></p>
<h3 id="20、Sentinel实现服务降级、服务熔断、服务限流"><a href="#20、Sentinel实现服务降级、服务熔断、服务限流" class="headerlink" title="20、Sentinel实现服务降级、服务熔断、服务限流"></a>20、Sentinel实现服务降级、服务熔断、服务限流</h3><p>资料查询：</p>
<p>  附官网：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel">Sentinel GitHub 官网</a></p>
<p>  中文介绍文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">Sentinel Wiki中文介绍文档</a></p>
<p>  Sentinel 使用介绍：<a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/en-us/index.html#_spring_cloud_alibaba_sentinel">Spring Cloud 关于 Sentinel 使用文档</a></p>
<h4 id="20-1、是什么"><a href="#20-1、是什么" class="headerlink" title="20.1、是什么"></a>20.1、是什么</h4><p>(本段内容摘自：Sentinel Wiki 中文文档，一句话解释Sentinel，就是之前介绍过的：Hystrix 实现服务降级、服务熔断、服务限流，Sentinel 后起之秀，更优秀)</p>
<p>随着微服务的流行，服务和服务之间的稳定性变得越来越重要。Sentinel 以流量为切入点，从<strong>流量控制</strong>、<strong>熔断降级</strong>、<strong>系统负载保护</strong>等多个维度保护服务的稳定性。</p>
<p><img src="/2021/03/15/springcloud/130.png" alt="img"></p>
<h4 id="20-2、Sentinel的特征"><a href="#20-2、Sentinel的特征" class="headerlink" title="20.2、Sentinel的特征"></a>20.2、Sentinel的特征</h4><ul>
<li><strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</li>
<li><strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</li>
<li><strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</li>
<li><strong>完善的 SPI 扩展点</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</li>
</ul>
<h4 id="20-3、Sentinel的作用"><a href="#20-3、Sentinel的作用" class="headerlink" title="20.3、Sentinel的作用"></a>20.3、Sentinel的作用</h4><p><img src="/2021/03/15/springcloud/131.png" alt="在这里插入图片描述"></p>
<p><strong>Sentinel 的开源生态：</strong></p>
<p><img src="/2021/03/15/springcloud/132.png" alt="在这里插入图片描述"></p>
<p>Sentinel 分为两个部分:</p>
<ul>
<li>核心库（Java 客户端）：不依赖任何框架/库，能够运行于所有 Java 运行时环境，同时对 Dubbo / Spring Cloud 等框架也有较好的支持。</li>
<li>控制台（Dashboard）：基于 Spring Boot 开发，打包后使用 java -jar xxx.jar 方式可以直接运行，不需要额外的 Tomcat 等应用容器。</li>
</ul>
<h4 id="20-4、安装Sentinel控制台-Dashboard"><a href="#20-4、安装Sentinel控制台-Dashboard" class="headerlink" title="20.4、安装Sentinel控制台(Dashboard)"></a>20.4、安装Sentinel控制台(Dashboard)</h4><ol>
<li><p>Sentinel Dashboard 下载地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/releases">Sentinel Dashboard 下载地址</a></p>
</li>
<li><p>环境：JDK 8，端口：<strong>8080 不被占用。</strong></p>
</li>
<li><p>在安装目录进入 cmd 控制台，使用 <strong><code>java -jar sentinel-dashboard-1.7.2.jar</code></strong> 方式直接运行。</p>
<p><img src="/2021/03/15/springcloud/133.png" alt="image-20210313024314111"></p>
</li>
<li><p>使用 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> 访问 Sentinel 图形管理界面。</p>
<p>登陆账号、密码均为：**<code>sentinel</code>**</p>
<p><img src="/2021/03/15/springcloud/134.png" alt="image-20210313024508488"></p>
</li>
<li><p>至此，Sentinel控制台(Dashboard)安装成功。</p>
</li>
</ol>
<h4 id="20-5、微服务项目整合Sentinel"><a href="#20-5、微服务项目整合Sentinel" class="headerlink" title="20.5、微服务项目整合Sentinel"></a>20.5、微服务项目整合Sentinel</h4><p>使用 <code>Sentinel</code> 最好配好 <code>Nacos</code> 一起使用。</p>
<p>启动Sentinel与Nacos的微服务，并通过<a href="http://localhost:8080与http://localhost:8848/nacos/#/login进行访问。">http://localhost:8080与http://localhost:8848/nacos/#/login进行访问。</a></p>
<p>新建微服务模块：</p>
<ol>
<li><p>添加pom依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入 sentinel 依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--nacos服务注册依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--sentinel持久化需要的依赖(后续持久化会用到,此处可有可无)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>application.yml 配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacos服务注册中心地址</span></span><br><span class="line">    <span class="comment"># 添加sentinel相关配置</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#配置sentinel dashboard地址</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span> <span class="comment">#sentinel默认8719，假如被占用了会自动从8719开始依次+1扫描。直至找到未被占用的端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露，用于监控等</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动类添加 <strong>@EnableDiscoveryClient</strong> 注解</p>
</li>
<li><p>业务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLimitController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动项目，查看Sentinel是否成功监控：</p>
<p>此时进入 Sentinel 图形管理界面，并没有看到关于微服务任何信息。这是因为 <strong>Sentinel 采用的<code>懒加载机制</code>，只有执行一次方法调用，才能被Sentinel监控到</strong>。 然后多次调用 /testA 接口，在实时监控便能够看到接口 调用时间、QPS、响应时间 等内容。 说明：<strong>Sentinel 8080 已经在监控微服务 8401，监控会有一丁点的延迟。服务一段时间不调用，实时监控会消失。</strong></p>
</li>
</ol>
<h4 id="20-6、Spring-Cloud-Alibaba-Sentinel-流控、降级、热点、系统规则"><a href="#20-6、Spring-Cloud-Alibaba-Sentinel-流控、降级、热点、系统规则" class="headerlink" title="20.6、Spring Cloud Alibaba Sentinel 流控、降级、热点、系统规则"></a>20.6、Spring Cloud Alibaba Sentinel 流控、降级、热点、系统规则</h4><p><img src="/2021/03/15/springcloud/135.png" alt="image-20210313190605946"></p>
<h5 id="20-6-1、流控规则"><a href="#20-6-1、流控规则" class="headerlink" title="20.6.1、流控规则"></a>20.6.1、流控规则</h5><p>流控规则，即：流量控制规则。可自行参考官网介绍：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">GitHub 流量控制</a>。具体配置有 <strong><code>资源名</code>**、</strong><code>针对来源</code><strong>、</strong><code>阈值类型</code><strong>、</strong><code>是否集群</code><strong>、</strong><code>流控模式</code><strong>、</strong><code>单机阈值</code><strong>、</strong><code>流控效果</code>** 这几项，它们配合进行使用。</p>
<p>可以通过<code>簇点链路</code>的方式添加，也可以通过<code>流控规则</code>方式添加。</p>
<p><img src="/2021/03/15/springcloud/136.png" alt="image-20210313190901838"></p>
<blockquote>
<p>**<code>资源名</code>**：唯一路径，默认为请求路径（也可以是后续介绍的 @SentinelResource 注解的 value 属性值）<br>**<code>针对来源</code>**：Sentinel 可以针对调用者进行限流，填写微服务名。默认为 default（不区分来源）<br>**<code>是否集群</code>**：本文为单机测试，是否集群不选</p>
</blockquote>
<h6 id="20-6-1-1、阈值类型：QPS"><a href="#20-6-1-1、阈值类型：QPS" class="headerlink" title="20.6.1.1、阈值类型：QPS"></a>20.6.1.1、阈值类型：QPS</h6><p><strong>QPS（每秒钟的请求数量）</strong>：当调用该 API 的 <strong><code>QPS</code></strong> 达到阈值的时候，进行限流。</p>
<p><strong>配置(默认流控模式为<code>直接</code>，流控效果为<code>快速失败</code>)：</strong></p>
<p><img src="/2021/03/15/springcloud/137.png" alt="在这里插入图片描述"></p>
<p><strong>效果</strong>：/testA 服务，每秒只允许调用 1 次，超出阈值后，直接失败（流控 Sentinel 默认提示：**<code>Blocked by Sentinel(flow limiting)</code>**）</p>
<h6 id="20-6-1-2、阈值类型：线程数"><a href="#20-6-1-2、阈值类型：线程数" class="headerlink" title="20.6.1.2、阈值类型：线程数"></a>20.6.1.2、阈值类型：线程数</h6><p><strong>线程数</strong>：当调用该 API 的 <strong><code>线程数</code></strong> 达到阈值的时候，进行限流。</p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/138.png" alt="在这里插入图片描述"></p>
<p><strong>效果</strong>：</p>
<p>/testA 服务，单个线程只允许调用 1 次，超出阈值后，直接失败（流控 Sentinel 默认提示：**<code>Blocked by Sentinel(flow limiting)</code>**）</p>
<h6 id="20-6-1-3、流控模式：直接"><a href="#20-6-1-3、流控模式：直接" class="headerlink" title="20.6.1.3、流控模式：直接"></a>20.6.1.3、流控模式：直接</h6><p><strong>效果</strong>：超出阈值后，直接失败。</p>
<h6 id="20-6-1-4、流控模式：关联"><a href="#20-6-1-4、流控模式：关联" class="headerlink" title="20.6.1.4、流控模式：关联"></a>20.6.1.4、流控模式：关联</h6><p><strong>关联</strong>：当关联的资源达到阈值时，就限流自己。**<code>当与 A 资源关联的 B 资源达到阈值时，就限流自己(A)</code>**，即：B惹事，A挂了</p>
<p><strong>应用场景：</strong></p>
<p>双十一，<code>支付接口</code>和<code>下单接口</code>关联。当支付接口达到阈值，就限流下单接口。</p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/139.png" alt="在这里插入图片描述"></p>
<p><strong>效果</strong>：</p>
<p><code>/testA</code> 服务关联<code>/testB</code> 服务，1s 调用 1次，服务正常。当狂点刷新调用 <code>/testB</code> 服务，超出阈值 QPS = 1 后，此时 /testA 被限流了，这就是 **<code>B惹事，A挂了</code>**。</p>
<h6 id="20-6-1-5、流控模式：链路"><a href="#20-6-1-5、流控模式：链路" class="headerlink" title="20.6.1.5、流控模式：链路"></a>20.6.1.5、流控模式：链路</h6><p>链路：当链路中的资源达到阈值时，就会对使用到该资源的链路进行流控。当A01 资源达到设定阈值时，所有调用该服务的链路，都会被限流，即：A01 挂了，用到我的链路都得挂。</p>
<p>此处会用到 @SentinelResource 注解 value 属性值 作为资源名。此处只是使用一下。</p>
<p>模拟两条请求链路：</p>
<p>A链路： A → A01 → A04 → A05<br>B链路： B → A01 → A02 → A03</p>
<p><img src="/2021/03/15/springcloud/140.png" alt="在这里插入图片描述"></p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/141.png" alt="在这里插入图片描述"></p>
<p><strong>效果</strong>：</p>
<p>对 <strong><code>testA01</code></strong> 服务进行 <strong><code>链路</code></strong> 流控，该服务关联有 A 和 B 两条链路。当 A 链路1s 调用 1次，服务正常。当该链路调用 **<code>超出阈值 QPS = 1 后，此时A链路都会被限流，同时因为B链路也调用 testA01，所以B链路也会同时被限流调用</code>**。</p>
<h6 id="20-6-1-6、用postman进行循环访问"><a href="#20-6-1-6、用postman进行循环访问" class="headerlink" title="20.6.1.6、用postman进行循环访问"></a>20.6.1.6、用postman进行循环访问</h6><ol>
<li><p>postman里新建多线程集合组：</p>
<p><img src="/2021/03/15/springcloud/springcloud%5C142.png" alt="img"></p>
</li>
<li><p>访问地址添加进新线程组：</p>
<p><img src="/2021/03/15/springcloud/143.png" alt="img"></p>
</li>
<li><p>run：</p>
<p><img src="/2021/03/15/springcloud/144.png" alt="img"></p>
</li>
</ol>
<h6 id="20-6-1-7、流控效果：快速失败"><a href="#20-6-1-7、流控效果：快速失败" class="headerlink" title="20.6.1.7、流控效果：快速失败"></a>20.6.1.7、流控效果：快速失败</h6><p>效果：</p>
<p>直接失败。（流控 Sentinel 默认提示：**<code>Blocked by Sentinel(flow limiting)</code>**）</p>
<h6 id="20-6-1-8、流控效果：Warm-Up"><a href="#20-6-1-8、流控效果：Warm-Up" class="headerlink" title="20.6.1.8、流控效果：Warm Up"></a>20.6.1.8、流控效果：Warm Up</h6><p><strong>Warm Up</strong>：某个服务，日常访问量很少，基本为 0，突然1s访问量 10w，这种极端情况，会直接将服务击垮。所以通过配置 <strong><code>流控效果：Warm Up</code>**，允许系统慢慢呼呼的进行</strong>预热**，经<code>预热时长</code>逐渐升至设定的QPS阈值。以下图片来自<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">官网</a>。</p>
<p><img src="/2021/03/15/springcloud/145.png" alt="image">限限流 冷启动：（以下来自<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8">官网</a>）</p>
<p>当流量突然增大的时候，我们常常会希望系统从空闲状态到繁忙状态的切换的时间长一些。即如果系统在此之前长期处于空闲的状态，我们希望处理请求的数量是缓步的增多，经过预期的时间以后，到达系统处理请求个数的最大值。Warm Up（冷启动，预热）模式就是为了实现这个目的的。</p>
<p>这个场景主要用于启动需要额外开销的场景，例如建立数据库连接等。</p>
<p>它的实现是在 <a target="_blank" rel="noopener" href="https://github.com/google/guava/blob/master/guava/src/com/google/common/util/concurrent/SmoothRateLimiter.java">Guava</a> 的算法的基础上实现的。然而，和 Guava 的场景不同，Guava 的场景主要用于调节请求的间隔，即 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Leaky_bucket">Leaky Bucket</a>，而 Sentinel 则主要用于控制每秒的 QPS，即我们满足每秒通过的 QPS 即可，我们不需要关注每个请求的间隔，换言之，我们更像一个 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Token_bucket">Token Bucket</a>。</p>
<p>默认 <code>coldFactor</code> 为 3，即请求 QPS 从 <code>threshold / 3</code> 开始，经预热时长逐渐升至设定的 QPS 阈值。</p>
<blockquote>
<p><strong>公式：</strong>阈值/coldFactor（默认值为3）</p>
</blockquote>
<p>源码：</p>
<p><img src="/2021/03/15/springcloud/147.png" alt="img"></p>
<p><strong>应用场景：</strong></p>
<p>秒杀系统。秒杀系统在开启的瞬间，会有很多的流量上来，很有可能将系统打死。预热方式就是为了保护系统，可以慢慢的将流量放进来，最终将阈值增长到指定的数值。</p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/146.png" alt="在这里插入图片描述"></p>
<p>效果：</p>
<p><code>/testA</code> 服务，设置 QPS 单机阈值为 10，采用 Warm Up 预热的方式，预热时长为 5s。根据计算公式 **<code>10 / 3 = 3</code>**，前 5s 的阈值为 3，预热 5s 后阈值增长到 10。</p>
<p>即：前5s内，<strong>访问超过 3 次便会被限流；5s 后，阈值增长到 10，此时访问超过 3 次也不会被限流</strong>，<strong>这就是 Warm Up 预热效果。</strong></p>
<h6 id="20-6-1-9、流控效果：排队等待"><a href="#20-6-1-9、流控效果：排队等待" class="headerlink" title="20.6.1.9、流控效果：排队等待"></a>20.6.1.9、流控效果：排队等待</h6><p><strong>排队等待</strong>：让请求以均匀的速度通过，对应的是<code>漏桶算法</code>。这种方式主要用于处理间隔性突发的流量，例如消息队列。</p>
<p><strong>应用场景：</strong></p>
<p>在某一秒有大量的请求到来，而接下来的几秒则处于空闲状态。我们希望系统能够在接下来的空闲期间逐渐处理这些请求，而不是在第一秒直接拒绝多余的请求。**<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">官网</a>**</p>
<blockquote>
<p>注意：匀速排队模式暂时不支持 QPS &gt; 1000 的场景。</p>
</blockquote>
<p><img src="/2021/03/15/springcloud/210.png" alt="image"></p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/148.png" alt="在这里插入图片描述"></p>
<p><strong>效果</strong>：</p>
<p><code>/testA</code> 服务，设置 QPS 单机阈值为 2，每秒只接收 2 个请求。设置超时时间 5s。采用漏斗算法，让后台匀速的处理请求，而不是直接拒绝更多的请求。超时的请求则被抛弃，返回错误信息。（流控 Sentinel 默认提示：**<code>Blocked by Sentinel(flow limiting)</code>**）</p>
<h5 id="20-6-2、降级规则"><a href="#20-6-2、降级规则" class="headerlink" title="20.6.2、降级规则"></a>20.6.2、降级规则</h5><p>降级规则。可自行参考官网介绍：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7">GitHub 熔断降级</a>。降级策略有 <strong><code>慢调用比例</code>**、</strong><code>异常比例</code><strong>、</strong><code>异常数</code>** 三种。</p>
<p>熔断状态:</p>
<p>熔断有三种状态，分别为<code>OPEN</code>、<code>HALF_OPEN</code>、<code>CLOSED</code></p>
<p><img src="/2021/03/15/springcloud/150.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/149.png" alt="image-20210313202500145"></p>
<blockquote>
<p>**<code>资源名</code>**：唯一路径，默认为请求路径（也可以是后续介绍的 @SentinelResource 注解的 value 属性值）</p>
</blockquote>
<h6 id="20-6-2-1、慢调用比例"><a href="#20-6-2-1、慢调用比例" class="headerlink" title="20.6.2.1、慢调用比例"></a>20.6.2.1、慢调用比例</h6><p>慢调用比例 (<code>SLOW_REQUEST_RATIO</code>)：选择以<code>慢调用比例作为阈值</code>，需要设置允许的慢调用<code>RT（即最大的响应时间）</code>，请求的响应时间<code>大于</code>该值则统计为慢调用。当单位<code>统计时长</code>（<code>statIntervalMs</code>）内请求数目<code>大于</code>设置的<code>最小请求数目</code>，<strong>并且</strong>慢调用的比例<code>大于</code>阈值，则接下来的熔断时长内请求会<strong>自动被熔断</strong>。经过熔断时长后熔断器会进入<strong>探测恢复状态</strong>（<code>HALF-OPEN</code>状态），若接下来的一个请求响应时间小于设置的慢调用 RT 则结束熔断，若大于设置的慢调用 RT 则会再次被熔断。（以上来自<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7">官网</a>）</p>
<p><img src="/2021/03/15/springcloud/springcloud%5C151.png" alt="img"></p>
<p><strong>执行逻辑</strong>：</p>
<ul>
<li><p><strong>熔断（OPEN）：请求数大于最小请求数并且慢调用的比率大于比例阈值则发生熔断</strong>，熔断时长为用户自定义设置。</p>
</li>
<li><p><strong>探测（HALFOPEN）</strong>：当熔断过了定义的熔断时长，状态由熔断（OPEN）变为探测（HALFOPEN）。</p>
</li>
<li><p>如果接下来的一个请求小于最大RT，说明慢调用已经恢复，结束熔断，状态由探测（HALF_OPEN）变更为关闭（CLOSED）</p>
</li>
<li><p>如果接下来的一个请求大于最大RT，说明慢调用未恢复，继续熔断，熔断时长保持一致</p>
</li>
</ul>
<p>注意Sentinel默认统计的RT上限是<code>4900ms</code>，超出此阈值的都会算作4900ms，若需要变更此上限可以通过启动配置项<code>-Dcsp.sentinel.statistic.max.rt=xxx</code>来配置。</p>
<h6 id="20-6-2-2、异常比例"><a href="#20-6-2-2、异常比例" class="headerlink" title="20.6.2.2、异常比例"></a>20.6.2.2、异常比例</h6><p><strong>异常比例</strong>：<code>QPS &gt;= 5</code> &amp;&amp; <code>异常比例超过设定的阈值</code>，便会发生服务降级 。</p>
<p>异常比例为 0.0~1.0 范围内值。**<code>时间窗口就是断路器开启时间长短(降级时间)</code>** 。要看官网介绍来这里：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7#%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5">异常比例介绍</a></p>
<p><strong>图示：</strong></p>
<p><img src="/2021/03/15/springcloud/152.png" alt="在这里插入图片描述"></p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/153.png" alt="在这里插入图片描述"></p>
<p><strong>效果：</strong></p>
<p><code>/testA</code> 服务，设置 降级策略为 **<code>异常比例</code>**，异常比例设为 **<code>0.5</code>**，时间窗口为 **<code>5s</code>**。即：1s 发送6个请求，异常比例超过 50%，就会被熔断，断路器打开5s，5s后自动关闭，继续提供服务。</p>
<p>如果1s发送6次请求，前3次网页报错，因为第4次访问后，异常比例 &gt; 50%，第4次便会被熔断，报 **<code>Blocked by Sentinel(flow limiting)</code>**。5s后继续提供服务哦。</p>
<h6 id="20-6-2-3、异常数"><a href="#20-6-2-3、异常数" class="headerlink" title="20.6.2.3、异常数"></a>20.6.2.3、异常数</h6><p><strong>异常数</strong>：指的是资源 <strong><code>近1分钟</code></strong> 的异常数目，超过阈值之后会进行熔断。<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7#%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5">官网</a></p>
<p><strong>重点注意：</strong>异常数，统计时间窗口是分钟级别，若 timeWindow 小于 60s，则结束熔断状态后仍可能再次进入熔断状态。推荐 <strong><code>时间窗口一定要&gt;=60s</code></strong></p>
<p><strong>图示：</strong></p>
<p><img src="/2021/03/15/springcloud/154.png" alt="在这里插入图片描述"></p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/155.png" alt="在这里插入图片描述"></p>
<p><strong>效果：</strong></p>
<p><code>/testA</code> 服务，设置 降级策略为 **<code>异常数</code>**，异常数设为 **<code>5</code>**，时间窗口为 **<code>60s</code>**。即：调用服务，当异常数超过5个时，开启断路器，执行熔断操作。60s 后，断路器关闭，服务恢复正常。</p>
<p>执行 /testA 服务请求，因为每个请求都是异常，前5次调用正常返回，只是报异常到前台(错误页面)；第6次服务调用时，便会被降级熔断。报 **<code>Blocked by Sentinel(flow limiting)</code>**。60s后继续提供服务哦。</p>
<h5 id="20-6-3、热点规则"><a href="#20-6-3、热点规则" class="headerlink" title="20.6.3、热点规则"></a>20.6.3、热点规则</h5><p>(本段内容摘自：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81">Github 热点规则官方介绍</a>)</p>
<h6 id="20-6-3-1、何为热点？"><a href="#20-6-3-1、何为热点？" class="headerlink" title="20.6.3.1、何为热点？"></a>20.6.3.1、何为热点？</h6><p>热点即经常访问的数据。很多时候我们希望统计某个热点数据中访问频次最高的 Top K 数据，并对其访问进行限制。比如：</p>
<blockquote>
<p>商品 ID 为参数，统计一段时间内最常购买的商品 ID 并进行限制<br>用户 ID 为参数，针对一段时间内频繁访问的用户 ID 进行限制</p>
</blockquote>
<p><code>热点参数限流会统计传入参数中的热点参数，并根据配置的限流阈值与模式，对包含热点参数的资源调用进行限流</code>。 <strong>热点参数限流可以看做是一种特殊的流量控制，仅对包含热点参数的资源调用生效。</strong></p>
<p>Sentinel 利用<code>LRU 策略</code>统计最近最常访问的热点参数，结合<code>令牌桶算法</code>来进行参数级别的流控。热点参数限流支持集群模式。</p>
<p><img src="/2021/03/15/springcloud/156.png" alt="在这里插入图片描述"></p>
<h6 id="20-6-3-2、何为热点限流"><a href="#20-6-3-2、何为热点限流" class="headerlink" title="20.6.3.2、何为热点限流"></a>20.6.3.2、何为热点限流</h6><p>一句话解释：根据 url 传递进来的参数进行限流。<strong>带这个参数就限流，不带就不限流</strong>。</p>
<h6 id="20-6-3-3、热点规则"><a href="#20-6-3-3、热点规则" class="headerlink" title="20.6.3.3、热点规则"></a>20.6.3.3、热点规则</h6><p>共有 <strong><code>资源名</code>**、</strong><code>限流模式(只支持QPS模式)</code><strong>、</strong><code>参数索引</code><strong>、</strong><code>单机阈值</code><strong>、</strong><code>统计窗口时长</code><strong>、</strong><code>是否集群</code>** 六种参数；高级选项还有额外一些参数。</p>
<p><img src="/2021/03/15/springcloud/157.png" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong><code>资源名</code>**：唯一路径，默认为请求路径。</strong>此处必须是 @SentinelResource 注解的 value 属性值，配置@GetMapping 的请求路径无效）**<br><strong><code>参数索引</code>**：参数索引（从</strong><code>0</code>**开始，0表示第一个参数、1表示第二个参数）</p>
</blockquote>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/158.png" alt="在这里插入图片描述"></p>
<p><strong>效果：</strong></p>
<p>对 <code>/testC</code> 服务，配置热点key限流。当 1.第<code>二</code>个参数存在   2.一秒内调用 <code>/testC</code> 服务 &gt; 5次，满足限流规则。服务将被熔断。断路器打开，5s 后服务恢复正常。</p>
<p><strong>参数例外项配置：</strong></p>
<p><strong>需求</strong>(当请求参数name的值为Wade时，改变其限流阈值)：</p>
<p>当 name 参数值为 Wade 时，限流阈值变更为 100。此时就需要对 参数例外项 进行配置了。</p>
<p><code>参数类型</code>支持：int、double、String、long、float、char、byte 7种类型，参数值 指 name 参数的值，<code>限流阈值</code>指该参数值允许的阈值。</p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/159.png" alt="在这里插入图片描述"></p>
<p><strong>测试：</strong></p>
<p>调用 URL：</p>
<p><code>http://localhost:8401/testC?id=1&amp;name=Wade</code>，阈值为200；</p>
<p><code>http://localhost:8401/testC?id=1&amp;name=Jhon</code>，阈值为200；</p>
<h5 id="20-6-4、系统规则（不常用）"><a href="#20-6-4、系统规则（不常用）" class="headerlink" title="20.6.4、系统规则（不常用）"></a>20.6.4、系统规则（不常用）</h5><h6 id="20-6-4-1、是什么"><a href="#20-6-4-1、是什么" class="headerlink" title="20.6.4.1、是什么"></a>20.6.4.1、是什么</h6><p>系统保护规则是从应用级别的入口流量进行控制，从单台机器的<code>load</code>、<code>CPU 使用率</code>、<code>平均 RT</code>、<code>入口 QPS</code>和<code>并发线程数</code>等几个维度监控应用指标，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。</p>
<p>系统保护规则是应用整体维度的，而不是资源维度的，并且仅对入口流量生效。入口流量指的是进入应用的流量（EntryType.IN），比如 Web 服务或 Dubbo 服务端接收的请求，都属于入口流量。</p>
<p>Sentinel 系统自适应限流从整体维度对应用入口流量进行控制，结合应用的 Load、CPU 使用率、总体平均 RT、入口 QPS 和并发线程数等几个维度的监控指标，通过自适应的流控策略，让系统的入口流量和系统的负载达到一个平衡，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81">官网</a></p>
<h6 id="20-6-4-2、系统规则支持的模式"><a href="#20-6-4-2、系统规则支持的模式" class="headerlink" title="20.6.4.2、系统规则支持的模式"></a>20.6.4.2、系统规则支持的模式</h6><ul>
<li>Load 自适应（仅对 Linux/Unix-like 机器生效）：系统的 load1 作为启发指标，进行自适应系统保护。当系统 load1 超过设定的启发值，且系统当前的并发线程数超过估算的系统容量时才会触发系统保护（BBR 阶段）。系统容量由系统的 maxQps * minRt 估算得出。设定参考值一般是 CPU cores * 2.5。</li>
<li>CPU usage（1.5.0+ 版本）：当系统 CPU 使用率超过阈值即触发系统保护（取值范围 0.0-1.0），比较灵敏。</li>
<li>平均 RT：当单台机器上所有入口流量的平均 RT 达到阈值即触发系统保护，单位是毫秒。</li>
<li>并发线程数：当单台机器上所有入口流量的并发线程数达到阈值即触发系统保护。</li>
<li>入口 QPS：当单台机器上所有入口流量的 QPS 达到阈值即触发系统保护。</li>
</ul>
<h6 id="20-6-4-3、入口QPS配置"><a href="#20-6-4-3、入口QPS配置" class="headerlink" title="20.6.4.3、入口QPS配置"></a>20.6.4.3、入口QPS配置</h6><p>入口QPS，实用性还是比较危险的。 如果 sentinel 密码被修改，将你的整个系统 <strong><code>入口QPS</code></strong> 配置很小，那么整个系统就瘫痪了。</p>
<p>但是 入口QPS 有总控的功能。最终选择是否使用，还是视情况而定吧</p>
<p><strong>配置：</strong></p>
<p><img src="/2021/03/15/springcloud/160.png" alt="在这里插入图片描述"></p>
<p><strong>效果：</strong></p>
<p>整个系统，每个请求 QPS = 1 正常访问，当该请求 QPS &gt;1 就会被限流。</p>
<h5 id="20-6-5、-SentinelResource"><a href="#20-6-5、-SentinelResource" class="headerlink" title="20.6.5、@SentinelResource"></a>20.6.5、@SentinelResource</h5><p><code>@SentinelResource</code>可以说是 Sentinel 学习的突破口，搞懂了这个注解的应用，基本上就搞清楚了 Sentinel 的大部分应用场景。Sentinel 提供了 <strong>@SentinelResource 注解用于定义资源，并提供了AspectJ的扩展用于自动定义资源、处理BlockException等。</strong></p>
<h6 id="20-6-5-1、-SentinelResource-属性介绍"><a href="#20-6-5-1、-SentinelResource-属性介绍" class="headerlink" title="20.6.5.1、@SentinelResource 属性介绍"></a>20.6.5.1、@SentinelResource 属性介绍</h6><table>
<thead>
<tr>
<th align="center">属性名</th>
<th align="center">是否必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>value</strong></td>
<td align="center">是</td>
<td align="left">资源名称（必填项，需要通过 <code>value</code> 值找到对应的规则进行配置）</td>
</tr>
<tr>
<td align="center">entryType</td>
<td align="center">否</td>
<td align="left">entry类型，标记流量的方向，取值IN/OUT，默认是OUT</td>
</tr>
<tr>
<td align="center"><strong>blockHandler</strong></td>
<td align="center">否</td>
<td align="left">**处理<code>BlockException</code>的函数名称(可以理解为对Sentinel的配置进行方法兜底)**。函数要求：<br>1.必须是<code>public</code>修饰<br>2.<code>返回类型</code>与<code>原方法</code>一致<br>3. <code>参数类型</code>需要和<code>原方法</code>相匹配，并在最后加 <code>BlockException</code>类型的参数。<br>4. 默认需和原方法在同一个类中(耦合度高)。若希望使用其他类的函数，可配置<code>blockHandlerClass</code>，并<code>指定</code>blockHandlerClass里面的方法。<br></td>
</tr>
<tr>
<td align="center"><strong>blockHandlerClass</strong></td>
<td align="center">否</td>
<td align="left"><strong>存放blockHandler的类</strong>。<br>对应的处理函数必须<code>public static</code>修饰，否则无法解析，其他要求：同blockHandler。</td>
</tr>
<tr>
<td align="center"><strong>fallback</strong></td>
<td align="center">否</td>
<td align="left">**用于在抛出异常的时候提供fallback处理逻辑(可以理解为对<code>java异常</code>情况方法兜底)**。<br>fallback函数可以针对所有类型的异常（除了 <code>exceptionsToIgnore</code>里面排除掉的异常类型）进行处理。函数要求：<br>1.<code>返回类型</code>与<code>原方法</code>一致<br>2.<code>参数类型</code>需要和<code>原方法</code>相匹配，Sentinel 1.6开始，也可在方法最后加<code>Throwable</code>类型的参数。<br>3.默认需和原方法在同一个类中(耦合度高)。若希望使用其他类的函数，可配置<code>fallbackClass</code> ，并<code>指定</code>fallbackClass里面的方法。<br></td>
</tr>
<tr>
<td align="center"><strong>fallbackClass</strong></td>
<td align="center">否</td>
<td align="left"><strong>存放fallback的类</strong>。<br>对应的处理函数必须<code>static</code>修饰，否则无法解析，其他要求：同fallback。</td>
</tr>
<tr>
<td align="center"><strong>defaultFallback</strong></td>
<td align="center">否</td>
<td align="left"><strong>用于通用的 fallback 逻辑</strong>。<br>默认 fallback 函数可以针对所有类型的异常（除了<code>exceptionsToIgnore</code>里面排除掉的异常类型）进行处理。<strong>若同时配置了 fallback 和 defaultFallback，以fallback为准</strong>。函数要求：<br>1.<code>返回类型</code>与<code>原方法</code>一致<br>2.方法参数列表为<code>空</code>，或者有一个<code>Throwable </code>类型的参数。<br>3.默认需要和原方法在同一个类中(耦合度高)。若希望使用其他类的函数，可配置<code>fallbackClass</code> ，并<code>指定</code>fallbackClass 里面的方法。<br></td>
</tr>
<tr>
<td align="center"><strong>exceptionsToIgnore</strong></td>
<td align="center">否</td>
<td align="left"><strong>指定排除掉哪些异常。</strong><br>排除的异常不会计入异常统计，也不会进入fallback逻辑，而是原样抛出。</td>
</tr>
<tr>
<td align="center">exceptionsToTrace</td>
<td align="center">否</td>
<td align="left">需要trace的异常</td>
</tr>
</tbody></table>
<p>（加深标注属性为常用属性）</p>
<p><img src="/2021/03/15/springcloud/164.png" alt="img"></p>
<h6 id="20-6-5-2、fallback-指定java异常兜底方法"><a href="#20-6-5-2、fallback-指定java异常兜底方法" class="headerlink" title="20.6.5.2、fallback 指定java异常兜底方法"></a>20.6.5.2、fallback 指定java异常兜底方法</h6><p>**<code>fallback只用来处理与Java逻辑异常相关的兜底</code>**。比如：NullPointerException、ArrayIndexOutOfBoundsException 等java代码中的异常，fallback 指定的兜底方法便会生效。</p>
<p><strong>兜底方法与业务方法耦合</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testA&quot;, fallback = &quot;fallbackMethod&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;-----testA&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">fallbackMethod</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;限流请求连接(Java类异常)的兜底方法：&quot;</span> + e.getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用 fallbackClass 将兜底方法与业务解耦合</strong>：</p>
<p><img src="/2021/03/15/springcloud/161.png" alt="在这里插入图片描述"></p>
<h6 id="20-6-5-3、blockHandler-指定-Sentinel-配置兜底方法"><a href="#20-6-5-3、blockHandler-指定-Sentinel-配置兜底方法" class="headerlink" title="20.6.5.3、blockHandler 指定 Sentinel 配置兜底方法"></a>20.6.5.3、blockHandler 指定 Sentinel 配置兜底方法</h6><p>**<code>blockHandler 只用来处理 与 Sentinel 配置有关的兜底</code>**。比如：配置某资源 QPS =1，当 QPS &gt;1 时，blockHandler 指定的兜底方法便会生效。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 业务逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testB&quot;,blockHandler = &quot;exceptionMethod&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;-----testB&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">exceptionMethod</span><span class="params">(BlockException exception)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;限流@SentinelResource value 属性的兜底方法:&quot;</span> + exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用 fallbackClass 将兜底方法与业务解耦合</strong></p>
<p><img src="/2021/03/15/springcloud/162.png" alt="在这里插入图片描述"></p>
<h6 id="20-6-5-4、exceptionsToIgnore-用于指定异常不走兜底方法"><a href="#20-6-5-4、exceptionsToIgnore-用于指定异常不走兜底方法" class="headerlink" title="20.6.5.4、exceptionsToIgnore 用于指定异常不走兜底方法"></a>20.6.5.4、exceptionsToIgnore 用于指定异常不走兜底方法</h6><p>使用<code>exceptionsTolgnore</code>属性，来<code>指定某些异常不执行兜底方法，直接显示错误信息</code>。配置 ArithmeticException 异常不走兜底方法。java.lang.ArithmeticException: / by zero ，便不会再执行兜底方法，直接显示错误信息给前台页面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testA&quot;, </span></span><br><span class="line"><span class="meta">					fallback = &quot;fallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">					fallbackClass = CustomerFallback.class, </span></span><br><span class="line"><span class="meta">					exceptionsToIgnore = ArithmeticException.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;-----testA&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="20-6-5-5、defaultFallback-用于指定通用的-fallback-兜底方法"><a href="#20-6-5-5、defaultFallback-用于指定通用的-fallback-兜底方法" class="headerlink" title="20.6.5.5、defaultFallback 用于指定通用的 fallback 兜底方法"></a>20.6.5.5、defaultFallback 用于指定通用的 fallback 兜底方法</h6><p>使用 defaultFallback 来指定通用的 fallback 兜底方法。</p>
<ul>
<li>如果当前业务配置有 defaultFallback 和 fallback 两个属性，则优先执行 fallback 指定的方法。</li>
<li>如果 fallback 指定的方法不存在，还会执行 defaultFallback 指定的方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 业务逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testA&quot;,</span></span><br><span class="line"><span class="meta">        fallback = &quot;fallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">        fallbackClass = CustomerFallback.class,</span></span><br><span class="line"><span class="meta">        defaultFallback = &quot;defaultFallbackMethod&quot; //直接指定即可，使用比较简单</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;-----testA&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单独一个类，存放兜底方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerFallback</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">defaultFallbackMethod</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;通用的fallback兜底方法&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">fallbackMethod</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;限流请求连接(Java类异常)的兜底方法：&quot;</span> + e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面兜底方案面临的问题：</p>
<ol>
<li>系统默认的，没有体现我们自己的业务要求。</li>
<li>依照现有条件，我们自定义的处理方法又和业务代码耦合在一块，不直观。</li>
<li>每个业务方法都添加一个兜底的，那代码膨胀加剧。</li>
<li>全局统一的处理方法没有体现。</li>
</ol>
<p>客户自定义限流处理逻辑：</p>
<ol>
<li><p>创建CustomerBlockHandler类用于自定义限流处理逻辑：</p>
</li>
<li><p>自定义限流处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerBlockHandler</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title">handlerException</span><span class="params">(BlockException exception)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">4444</span>,<span class="string">&quot;按客戶自定义,global handlerException----1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title">handlerException2</span><span class="params">(BlockException exception)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">4444</span>,<span class="string">&quot;按客戶自定义,global handlerException----2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>RateLimitController：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RateLimitController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/byResource&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byResource&quot;,blockHandler = &quot;handleException&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">byResource</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;按资源名称限流测试OK&quot;</span>,<span class="keyword">new</span> Payment(<span class="number">2020L</span>,<span class="string">&quot;serial001&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">handleException</span><span class="params">(BlockException exception)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>,exception.getClass().getCanonicalName()+<span class="string">&quot;\t 服务不可用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/rateLimit/byUrl&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byUrl&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">byUrl</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;按url限流测试OK&quot;</span>,<span class="keyword">new</span> Payment(<span class="number">2020L</span>,<span class="string">&quot;serial002&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/rateLimit/customerBlockHandler&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;customerBlockHandler&quot;,</span></span><br><span class="line"><span class="meta">            blockHandlerClass = CustomerBlockHandler.class,</span></span><br><span class="line"><span class="meta">            blockHandler = &quot;handlerException2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">customerBlockHandler</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;按客戶自定义&quot;</span>,<span class="keyword">new</span> Payment(<span class="number">2020L</span>,<span class="string">&quot;serial003&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/15/springcloud/163.png" alt="img"></p>
</li>
</ol>
<p>Sentinel的三个核心API：</p>
<p><img src="/2021/03/15/springcloud/文件/java/我/java后台学习笔记/springcloud/springcloud/165.png" alt="image-20210314010417987"></p>
<p>注意异常降级<strong>仅针对业务异常</strong>，对 Sentinel 限流降级本身的异常（<code>BlockException</code>）不生效。为了统计异常比例或异常数，需要通过 <code>Tracer.trace(ex)</code> 记录业务异常。示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Entry entry = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  entry = SphU.entry(key, EntryType.IN, key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Write your biz code here.</span></span><br><span class="line">  <span class="comment">// &lt;&lt;BIZ CODE&gt;&gt;</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!BlockException.isBlockException(t)) &#123;</span><br><span class="line">    Tracer.trace(t);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (entry != <span class="keyword">null</span>) &#123;</span><br><span class="line">    entry.exit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="20-7、服务熔断"><a href="#20-7、服务熔断" class="headerlink" title="20.7、服务熔断"></a>20.7、服务熔断</h4><p>sentinel整合ribbon+openFeign+fallback</p>
<p>公共：</p>
<ol>
<li><p>启动nacos和启动sentinel服务</p>
</li>
<li><p>新建两个服务提供端（实现负载均衡）（详情看上面微服务项目整合Sentinel）</p>
</li>
<li><p>服务提供端的业务类PaymentController：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Long,Payment&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 模拟数据库</span></span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        hashMap.put(<span class="number">1L</span>,<span class="keyword">new</span> Payment(<span class="number">1L</span>,<span class="string">&quot;28a8c1e3bc2742d8848569891fb42181&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">2L</span>,<span class="keyword">new</span> Payment(<span class="number">2L</span>,<span class="string">&quot;bba8c1e3bc2742d8848569891ac32182&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">3L</span>,<span class="keyword">new</span> Payment(<span class="number">3L</span>,<span class="string">&quot;6ua8c1e3bc2742d8848569891xt92183&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输入1、2、3得到数据，输入4报空指针异常</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Payment payment = hashMap.get(id);</span><br><span class="line">        CommonResult&lt;Payment&gt; result = <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;from mysql,serverPort:  &quot;</span>+serverPort,payment);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建服务消费端</p>
</li>
<li><p>业务类CircleBreakerController</p>
</li>
</ol>
<h5 id="20-7-1、Ribbon系列"><a href="#20-7-1、Ribbon系列" class="headerlink" title="20.7.1、Ribbon系列"></a>20.7.1、Ribbon系列</h5><ol>
<li><p>添加sentinel依赖pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>application.yml配置文件：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">84</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="comment">#配置Sentinel dashboard地址</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#消费者将要去访问的微服务名称(注册成功进nacos的微服务提供者)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动添加@EnableDiscoveryClient</p>
</li>
<li><p>添加RestTemplate配置类ApplicationContextConfig(<strong>添加@LoadBalanced</strong>)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="20-7-2、OpenFeign系列（Feign组件一般是在消费者侧）"><a href="#20-7-2、OpenFeign系列（Feign组件一般是在消费者侧）" class="headerlink" title="20.7.2、OpenFeign系列（Feign组件一般是在消费者侧）"></a>20.7.2、OpenFeign系列（Feign组件一般是在消费者侧）</h5><ol>
<li><p>添加OpenFeign依赖pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud openfeign --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>application.yml配置文件（激活Sentinel对Feign的支持）：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">84</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="comment">#配置Sentinel dashboard地址</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#消费者将要去访问的微服务名称(注册成功进nacos的微服务提供者)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 激活Sentinel对Feign的支持</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动类添加注解：@EnableFeignClients</p>
</li>
<li><p>service接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;,fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>全局fallback实现service接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title">PaymentService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(Long id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">44444</span>,<span class="string">&quot;服务降级返回,---PaymentFallbackService&quot;</span>,<span class="keyword">new</span> Payment(id,<span class="string">&quot;errorSerial&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>业务类CircleBreakerController：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleBreakerController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SERVICE_URL = <span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//@SentinelResource(value = &quot;fallback&quot;) //没有配置</span></span><br><span class="line">    <span class="comment">//@SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;) //fallback只负责业务异常</span></span><br><span class="line">    <span class="comment">//@SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;) //blockHandler只负责sentinel控制台配置违规</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;,blockHandler = &quot;blockHandler&quot;,</span></span><br><span class="line"><span class="meta">            exceptionsToIgnore = &#123;IllegalArgumentException.class&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">fallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="string">&quot;/paymentSQL/&quot;</span>+id,CommonResult.class,id);</span><br><span class="line">空指针异常</span><br><span class="line">        <span class="comment">// 输入4报非法参数异常，输入其他报空指针异常</span></span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException (<span class="string">&quot;IllegalArgumentException,非法参数异常，输入其他报....&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (result.getData() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException (<span class="string">&quot;NullPointerException,该ID没有对应记录,空指针异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//本例是fallback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">handlerFallback</span><span class="params">(<span class="meta">@PathVariable</span>  Long id,Throwable e)</span> </span>&#123;</span><br><span class="line">        Payment payment = <span class="keyword">new</span> Payment(id,<span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">444</span>,<span class="string">&quot;兜底异常handlerFallback,exception内容  &quot;</span>+e.getMessage(),payment);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//本例是blockHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">blockHandler</span><span class="params">(<span class="meta">@PathVariable</span>  Long id,BlockException blockException)</span> </span>&#123;</span><br><span class="line">        Payment payment = <span class="keyword">new</span> Payment(id,<span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">445</span>,<span class="string">&quot;blockHandler-sentinel限流,无此流水: blockException  &quot;</span>+blockException.getMessage(),payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================OpenFeign</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentService.paymentSQL(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>没有配置：@SentinelResource(value = “fallback”) （不友好）</p>
<ul>
<li><p>测试：<a target="_blank" rel="noopener" href="http://lcaolhost:84/consumer/fallback/2">http://lcaolhost:84/consumer/fallback/2</a></p>
<p><img src="/2021/03/15/springcloud/167.png" alt="image-20210314020226329"></p>
</li>
<li><p>测试：<a target="_blank" rel="noopener" href="http://lcaolhost:84/consumer/fallback/4">http://lcaolhost:84/consumer/fallback/4</a></p>
<p><img src="/2021/03/15/springcloud/168.png" alt="image-20210314020528745"></p>
</li>
<li><p>测试：<a target="_blank" rel="noopener" href="http://lcaolhost:84/consumer/fallback/5">http://lcaolhost:84/consumer/fallback/5</a></p>
<p><img src="/2021/03/15/springcloud/169.png" alt="image-20210314020917296"></p>
</li>
</ul>
</li>
<li><p>只配置fallback（只负责运行异常）：@SentinelResource(value = “fallback”,fallback = “handlerFallback”)</p>
<ul>
<li><p>测试：<a target="_blank" rel="noopener" href="http://lcaolhost:84/consumer/fallback/4">http://lcaolhost:84/consumer/fallback/4</a></p>
<p><img src="/2021/03/15/springcloud/170.png" alt="image-20210314021545779"></p>
</li>
<li><p>测试：<a target="_blank" rel="noopener" href="http://lcaolhost:84/consumer/fallback/5">http://lcaolhost:84/consumer/fallback/5</a></p>
<p><img src="/2021/03/15/springcloud/171.png" alt="image-20210314021737234"></p>
</li>
</ul>
</li>
<li><p>只配置blockHandler（只负责sentinel控制台配置违规）：@SentinelResource(value = “fallback”,blockHandler = “blockHandler”)</p>
<p>配置sentinel控制台：</p>
<p><img src="/2021/03/15/springcloud/172.png" alt="image-20210314022142172"></p>
<ul>
<li><p>测试：<a target="_blank" rel="noopener" href="http://lcaolhost:84/consumer/fallback/4%E7%82%B9%E5%87%BB%E4%B8%80%E6%AC%A1">http://lcaolhost:84/consumer/fallback/4点击一次</a></p>
<p><img src="/2021/03/15/springcloud/168.png" alt="image-20210314020528745"></p>
<p>连续点击：</p>
<p><img src="/2021/03/15/springcloud/173.png" alt="image-20210314022337780"></p>
</li>
</ul>
</li>
<li><p>fallback和blockHandler都配置：</p>
<p>若blockHandler和fallback都进行了配置，则被限流降级而抛出BlockException时<strong>只会进入blockHandler处理逻辑</strong>。</p>
</li>
</ul>
<h5 id="20-7-3、熔断框架比较"><a href="#20-7-3、熔断框架比较" class="headerlink" title="20.7.3、熔断框架比较"></a>20.7.3、熔断框架比较</h5><p><img src="/2021/03/15/springcloud/174.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/175.png" alt="img"></p>
<h4 id="20-8、Sentinel-控制台规则持久化（持久化到Nacos比较鸡肋）"><a href="#20-8、Sentinel-控制台规则持久化（持久化到Nacos比较鸡肋）" class="headerlink" title="20.8、Sentinel 控制台规则持久化（持久化到Nacos比较鸡肋）"></a>20.8、Sentinel 控制台规则持久化（持久化到Nacos比较鸡肋）</h4><p>Sentinel 控制台规则持久化问题：</p>
<p>在 Sentinel 中，我们会为多个服务进行 流控、限流、热点 等规则 的配置，但是当服务重启后再进入 Sentinel 后，发现之前配置过的规则都不在了，这样子的体验显然不友好，此时就需要我们对 Sentinel 中配置的规则规则进行持久化操作。</p>
<p>目前控制台的规则推送也是通过<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8#%E6%9F%A5%E8%AF%A2%E6%9B%B4%E6%94%B9%E8%A7%84%E5%88%99">规则查询更改 HTTP API</a>来更改规则。这也意味着这些规则 仅在内存态生效，应用重启之后，该规则会丢失。</p>
<p>以上是原始模式。当了解了原始模式之后，我们非常鼓励您通过<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%99%E6%89%A9%E5%B1%95">动态规则</a> 并结合各种外部存储来定制自己的规则源。我们推荐通过动态配置源的控制台来进行规则写入和推送，而不是通过 Sentinel 客户端直接写入到动态配置源中。在生产环境中，我们推荐 push 模式，具体可以参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%AD%E4%BD%BF%E7%94%A8-Sentinel">在生产环境使用 Sentinel</a>。也可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42437633/article/details/106443342">博客</a></p>
<p>规则管理及推送：</p>
<p><img src="/2021/03/15/springcloud/166.png" alt="在这里插入图片描述"></p>
<h5 id="20-8-1、持久化配置（鸡肋）"><a href="#20-8-1、持久化配置（鸡肋）" class="headerlink" title="20.8.1、持久化配置（鸡肋）"></a>20.8.1、持久化配置（鸡肋）</h5><p><strong>将限流配置规则持久化进Nacos保存</strong>，只要刷新8401某个rest地址，sentinel控制台的流控规则就能看到，只要Nacos里面的配置不删除，针对8401上sentinel上的流控规则持续有效。</p>
<p>步骤：</p>
<ol>
<li><p>添加依赖pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos 后续做持久化用到--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改添加application.yml（主要是datasource）：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacos服务注册中心地址</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#配置Sentinel dashboard地址</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">      <span class="comment">#添加nacos数据源配置</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">            <span class="attr">dataId:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">            <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">            <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">            <span class="attr">rule-type:</span> <span class="string">flow</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 激活Sentinel对Feign的支持</span></span><br></pre></td></tr></table></figure>

<p>其中dataId的值为${spring.application.name}。</p>
</li>
<li><p>添加nacos业务配置规则</p>
<p><img src="/2021/03/15/springcloud/176.png" alt="img"></p>
<p>其中Data ID的值为${spring.application.name}的值。</p>
</li>
<li><p>在配置中的选择json，并添加内容：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;resource&quot;</span>:<span class="string">&quot;/rateLimit/byUrl&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;limitApp&quot;</span>:<span class="string">&quot;default&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;grade&quot;</span>:<span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;count&quot;</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;strategy&quot;</span>:<span class="number">0</span>,</span><br><span class="line">		<span class="attr">&quot;controlBehavior&quot;</span>:<span class="number">0</span>,</span><br><span class="line">		&quot;clusterMode&quot;; false</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>resource：资源名称；</li>
<li>limitApp：来源应用；</li>
<li>grade：國值类型，0表示线程数，1表示QPS；</li>
<li>count：单机國值；</li>
<li>strategy：流控模式，0表示直接，1表示关联，2表示链路；</li>
<li>controlBehavior：流控效果，0表示快速失败，1表示Warm Up，2表示排队等待；</li>
<li>clusterMode：是否集群。</li>
</ul>
</li>
<li><p>重启微服务，刷新sentinel。</p>
<p>发现业务规则有了</p>
<p><img src="/2021/03/15/springcloud/177.png" alt="img"></p>
</li>
<li><p>快速访问测试接口：配置成功。</p>
<p><img src="/2021/03/15/springcloud/178.png" alt="image-20210314025406567"></p>
</li>
<li><p>关闭微服务再看sentinel：</p>
<p><img src="/2021/03/15/springcloud/179.png" alt="img"></p>
</li>
<li><p>重启微服务再看sentinel：（鸡肋）</p>
<p><img src="/2021/03/15/springcloud/180.png" alt="image-20210314025455716"></p>
</li>
</ol>
<h5 id="20-8-2、Alibaba-AHAS-与-Alibaba-Sentinel"><a href="#20-8-2、Alibaba-AHAS-与-Alibaba-Sentinel" class="headerlink" title="20.8.2、Alibaba AHAS 与 Alibaba Sentinel"></a>20.8.2、Alibaba AHAS 与 Alibaba Sentinel</h5><h6 id="20-8-2-1、AHAS是什么："><a href="#20-8-2-1、AHAS是什么：" class="headerlink" title="20.8.2.1、AHAS是什么："></a>20.8.2.1、AHAS是什么：</h6><p>应用高可用服务AHAS是一款专注于提高应用高可用能力的SaaS产品，提供应用架构自动探测、故障注入式高可用能力演练、一键应用防护和增加功能开关等功能，可以快速低成本地提升应用可用性。</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/product/87450.html">官网</a></p>
<p>Alibaba AHAS是<code>商业化</code>的（说白了就是要用钱买）</p>
<p>Alibaba Sentinel是<code>开源</code>的，任何人都能用</p>
<p>Alibaba AHAS完成了对配置信息持久化的更深一层的包装。</p>
<p>更多资料：</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/167568.html">Alibaba AHAS 与 Alibaba Sentinel的对比</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lettuce_/article/details/102799028">springcloud（11）Alibaba-AHAS 限流方式</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hosaos/article/details/91413895">Sentinel-集成阿里云AHAS控制台实现集群流控</a></p>
<h3 id="21、SpringCloud-Alibaba-Seata处理分布式事务"><a href="#21、SpringCloud-Alibaba-Seata处理分布式事务" class="headerlink" title="21、SpringCloud Alibaba Seata处理分布式事务"></a>21、SpringCloud Alibaba Seata处理分布式事务</h3><h4 id="21-1、目前微服务面临的问题"><a href="#21-1、目前微服务面临的问题" class="headerlink" title="21.1、目前微服务面临的问题"></a>21.1、目前微服务面临的问题</h4><p>在之前 <strong><code>单机单库</code></strong> 环境下，针对事务的处理还是比较简单的。尤其是结合 Spring 框架，可以说是一个@Transaction 注解走天下。事务 &amp; Spring 事务相关内容，点击链接去了解吧：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lzb348110175/article/details/104854696">事务 &amp; Spring 事务内容介绍</a></p>
<p>在如今 Spring Cloud 分布式微服务架构体系中，按业务模块划分，一个模块使用一个数据库。多个模块配合来完成一个业务，我们就从 <a target="_blank" rel="noopener" href="http://seata.io/zh-cn/docs/user/quickstart.html">官网</a> 的一个微服务实例开始吧。</p>
<h5 id="21-1-1、-用例"><a href="#21-1-1、-用例" class="headerlink" title="21.1.1、 用例"></a>21.1.1、 用例</h5><p><strong>用户购买商品的业务逻辑。整个业务逻辑由3个微服务提供支持：</strong></p>
<ul>
<li>仓储服务：对给定的商品扣除仓储数量。</li>
<li>订单服务：根据采购需求创建订单。</li>
<li>帐户服务：从用户帐户中扣除余额。</li>
</ul>
<h5 id="21-1-2、架构图"><a href="#21-1-2、架构图" class="headerlink" title="21.1.2、架构图"></a>21.1.2、架构图</h5><p><img src="/2021/03/15/springcloud/181.png" alt="在这里插入图片描述"></p>
<h5 id="21-1-3、分布式事务解决方案"><a href="#21-1-3、分布式事务解决方案" class="headerlink" title="21.1.3、分布式事务解决方案"></a>21.1.3、分布式事务解决方案</h5><p>单体应用被拆分成微服务应用，原来的三个模块被拆分成三个独立的应用，分别使用三个<code>独立的数据源</code>，业务操作需要调用三个服务来完成。此时<strong>每个服务内部的数据一致性由<code>本地事务</code>来保证</strong>，但是<strong>全局数据一致性问题是无法保证的</strong>。所以，Alibaba Seata来处理分布式事务</p>
<h4 id="21-2、是什么"><a href="#21-2、是什么" class="headerlink" title="21.2、是什么"></a>21.2、是什么</h4><p>Seata 是一款开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。 Seata 将为用户提供了**<code>AT</code>**、<code>TCC</code>、<code>SAGA</code>和<code>XA</code>事务模式，为用户打造一站式的分布式解决方案。</p>
<p>在 Seata 开源之前，Seata 对应的内部版本在阿里经济体内部一直扮演着<code>分布式一致性中间件</code>的角色，帮助经济体平稳的度过历年的双11，对各部门业务进行了有力的支撑。经过多年沉淀与积累，商业化产品先后在阿里云、金融云进行售卖。2019.1 为了打造更加完善的技术生态和普惠技术成果，Seata 正式宣布对外开源，未来 Seata 将以社区共建的形式帮助其技术更加可靠与完备。</p>
<p>此处重点介绍 **<code>AT模式</code>**，在工作中也最常用，用起来也比较简单。</p>
<p>Seata的四个模式<a target="_blank" rel="noopener" href="https://seata.io/zh-cn/docs/dev/mode/at-mode.html">官网</a>、<a target="_blank" rel="noopener" href="https://my.oschina.net/sofastack/blog/3092880">资料</a>：</p>
<ul>
<li><p><strong>AT 模式：</strong></p>
<p>提供无侵入自动补偿的事务模式，目前已支持 MySQL、 Oracle 、PostgreSQL和 TiDB的AT模式，H2 开发中</p>
</li>
<li><p>TCC 模式<a target="_blank" rel="noopener" href="https://blog.csdn.net/huaishu/article/details/89880971">资料</a>：</p>
<p>支持 TCC 模式并可与 AT 混用，灵活度更高</p>
</li>
<li><p>SAGA 模式<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38308374/article/details/108907413">资料</a>：</p>
<p>为长事务提供有效的解决方案</p>
</li>
<li><p>XA 模式<a target="_blank" rel="noopener" href="https://blog.csdn.net/yyl2733291216/article/details/106149336/">资料</a>：</p>
<p>支持已实现 XA 接口的数据库的 XA 模式</p>
</li>
</ul>
<h4 id="21-3、Seata-术语表"><a href="#21-3、Seata-术语表" class="headerlink" title="21.3、Seata 术语表"></a>21.3、Seata 术语表</h4><p>（术语即：名词介绍，以下内容摘自：Seata 官方文档 <a target="_blank" rel="noopener" href="http://seata.io/zh-cn/docs/overview/terminology.html%EF%BC%89">http://seata.io/zh-cn/docs/overview/terminology.html）</a></p>
<ul>
<li><strong>TC (Transaction Coordinator) - 事务协调者</strong><br>维护全局和分支事务的状态，驱动全局事务提交或回滚。</li>
<li><strong>TM (Transaction Manager) - 事务管理器</strong><br>定义全局事务的范围：开始全局事务、提交或回滚全局事务。</li>
<li><strong>RM (Resource Manager) - 资源管理器</strong><br>管理分支事务处理的资源，与TC交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。</li>
</ul>
<p>其中，TC 为单独部署的 <strong>Server</strong> 服务端，TM 和 RM 为嵌入到应用中的 <strong>Client</strong> 客户端。</p>
<p><img src="/2021/03/15/springcloud/182.png" alt="在这里插入图片描述"></p>
<p>Seata管理的分布式事务的典型生命周期（执行过程）：</p>
<ol>
<li>TM 向 TC 申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的 XID；</li>
<li>XID 在微服务调用链路的上下文中传播；</li>
<li>RM 向 TC 注册分支事务，将其纳入 XID 对应全局事务的管辖；</li>
<li>TM 向 TC 发起针对 XID 的全局提交或回滚决议；</li>
<li>TC 调度 XID 下管辖的全局分支事务，完成分支提交或回滚请求。</li>
</ol>
<h4 id="21-4、AT模式"><a href="#21-4、AT模式" class="headerlink" title="21.4、AT模式"></a>21.4、AT模式</h4><h5 id="21-4-1、AT-前提"><a href="#21-4-1、AT-前提" class="headerlink" title="21.4.1、AT 前提"></a>21.4.1、AT 前提</h5><ul>
<li>基于支持本地 ACID 事务的关系型数据库。</li>
<li>Java 应用，通过 JDBC 访问数据库。</li>
</ul>
<h5 id="21-4-2、AT-整体机制"><a href="#21-4-2、AT-整体机制" class="headerlink" title="21.4.2、AT 整体机制"></a>21.4.2、AT 整体机制</h5><p>两阶段提交协议的演变：</p>
<ul>
<li>一阶段：业务数据和回滚日志记录在同一个本地事务中提交，释放本地锁和连接资源。</li>
<li>二阶段：<ul>
<li>提交异步化，非常快速地完成。</li>
<li>回滚通过一阶段的回滚日志进行<code>反向补偿</code>。</li>
</ul>
</li>
</ul>
<h5 id="21-4-3、写隔离"><a href="#21-4-3、写隔离" class="headerlink" title="21.4.3、写隔离"></a>21.4.3、写隔离</h5><ul>
<li>一阶段本地事务提交前，需要确保先拿到 <strong>全局锁</strong> 。</li>
<li>拿不到 <strong>全局锁</strong> ，不能提交本地事务。</li>
<li>拿 <strong>全局锁</strong> 的尝试被限制在一定范围内，超出范围将放弃，并回滚本地事务，释放本地锁。</li>
</ul>
<p>以一个示例来说明：</p>
<p>两个全局事务 tx1 和 tx2，分别对 a 表的 m 字段进行更新操作，m 的初始值 1000。</p>
<p>tx1 先开始，开启本地事务，拿到本地锁，更新操作 m = 1000 - 100 = 900。本地事务提交前，先拿到该记录的 <strong>全局锁</strong> ，本地提交释放本地锁。 tx2 后开始，开启本地事务，拿到本地锁，更新操作 m = 900 - 100 = 800。本地事务提交前，尝试拿该记录的 <strong>全局锁</strong> ，tx1 全局提交前，该记录的全局锁被 tx1 持有，tx2 需要重试等待 <strong>全局锁</strong> 。</p>
<p><img src="/2021/03/15/springcloud/183.png" alt="img"></p>
<p>tx1 二阶段全局提交，释放 <strong>全局锁</strong> 。tx2 拿到 <strong>全局锁</strong> 提交本地事务。</p>
<p><img src="/2021/03/15/springcloud/184.png" alt="img"></p>
<p>如果 tx1 的二阶段全局回滚，则 tx1 需要重新获取该数据的本地锁，进行反向补偿的更新操作，实现分支的回滚。</p>
<p>此时，如果 tx2 仍在等待该数据的 <strong>全局锁</strong>，同时持有本地锁，则 tx1 的分支回滚会失败。分支的回滚会一直重试，直到 tx2 的 <strong>全局锁</strong> 等锁超时，放弃 <strong>全局锁</strong> 并回滚本地事务释放本地锁，tx1 的分支回滚最终成功。</p>
<p>因为整个过程 <strong>全局锁</strong> 在 tx1 结束前一直是被 tx1 持有的，所以不会发生 <strong>脏写</strong> 的问题。</p>
<h5 id="21-4-4、读隔离"><a href="#21-4-4、读隔离" class="headerlink" title="21.4.4、读隔离"></a>21.4.4、读隔离</h5><p>在数据库本地事务隔离级别 <strong>读已提交（Read Committed）</strong> 或以上的基础上，Seata（AT 模式）的默认全局隔离级别是 <strong>读未提交（Read Uncommitted）</strong> 。</p>
<p>如果应用在特定场景下，必需要求全局的 <strong>读已提交</strong> ，目前 Seata 的方式是通过 SELECT FOR UPDATE 语句的代理。</p>
<p><img src="/2021/03/15/springcloud/185.png" alt="img"></p>
<p>SELECT FOR UPDATE 语句的执行会申请 <strong>全局锁</strong> ，如果 <strong>全局锁</strong> 被其他事务持有，则释放本地锁（回滚 SELECT FOR UPDATE 语句的本地执行）并重试。这个过程中，查询是被 block 住的，直到 <strong>全局锁</strong> 拿到，即读取的相关数据是 <strong>已提交</strong> 的，才返回。</p>
<p>出于总体性能上的考虑，Seata 目前的方案<strong>并没有对所有 SELECT 语句都进行代理</strong>，仅针对 FOR UPDATE 的 SELECT 语句。</p>
<h5 id="21-4-5、工作机制"><a href="#21-4-5、工作机制" class="headerlink" title="21.4.5、工作机制"></a>21.4.5、工作机制</h5><p>以一个示例来说明整个 AT 分支的工作过程。</p>
<p>业务表：<code>product</code></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Key</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PRI</td>
</tr>
<tr>
<td>name</td>
<td>varchar(100)</td>
<td></td>
</tr>
<tr>
<td>since</td>
<td>varchar(100)</td>
<td></td>
</tr>
</tbody></table>
<p><strong>AT 分支事务的业务逻辑：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">&#x27;GTS&#x27;</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h6 id="21-4-5-1、一阶段"><a href="#21-4-5-1、一阶段" class="headerlink" title="21.4.5.1、一阶段"></a>21.4.5.1、一阶段</h6><p>过程：</p>
<ol>
<li>解析 SQL：得到 SQL 的类型（UPDATE），表（product），条件（where name = ‘TXC’）等相关的信息。</li>
<li>查询前镜像：根据解析得到的条件信息，生成查询语句，定位数据。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span>, since <span class="keyword">from</span> product <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>得到前镜像：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>TXC</td>
<td>2021</td>
</tr>
</tbody></table>
<ol>
<li>执行业务 SQL：更新这条记录的 name 为 ‘GTS’。</li>
<li>查询后镜像：根据前镜像的结果，通过 <strong>主键</strong> 定位数据。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span>, since <span class="keyword">from</span> product <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span><span class="string">`;</span></span><br></pre></td></tr></table></figure>

<p>得到后镜像：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>GTS</td>
<td>2021</td>
</tr>
</tbody></table>
<p>插入回滚日志：把前后镜像数据以及业务 SQL 相关的信息组成一条回滚日志记录，插入到 <code>UNDO_LOG</code> 表中。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;branchId&quot;</span>: <span class="number">641789253</span>,</span><br><span class="line">	<span class="attr">&quot;undoItems&quot;</span>: [&#123;</span><br><span class="line">		<span class="attr">&quot;afterImage&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;rows&quot;</span>: [&#123;</span><br><span class="line">				<span class="attr">&quot;fields&quot;</span>: [&#123;</span><br><span class="line">					<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;type&quot;</span>: <span class="number">4</span>,</span><br><span class="line">					<span class="attr">&quot;value&quot;</span>: <span class="number">1</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;type&quot;</span>: <span class="number">12</span>,</span><br><span class="line">					<span class="attr">&quot;value&quot;</span>: <span class="string">&quot;GTS&quot;</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;since&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;type&quot;</span>: <span class="number">12</span>,</span><br><span class="line">					<span class="attr">&quot;value&quot;</span>: <span class="string">&quot;2021&quot;</span></span><br><span class="line">				&#125;]</span><br><span class="line">			&#125;],</span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span>: <span class="string">&quot;product&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">&quot;beforeImage&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;rows&quot;</span>: [&#123;</span><br><span class="line">				<span class="attr">&quot;fields&quot;</span>: [&#123;</span><br><span class="line">					<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;type&quot;</span>: <span class="number">4</span>,</span><br><span class="line">					<span class="attr">&quot;value&quot;</span>: <span class="number">1</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;type&quot;</span>: <span class="number">12</span>,</span><br><span class="line">					<span class="attr">&quot;value&quot;</span>: <span class="string">&quot;TXC&quot;</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;since&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;type&quot;</span>: <span class="number">12</span>,</span><br><span class="line">					<span class="attr">&quot;value&quot;</span>: <span class="string">&quot;2021&quot;</span></span><br><span class="line">				&#125;]</span><br><span class="line">			&#125;],</span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span>: <span class="string">&quot;product&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">&quot;sqlType&quot;</span>: <span class="string">&quot;UPDATE&quot;</span></span><br><span class="line">	&#125;],</span><br><span class="line">	<span class="attr">&quot;xid&quot;</span>: <span class="string">&quot;xid:xxx&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>提交前，向 TC注册分支：申请 <code>product</code> 表中，主键值等于 1 的记录的<strong>全局锁</strong>.</li>
<li>本地事务提交：业务数据的更新和前面步骤中生成的 UNDO LOG 一并提交。</li>
<li>将本地事务提交的结果上报给 TC。</li>
</ol>
<h6 id="21-4-5-2、二阶段-回滚"><a href="#21-4-5-2、二阶段-回滚" class="headerlink" title="21.4.5.2、二阶段-回滚"></a>21.4.5.2、二阶段-回滚</h6><ol>
<li><p>收到 TC 的分支回滚请求，开启一个本地事务，执行如下操作。</p>
</li>
<li><p>通过 XID 和 Branch ID 查找到相应的 UNDO LOG 记录。</p>
</li>
<li><p>数据校验：拿 UNDO LOG 中的后镜与当前数据进行比较，如果有不同，说明数据被当前全局事务之外的动作做了修改（脏写）。这种情况，需要根据配置策略来做处理，详细的说明在另外的文档中介绍。</p>
</li>
<li><p>根据 UNDO LOG 中的前镜像和业务 SQL 的相关信息生成并执行回滚的语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">&#x27;TXC&#x27;</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>提交本地事务。并把本地事务的执行结果（即分支事务回滚的结果）上报给 TC。</p>
</li>
</ol>
<h6 id="21-4-5-3、二阶段-提交"><a href="#21-4-5-3、二阶段-提交" class="headerlink" title="21.4.5.3、二阶段-提交"></a>21.4.5.3、二阶段-提交</h6><ol>
<li>收到 TC 的分支提交请求，把请求放入一个异步任务的队列中，马上返回提交成功的结果给 TC。</li>
<li>异步任务阶段的分支提交请求将异步和批量地删除相应<code>UNDO LOG</code>记录。</li>
</ol>
<p>回滚事务表：</p>
<p>UNDO_LOG Table：不同数据库在类型上会略有差别。</p>
<p>以 MySQL 为例：</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>branch_id</td>
<td>bigint PK</td>
</tr>
<tr>
<td>xid</td>
<td>varchar(100)</td>
</tr>
<tr>
<td>context</td>
<td>varchar(128)</td>
</tr>
<tr>
<td>rollback_info</td>
<td>longblob</td>
</tr>
<tr>
<td>log_status</td>
<td>tinyint</td>
</tr>
<tr>
<td>log_created</td>
<td>datetime</td>
</tr>
<tr>
<td>log_modified</td>
<td>datetime</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注意此处0.7.0+ 增加字段 context</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`undo_log`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`branch_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`xid`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`context`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`rollback_info`</span> longblob <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`log_status`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`log_created`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`log_modified`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`ux_undo_log`</span> (<span class="string">`xid`</span>,<span class="string">`branch_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<h6 id="21-4-5-4、总结"><a href="#21-4-5-4、总结" class="headerlink" title="21.4.5.4、总结"></a>21.4.5.4、总结</h6><ul>
<li>是什么</li>
</ul>
<p><img src="/2021/03/15/springcloud/186.png" alt="img"></p>
<ul>
<li>一阶段加载：</li>
</ul>
<p><img src="/2021/03/15/springcloud/187.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/188.png" alt="img"></p>
<ul>
<li>二阶段提交：</li>
</ul>
<p><img src="/2021/03/15/springcloud/189.png" alt="img"></p>
<ul>
<li>二阶段回滚：</li>
</ul>
<p><img src="/2021/03/15/springcloud/190.png" alt="img"></p>
<p><img src="/2021/03/15/springcloud/191.png" alt="img"></p>
<h4 id="21-5、Spring-Cloud-整合-Nacos-1-3-1-Seata-1-2-0-集群部署-Windows版"><a href="#21-5、Spring-Cloud-整合-Nacos-1-3-1-Seata-1-2-0-集群部署-Windows版" class="headerlink" title="21.5、Spring Cloud 整合 Nacos 1.3.1 + Seata 1.2.0 集群部署(Windows版)"></a>21.5、Spring Cloud 整合 Nacos 1.3.1 + Seata 1.2.0 集群部署(Windows版)</h4><h5 id="21-5-1、环境说明"><a href="#21-5-1、环境说明" class="headerlink" title="21.5.1、环境说明"></a>21.5.1、环境说明</h5><p><strong>部署环境+版本：</strong> <strong><code>MySQL 5.7.x</code></strong> + <strong><code>Nacos 1.3.1</code></strong> + <strong><code>Seata 1.2.0</code></strong> + **<code>Windows 环境演示</code>**，Linux 部署类似。</p>
<h5 id="21-5-2、Seata-1-2-0-下载"><a href="#21-5-2、Seata-1-2-0-下载" class="headerlink" title="21.5.2、Seata 1.2.0 下载"></a>21.5.2、Seata 1.2.0 下载</h5><p>进入 <a target="_blank" rel="noopener" href="http://seata.io/zh-cn/blog/download.html">Seata 官网下载地址</a> 或者 <a target="_blank" rel="noopener" href="https://github.com/seata/seata/releases/tag/v1.2.0">Seata Github下载地址</a>，选择 Seata 1.2.0 版本下载。</p>
<h5 id="21-5-3、官网新人文档中的资源目录介绍"><a href="#21-5-3、官网新人文档中的资源目录介绍" class="headerlink" title="21.5.3、官网新人文档中的资源目录介绍"></a>21.5.3、官网新人文档中的资源目录介绍</h5><p><img src="/2021/03/15/springcloud/192.png" alt="在这里插入图片描述"></p>
<p><strong>详细说明</strong></p>
<p><img src="/2021/03/15/springcloud/193.png" alt="在这里插入图片描述"></p>
<h5 id="21-5-4、Seata-Server-端配置"><a href="#21-5-4、Seata-Server-端配置" class="headerlink" title="21.5.4、Seata Server 端配置"></a>21.5.4、Seata Server 端配置</h5><h6 id="21-5-4-1、解压"><a href="#21-5-4-1、解压" class="headerlink" title="21.5.4.1、解压"></a>21.5.4.1、解压</h6><p>将下载的 <strong><code>seata-server-1.2.0.zip</code></strong> 解压到某个路径下（注意该路径不要有中文或空格）。</p>
<h6 id="21-5-4-2、MySQL-数据库配置"><a href="#21-5-4-2、MySQL-数据库配置" class="headerlink" title="21.5.4.2、MySQL 数据库配置"></a>21.5.4.2、MySQL 数据库配置</h6><p>1、执行MySQL数据库操作前，需要我们手动创建一个名称为 <strong><code>seata</code></strong> 的数据库，然后在该数据库下建表。建库命令如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> seata <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/15/springcloud/194.png" alt="image-20210314232019841"></p>
<p>进入 <a target="_blank" rel="noopener" href="https://github.com/seata/seata/tree/1.2.0/script">资源目录</a> <strong><code>seata/script/server/db/mysql.sql</code></strong> ，执行SQL语句。建表语句如下，你也可以点击链接获取。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------</span></span><br><span class="line"><span class="comment">-- the table to store GlobalSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`global_table`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`xid`</span>                       <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`transaction_id`</span>            <span class="built_in">BIGINT</span>,</span><br><span class="line">    <span class="string">`status`</span>                    <span class="built_in">TINYINT</span>      <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`application_id`</span>            <span class="built_in">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="string">`transaction_service_group`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="string">`transaction_name`</span>          <span class="built_in">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">    <span class="string">`timeout`</span>                   <span class="built_in">INT</span>,</span><br><span class="line">    <span class="string">`begin_time`</span>                <span class="built_in">BIGINT</span>,</span><br><span class="line">    <span class="string">`application_data`</span>          <span class="built_in">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    <span class="string">`gmt_create`</span>                DATETIME,</span><br><span class="line">    <span class="string">`gmt_modified`</span>              DATETIME,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`xid`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_gmt_modified_status`</span> (<span class="string">`gmt_modified`</span>, <span class="string">`status`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_transaction_id`</span> (<span class="string">`transaction_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store BranchSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`branch_table`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`branch_id`</span>         <span class="built_in">BIGINT</span>       <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`xid`</span>               <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`transaction_id`</span>    <span class="built_in">BIGINT</span>,</span><br><span class="line">    <span class="string">`resource_group_id`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="string">`resource_id`</span>       <span class="built_in">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    <span class="string">`branch_type`</span>       <span class="built_in">VARCHAR</span>(<span class="number">8</span>),</span><br><span class="line">    <span class="string">`status`</span>            <span class="built_in">TINYINT</span>,</span><br><span class="line">    <span class="string">`client_id`</span>         <span class="built_in">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">    <span class="string">`application_data`</span>  <span class="built_in">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    <span class="string">`gmt_create`</span>        DATETIME(<span class="number">6</span>),</span><br><span class="line">    <span class="string">`gmt_modified`</span>      DATETIME(<span class="number">6</span>),</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`branch_id`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_xid`</span> (<span class="string">`xid`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store lock data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`lock_table`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`row_key`</span>        <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`xid`</span>            <span class="built_in">VARCHAR</span>(<span class="number">96</span>),</span><br><span class="line">    <span class="string">`transaction_id`</span> <span class="built_in">BIGINT</span>,</span><br><span class="line">    <span class="string">`branch_id`</span>      <span class="built_in">BIGINT</span>       <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`resource_id`</span>    <span class="built_in">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    <span class="string">`table_name`</span>     <span class="built_in">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="string">`pk`</span>             <span class="built_in">VARCHAR</span>(<span class="number">36</span>),</span><br><span class="line">    <span class="string">`gmt_create`</span>     DATETIME,</span><br><span class="line">    <span class="string">`gmt_modified`</span>   DATETIME,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`row_key`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_branch_id`</span> (<span class="string">`branch_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/15/springcloud/195.png" alt="在这里插入图片描述"></p>
<h6 id="21-5-4-3、Server端参数项配置"><a href="#21-5-4-3、Server端参数项配置" class="headerlink" title="21.5.4.3、Server端参数项配置"></a>21.5.4.3、Server端参数项配置</h6><p>解压后，进入 <strong><code>conf</code></strong> 目录开始参数的配置。我们修改 <strong><code>file.conf</code></strong> 和 <strong><code>registry.conf</code></strong> 这两个文件。</p>
<p><img src="/2021/03/15/springcloud/196.png" alt="在这里插入图片描述"></p>
<ol>
<li><p><strong>对 file.conf 配置：</strong></p>
<p><img src="/2021/03/15/springcloud/197.png" alt="在这里插入图片描述"></p>
</li>
<li><p><strong>对 registry.conf 配置：</strong></p>
<p><img src="/2021/03/15/springcloud/198.png" alt="在这里插入图片描述"></p>
</li>
</ol>
<h6 id="21-5-4-4、启动Seata-Server端"><a href="#21-5-4-4、启动Seata-Server端" class="headerlink" title="21.5.4.4、启动Seata Server端"></a>21.5.4.4、启动Seata Server端</h6><p>进入 bin 目录，双击 <strong><code>seata-server.bat</code></strong> 启动。（Linux环境请选择 seata-server.sh 启动）</p>
<p><img src="/2021/03/15/springcloud/199.png" alt="在这里插入图片描述"></p>
<p>到此为止，Seata Server 端启动完成。</p>
<h4 id="21-5-5、config-center-配置中心配置"><a href="#21-5-5、config-center-配置中心配置" class="headerlink" title="21.5.5、config-center 配置中心配置"></a>21.5.5、config-center 配置中心配置</h4><p>配置中心的配置，本文使用 nacos 作为配置中心。</p>
<h6 id="21-5-5-1、获取要配置的参数信息"><a href="#21-5-5-1、获取要配置的参数信息" class="headerlink" title="21.5.5.1、获取要配置的参数信息"></a>21.5.5.1、获取要配置的参数信息</h6><p>进入 <a target="_blank" rel="noopener" href="https://github.com/seata/seata/tree/1.2.0/script">资源目录</a> <strong><code>seata/script/config-center/config.txt</code></strong> ，展示的是 Seata 1.2.0 版本所有配置中心的内容，全部配置点击链接查看。本文使用db方式，故选择db相关配置，需要用到的配置如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">service.vgroupMapping.my_test_tx_group=default  </span><br><span class="line">service.default.grouplist=127.0.0.1:8091</span><br><span class="line">service.enableDegrade=false</span><br><span class="line">service.disableGlobalTransaction=false</span><br><span class="line">store.mode=db  /*此处修改为db*/</span><br><span class="line">store.db.datasource=druid</span><br><span class="line">store.db.dbType=mysql</span><br><span class="line">store.db.driverClassName=com.mysql.jdbc.Driver  /*自定义修改*/</span><br><span class="line">store.db.url=jdbc:mysql://192.168.204.201:3306/seata?useUnicode=true /*自定义修改*/</span><br><span class="line">store.db.user=root  /*自定义修改*/</span><br><span class="line">store.db.password=root  /*自定义修改*/</span><br><span class="line">store.db.minConn=5</span><br><span class="line">store.db.maxConn=30</span><br><span class="line">store.db.globalTable=global_table</span><br><span class="line">store.db.branchTable=branch_table</span><br><span class="line">store.db.queryLimit=100</span><br><span class="line">store.db.lockTable=lock_table</span><br><span class="line">store.db.maxWait=5000</span><br></pre></td></tr></table></figure>

<h6 id="21-5-5-2、将参数配置到Nacos配置中心"><a href="#21-5-5-2、将参数配置到Nacos配置中心" class="headerlink" title="21.5.5.2、将参数配置到Nacos配置中心"></a>21.5.5.2、将参数配置到Nacos配置中心</h6><p>进入 资源目录 seata/script/config-center/nacos/nacos-config.sh ，该配置会将 seata 相关配置批量添加到 nacos 服务器。</p>
<p>该脚本可以随便放在某个位置，只要脚本 nacos-config.sh 能够读取到 config.txt 文件即可。本文放在如下为止</p>
<p><img src="/2021/03/15/springcloud/200.png" alt="在这里插入图片描述"></p>
<p>你自己打开<code>nacos-config.sh</code>脚本 看看它查找 config.txt 的逻辑就可以了，只要能够读取到 config.txt 文件即可。nacos-config.sh 脚本支持传入<code>四个参数</code>：</p>
<ul>
<li>-h nacos 所在服务器的IP地址，默认为 localhost</li>
<li>-p nacos 端口号，默认为 8848</li>
<li>-g nacos 配置所属 group 名称，默认为 SEATA_GROUP</li>
<li>-t 将 nacos 配置保存到指定的命名空间，默认为 “”，代表 public 命名空间（注意：-t 参数值接收的是 命名空间ID，不是 命名空间名称） </li>
</ul>
<p>使用 <strong>git 命令框</strong> 执行 <strong><code>sh nacos-config.sh</code></strong> ，就可以将配置批量保存到 nacos 服务器。如下图所示：</p>
<p><img src="/2021/03/15/springcloud/201.gif" alt="在这里插入图片描述"></p>
<p>到此为止，Config Center 配置中心参数，配置完成。</p>
<h4 id="21-5-6、client-客户端配置"><a href="#21-5-6、client-客户端配置" class="headerlink" title="21.5.6、client 客户端配置"></a>21.5.6、client 客户端配置</h4><h5 id="21-5-6-1、业务场景"><a href="#21-5-6-1、业务场景" class="headerlink" title="21.5.6.1、业务场景"></a>21.5.6.1、业务场景</h5><p>用户购买商品的业务逻辑。整个业务逻辑由3个微服务提供支持：</p>
<ul>
<li>订单服务A：根据采购需求创建订单。</li>
<li>仓储服务B：对给定的商品扣除仓储数量。</li>
<li>帐户服务C：从用户帐户中扣除余额。</li>
</ul>
<p>用户A购买商品，调用<code>A服务</code>创建订单完成，调用<code>B服务</code>扣减库存，然后调用<code>C服务</code>扣减账户余额。<strong>每个服务内部的数据一致性由本地事务来保证，多个服务调用来完成业务，全局事务数据一致性则由 Seata 来保证。</strong></p>
<h5 id="21-5-6-2、业务数据库准备"><a href="#21-5-6-2、业务数据库准备" class="headerlink" title="21.5.6.2、业务数据库准备"></a>21.5.6.2、业务数据库准备</h5><p>配置三个业务分别对应各自的数据库。</p>
<ul>
<li>A服务 对应数据库：seata_order ；表：t_order</li>
<li>B服务 对应数据库：seata_storage ；表：t_storage</li>
<li>C服务 对应数据库：seata_account ；表：t_account</li>
</ul>
<p><strong>建库，建表语句如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建seata_order数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> seata_order;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建t_order表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> seata_order.t_order(</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="string">`user_id`</span> <span class="built_in">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">    <span class="string">`product_id`</span> <span class="built_in">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;产品id&#x27;</span>,</span><br><span class="line">    <span class="string">`count`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">    <span class="string">`money`</span> <span class="built_in">DECIMAL</span>(<span class="number">11</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;金额&#x27;</span>,</span><br><span class="line">    <span class="string">`status`</span> <span class="built_in">INT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;订单状态：0：创建中; 1：已完结&#x27;</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">7</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建seata_storage数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> seata_storage;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建t_storage表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> seata_storage.t_storage(</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="string">`product_id`</span> <span class="built_in">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;产品id&#x27;</span>,</span><br><span class="line">    <span class="string">`total`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;总库存&#x27;</span>,</span><br><span class="line">    <span class="string">`used`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;已用库存&#x27;</span>,</span><br><span class="line">    <span class="string">`residue`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;剩余库存&#x27;</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入一条数据 </span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_storage.t_storage(<span class="string">`id`</span>,<span class="string">`product_id`</span>,<span class="string">`total`</span>,<span class="string">`used`</span>,<span class="string">`residue`</span>)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;100&#x27;</span>,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;100&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建seata_account数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> seata_account;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建t_account表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> seata_account.t_account(</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    <span class="string">`user_id`</span> <span class="built_in">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">    <span class="string">`total`</span> <span class="built_in">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;总额度&#x27;</span>,</span><br><span class="line">    <span class="string">`used`</span> <span class="built_in">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;已用余额&#x27;</span>,</span><br><span class="line">    <span class="string">`residue`</span> <span class="built_in">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;剩余可用额度&#x27;</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入一条数据 </span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_account.t_account(<span class="string">`id`</span>,<span class="string">`user_id`</span>,<span class="string">`total`</span>,<span class="string">`used`</span>,<span class="string">`residue`</span>) <span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1000&#x27;</span>,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1000&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="21-5-6-3、创建-undo-log-表"><a href="#21-5-6-3、创建-undo-log-表" class="headerlink" title="21.5.6.3、创建 undo_log 表"></a>21.5.6.3、创建 undo_log 表</h5><p>进入 <a target="_blank" rel="noopener" href="https://github.com/seata/seata/tree/1.2.0/script">资源目录</a> <strong><code>seata/script/client/at/db/mysql.sql</code></strong> ，展示的就是 undo_log 表的建表语句，该表需要在涉及到事务处理的每个库中都添加以下。undo_log 表建表语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`undo_log`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`id`</span>            <span class="built_in">BIGINT</span>(<span class="number">20</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&#x27;increment id&#x27;</span>,</span><br><span class="line">    <span class="string">`branch_id`</span>     <span class="built_in">BIGINT</span>(<span class="number">20</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;branch transaction id&#x27;</span>,</span><br><span class="line">    <span class="string">`xid`</span>           <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;global transaction id&#x27;</span>,</span><br><span class="line">    <span class="string">`context`</span>       <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;undo_log context,such as serialization&#x27;</span>,</span><br><span class="line">    <span class="string">`rollback_info`</span> LONGBLOB     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;rollback info&#x27;</span>,</span><br><span class="line">    <span class="string">`log_status`</span>    <span class="built_in">INT</span>(<span class="number">11</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;0:normal status,1:defense status&#x27;</span>,</span><br><span class="line">    <span class="string">`log_created`</span>   DATETIME     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;create datetime&#x27;</span>,</span><br><span class="line">    <span class="string">`log_modified`</span>  DATETIME     <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;modify datetime&#x27;</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`ux_undo_log`</span> (<span class="string">`xid`</span>, <span class="string">`branch_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span></span><br><span class="line">  AUTO_INCREMENT = <span class="number">1</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8 <span class="keyword">COMMENT</span> =<span class="string">&#x27;AT transaction mode undo table&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="21-5-6-4、库表创建完成图示"><a href="#21-5-6-4、库表创建完成图示" class="headerlink" title="21.5.6.4、库表创建完成图示"></a>21.5.6.4、库表创建完成图示</h5><p><img src="/2021/03/15/springcloud/202.png" alt="在这里插入图片描述"></p>
<h5 id="21-5-6-5、添加-pom-依赖"><a href="#21-5-6-5、添加-pom-依赖" class="headerlink" title="21.5.6.5、添加 pom 依赖"></a>21.5.6.5、添加 pom 依赖</h5><p>pom.xml 部分的注意事项，可参考：<a target="_blank" rel="noopener" href="https://seata.io/zh-cn/docs/ops/deploy-guide-beginner.html">部署指南-注意事项</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="21-5-6-7、application-yml-针对-seata-进行配置"><a href="#21-5-6-7、application-yml-针对-seata-进行配置" class="headerlink" title="21.5.6.7、application.yml 针对 seata 进行配置"></a>21.5.6.7、application.yml 针对 seata 进行配置</h5><p>进入<a target="_blank" rel="noopener" href="https://github.com/seata/seata/tree/1.2.0/script">资源目录</a><code>seata/script/client/spring/</code>，展示的就是 seata 整合 Spring 的全部配置内容，提供了<code>.properties</code>、<code>.yml</code>两种格式的配置。详细的配置项还挺多，此处就不粘贴了，你可以点击 资源目录 查看。此处挑选了本案例需要的部分内容进行配置，配置如下所示：（项目application.yml完整配置，请参考文末项目完整代码）</p>
<p><code>该配置在每个服务模块都需要配置一份</code>，你也可以通过 nacos 配置中心的方式配置使用。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">application-id:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">  <span class="attr">tx-service-group:</span> <span class="string">my_test_tx_group</span></span><br><span class="line">  <span class="attr">enable-auto-data-source-proxy:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">vgroup-mapping:</span></span><br><span class="line">      <span class="attr">my_test_tx_group:</span> <span class="string">default</span>  <span class="comment"># 此处key需要与tx-service-group的value一致，否则会报 no available service &#x27;null&#x27; found, please make sure registry config correct 异常</span></span><br><span class="line">    <span class="attr">grouplist:</span></span><br><span class="line">      <span class="attr">default:</span> <span class="number">192.168</span><span class="number">.41</span><span class="number">.113</span><span class="string">:8091</span></span><br><span class="line">    <span class="attr">enable-degrade:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable-global-transaction:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">namespace:</span></span><br><span class="line">      <span class="attr">serverAddr:</span> <span class="number">192.168</span><span class="number">.41</span><span class="number">.113</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">SEATA_GROUP</span></span><br><span class="line">      <span class="attr">userName:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">seata-server</span>  <span class="comment"># 此处名称需和 seata server 服务端 application一致,否则会报 no available service &#x27;null&#x27; found, please make sure registry config correct 异常</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.41</span><span class="number">.113</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">namespace:</span></span><br><span class="line">      <span class="attr">userName:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>业务代码略</p>
<h4 id="21-5-7、Seata-高可用集群部署"><a href="#21-5-7、Seata-高可用集群部署" class="headerlink" title="21.5.7、Seata 高可用集群部署"></a>21.5.7、Seata 高可用集群部署</h4><h5 id="21-5-7-1、集群部署"><a href="#21-5-7-1、集群部署" class="headerlink" title="21.5.7.1、集群部署"></a>21.5.7.1、集群部署</h5><p>Seata 集群部署比较简单，只需将已配置好的 seata-server 再启动一个即可。seata 默认使用 8091 端口，此次我在 Windows 部署，所以 seata-server 第二个节点选用 8092 端口，进入 cmd 命令行，使用命令：<code>seata-server.bat -p 8092</code>启动seata-server 第二台节点。(Linux 正式环境，多机器的话，只需要 scp 到另一台机器，启动即可)</p>
<p>通过 nacos 服务列表，seata-server 实例数由 1 变为 2。端口分别为 8091、8092 。集群搭建完成，挺简单的。想要几个节点就来几个节点，so easy。<br><img src="/2021/03/15/springcloud/203.gif" alt="在这里插入图片描述"></p>
<h5 id="21-5-7-2、服务注册成功"><a href="#21-5-7-2、服务注册成功" class="headerlink" title="21.5.7.2、服务注册成功"></a>21.5.7.2、服务注册成功</h5><p>3个服务启动成功后，均会通过 RPC 的方式注册到 Seata 集群的两个节点上来，如下图所示：</p>
<p><img src="/2021/03/15/springcloud/204.png" alt="在这里插入图片描述"></p>
<h5 id="21-5-7-3、Seata集群测试"><a href="#21-5-7-3、Seata集群测试" class="headerlink" title="21.5.7.3、Seata集群测试"></a>21.5.7.3、Seata集群测试</h5><p>使用 postman 发送 50 个请求，中途关闭 8091 节点。由于集群之间通过 Nacos 通信原因，一个节点的突然宕机，会导致部分请求失败，但是服务很快便会恢复正常。</p>
<p>当再次将 8091 节点启动后，服务还是能够正常请求，8091 节点也有事务相应的日志显示，说明Seata 集群能够正常提供服务。测试如图所示：<br><img src="/2021/03/15/springcloud/205.gif" alt="在这里插入图片描述"></p>
<h4 id="21-5-8、全局事务服务-GTS-阿里云"><a href="#21-5-8、全局事务服务-GTS-阿里云" class="headerlink" title="21.5.8、全局事务服务 GTS-阿里云"></a>21.5.8、全局事务服务 GTS-阿里云</h4><h5 id="21-5-8-1、是什么"><a href="#21-5-8-1、是什么" class="headerlink" title="21.5.8.1、是什么"></a>21.5.8.1、是什么</h5><p><a target="_blank" rel="noopener" href="https://help.aliyun.com/product/48444.html">官网</a></p>
<p>全局事务服务（Global Transaction Service，简称 GTS）是一款高性能、高可靠、接入简单的分布式事务中间件，用于解决分布式环境下的事务一致性问题。 在单机数据库下很容易维持事务的 ACID（Atomicity、Consistency、Isolation、Durability）特性，但在分布式系统中并不容易，GTS 可以保证分布式系统中的分布式事务的 ACID 特性。 GTS 支持 DRDS、RDS、MySQL 等多种数据源，可以配合 EDAS 和 Dubbo 等微服务框架使用， 兼容 MQ 实现事务消息。通过各种组合，可以轻松实现分布式数据库事务、多库事务、消息事务、服务链路级事务等多种业务需求。</p>
<h5 id="21-5-8-2、GTS与Seata"><a href="#21-5-8-2、GTS与Seata" class="headerlink" title="21.5.8.2、GTS与Seata"></a>21.5.8.2、GTS与Seata</h5><ul>
<li>Seata：开源框架</li>
<li>GTS：付费的商用框架</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/23/springboot%E9%A1%B9%E7%9B%AE%E6%89%93%E6%88%90jar%E5%8C%85%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E5%9C%A8linux%E4%B8%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/springboot%E9%A1%B9%E7%9B%AE%E6%89%93%E6%88%90jar%E5%8C%85%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E5%9C%A8linux%E4%B8%8A/" class="post-title-link" itemprop="url">springboot项目打成jar包后台运行在linux上</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-23 03:15:47 / 修改时间：03:16:42" itemprop="dateCreated datePublished" datetime="2020-11-23T03:15:47+08:00">2020-11-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaee/" itemprop="url" rel="index"><span itemprop="name">javaee</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaee/springboot%E9%A1%B9%E7%9B%AE%E6%89%93%E6%88%90jar%E5%8C%85%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E5%9C%A8linux%E4%B8%8A/" itemprop="url" rel="index"><span itemprop="name">springboot项目打成jar包后台运行在linux上</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>背景：springboot2为为主体搭建的项目，直接打成jar包，上传到linux上面</p>
<p>启动项目：java -jar xx.jar 这样很方便，但是不能关闭窗口，否则项目就停了</p>
<p>后台启动： nohup java -jar xx.jar &amp; </p>
<p>这样就能后台启动了</p>
<p>有时候我们并不是部署单机版的，需要部署多个，可能部署到一台机器上，但是端口肯定得不一样吧，要是再重新打包一份就太麻烦了，我们可以在启动命令上加上启动端口参数</p>
<p>命令：nohup java -jar xx.jar –server.port=8083 &amp;</p>
<p>此时你会发现在当前目录下多了nohup.out 的文件，这个文件就是你项目的日志文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">　　　　<span class="comment">&lt;!-- 打包可执行jar包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.sanro.test.CMApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/23/springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">springboot项目的远程部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-23 03:11:44 / 修改时间：03:19:06" itemprop="dateCreated datePublished" datetime="2020-11-23T03:11:44+08:00">2020-11-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaee/" itemprop="url" rel="index"><span itemprop="name">javaee</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaee/springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/" itemprop="url" rel="index"><span itemprop="name">springboot项目的远程部署</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在之前写过一篇博客关于ssm项目远程部署<br> 地址：<a href="https://xgh-user.github.io/2020/11/23/ssm-maven%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/">在这里</a></p>
<p>该教程是基于上篇，只是有部分修改而已。</p>
<p>Springboot 远程部署需要修改一下几点：</p>
<h3 id="1、POM文件"><a href="#1、POM文件" class="headerlink" title="1、POM文件"></a>1、POM文件</h3><p>（1）打包方式，这里将jar —&gt; war<br> <img src="/2020/11/23/springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/1.jpg" alt="1"><br> （2）关于依赖<br> springboot由于内置了tomcat，所以在使用war包部署是需要移除内置tomcat，并添加servlet容器支持。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--移除嵌入式tomcat插件--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--添加servlet-api的依赖，使用war包部署这个必须要有--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.36<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="二、SpringbootApplication启动类"><a href="#二、SpringbootApplication启动类" class="headerlink" title="二、SpringbootApplication启动类"></a>二、SpringbootApplication启动类</h3><p>启动类需要继承 <strong>SpringBootServletInitializer</strong>  类，并且重写<strong>configure</strong> 方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.support.SpringBootServletInitializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloSpringbootApplication</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.sources(HelloSpringbootApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SpringApplication.run(HelloSpringbootApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只需以上两部就可以完成Springboot项目远程部署。</p>
<p>转载自：<a target="_blank" rel="noopener" href="https://blog.csdn.net/android_ztz/article/details/79262416">https://blog.csdn.net/android_ztz/article/details/79262416</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/23/ssm-maven%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/ssm-maven%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">ssm+maven项目的远程部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-23 02:58:56 / 修改时间：03:11:06" itemprop="dateCreated datePublished" datetime="2020-11-23T02:58:56+08:00">2020-11-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaee/" itemprop="url" rel="index"><span itemprop="name">javaee</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaee/ssm-maven%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/" itemprop="url" rel="index"><span itemprop="name">ssm+maven项目的远程部署</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、环境"><a href="#一、环境" class="headerlink" title="一、环境"></a>一、环境</h3><p>本教程使用的环境如下 </p>
<ul>
<li><p>idea 2017 </p>
</li>
<li><p>tomcat 8.5 </p>
</li>
<li><p>centos 7 </p>
</li>
<li><p>maven 3.5</p>
<p>注意：tomcat6 和 tomcat7、8、9会有一些区别，下面会详细介绍</p>
</li>
</ul>
<h3 id="二、配置【只需完成下面三步】"><a href="#二、配置【只需完成下面三步】" class="headerlink" title="二、配置【只需完成下面三步】"></a>二、配置【只需完成下面三步】</h3><h4 id="1、Tomcat-服务器配置"><a href="#1、Tomcat-服务器配置" class="headerlink" title="1、Tomcat 服务器配置"></a>1、Tomcat 服务器配置</h4><p>如果不了解 Tomcat 的安装，参考 <a target="_blank" rel="noopener" href="http://blog.csdn.net/android_ztz/article/details/79249467">http://blog.csdn.net/android_ztz/article/details/79249467</a> </p>
<p>找到[tomcat安装的根路径]/conf/tomcat-users.xml 文件，编辑如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;tomcat-users xmlns&#x3D;&quot;http:&#x2F;&#x2F;tomcat.apache.org&#x2F;xml&quot;</span><br><span class="line">              xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">              xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;tomcat.apache.org&#x2F;xml tomcat-users.xsd&quot;</span><br><span class="line">              version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">  &lt;role rolename&#x3D;&quot;admin-gui&quot;&#x2F;&gt;</span><br><span class="line">  &lt;role rolename&#x3D;&quot;admin-script&quot;&#x2F;&gt;</span><br><span class="line">  &lt;role rolename&#x3D;&quot;manager-gui&quot;&#x2F;&gt;</span><br><span class="line">  &lt;role rolename&#x3D;&quot;manager-script&quot;&#x2F;&gt;</span><br><span class="line">  &lt;role rolename&#x3D;&quot;manager-jmx&quot;&#x2F;&gt;</span><br><span class="line">  &lt;role rolename&#x3D;&quot;manager-status&quot;&#x2F;&gt;</span><br><span class="line">  &lt;user username&#x3D;&quot;tomcat&quot; password&#x3D;&quot;tomcat&quot; roles&#x3D;&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;tomcat-users&gt;</span><br></pre></td></tr></table></figure>

<p>role标签都是定义权限，user标签定义的是用户，usernme和password都是自定义的，roles是赋予该用户的权限。</p>
<blockquote>
<p>测试配置是否成功</p>
</blockquote>
<p>在浏览器中访问 <a href="http://yourIp:port/manager/text">http://yourIp:port/manager/text</a> (tomcat 7、8、9) ；<br> <a href="http://yourIp:port/manager/html">http://yourIp:port/manager/html</a> （tomcat 6）<br> 如果出现输入账户和密码的弹框，表示成功。</p>
<p>但是有可能会出现 <strong>【管理页面403 Access Denied】错误</strong>，详情见下面问题2：</p>
<p>【修改Tomcat端口号-默认是8080】<br> 如果需要修改，找到[tomcat安装的根路径]/conf/server.xml ，找到这一段。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port&#x3D;&quot;8080&quot; protocol&#x3D;&quot;HTTP&#x2F;1.1&quot;</span><br><span class="line">               connectionTimeout&#x3D;&quot;20000&quot;</span><br><span class="line">               redirectPort&#x3D;&quot;8443&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>只需修改port的值即可。</p>
<h3 id="二、配置Maven"><a href="#二、配置Maven" class="headerlink" title="二、配置Maven"></a>二、配置Maven</h3><p>打开[Maven的安装路径]/conf/setting.xml文件 ，找到这一段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;servers&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;tomcat8&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;username&gt;tomcat&lt;&#x2F;username&gt;</span><br><span class="line">      &lt;password&gt;tomcat&lt;&#x2F;password&gt;</span><br><span class="line">    &lt;&#x2F;server&gt;</span><br><span class="line">  &lt;&#x2F;servers&gt;</span><br></pre></td></tr></table></figure>

<p>id : tomcat+版本号<br> username : 在Tomcat配置的用户名<br> password : 在Tomcat配置的密码</p>
<h3 id="三、使用idea新建一个Maven项目，打开自动生成的pom文件，配置如下："><a href="#三、使用idea新建一个Maven项目，打开自动生成的pom文件，配置如下：" class="headerlink" title="三、使用idea新建一个Maven项目，打开自动生成的pom文件，配置如下："></a>三、使用idea新建一个Maven项目，打开自动生成的pom文件，配置如下：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;maven-v4_0_0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.ztz&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;deploy-project&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;war&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;name&gt;deploy-project Maven Webapp&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.8.1&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;defaultGoal&gt;compile&lt;&#x2F;defaultGoal&gt;</span><br><span class="line">    &lt;finalName&gt;deploy-project&lt;&#x2F;finalName&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">      &lt;!-- maven项目插件运行配置 --&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">          &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">          &lt;encoding&gt;UTF-8&lt;&#x2F;encoding&gt;</span><br><span class="line">        &lt;&#x2F;configuration&gt;</span><br><span class="line">      &lt;&#x2F;plugin&gt;</span><br><span class="line">      &lt;!-- maven远程项目部署插件 --&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.tomcat.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;tomcat7-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.2&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;!-- 填写自己服务器的IP地址和端口号,并且其他的不变,Tomcat7、8、9使用这个，Tomcat6使用另一个--&gt;</span><br><span class="line">          &lt;url&gt;http:&#x2F;&#x2F;192.168.199.133&#x2F;manager&#x2F;text&lt;&#x2F;url&gt;</span><br><span class="line">          &lt;server&gt;tomcat8&lt;&#x2F;server&gt;</span><br><span class="line">          &lt;!-- 这个账户和密码是自定义的，和Maven，Tomcat中配置要保持一致--&gt;</span><br><span class="line">          &lt;username&gt;tomcat&lt;&#x2F;username&gt;</span><br><span class="line">          &lt;password&gt;tomcat&lt;&#x2F;password&gt;</span><br><span class="line">          &lt;port&gt;80&lt;&#x2F;port&gt;</span><br><span class="line">          &lt;!-- 若tomcat项目中已存在，且使&quot;mvn tomcat7:deploy&quot;命令必须要设置下面的代码 --&gt;</span><br><span class="line">          &lt;!-- 更新项目时，仅需要执行&quot;mvn tomcat7:redeploy&quot;命令即可 --&gt;</span><br><span class="line">          &lt;!-- 上述命令无论服务器是tomcat7、8或9，均是使用&quot;mvn tomcat7:deploy&quot;或&quot;mvn tomcat7:redeploy&quot; --&gt;</span><br><span class="line">          &lt;update&gt;true&lt;&#x2F;update&gt;</span><br><span class="line">          &lt;!-- 项目路径 --&gt;</span><br><span class="line">          &lt;path&gt;&#x2F;deploy-project&lt;&#x2F;path&gt;</span><br><span class="line">        &lt;&#x2F;configuration&gt;</span><br><span class="line">      &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>最主要的配置就是<built>标签中，关于<built>详解：<br> finalName：项目名<br> server： 服务器名和版本<br> username： 和tomcat、maven中保持一致<br> password：和tomcat、maven中保持一致<br> port：需要部署到的端口，要和服务器配置的端口一致<br> path：访问项目的路径</built></built></p>
<blockquote>
<p>其他就可以和上面保持一致。</p>
</blockquote>
<p>现在已经完成了所有的配置，那么就开始测试一下能否部署成功，在idea 中点击右栏[Maven标签]<br><img src="/2020/11/23/ssm-maven%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/1.jpg"></p>
<p> 双击【tomcat7:deploy】完成部署，查看控制台信息<br><img src="/2020/11/23/ssm-maven%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2/2.jpg" alt="2"></p>
<p>—————————————- 华丽 ——————————————–</p>
<p>遇到的问题1： </p>
<ul>
<li><p>Tomcat已启动，内网可以访问，但是外网不可以访问。 </p>
<p>答 ： 这很有可能是防火墙阻止了浏览器的访问。 </p>
</li>
<li><p>解决方式：</p>
<p>centos7使用的防火墙是 firewall 而不是 iptables 可以开要访问的端口，先查看一下防火墙状态：  firewall-cmd –state ， 结是running 或者 not running ， 建议running状态下添加开放端口。 比如需要访问的是8080端口，则可以这样 </p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-port=8080/tcp     # --permanent 表示永久添加；去掉标识临时，重启后恢复 </span><br><span class="line"> firewall-cmd --reload     # 加载配置，使得修改有效。 </span><br><span class="line"> 查看端口是否开放成功？  </span><br><span class="line">firewall-cmd --permanent --zone=public --list-ports      #查看开启的端口</span><br></pre></td></tr></table></figure>

<p>如果出现 8080/tcp 表示成功 。  </p>
<p>需要了解firewall更多，点击这里。 </p>
<hr>
<ul>
<li><p>遇到的问题2： </p>
<p>管理页面403 Access Denied </p>
<p>这说明你没有权限访问， </p>
</li>
<li><p>解决方式：</p>
<p>打开/webapps/manager/META-INF/目录下context.xml文件，将下面这段注释掉或者修改为下面这段。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">allow</span>=<span class="string">&quot;127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1|\d+\.\d+\.\d+\.\d+&quot;</span> /&gt;</span>12</span><br></pre></td></tr></table></figure>

<p>原因是： \d+.\d+.\d+.\d+ 标识任访问，如果不添加这个，则只允许前面两种类型IP访问，allow中是用正则表达式来表示的。</p>
<hr>
<ul>
<li><p>遇到的问题3 ： </p>
<p>[ERROR] Failed to execute goal  org.apache.tomcat.maven:tomcat7-maven-plugin: 2.0-SNAPSHOT:deploy  (default-cli) on project helloworld: Cannot invoke Tomcat manager:  Server returned HTTP response code: 401 for URL: <a target="_blank" rel="noopener" href="http://localhost:8080/manager/text/deploy?path=/helloworld">http://localhost:8080/manager/text/deploy?path=%2Fhelloworld</a> -&gt; [Help 1]</p>
</li>
</ul>
<p>该错误是在部署时出现的，是由于权限问题，可能是你的 tomcat-users.xml中user的权限不够，也可能是你的idea中pom文件的用户名和密码错了。</p>
<p>转载自：<a target="_blank" rel="noopener" href="https://blog.csdn.net/android_ztz/article/details/79249335">https://blog.csdn.net/android_ztz/article/details/79249335</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/10/02java%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99%E5%92%8C%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/02java%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99%E5%92%8C%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">02java语法规则和规范</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-10 02:49:30 / 修改时间：02:51:45" itemprop="dateCreated datePublished" datetime="2020-11-10T02:49:30+08:00">2020-11-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javase/" itemprop="url" rel="index"><span itemprop="name">javase</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javase/java%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99%E5%92%8C%E8%A7%84%E8%8C%83/" itemprop="url" rel="index"><span itemprop="name">java语法规则和规范</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>需要掌握的内容：</p>
<ul>
<li><p>标识符</p>
</li>
<li><p>关键字</p>
</li>
<li><p>字面值</p>
</li>
<li><p>变量</p>
</li>
<li><p>数据类型</p>
</li>
<li><p>运算符：</p>
<ul>
<li>算术运算符</li>
<li>关系运算符</li>
<li>逻辑运算符</li>
<li>赋值类运算符</li>
<li>字符串连接运算符</li>
<li>三元运算符</li>
<li>赋值运算符</li>
<li>字符串连接运算符</li>
</ul>
</li>
<li><p>控制语句</p>
<ul>
<li>选择结构<ul>
<li>if,if..else</li>
<li>switch</li>
</ul>
</li>
<li>循环结构<ul>
<li>for</li>
<li>while</li>
<li>do..while()</li>
</ul>
</li>
<li>控制循环的语句<ul>
<li>break</li>
<li>continue</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1、标识符："><a href="#1、标识符：" class="headerlink" title="1、标识符："></a>1、标识符：</h3><p>1、在java程序当中，使用EditPlus工具进行代码编写的时候，</p>
<p>有一些单词是蓝色，有的是红色，有的绿色，有的是黑色，有</p>
<p>的是紫色，有的是粉色….</p>
<p>2、注意：在java源代码当中，在EditPlus工具中显示的高亮颜色为黑色时，<br>这个单词属于标识符。</p>
<p>3、标识符可以标识什么？<br>可以标识：</p>
<ul>
<li>类名</li>
<li>方法名</li>
<li>变量名</li>
<li>接口名</li>
<li>常量名</li>
<li>……</li>
</ul>
<p>4、到底什么是标识符呢？<br>一句话搞定：凡是程序员自己有权利命名的单词都是标识符。</p>
<p>5、标识符可以随意编写吗，有命名规则吗？有<br>什么是命名规则？<br>    命名规则属于语法机制，必须遵守，不遵守命名规则标识不符合语法，<br>    这样，编译器会报错。</p>
<ul>
<li><p>规则1：标识符只能由数字、字母（包括中文）、下划线_、美元符号$组成，<br>不能含有其它符号。</p>
</li>
<li><p>规则2：标识符不能以数字开头</p>
</li>
<li><p>规则3：关键字不能做标识符。例如：public class static void 这些蓝色的字体</p>
<p>都是关键字，关键字是不能做标识符的。</p>
</li>
<li><p>规则4：标识符是严格区分大小写的。大写A和小写a不一样。</p>
</li>
<li><p>规则5：标识符理论上是没有长度限制的。</p>
</li>
</ul>
<p>6、注意的点：</p>
<p>class 123ABC{<br>        }<br>    编译报错，错误信息是：<br>        错误: 需要&lt;标识符&gt;<br>    错误原因：编译器检测到class这个单词，那么编译器会从class这个<br>    单词后面找类名，而类名是标识符，编译器找了半天没有找到标识符，<br>    因为123ABC不是标识符，所以编译器提示的错误信息是：需要&lt;标识符&gt;<br>    解决办法：<br>        将123ABC修改为合法的标识符。</p>
<p>class Hello World{<br>        }<br>    <strong>类名是标识符，标识符“中”不能有空格</strong><br>    编译器错误信息是：<br>        错误: 需要’{‘<br>    编译器检测到class，然后找class后面的标识符，编译器找到了一个合法的标识符<br>    叫做“Hello”，然后编译器继续往后找“{”，结果没有找到“{”，所以报错了。<br>    解决办法：<br>        办法1：是把World删除<br>        办法2：把空格删除</p>
<p>class public {<br>        }<br>    <strong>关键字不能做标识符</strong><br>    编译器错误信息是：<br>        错误: 需要&lt;标识符&gt;</p>
<p>这个可以，因为 public1 不是关键字，可以用<br>class public1 {<br>        }</p>
<pre><code>* 虽然java中的标识符严格区分大小写
* 但是对于类名来说，如果一个java源文件中同时出现了：A类和a类
* 那么谁在前就生成谁。大家以后最好不要让类名“相同”。
* 最好类名是不同的。</code></pre>
<p>7、题目：<br>        创建一个java文件，起名 123.java可以吗？<br>        可以，完全可以，在windows操作系统中文件名叫做：123.java没毛病。<br>        123其实并不是标识符。只是一个文件名。<br>        只不过在123.java文件中无法定义public的类。<br>8、命名规范：<br>1、命名规则和命名规范有什么区别？</p>
<p>命名规则是语法，不遵守就会编译报错。</p>
<p>命名规范只是说，大家尽量按照统一的规范来进行命名，不符合规范也行，</p>
<p>代码是可以编译通过的，但是你的代码风格和大家不一样，这个通常也是不允许的。</p>
<p>规则类似于：现实世界中的法律。</p>
<p>规范类似于：现实世界中的道德。</p>
<p>统一按照规范进行的话，代码的可读性很好。代码很容易让其它开发人员理解。</p>
<p>2、具体的命名规范是哪些？</p>
<ul>
<li>规范1：见名知意（这个标识符在起名的时候，最好一看这个单词就知道啥意思。）</li>
<li>规范2：遵循驼峰命名方式，什么是驼峰（一高一低，一高一低…）<br>驼峰有利于单词与单词之间很好的进行分隔<br>BiaoShiFuTest，这个很好，一眼就能看出来是4个单词。</li>
<li>规范3：类名、接口名有特殊要求<br>类名和接口名首字母大写，后面每个单词首字母大写。<br>StudentTest、UserTest ，这是类名、接口名。</li>
<li>规范4：变量名、方法名有特殊要求<br>变量名和方法名首字母小写，后面每个单词首字母大写。<br>nianLing/age（NianLing这样就不符合了。）<br>mingZi/name（MingZi这样也不符合了。）</li>
<li>规范5：所有“常量”名：全部大写，并且单词和单词之间采用下划线衔接。<br>USER_AGE ：用户年龄<br>MATH_PI：固定不变的常量3.1415926…..</li>
</ul>
<h3 id="2、关键字："><a href="#2、关键字：" class="headerlink" title="2、关键字："></a>2、关键字：</h3><p>关键字:</p>
<p>在SUN公司开发Java语言的时候，提前定义好了一些具有特殊含义的单词，这些单词全部小写，具有特殊含义，不能用作标识符。凡是在EditPlus中以蓝色字体形式存在的都是关键字，具有特殊含义。</p>
<p>切记：</p>
<ul>
<li><p>java语言中的所有关键字都是全部小写。</p>
</li>
<li><p>注意：java语言中是严格区分大小写的。</p>
<p>public和Public不一样。</p>
<p>Class和class不一样。</p>
<p>static和Static也不一样。</p>
</li>
<li><p><strong>重点</strong>：string不是java关键字！！！</p>
</li>
</ul>
<p>Java关键字(50个)的大致含义(运用记忆)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">关键字			含义</span><br><span class="line">	<span class="keyword">abstract</span>		表明类或者成员方法具有抽象属性</span><br><span class="line">	<span class="keyword">assert</span>			用来进行程序调试</span><br><span class="line">	<span class="keyword">boolean</span>			基本数据类型之一，布尔类型</span><br><span class="line">	<span class="keyword">break</span>			提前跳出一个块</span><br><span class="line">	<span class="keyword">byte</span>			基本数据类型之一，字节类型</span><br><span class="line">	<span class="keyword">case</span>			用在<span class="keyword">switch</span>语句之中，表示其中的一个分支</span><br><span class="line">	<span class="keyword">catch</span>			用在异常处理中，用来捕捉异常</span><br><span class="line">	<span class="keyword">char</span>			基本数据类型之一，字符类型</span><br><span class="line">	<span class="class"><span class="keyword">class</span>			类</span></span><br><span class="line"><span class="class">	<span class="title">const</span>			保留关键字，没有具体含义</span></span><br><span class="line"><span class="class">	<span class="title">continue</span>		回到一个块的开始处</span></span><br><span class="line"><span class="class">	<span class="title">default</span>			默认，例如，用在<span class="title">switch</span>语句中，表明一个默认的分支</span></span><br><span class="line"><span class="class">	<span class="title">do</span>				用在<span class="title">do</span>-<span class="title">while</span>循环结构中</span></span><br><span class="line"><span class="class">	<span class="title">double</span>			基本数据类型之一，双精度浮点数类型</span></span><br><span class="line"><span class="class">	<span class="title">else</span>			用在条件语句中，表明当条件不成立时的分支</span></span><br><span class="line"><span class="class">	<span class="title">enum</span>			枚举</span></span><br><span class="line"><span class="class">	<span class="keyword">extends</span>			表明一个类型是另一个类型的子类型，这里常见的类型有类和接口</span></span><br><span class="line"><span class="class">	<span class="title">final</span>			用来说明最终属性，表明一个类不能派生出子类，或者成员方法不能被覆盖，或者成员					 	    域的值不能被改变，用来定义常量</span></span><br><span class="line"><span class="class">	<span class="title">finally</span>			用于处理异常情况，用来声明一个基本肯定会被执行到的语句块</span></span><br><span class="line"><span class="class">	<span class="title">float</span>			基本数据类型之一，单精度浮点数类型</span></span><br><span class="line"><span class="class">	<span class="title">for</span>				一种循环结构的引导词</span></span><br><span class="line"><span class="class">	<span class="title">goto</span>			保留关键字，没有具体含义</span></span><br><span class="line"><span class="class">	<span class="title">if</span>				条件语句的引导词</span></span><br><span class="line"><span class="class">	<span class="keyword">implements</span>		表明一个类实现了给定的接口</span></span><br><span class="line"><span class="class">	<span class="title">import</span>			表明要访问指定的类或包</span></span><br><span class="line"><span class="class">	<span class="title">instance</span> <span class="title">of</span>		用来测试一个对象是否是指定类型的实例对象</span></span><br><span class="line"><span class="class">	<span class="title">int</span>				基本数据类型之一，整数类型</span></span><br><span class="line"><span class="class">	<span class="title">interface</span>		接口</span></span><br><span class="line"><span class="class">	<span class="title">long</span>			基本数据类型之一，长整数类型</span></span><br><span class="line"><span class="class">	<span class="title">native</span>			用来声明一个方法是由与计算机相关的语言(如<span class="title">C</span>/<span class="title">C</span>++/<span class="title">FORTRAN</span>语言)实现的</span></span><br><span class="line"><span class="class">	<span class="title">new</span>				用来创建新实例对象</span></span><br><span class="line"><span class="class">	<span class="title">package</span>			包</span></span><br><span class="line">	private			一种访问控制方式:私用模式</span><br><span class="line">	<span class="keyword">protected</span>		一种访问控制方式:保护模式</span><br><span class="line">	<span class="keyword">public</span>			一种访问控制方式:共用模式</span><br><span class="line">	<span class="keyword">return</span>			从成员方法中返回数据</span><br><span class="line">	<span class="keyword">short</span>			基本数据类型之一,短整数类型</span><br><span class="line">	<span class="keyword">static</span>			表明具有静态属性</span><br><span class="line">	<span class="keyword">strictfp</span>		用来声明FP_strict(单精度或双精度浮点数)表达式遵循IEEE <span class="number">754</span>算术规范</span><br><span class="line">	<span class="keyword">super</span>			表明当前对象的父类型的引用或者父类型的构造方法</span><br><span class="line">	<span class="keyword">switch</span>			分支语句结构的引导词</span><br><span class="line">	<span class="keyword">synchronized</span>	表明一段代码需要同步执行</span><br><span class="line">	<span class="keyword">this</span>			指向当前实例对象的引用</span><br><span class="line">	<span class="keyword">throw</span>			抛出一个异常</span><br><span class="line">	<span class="keyword">throws</span>			声明在当前定义的成员方法中所有需要抛出的异常</span><br><span class="line">	<span class="keyword">transient</span>		声明不用序列化的成员域</span><br><span class="line">	<span class="keyword">try</span>				尝试一个可能抛出异常的程序块</span><br><span class="line">	<span class="keyword">void</span>			声明当前成员方法没有返回值</span><br><span class="line">	<span class="keyword">volatile</span>		表明两个或者多个变量必须同步地发生变化</span><br><span class="line">	<span class="keyword">while</span>			用在循环结构中</span><br></pre></td></tr></table></figure>



<h3 id="3、字面量："><a href="#3、字面量：" class="headerlink" title="3、字面量："></a>3、字面量：</h3><p>关于程序当中的数据<br>        开发软件是为了解决现实世界中的问题。<br>        而现实世界当中，有很多问题都是使用数据进行描述的。<br>        所以软件执行过程中最主要就是对数据的处理。</p>
<p>软件在处理数据之前需要能够表示数据，在java代码中怎么去表示数据呢？在java中有这样的一个概念：字面量。</p>
<p>注意：在java语言中“数据”被称为“字面量”。<br>        10<br>        1.23<br>        true<br>        false<br>        ‘a’<br>        “abc”<br>        以上这些都是数据，在程序中都被叫做“字面量”。</p>
<p>字面量可以分为很多种类：<br>    整数型字面量：1 2 3 100 -100 -20 ….<br>    浮点型字面量：1.3 1.2 3.14…..<br>    布尔型字面量：true、false没有其它值了，表示真和假,true表示真，false表示假<br>    字符型字面量：’a’、’b’、’中’<br>    字符串型字面量：”abc”、”a”、”b”、”中国”<br>其中字符型和字符串型都是描述了现实世界中的文字：<br>需要注意的是：<br>    所有的字符型只能使用单引号括起来。<br>    所有的字符串型只能使用双引号括起来。<br>    字符型一定是单个字符才能成为“字符型”<br>在语法级别上区分字符型和字符串型：<br>    主要看是双引号还是单引号。<br>    单引号的一定是字符型。<br>    双引号的一定是字符串型。</p>
<h3 id="4、变量："><a href="#4、变量：" class="headerlink" title="4、变量："></a>4、变量：</h3><p>变量的定义：<br>        变量其实就是内存当中存储数据的最基本的单元。<br>        变量就是一个存储数据的盒子。</p>
<p>在java语言当中任何数据都是有数据类型的，其中整数型是：int<br>当然，在java中除了数据类型int之外，还有其它的类型，例如带小数的：double等<br>数据类型有什么用呢？<br>    重点：不同的数据类型，在内存中分配的空间大小不同。<br>    也就是说，Java虚拟机到底给这个数据分配多大的空间，主要还是看这个变量的数据类型。<br>    根据不同的类型，分配不同大小的空间。<br>    对于int这种整数类型，JVM会自动给int分配4个字节大小的空间。</p>
<p>1个字节=8个比特位<br>1个比特位就是一个1或0. 注意：比特位是二进制位。<br>int是占用多少个二进制位？1个int占有32个二进制位（bit位）<br>int i = 1; 实际上在内存中是这样表示的：<br>    00000000 00000000 00000000 00000001<br>int i = 2;<br>    00000000 00000000 00000000 00000010<br>二进制位就是：满2进1位（0 1 10 11 100 101….）<br>十进制位就是：满10进1位（1 2 3 4 5 6 7 8 9 10）</p>
<p>对于一个变量来说，包括三要素：</p>
<ul>
<li>变量的数据类型</li>
<li>变量的名字</li>
<li>变量中保存的值</li>
</ul>
<p>类型+名字+值<br>    类型决定空间的大小。<br>    起个名字是为了以后方便访问。（以后在程序中访问这个数据是通过名称来访问的。）<br>    值是变量保存的数据。</p>
<p>变量名属于标识符</p>
<ul>
<li>变量名命名规范</li>
<li>首字母小写，后面每个单词首字母大写，遵循驼峰命名方式，见名知意。</li>
</ul>
<p>变量声明/定义的语法格式<br>    数据类型 变量名;<br>    例如：<br>        int nianLing;</p>
<p>在java语言中有一个规定，变量必须先声明，再赋值才能访问。（没有值相当于这个空间没有开辟。）<br>在java语言中给一个变量赋值呢的语法格式<br>    重点：使用一个运算符，叫做“=”，这个运算符被称为赋值运算符。<br>    赋值运算符“=”的运算特点是：等号右边先执行，执行完之后赋值给左边的变量。<br>变量声明的时候可以同时进行赋值。<br>一行同时声明多个变量。<br>重点：在同一个域当中，变量名不能重名，不能重复声明（和类型没有关系。不能同名。）。<br>变量可以重新赋值，但在同一个域当中，不能重复声明。</p>
<p>关于变量的一个分类：<br>    变量根据出现的位置进行划分：<br>        在方法体当中声明的变量：局部变量。<br>        在方法体之外，类体内声明的变量：成员变量。<br>        重点依据是：声明的位置。<br>注意：局部变量只在方法体当中有效，方法体执行结束该变量的内存就释放了。</p>
<p>变量的作用域：</p>
<ul>
<li>作用域的定义:<br>变量的有效范围。</li>
<li>关于变量的作用域，可以记住一句话：<br>出了大括号就不认识了。</li>
<li>java中有一个很重要的原则：<br>就近原则。（不仅java中是这样，其它编程语言都有这个原则。）<br>哪个离我近，就访问哪个。</li>
</ul>
<h3 id="5、数据类型："><a href="#5、数据类型：" class="headerlink" title="5、数据类型："></a>5、数据类型：</h3><p>数据类型有什么用？<br>        数据类型用来声明变量，程序在运行过程中根据不同的数据类型分配不同大小的空间。<br>        int i = 10;<br>        double d = 1.23;<br>        i变量和d变量类型不同，空间大小不同。</p>
<h4 id="总述"><a href="#总述" class="headerlink" title="总述"></a>总述</h4><ul>
<li>数据类型在java语言中包括两种：<ul>
<li>基本数据类型<br>基本数据类型又可以划分为4大类8小种：<ul>
<li>整数型<br>byte,short,int,long （没有小数的）</li>
<li>浮点型<br>float,double （带有小数的）</li>
<li>布尔型<br>boolean：只有两个值true和false，true表示真，false表示假</li>
<li>字符型<br>char：java中规定字符型字面量必须使用单引号括起来。属于文字。</li>
<li>8小种：<ul>
<li>byte,short,int,long</li>
<li>float,double</li>
<li>boolean</li>
<li>char</li>
</ul>
</li>
</ul>
</li>
<li>引用数据类型<pre><code>字符串型String属于引用数据类型。
String字符串不属于基本数据类型范畴。
java中除了基本数据类型之外，剩下的都是引用数据类型。
引用数据类型后期面向对象的时候才会接触。</code></pre>
</li>
</ul>
</li>
</ul>
<p>8种基本数据类型中<br>    整数型：byte short int long有什么区别？<br>    浮点型：float和double有什么区别？<br>    区别：占用的空间大小不同。</p>
<p>关于计算机存储单位？<br>    计算机只能识别二进制。（1001101100…）<br>    1字节 = 8bit（8比特）–&gt; 1byte = 8bit<br>    1bit就是一个1或0.<br>    1KB = 1024byte<br>    1MB = 1024KB<br>    1GB = 1024MB<br>    1TB = 1024GB</p>
<p>?    byte b = 2; 在计算机中是这样表示的：00000010<br>?    short s = 2; 在计算机中是这样表示的：00000000 00000010<br>?    int i = 2;在计算机中是这样表示的：00000000 00000000 00000000 00000010<br>?    …</p>
<p>?    类型            占用字节数量(byte)</p>
<p>?    byte                1<br>?    short                2<br>?    int                    4<br>?    long                8<br>?    float                4<br>?    double            8<br>?    boolean        1  (1byte的1或0，00000001(true)或00000000(false))<br>?    char                2</p>
<p>关于二进制：<br>1            2                3            4                5                6            7<br>1            10                11            100            101            110        111  ….<br>十进制转换成二进制<br>125 转换成二进制：<br>    办法：除以2，然后余数逆序输出：1111101<br>二进制转换成十进制<br>    2的2次方   2的1次方 2的0次方<br>    1                1            1<br>    4                2            1<br>    1<em>4 + 1</em>2 + 1*1 = 7</p>
<p>?    2的2次方   2的1次方 2的0次方<br>?    1            0            1<br>?    4            2            1<br>?    1<em>4 + 0</em>2 + 1*1 = 5</p>
<p>byte类型的取值范围：<br>    byte是 [-128 ~ 127] 共可以标识256个不同的数字。<br>    byte类型的最大值是怎么计算出来的？<br>        byte是1个字节，是8个比特位，所以byte可以存储的最大值是：01111111<br>    注意：在计算机当中，一个二进制位最左边的是符号位，当为0时表示正数，<br>    当为1时表示负数。所以byte类型最大值是：01111111<br>    那么是不是2的7次方-1呢？<br>        是不是：10000000（前边是一个二进制） - 1<br>    byte类型最大值是：2的7次方 - 1.</p>
<p>有几个取值范围需要大家记住：<br>    (1个字节)byte: [-128 ~ 127]<br>    (2个字节)short:[-32768 ~ 32767] 可以表示65536个不同的数字<br>    (4个字节)int: [-2147483648 ~ 2147483647]<br>    (2个字节)char: [0~65535]  可以表示65536个不同的数字<br>short和char实际上容量相同，不过char可以表示更大的数字。<br>因为char表示的是文字，文件没有正负之分，所以char可以表示更大的数字。</p>
<p>对于8种基本数据类型来说：<br>其中byte,short,int,long,float,double,boolean，这7种类型计算机表示起来比较容易，因为他们都是数字。其中布尔类型只有两个值true和false，实际上true和false分别在C++中对应的是1和0，1为true，false为0。<br>对于char类型来说计算机表示起来比较麻烦，因为char对应的是文字，每一个国家的文字不一样，文字不能直接通过“自然算法”转换成二进制。这个时候怎么办？字符编码诞生了。</p>
<p>什么是字符编码？<br>    字符编码是人为的定义的一套转换表。<br>    在字符编码中规定了一系列的文字对应的二进制。<br>    字符编码其实本质上就是一本字典，该字段中描述了文字与二进制之间的对照关系。<br>    字符编码是人为规定的。（是某个计算机协会规定的。）<br>    字符编码涉及到编码和解码两个过程，编码和解码的时候必须采用同一套字符编码方式，不然就会出现乱码。</p>
<p>关于字符编码的发展过程？<br>    起初的时候计算机是不支持文字的，只支持科学计算。实际上计算机起初是为了<br>    战争而开发的，计算导弹的轨道….</p>
<p>?    后来随着计算机的发展，计算机开始支持文字，最先支持的文字是英文，英文<br>?    对应的字符编码方式是：ASCII码。</p>
<p>?    ASCII码采用1byte进行存储，因为英文字母是26个。（键盘上所有的键全部算上也<br>?    超不过256个。1byte可以表示256种不同的情况。所以英文本身在计算机方面就占有<br>?    优势。）<br>?    ‘a’ –(采用ASCII码进行编码)-&gt; 01100001<br>?    01100001 –(采用ASCII码进行解码)-&gt; ‘a’<br>?    如果编码和解码采用的不是同一个编码方式，会出现乱码。<br>?    ‘b’ —&gt; 98<br>?    ‘c’ —&gt; 99…<br>?    ‘a’ —&gt; 97</p>
<p>?    ‘A’ —&gt; 65<br>?    ‘B’ —&gt; 66<br>?    …</p>
<p>?    ‘0’ —&gt; 48  （这个’0’不是那个0，是文字’0’）<br>?    ‘1’ —&gt; 49<br>?<br>?    随着计算机语言的发展，后来国际标准组织制定了ISO-8859-1编码方式，<br>?    又称为latin-1编码方式，向上兼容ASCII码。但不支持中文。<br>?    后来发展到亚洲，才支持中文，日文，韩文….<br>?    中文这块的编码方式：GB2312&lt;GBK&lt;GB18030 （容量的关系）<br>?    以上编码方式是简体中文。<br>?    繁体中文：big5（台湾使用的是大五码。）<br>?    在java中，java语言为了支持全球所有的文字，采用了一种字符编码方式<br>?    叫做unicode编码。unicode编码统一了全球所有的文字，支持所有文字。<br>?    具体的实现包括：UTF-8 UTF-16 UTF-32….    </p>
<p>需要记住：<br>    ASCII（’a’是97 ‘A’是65 ‘0’是48…）<br>    ISO-8859-1（latin-1）<br>    GB2312<br>    GBK<br>    GB18030<br>    Big5<br>    unicode（utf8 utf16 utf32）</p>
<h4 id="布尔型bollean："><a href="#布尔型bollean：" class="headerlink" title="布尔型bollean："></a>布尔型bollean：</h4><p>1、在java语言中boolean类型只有两个值，没有其他值：<br>true和false。<br>不像C或者C++，C语言中1和0也可以表示布尔类型<br>2、boolean类型在实际开发中使用在哪里呢？<br>使用在逻辑判断当中，通常放到条件的位置上（充当条件）</p>
<h4 id="字符型char："><a href="#字符型char：" class="headerlink" title="字符型char："></a>字符型char：</h4><p>1、char占用2个字节。<br>char可以存储1个汉字吗？<br>可以的，汉字占用2个字节，java中的char类型占用2个字节，正好。<br>2、char的取值范围：[0-65535]<br>3、char采用unicode编码方式。<br>4、char类型的字面量使用单引号括起来。<br>5、char可以存储一个汉字。<br>6、转义字符：<br>java语言中“\”负责转义。<br>\t 表示制表符tab<br>\n 表示制表符回车<br>System.out.println(); 换行<br>System.out.print(); 不换行<br>&#39; 表示一个普通不能再普通的单引号字符 ‘（&#39;联合起来表示一个普通的 ‘）<br>\ 表示一个“普通的反斜杠字符 <br>// 双引号括起来的是字符串<br>System.out.println(“test”);<br>// 希望输出的结果是：”test”<br>// 错误: 需要’)’<br>//System.out.println(“”test””);<br>System.out.println(““test””); //内部的双引号我用中文的行吗？可以。<br>7、整数能否直接赋值给char<br>char x = 97;<br>这个java语句是允许的，并且输出的结果是’a’<br>经过这个测试得出两个结论：</p>
<ul>
<li>当一个整数赋值给char类型变量的时候，会自动转换成char字符型，最终的结果是一个字符。</li>
<li>当一个整数没有超出byte short char的取值范围的时候，这个整数可直接赋值给byte short char类型的变量。</li>
</ul>
<h4 id="浮点型float-double"><a href="#浮点型float-double" class="headerlink" title="浮点型float/double:"></a>浮点型float/double:</h4><p>浮点型包括：<br>float            4个字节<br>double        8个字节<br>float是单精度<br>double是双精度<br>double更精确<br>比如说：<br>10.0 / 3 如果采用float来存储的话结果可能是：3.33333<br>10.0 / 3 如果采用double来存储的话结果可能是：3.3333333333333<br>但是需要注意的是，如果用在银行方面或者说使用在财务方面，double<br>也是远远不够的，在java中提供了一种精度更高的类型，这种类型专门<br>使用在财务软件方面：java.math.BigDecimal （不是基本数据类型，属于<br>引用数据类型。）<br>float和double存储数据的时候都是存储的近似值。<br>因为现实世界中有这种无线循环的数据，例如：3.3333333333333….<br>数据实际上是无限循环，但是计算机的内存有限，用一个有限的资源<br>表示无限的数据，只能存储近似值。</p>
<p>long类型占用8个字节。<br>float类型占用4个字节。<br>注意：任意一个浮点型都比整数型空间大。<br>    float容量 &gt; long容量。<br>java中规定，任何一个浮点型数据默认被当做double来处理。<br>如果想让这个浮点型字面量被当做float类型来处理，那么<br>请在字面量后面添加F/f。<br>1.0 那么1.0默认被当做double类型处理。<br>1.0F 这才是float类型。（1.0f）</p>
<h4 id="整型byte-short-int-long："><a href="#整型byte-short-int-long：" class="headerlink" title="整型byte/short/int/long："></a>整型byte/short/int/long：</h4><p>整数型在java语言中共4种类型：<br>byte    1个字节  最大值127<br>short    2个字节  最大值32767<br>int    4个字节  2147483647是int最大值，超了这个范围可以使用long类型。<br>long    8个字节<br>1个字节 = 8个二进制位<br>1byte = 8bit<br>对于以上的四个类型来说，最常用的是int。</p>
<p>在java语言中整数型字面量有4种表示形式：<br>十进制：最常用的。<br>二进制<br>八进制<br>十六进制</p>
<p>在java中有一条非常重要的结论，必须记住：<br>在任何情况下，整数型的“字面量/数据”默认被当做int类型处理。<br>如果希望该“整数型字面量”被当做long类型来处理，需要在“字面量”后面添加L/l<br>建议使用大写L，因为小写l和1傻傻分不清。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误: 整数太大</span></span><br><span class="line"><span class="keyword">long</span> e = <span class="number">2147483648</span>;</span><br></pre></td></tr></table></figure>

<p>在java中，整数型字面量一上来编译器就会将它看做int类型<br>而2147483648已经超出了int的范围，所以在没有赋值之前就出错了。<br>记住，不是e放不下2147483648，e是long类型，完全可以容纳2147483648<br>只不过2147483648本身已经超出了int范围。<br>解决问题：<br>    long e = 2147483648L;</p>
<ul>
<li>小容量可以直接赋值给大容量，称为自动类型转换。</li>
<li>大容量不能直接赋值给小容量，需要使用强制类型转换符进行强转。</li>
</ul>
<p>但需要注意的是：<br>加强制类型转换符之后，虽然编译通过了，但是运行的时候可能会损失精度。<br>大容量转换成小容量，要想编译通过，必须加强制类型转换符，进行强制类型转换。<br>但是要记住：编译虽然过了，但是运行时可能损失精度。</p>
<p>java中有一个语法规则：<br>当这个整数型字面量没有超出byte的取值范围，那么这个整数型字面量可以直接赋值给byte类型的变量。<br>当整数型字面量没有超出short类型取值范围的时候，该字面量可以直接赋值给short。<br>这种语法机制是为了方便写代码，而存在的。<br>byte、char、short做混合运算的时候，各自先转换成int再做运算。</p>
<p>计算机的数据存储方式：</p>
<ul>
<li>计算机在任何情况下都只能识别二进制</li>
<li>计算机在底层存储数据的时候，一律存储的是“二进制的补码形式”<br>计算机采用补码形式存储数据的原因是：补码形式效率最高。</li>
<li>补码：<br>实际上是这样的，二进制有：原码 反码 补码 </li>
<li>记住：<br>对于一个正数来说：二进制原码、反码、补码是同一个，完全相同。</li>
<li>分析 byte b = (byte)150;  //-106<br>这个b是多少？<br>int类型的4个字节的150的二进制码是什么？<br>00000000 00000000 00000000 10010110<br>将以上的int类型强制类型转为1个字节的byte，最终在计算机中的二进制码是：<br>10010110</li>
</ul>
<p>千万要注意：计算机永远存储的都是二进制补码形式。也就是说上面<br>10010110 这个是一个二进制补码形式，你可以采用逆推导的方式推算出<br>这个二进制补码对应的原码是啥！！！！！！<br>10010110 —&gt; 二进制补码形式<br>10010101 —&gt; 二进制反码形式<br>11101010 —&gt; 二进制原码形式 </p>
<p>计算机数据的自动转换：<br>在类型转换的时候需要遵循规则</p>
<ul>
<li>八种基本数据类型中，除 boolean 类型不能转换，剩下七种类型之间都可以进行转换；</li>
<li>如果整数型字面量没有超出 byte,short,char 的取值范围，可以直接将其赋值给byte,short,char 类型的变    量；</li>
<li>小容量向大容量转换称为自动类型转换，容量从小到大的排序为：<br>byte &lt; short(char) &lt; int &lt; long &lt; float &lt; double，其中 short和 char<br>都占用两个字节，但是char 可以表示更大的正整数；</li>
<li>大容量转换成小容量，称为强制类型转换，编写时必须添加“强制类型转换符”，但运行时可能出现精度损失，谨慎使用；</li>
<li>byte,short,char 类型混合运算时，先各自转换成 int 类型再做运算；</li>
<li>多种数据类型混合运算，各自先转换成容量最大的那一种再做运算；</li>
</ul>
<p>多种数据类型做混合运算的时候，最终的结果类型是“最大容量”对应的类型。<br>boolean &lt; (char/short/byte)int &lt; float &lt; double<br>char+short+byte 这个除外。<br>因为char + short + byte混合运算的时候，会各自先转换成int再做运算。<br>java中规定，int类型和int类型最终的结果还是int类型(最终取整)。</p>
<p>6、java中的输入和输出：<br>    输出信息到控制台：<br>        System.out.println(…);<br>    在java中怎么接收键盘的输入呢？<br>        前提：java.util.Scanner s = new java.util.Scanner(System.in);<br>        接收一个整数：<br>            int num = s.nextInt();<br>        接收一个字符串：<br>            String str = s.next();<br>        import java.util.Scanner;<br>        Scanner s = new Scanner(System.in);</p>
<h3 id="7、运算符："><a href="#7、运算符：" class="headerlink" title="7、运算符："></a>7、运算符：</h3><p>1、算术运算符：</p>
<p><code>+</code> : 求和</p>
<p><code>-</code> : 相减</p>
<p><code>*</code> : 乘积</p>
<p><code>/</code> : 商</p>
<p><code>%</code> : 求余数（求模）</p>
<p><code>++</code> : 自加1</p>
<p><code>--</code> : 自减1</p>
<pre><code>对于++运算符来说：
可以出现在变量前，也可以出现在变量后。
不管出现在变量前还是后，总之++执行结束之后，变量的值一定会自加1。
* ++出现在变量后：
 语法：当++出现在变量后，会先做赋值运算，再自加1
* ++出现在变量前：
 语法：当++出现在变量前的时候，会先进行自加1的运算，然后再赋值。 

2、关系运算符：
    &gt;    大于
    &gt;=    大于等于
    &lt;    小于
    &lt;=    小于等于
    ==    等于
    !=    不等于

    一定要记住一个规则：
        所有的关系运算符的运算结果都是布尔类型，
        不是true就是false，不可能是其他值。

    在java语言中:
        = ： 赋值运算符
        == ：关系运算符，判断是否相等。

    注意：关系运算符中如果有两个符号的话，两个符号之间不能有空格。
        &gt;= 这是对的, &gt; = 这是不对的。
        == 这是对的，= = 这是不对的。

3、逻辑运算符：
    &amp;    逻辑与（可以翻译成并且）
    |    逻辑或（可以翻译成或者）
    !    逻辑非（取反）
    &amp;&amp;    短路与
    ||    短路或

    用普通话描述的话：100 大于 99 并且 100 大于 98 ，有道理
    用代码描述的话：100 &gt; 99 &amp; 100 &gt; 98 --&gt; true

    true &amp; true --&gt; true

    非常重要：
        逻辑运算符两边要求都是布尔类型，并且最终的运算结果也是布尔类型。
        这是逻辑运算符的特点。

    100 &amp; true 不行，语法错误。
    100 &amp; 200 不行，没有这种语法。
    true &amp; false 这样可以。

    100 &gt; 90 &amp; 100 &gt; 101 --&gt; false

    &amp; 两边都是true，结果才是true
    | 有一边是true，结果就是true

    关于短路与 &amp;&amp;，短路或 ||（以短路与为例）

        * 短路与&amp;&amp; 和 逻辑与&amp; 的区别
            首先这两个运算符的运算结果没有任何区别，完全相同。
            只不过“短路与&amp;&amp;”会发生短路现象。

        * 短路现象
            右边表达式不执行，这种现象叫做短路现象。

        * 什么时候使用&amp;&amp;，什么时候使用&amp; ？
            从效率方面来说，&amp;&amp;比&amp;的效率高一些。
            因为逻辑与&amp;不管第一个表达式结果是什么，第二个表达式一定会执行。(&amp;&amp;更智能)

            以后的开发中，短路与&amp;&amp;和逻辑与还是需要同时并存的。
                大部分情况下都建议使用短路与&amp;&amp;
                只有当既需要左边表达式执行，又需要右边表达式执行的时候，才会
                选择逻辑与&amp;。
        * 什么时候会发生短路？
            int x = 10;
            int y = 11;
            // 逻辑与&amp;什么时候结果为true（两边都是true，结果才是true）
            // 左边的 x&gt;y 表达式结果已经是false了，其实整个表达式的结
            // 果已经确定是false了，按道理来说右边的表达式不应该执行。
            System.out.println(x &gt; y &amp; x &gt; y++); 

            // 通过这个测试得出：x &gt; y++ 这个表达式执行了。
            System.out.println(y); // 12

            //测试短路与&amp;&amp;
            int m = 10;
            int n = 11;
            // 使用短路与&amp;&amp;的时候，当左边的表达式为false的时候，右边的表达式不执行
            // 这种现象被称为短路。
            System.out.println(m &gt; n &amp;&amp; m &gt; n++);
            System.out.println(n); // 11

            什么时候发生短路或现象(|| 短路或)？
            // “或”的时候只要有一边是true，结果就是true。
            // 所以，当左边的表达式结果是true的时候，右边的表达式不需要执行，此时会短路。

4、赋值运算符：
    1、赋值运算符包括“基本赋值运算符”和“扩展赋值运算符”：基本的、扩展的。
    2、基本赋值运算符
        =
    3、扩展的赋值运算符
        +=
        -=
        *=
        /=
        %=
        注意：扩展赋值运算符在编写的时候，两个符号之间不能有空格。
            + =  错误的。
            += 正确的。
    4、很重要的语法机制：
        使用扩展赋值运算符的时候，永远都不会改变运算结果类型。
        byte x = 100;
        x += 1;
        x自诞生以来是byte类型，那么x变量的类型永远都是byte。不会变。
        不管后面是多大的数字。

    5、赋值运算符“=”右边优先级比较高，先执行右边的表达式
       然后将表达式执行结束的结果放到左边的“盒子”当中。（赋值）

    6、研究：
        // i += 10 和 i = i + 10 真的是完全一样吗？
        // 答案：不一样，只能说相似，其实本质上并不是完全相同。
        byte x = 100; // 100没有超出byte类型取值范围，可以直接赋值
        System.out.println(x); // 100

        // 分析：这个代码是否能够编译通过？
        // 错误: 不兼容的类型: 从int转换到byte可能会有损失
        //x = x + 1; // 编译器检测到x + 1是int类型，int类型可以直接赋值给byte类型的变量x吗？

        // 使用扩展赋值运算符可以吗？
        // 可以的，所以得出结论：x += 1 和 x = x + 1不一样。
        // 其实 x += 1 等同于：x = (byte)(x + 1);
        x += 1;
        System.out.println(x); // 101

        // 早就超出byte的取值范围了。
        x += 199; // x = (byte)(x + 199);
        System.out.println(x); // 44 （当然会自动损失精度了。）

5、条件运算符（三目运算符）：
    语法格式：
        布尔表达式 ? 表达式1 : 表达式2

    执行原理
        布尔表达式的结果为true时，表达式1的执行结果作为整个表达式的结果。
        布尔表达式的结果为false时，表达式2的执行结果作为整个表达式的结果。

6、+ 运算符：
    1、+ 运算符在java语言中有两个作用：
        作用1：求和
        作用2：字符串拼接

    2、什么时候求和？什么时候进行字符串的拼接呢？
        当 + 运算符两边都是数字类型的时候，求和。
        当 + 运算符两边的“任意一边”是字符串类型，那么这个+会进行字符串拼接操作。

    3、一定要记住：字符串拼接完之后的结果还是一个字符串。

    4、示例：
        int a = 100;
        int b = 200;
        // 注意：当一个表达式当中有多个加号的时候
        // 遵循“自左向右”的顺序依次执行。（除非额外添加了小括号，小括号的优先级高）
        // 第一个+先运算，由于第一个+左右两边都是数字，所以会进行求和。
        // 求和之后结果是300，代码就变成了：System.out.println(300 + &quot;110&quot;);
        // 那么这个时候，由于+的右边是字符串&quot;110&quot;，所以此时的+会进行字符串拼接。
        System.out.println(a + b + &quot;110&quot;); // 最后一定是一个字符串：&quot;300110&quot;

        // 先执行小括号当中的程序：b + &quot;110&quot;，这里的+会进行字符串的拼接，
        // 拼接之后的结果是：&quot;200110&quot;，这个结果是一个字符串类型。
        // 代码就变成了：System.out.println(a + &quot;200110&quot;);
        // 这个时候的+还是进行字符串的拼接。最终结果是：&quot;100200110&quot;
        System.out.println(a + (b + &quot;110&quot;));

        // 在控制台上输出&quot;100+200=300&quot;
        System.out.println(a + &quot;+&quot; + b + &quot;=&quot; + c);

        在java语言中定义字符串类型的变量
        // String是字符串类型，并且String类型不属于基本数据类型范畴，属于引用类型。
        // name是变量名，只要是合法的标识符就行。
        // &quot;jack&quot; 是一个字符串型字面量。
        String name = &quot;jack&quot;;
        // 口诀：加一个双引号&quot;&quot;，然后双引号之间加两个加号：&quot;++&quot;，然后两个加号中间加变量名：&quot;+name+&quot;
        System.out.println(&quot;登录成功欢迎&quot;+name+&quot;回来&quot;);</code></pre>
<h3 id="8、控制语句："><a href="#8、控制语句：" class="headerlink" title="8、控制语句："></a>8、控制语句：</h3><p>选择结构<br>        - if,if..else<br>            if语句的语法结构以及运行原理<br>            if语句是分支语句，也可以叫做条件语句。<br>            if语句的语法格式：<br>                第一种写法：<br>                    int a = 100;<br>                    int b = 200;<br>                    if(布尔表达式){<br>                        java语句;<br>                        java语句;<br>                    }<br>                    这里的一个大括号{} 叫做一个分支。<br>                    if 这个单词翻译为如果，所以又叫做条件语句。<br>                    该语法的执行原理是：<br>                        如果布尔表达式的结果是true，则执行大括<br>                        号中的程序，否则大括号中代码不执行。</p>
<pre><code>            第二种写法：
                if(布尔表达式)&#123;  // 分支1
                    java语句;     
                &#125;else&#123;            // 分支2
                    java语句;
                &#125;
                执行原理：
                如果布尔表达式的结果是true，则执行分支1，分支2不执行。
                如果布尔表达式的结果是false， 分支1不执行，执行分支2.
                以上的这个语句可以保证一定会有一个分支执行。
                else表示其它。

            第三种写法：
                if(布尔表达式1)&#123; // 分支1
                    java语句;
                &#125;else if(布尔表达式2)&#123; // 分支2
                    java语句;
                &#125;else if(布尔表达式3)&#123;
                    java语句;
                &#125;else if(布尔表达式4)&#123;
                    java语句;
                &#125;....
                以上if语句的执行原理：
                    先判断“布尔表达式1”，如果“布尔表达式1”为true，则执行分支1，
                    然后if语句结束了。
                    当“布尔表达式1”结果是false，那么会继续判断布尔表达式2的结果，
                    如果布尔表达式2的结果是true，则执行分支2，然后整个if就结束了。

                    从上往下依次判断，主要看第一个true发生在哪个分支上。
                    第一个true对应的分支执行，只要一个分支执行，整个if结束。

            第四种写法：
                if(布尔表达式1)&#123; // 分支1
                    java语句;
                &#125;else if(布尔表达式2)&#123; // 分支2
                    java语句;
                &#125;else if(布尔表达式3)&#123;
                    java语句;
                &#125;else if(布尔表达式4)&#123;
                    java语句;
                &#125;else&#123;
                    java语句; // 以上条件没有一个成立的。这个else就执行了。
                &#125;</code></pre>
<p>?<br>            注意：<br>                1、对于if语句来说，在任何情况下只能有1个分支执行，不可能<br>                    存在2个或者更多个分支执行。if语句中只要有1个分支执行了，<br>                    整个if语句就结束了。（对于1个完整的if语句来说的。）</p>
<pre><code>            2、以上4种语法机制中，凡是带有else分支的，一定可以保证会有
            一个分支执行。以上4种当中，第一种和第三种没有else分支，这样
            的语句可能会导致最后一个分支都不执行。第二种和第四种肯定会有
            1个分支执行。

            3、当分支当中“java语句;”只有1条，那么大括号&#123;&#125;可以省略，但为了
            可读性，最好不要省略。

            4、控制语句和控制语句之间是可以嵌套的，但是嵌套的时候大家最好
            一个语句一个语句进行分析，不要冗杂在一起分析。
                if(true)&#123;
                    //窍门：分析外面if语句的时候，里面的这个if语句可以看做是普通的一堆java代码。
                    if(true)&#123;
                        if(false)&#123;

                        &#125;else&#123;
                            ....最终走这里了。
                        &#125;
                    &#125;else&#123;

                    &#125;
                &#125;else&#123;

                &#125;

                if()&#123;
                    // 窍门：分析外面if时，里面的for循环当做普通java代码来看。
                    for()&#123;
                        if()&#123;
                            for()&#123;

                            &#125;
                        &#125;
                    &#125;
                &#125;else&#123;
                    while()&#123;
                        if()&#123;
                            for()&#123;

                            &#125;
                        &#125;
                    &#125;
                &#125;

        示例1：
            业务要求：
                1、从键盘上接收一个人的年龄。
                2、年龄要求为[0-150]，其它值表示非法，需要提示非法信息。
                3、根据人的年龄来动态的判断这个人属于生命的哪个阶段？
                    [0-5] 婴幼儿
                    [6-10] 少儿
                    [11-18] 少年
                    [19-35] 青年
                    [36-55] 中年
                    [56-150] 老年
                4、请使用if语句完成以上的业务逻辑。

            String str = &quot;老年&quot;; // 字符串变量默认值是“老年”
            if(age &lt; 0 || age &gt; 150)&#123;
                System.out.println(&quot;对不起，年龄值不合法&quot;);
                //return;
            &#125; else if(age &lt;= 5)&#123;
                str = &quot;婴幼儿&quot;;
            &#125; else if(age &lt;= 10)&#123;
                str = &quot;少儿&quot;;
            &#125; else if(age &lt;= 18)&#123;
                str = &quot;少年&quot;;
            &#125; else if(age &lt;= 35)&#123;
                str = &quot;青年&quot;;
            &#125; else if(age &lt;= 55)&#123;
                str = &quot;中年&quot;;
            &#125; 
            System.out.println(str);

        示例2：
            业务要求：
                1、系统接收一个学生的考试成绩，根据考试成绩输出成绩的等级。

                2、等级：
                    优：[90~100]
                    良：[80~90) 
                    中：[70-80)
                    及格：[60~70)
                    不及格：[0-60)

                3、要求成绩是一个合法的数字，成绩必须在[0-100]之间，成绩可能带有小数。

            java.util.Scanner s = new java.util.Scanner(System.in);
            System.out.print(&quot;请输入您的考试成绩：&quot;);
            // 考试成绩带有小数
            double score = s.nextDouble();
            // 判断考试成绩
            String str = &quot;优&quot;;
            if(score &lt; 0 || score &gt; 100)&#123;
                str = &quot;成绩不合法!!!&quot;;
            &#125;else if(score &lt; 60)&#123;
                str = &quot;不及格&quot;;
            &#125;else if(score &lt; 70)&#123;
                str = &quot;及格&quot;;
            &#125;else if(score &lt; 80)&#123;
                str = &quot;中&quot;;
            &#125;else if(score &lt; 90)&#123;
                str = &quot;良&quot;;
            &#125;
            System.out.println(str);

    - switch
        switch语句：
            1、switch语句也是选择语句，也可以叫做分支语句。
            2、switch语句的语法格式

                switch(值)&#123;
                case 值1:
                    java语句;
                    java语句;...
                    break;
                case 值2:
                    java语句;
                    java语句;...
                    break;
                case 值3:
                    java语句;
                    java语句;...
                    break;
                default:
                    java语句;
                &#125;

                以上是一个完整的switch语句：
                    其中：break;语句不是必须的。default分支也不是必须的。

                switch语句支持的值:
                    支持int类型以及String类型。
                    但一定要注意JDK的版本，JDK8之前不支持String类型，只支持int。
                    在JDK8之后，switch语句开始支持字符串String类型。

                    switch语句本质上是只支持int和String，但是byte,short,char也可以
                    使用在switch语句当中，因为byte short char可以进行自动类型转换。

                    switch语句中“值”与“值1”、“值2”比较的时候会使用“==”进行比较。

            3、switch语句的执行原理
                拿“值”与“值1”进行比较，如果相同，则执行该分支中的java语句，
                然后遇到&quot;break;&quot;语句，switch语句就结束了。

                如果“值”与“值1”不相等，会继续拿“值”与“值2”进行比较，如果相同，
                则执行该分支中的java语句，然后遇到break;语句，switch结束。

                注意：如果分支执行了，但是分支最后没有“break;”，此时会发生case
                穿透现象。

                所有的case都没有匹配成功，那么最后default分支会执行。

                switch中的case可以合并。

            示例：
                1、系统接收一个学生的考试成绩，根据考试成绩输出成绩的等级。

                2、等级：
                    优：[90~100]
                    良：[80~90) 
                    中：[70-80)
                    及格：[60~70)
                    不及格：[0-60)

                3、要求成绩是一个合法的数字，成绩必须在[0-100]之间，成绩可能带有小数。

                必须使用switch语句来完成。

                // 提示用户输入学生成绩
                java.util.Scanner s = new java.util.Scanner(System.in);
                System.out.print(&quot;请输入学生成绩：&quot;);
                double score = s.nextDouble();
                //System.out.println(score);
                if(score &lt; 0 || score &gt; 100)&#123;
                    System.out.println(&quot;您输入的学生成绩不合法，再见！&quot;);
                    return; 
                &#125;

                // 程序能够执行到这里说明成绩一定是合法的。
                // grade的值可能是：0 1 2 3 4 5 6 7 8 9 10
                // 0 1 2 3 4 5 不及格
                // 6 及格
                // 7 中
                // 8 良
                // 9 10 优

                int grade = (int)(score / 10); // 95.5/10结果9.55，强转为int结果是9
                String str = &quot;不及格&quot;;
                switch(grade)&#123;
                case 10: case 9:
                    str = &quot;优&quot;;
                    break;
                case 8: 
                    str = &quot;良&quot;;
                    break;
                case 7:
                    str = &quot;中&quot;;
                    break;
                case 6:
                    str = &quot;及格&quot;;
                &#125;
                System.out.println(&quot;该学生的成绩等级为：&quot; + str);

* 循环结构（循环语句的出现就是为了解决代码的复用性）
    - for
        1、for循环的语法机制以及运行原理：
            语法机制：
                for(初始化表达式; 条件表达式; 更新表达式)&#123;
                    循环体; // 循环体由java语句构成
                    java语句;
                    java语句;
                    java语句;
                    java语句;
                    ....
                &#125;
                注意：
                    第一：初始化表达式最先执行，并且在整个循环中只执行一次。
                    第二：条件表达式结果必须是一个布尔类型，也就是：true或false
                执行原理：
                    先执行初始化表达式，并且初始化表达式只执行1次。
                    然后判断条件表达式的结果，如果条件表达式结果为true，
                    则执行循环体。
                    循环体结束之后，执行更新表达式。
                    更新完之后，再判断条件表达式的结果，
                    如果还是true，继续执行循环体。

                    直到更新表达式执行结束之后，再次判断条件时，条件为false，
                    for循环终止。

                更新表达式的作用是：控制循环的次数，换句话说，更新表达式会更新
                某个变量的值，这样条件表达式的结果才有可能从true变成false，从而
                终止for循环的执行，如果确实更新表达式，很有可能会导致死循环。

            2、嵌套使用：
                * 所有合法的“控制语句”都可以嵌套使用。
                * for循环嵌套一个for循环执行原理：
                        for()&#123;
                            //在分析外层for循环的时候，把里面的for就当做一段普通的java语句/代码.
                            for()&#123;&#125;
                        &#125;

            示例：
                九九乘法表

                1*1=1
                1*2=2 2*2=4
                1*3=3 2*3=6 3*3=9
                1*4=4 2*4=8 3*4=12 4*4=16
                ....
                ......
                1*9=9 2*9=18.............................9*9=81

                以上九九乘法表的特点：
                    第一个特点：共9行。
                    第二个特点：第1行1个。第2行2个。第n行n个。

                // 9行，循环9次。
                for(int i = 1; i &lt;= 9; i++)&#123; // 纵向循环
                    //System.out.println(i); // i是行号（1~9）
                    // 负责输出一行的。（内部for循环负责将一行上的全部输出。）
                    for(int j = 1; j &lt;= i; j++)&#123; // i是行号
                        System.out.print(j + &quot;*&quot; + i + &quot;=&quot; + i * j + &quot; &quot;);
                    &#125;
                    // 换行
                    System.out.println();
                &#125;

    - while
        1、while循环的语法机制以及执行原理
            语法机制：
                while(布尔表达式)&#123;
                    循环体;
                &#125;
            执行原理：
                判断布尔表达式的结果，如果为true就执行循环体，
                循环体结束之后，再次判断布尔表达式的结果，如果
                还是true，继续执行循环体，直到布尔表达式结果
                为false，while循环结束。

        2、while循环有没有可能循环次数为0次？（与do...while区分开）
            可能。
            while循环的循环次数是：0~n次。

    - do...while()
        do..while循环语句的执行原理以及语法机制：
        语法机制：
            do &#123;
                循环体;
            &#125;while(布尔表达式);

        注意：do..while循环最后的时候别漏掉“分号”

        执行原理：
            先执行循环体当中的代码，执行一次循环体之后，
            判断布尔表达式的结果，如果为true，则继续执行
            循环体，如果为false循环结束。

        对于do..while循环来说，循环体至少执行1次。循环体的执行次数是：1~n次。
        对于while循环来说，循环体执行次数是：0~n次。

* 控制循环的语句
    - break
        1、break;语句比较特殊，特殊在：break语句是一个单词成为一个完整的java语句。
        另外：continue也是这样，他俩都是一个单词成为一条语句。

        2、break 翻译为折断、弄断。

        3、break;语句可以用在哪里呢？
            用在两个地方，其它位置不行
            第一个位置：switch语句当中，用来终止switch语句的执行。
                用在switch语句当中，防止case穿透现象，用来终止switch。

            第二个位置：break;语句用在循环语句当中，用来终止循环的执行。
                用在for当中
                用在while当中
                用在do....while..当中。

        4、break;语句的执行并不会让整个方法结束，break;语句主要是用来终止离它最近
        的那个循环语句。

        5、怎么用break;语句终止指定的循环呢？（很少用）
            第一步：你需要给循环起一个名字，例如：
                a: for()&#123;
                    b:for()&#123;

                    &#125;
                &#125;
            第二步：终止：break a;

    - continue
        1、continue翻译为：继续
        2、continue语句和break语句要对比着学习
        3、continue语句的作用是：
            终止当前&quot;本次&quot;循环，直接进入下一次循环继续执行。
            for()&#123;
                if()&#123; // 当这个条件成立时，执行continue语句
                    continue; //当这个continue语句执行时，continue下面的代码不执行，直接进入下一次循环执行。
                &#125;
                // 以上的continue一旦执行，以下代码不执行，直接执行更新表达式。
                code1;
                code2;
                code3;
                code4;
            &#125;

        4、continue语句后面也可以指定循环
            a:for(;;更新表达式1)&#123;
                b:for(;;更新表达式2)&#123;
                    if()&#123;
                        continue a;
                    &#125;
                    code1;
                    code2;
                    code3;
                &#125;
            &#125;

    break;语句和return;语句的区别：
    不是一个级别。
    break;用来终止switch和离它最近的循环。
    return;用来终止离它最近的一个方法。</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/09/01%E5%85%B3%E4%BA%8Ejava/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/09/01%E5%85%B3%E4%BA%8Ejava/" class="post-title-link" itemprop="url">01关于java</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-09 03:04:16" itemprop="dateCreated datePublished" datetime="2020-11-09T03:04:16+08:00">2020-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-10 01:53:24" itemprop="dateModified" datetime="2020-11-10T01:53:24+08:00">2020-11-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javase/" itemprop="url" rel="index"><span itemprop="name">javase</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javase/%E5%85%B3%E4%BA%8Ejava/" itemprop="url" rel="index"><span itemprop="name">关于java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="需要掌握的内容："><a href="#需要掌握的内容：" class="headerlink" title="需要掌握的内容："></a>需要掌握的内容：</h3><ul>
<li>理解java的加载与执行</li>
<li>能够自己搭建java的开发环境</li>
<li>能够独立编写HelloWorld程序，编译并运行</li>
<li>掌握环境变量path的原理以及如何配置</li>
<li>掌握环境变量classpath的原理以及如何配置</li>
<li>java中的注释</li>
<li>public class 和 class 的区别</li>
</ul>
<h3 id="1、计算机结构："><a href="#1、计算机结构：" class="headerlink" title="1、计算机结构："></a>1、计算机结构：</h3><p>计算机包括：</p>
<ul>
<li>硬件<ul>
<li>CPU：中央处理器，负责计算机的核心运算，它是计算机的最核心部件，指挥官。 1 + 1 = 2</li>
<li>内存：临时存储区域，程序在运行的过程当中，一些数据的临时存储区域。</li>
<li>主板：链接各个部件</li>
<li>显卡</li>
<li>声卡</li>
<li>鼠标</li>
<li>键盘</li>
<li>硬盘【外存】：永久性保存，断电之后再启动，数据仍然存在。<br>…..</li>
</ul>
</li>
</ul>
<ul>
<li><p>软件</p>
<ul>
<li><p>系统软件</p>
<ul>
<li><p>windows系列的</p>
</li>
<li><p>winxp</p>
</li>
<li><p>win7<br>….</p>
</li>
<li><p>Linux系列的</p>
</li>
<li><p>Red Hat</p>
</li>
<li><p>Fedora</p>
</li>
<li><p>SUN Solaris<br>….</p>
</li>
</ul>
</li>
<li><p>应用软件</p>
<ul>
<li><p>QQ</p>
</li>
<li><p>百度云管家</p>
</li>
<li><p>Office办公软件</p>
</li>
</ul>
<p>…..</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>总结：</p>
<ul>
<li><p>应用软件是运行在系统软件当中的，系统软件和底层硬盘交互。</p>
</li>
<li><p>Java编程语言可以：完成应用软件的开发。</p>
</li>
<li><p>可以用一个功能比记事本强大的文本编辑器进行java程序的编写。</p>
</li>
<li><p>windows操作系统默认情况下是不显示文件扩展名的，作为程序员必须将文件的扩展名显示出来：</p>
<ul>
<li>计算机 –&gt; 组织 –&gt; 文件夹和搜索选项 –&gt; 查看 –&gt; 隐藏已知文件类型的扩展名【对勾去掉】           win7</li>
<li>计算机 –&gt; 查看 –&gt; 隐藏已知文件类型的扩展名【对勾去掉】                                        win10</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2、windows操作系统当中常用的DOS命令："><a href="#2、windows操作系统当中常用的DOS命令：" class="headerlink" title="2、windows操作系统当中常用的DOS命令："></a>2、windows操作系统当中常用的DOS命令：</h3><ul>
<li><p>什么是DOS命令呢？</p>
<p>在DOS命令窗口中才可以输入并执行DOS命令。<br>在最初的windows计算机中没有图形界面的，只有DOS命令窗口<br>也就是说通过执行DOS命令窗口可以完全完成文件的新建、编辑、保存、删除等一系列操作。</p>
</li>
<li><p>不使用UI界面，使用DOS命令可以完成所有的操作。</p>
</li>
<li><p>在DOS命令窗口中可以执行DOS命令</p>
</li>
<li><p>打开DOS命令窗口：</p>
<ul>
<li>快捷键：win + r，打开运行窗口</li>
<li>输入cmd回车</li>
</ul>
</li>
<li><p>查看IP地址：</p>
<ul>
<li>ipconfig</li>
<li>ipconfig /all  可以查看更详细的IP信息，这种查看方式可以看到网卡的物理地址。<br>物理地址具有全球唯一性。是在生产网卡的时候，嵌入的编号。</li>
</ul>
</li>
<li><p>清屏：cls</p>
</li>
<li><p>DOS窗口当中也可以设置字体和屏幕以及文字的颜色。</p>
</li>
<li><p>退出DOS命令窗口：exit</p>
</li>
<li><p>怎么从DOS命令窗口当中复制文本：<br>-任意位置点击鼠标右键–&gt;标记 –&gt; 选择你要复制的文本 –&gt; 点击鼠标右键 （此时已经到剪贴板当中了）<br> 找一个位置粘贴即可。<br>-左键选择你要复制的文本 –&gt; ctrl+c进行复制 （此时已经到剪贴板当中了）–&gt; x选择一个位置ctrl+v粘贴即可。</p>
</li>
<li><p>查看两台计算机之间是否可以正常通信：</p>
<ul>
<li>ping 192.168.27.23   【发送和接收数据包4次】</li>
<li>ping 192.168.27.23 -t 【一直不停的发送和接收数据包】</li>
<li>ping <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></li>
</ul>
<ul>
<li>登录百度：<a target="_blank" rel="noopener" href="http://119.75.218.70/">http://119.75.218.70</a></li>
</ul>
</li>
<li><p>强行终止DOS命令窗口中正在运行的程序：ctrl + c</p>
</li>
<li><p>打开DOS命令窗口默认所在的路径是：C:\Users\Administrator???</p>
</li>
<li><p>创建目录：mkdir abc【表示在当前所在目录下新建一个目录，起名abc】</p>
</li>
<li><p>关于目录切换命令：cd</p>
<ul>
<li><p>cd 命令的语法格式：</p>
<p>cd 路径</p>
</li>
<li><p>路径分为：</p>
<ul>
<li><p>绝对路径：<br>C:\Users\Administrator<br>D:\用户目录\收藏夹<br>……</p>
<p>从硬盘的根路径作为出发点。</p>
</li>
<li><p>相对路径：<br>从当前所在的位置作为起点的路径。</p>
</li>
</ul>
</li>
<li><p>自动补全：<br>cd e 【然后按tab键，当前所在的目录下所有以e开始的目录自动补全路径，当这个自动补全的路径不是自己想要的路径，可以继续使用tab键】</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>回到上级目录：cd .. 【..是一个路径，代表当前路径的上级路径】<br>  cd ../../../</p>
</li>
<li><p>直接回到根路径：cd \</p>
</li>
</ul>
<ul>
<li><p>查看当前目录下所有的子文件和子目录：dir</p>
</li>
<li><p>del：<br>删除一个或者多个文件<br>删除T1.class文件<br>C:\Users\Administrator&gt;del T1.class<br>删除所有.class结尾的文件，支持模糊匹配<br>C:\Users\Administrator&gt;del *.class</p>
<p>T1.class<br>T1.glass<br>del *ass 这个命令就会将T1.class和T1.glass都删除。<br>删除的一定是能匹配上的。</p>
<p>del *.class 这个命令中的那个“.”不要特殊化，这个“.”其实就是一个普通的字母</p>
</li>
<li><p>不要把相关重要的资料放到桌面上，因为桌面是属于C盘系统盘。</p>
</li>
<li><p>怎么切换盘符：【不需要使用cd命令】<br>c: 回车<br>d: 回车<br>e: 回车<br>f: 回车</p>
</li>
<li><p>打开注册表：regedit</p>
</li>
</ul>
<h3 id="3、关于windows操作系统当中常用的快捷键："><a href="#3、关于windows操作系统当中常用的快捷键：" class="headerlink" title="3、关于windows操作系统当中常用的快捷键："></a>3、关于windows操作系统当中常用的快捷键：</h3><ul>
<li>win + r    打开运行窗口</li>
<li>win + d    显示桌面</li>
<li>win + e    打开资源管理器</li>
<li>win + L    锁屏</li>
<li>alt + tab    应用之间的切换</li>
</ul>
<h3 id="4、“通用的”文本编辑快捷键："><a href="#4、“通用的”文本编辑快捷键：" class="headerlink" title="4、“通用的”文本编辑快捷键："></a>4、“通用的”文本编辑快捷键：</h3><ul>
<li>ctrl + a    全选</li>
<li>ctrl + c    复制</li>
<li>ctrl + v    粘贴</li>
<li>ctrl + s    保存</li>
<li>ctrl + x    剪切</li>
<li>ctrl + z    撤销</li>
<li>ctrl + y    重做</li>
<li>tab          缩进/多行缩进</li>
<li>shift + tab    取消缩进</li>
<li>HOME        回到行首</li>
<li>END        回到行尾</li>
<li>shift + home    选中一行</li>
<li>shift + end    选中一行</li>
<li>ctrl + shift + 向右或者向左的箭头  选中一个单词</li>
<li>鼠标双击：    选中一个单词</li>
<li>鼠标三击：    选中一行</li>
<li>ctrl + end    回到文件末尾</li>
<li>ctrl + home    回到文件头</li>
</ul>
<h3 id="5、什么是JDK？"><a href="#5、什么是JDK？" class="headerlink" title="5、什么是JDK？"></a>5、什么是JDK？</h3><p>Java Development Kits<br>Java开发工具包【Java开发必备】<br>可以从Oracle的官网上下载。<a target="_blank" rel="noopener" href="http://www.oracle.com/">http://www.oracle.com</a><br>下载JDK的时候需要注意：JDK的版本，不同的操作系统需要安装不同版本的JDK。</p>
<h3 id="6、Java分三大块：1999年"><a href="#6、Java分三大块：1999年" class="headerlink" title="6、Java分三大块：1999年"></a>6、Java分三大块：1999年</h3><ul>
<li><p>J2SE【Java的标准版本】：</p>
<p>基础，无论是以后走EE还是ME，SE是必须要精通的。<br>J2SE是SUN公司为java程序员准备的一套“基础类库”，这套基础类库学习之后，可以完成最基本的操作，<br>例如，文件的读写、线程的控制….</p>
</li>
<li><p>J2EE【Java的企业版本】：</p>
<p>这是SUN公司为程序员专门准备的一套“类库”，这套类库可以协助程序员完成企业级软件的开发<br>企业级软件：OA办公系统、进销存系统、超市系统…….</p>
</li>
<li><p>J2ME【Java的微型版本】</p>
<p>这是SUN公司为java程序员专门准备的另一套“类库”，这套类库可以协助程序员完成微型设备的嵌入式开发，<br>Java最初就是做微型设备嵌入式开发的。</p>
</li>
<li><p>2005年，java诞生十周年的时候，以上的三大模块改名了：</p>
<ul>
<li>JavaSE</li>
<li>JavaEE</li>
<li>JavaME</li>
</ul>
</li>
</ul>
<h3 id="7、关键术语："><a href="#7、关键术语：" class="headerlink" title="7、关键术语："></a>7、关键术语：</h3><ul>
<li>JDK【Java开发工具箱】</li>
<li>JRE【Java的运行时环境】</li>
<li>JVM【Java虚拟机】</li>
</ul>
<p>三者之间的关系：</p>
<ul>
<li>JDK 中包含JRE</li>
<li>JRE中包含JVM</li>
</ul>
<h3 id="8、Java语言特性："><a href="#8、Java语言特性：" class="headerlink" title="8、Java语言特性："></a>8、Java语言特性：</h3><ul>
<li><p>跨平台/可移植 </p>
<ul>
<li>有一种特殊的机制：JVM</li>
</ul>
<ul>
<li>Java程序并没有和底层的操作系统直接交互，java程序实际上运行在jvm当中，JVM屏蔽了操作系统之间的差异。</li>
<li>但是有一个前提：不同的操作系统中必须安装不同版本的JVM。</li>
<li>在可移植性方面表现非常好，一次编译，到处运行。</li>
<li>但是为了达到可移植，必须提前在操作系统中安装JRE，JRE有了之后才会有JVM。【JVM不能单独安装】<br>这方面体验不是特别好。</li>
<li>java语言只要编写一次，可以做到到处运行。<br>例如：java程序编写完之后，可以运行在windows操作系统上，<br>不需要做任何改动可以直接运行在Linux操作系统上，同样也<br>可以运行到MaC OS上面。<br>一次编写，到处运行。（平台改变了，程序不需要改。）</li>
</ul>
</li>
<li><p>JVM这种机制实现了跨平台，那么这种机制优点和缺点分别是什么？</p>
<ul>
<li><p>优点：一次编写到处运行，可以跨平台。</p>
</li>
<li><p>缺点：麻烦。对于运行java程序来说必须先有一个JVM。<br>就像你要想在网页上看视频，你必须先安装一个flash是一样的。</p>
</li>
<li><p>Java语言可以编写病毒吗？</p>
<p>可以，没问题。但是很难让用户中毒。<br>中毒的一般都是java程序员。所以很少有人编写java的病毒脚本。</p>
</li>
</ul>
</li>
<li><p>Java号称：开源、免费、跨平台、纯面向对象。</p>
<ul>
<li><p>开源：开发源代码，SUN公司编写的java类库的源代码普通程序员能看到。众人拾柴火焰高。<br>这样java程序会很健壮。很少的BUG【漏洞/陷阱】</p>
</li>
<li><p>免费</p>
</li>
<li><p>跨平台：依靠JVM机制【java程序不和操作系统交互，java程序运行在JVM中，JVM和操作系统交互。】<br>不同的操作系统有不同版本的JVM。</p>
</li>
<li><p>面向对象：人类在认识现实世界的时候多数是以面向对象的方式认知的。</p>
</li>
</ul>
</li>
<li><p>简单性：</p>
<ul>
<li>这里的简单说的是相对于C语言来说的。</li>
<li>例如：C语言当中有指针，C++中多继承</li>
<li>java取消了指针的概念，取消了多继承，只支持单继承。<br>…..</li>
</ul>
</li>
<li><p>java支持多线程</p>
</li>
<li><p>java中还有一种特殊的机制：自动垃圾回收机制。GC机制。<br>【java运行过程当中有一个“垃圾回收器”一直在守护着。】</p>
</li>
</ul>
<h3 id="9、Java的加载与执行：一个完整的java程序"><a href="#9、Java的加载与执行：一个完整的java程序" class="headerlink" title="9、Java的加载与执行：一个完整的java程序"></a>9、Java的加载与执行：一个完整的java程序</h3><p>1、Java开发的整个生命周期，包括两个重要的阶段，分别是：编译阶段和运行阶段</p>
<p>2、编译生成的程序被称为：字节码程序。编译生成的文件是：xxx.class文件</p>
<p>3、编译和运行可以在不同的操作系统中完成。</p>
<p>4、程序员在xxx.java文件中编写源代码，源代码必须符合java的语法，这些源代码就是高级语言。<br>存放源代码的文件被称为源文件。</p>
<p>5、过程：</p>
<ul>
<li><p>编译期：【在windows环境中完成】</p>
<p>安装JDK，配置环境</p>
<p>在硬盘的某个位置创建一个xxx.java源文件</p>
<p>打开源文件，在该文件当中编写符合java语法的源程序，然后保存。</p>
<p>使用JDK中自带的javac.exe命令对以上的java源程序进行编译。</p>
<p>编译通过：说明语法没有问题</p>
<p>在硬盘上生成一个或者多个字节码文件【xxx.class】</p>
<p>编译失败：说明源程序某个位置不符合java语法格式。</p>
<p>编译的语法格式：打开DOS命令窗口，输入：javac 源文件路径</p>
</li>
<li><p>注意：</p>
<ul>
<li>源文件路径可以是绝对路径，也可以是相对路径。</li>
<li>编译之后，其实java源文件删除不会影响程序的执行。</li>
<li>最好不要将java源文件删除，因为程序最终运行效果不是预期效果的时候，需要重新修改java源代码，然后进行重新编译生成全新的class字节码文件，再重新运行字节码程序。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p>运行期：【可以不在windows中完成，可以换一个操作系统，但前提是该操作系统中已经安装java的运行时环境】</p>
<ul>
<li>打开命令窗口，在命令窗口中使用java.exe命令运行java程序，语法格式：java 类名</li>
<li>注意：java这个命令使用的时候，java命令后面不是文件的路径。必须是一个“类名”。<ul>
<li>例如：<ul>
<li>java Hello</li>
<li>java Student</li>
<li>java User</li>
<li>java Product                </li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>以下程序的执行原理：<ul>
<li>java.exe命令执行会启动：JVM</li>
<li>JVM启动之后，马上启动“类加载器-Class Loader”</li>
<li>ClassLoader负责去硬盘的“某个位置”上搜索“类名.class”字节码文件。</li>
<li>找不到这个.class文件，一定会出现程序异常现象。</li>
<li>找到了这个.class文件之后将.class文件转换成”二进制”，操作系统可以直接识别二进制，<br>操作系统执行二进制码和底层的硬件平台进行交互。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="10、什么是类名？"><a href="#10、什么是类名？" class="headerlink" title="10、什么是类名？"></a>10、什么是类名？</h3><ul>
<li>假设硬盘上有一个文件，叫做Hello.class，那么类名就叫做：Hello</li>
<li>假设硬盘上有一个文件，叫做Student.class，那么类名就叫做：Student</li>
<li>假设硬盘上有一个文件，叫做User.class，那么类名就叫做：User</li>
<li>假设硬盘上有一个文件，叫做Product.class，那么类名就叫做：Product</li>
</ul>
<h3 id="11、开始第一个java程序的开发"><a href="#11、开始第一个java程序的开发" class="headerlink" title="11、开始第一个java程序的开发"></a>11、开始第一个java程序的开发</h3><p>1、JDK下载</p>
<p>2、JDK安装</p>
<ul>
<li>只安装了JDK，独立的JRE没有安装</li>
</ul>
<p>3、在硬盘的某个位置上新建一个java源文件：HelloWorld.java</p>
<p>4、在HelloWorld.java文件中编写源代码</p>
<p>5、打开命令窗口，使用javac命令进行编译：</p>
<ul>
<li><p>javac 源文件路径</p>
</li>
<li><p>出现以下错误：</p>
<p>C:\Users\Administrator&gt;javac<br>‘javac’ 不是内部或外部命令，也不是可运行的程序<br>或批处理文件。</p>
</li>
<li><p>怎么解决？</p>
<ul>
<li>第一种方案：切换到javac.exe文件所在的目录，这个时候使用javac.exe不会出问题，但是这种方式比较麻烦。</li>
<li>第二种方案：配置环境变量path</li>
</ul>
</li>
<li><p>原理：windows操作系统在查找某个命令的时候是怎么查找的？</p>
<ul>
<li>首先会从当前目录下找这个命令</li>
<li>当前目录下不存在这个命令的话，会去环境变量path指定的路径当中查找该命令。</li>
<li>还是找不到则出现错误提示信息。</li>
<li>path环境变量隶属于windows操作系统，和java无关，这个环境变量主要用来指定命令的搜索路径。</li>
</ul>
</li>
</ul>
<p>6、配置环境变量</p>
<ul>
<li><p>计算机 –&gt; 点击右键 –&gt; 属性 –&gt; 高级系统设置 –&gt; 环境变量</p>
</li>
<li><p>环境变量配置包括用户级别和系统级别</p>
</li>
<li><p>任何一个环境变量都有变量名和变量值，例如path环境变量：<br>变量名是:path值：路径【多个路径之间必须采用分号隔开，而且要求分号必须是半角分号】</p>
<p>path=C:\Program Files (x86)\Java\jdk1.7.0_75\bin;otherpath;otherpath…..</p>
</li>
</ul>
<p>编译1【绝对路径】：D:\course\JavaProjects&gt;javac D:\course\JavaProjects\02-JavaSE\day01\HelloWorld.java<br>编译2【相对路径】：D:\course\JavaProjects&gt;javac 02-JavaSE\day01\HelloWorld.java<br>编译3【相对路径】：D:\course\JavaProjects\02-JavaSE\day01&gt;javac HelloWorld.java</p>
<p>7、运行：</p>
<ul>
<li><p>必须将路径切换到“D:\course\JavaProjects\02-JavaSE\day01”目录下</p>
</li>
<li><p>执行：java HelloWorld</p>
</li>
<li><p>D:\course\JavaProjects\02-JavaSE\day01&gt;java HelloWorld<br>Hello World!</p>
</li>
</ul>
<h3 id="12、JDK、JRE、JVM三者之间的关系？"><a href="#12、JDK、JRE、JVM三者之间的关系？" class="headerlink" title="12、JDK、JRE、JVM三者之间的关系？"></a>12、JDK、JRE、JVM三者之间的关系？</h3><ul>
<li>JDK:Java开发工具箱</li>
<li>JRE:java运行环境</li>
<li>JVM:java虚拟机</li>
</ul>
<p>JDK包括JRE，JRE包括JVM。</p>
<p>JVM是不能独立安装的。</p>
<p>JRE和JDK都是可以独立安装的。</p>
<p>有单独的JDK安装包。</p>
<p>也有单独的JRE安装包。</p>
<p>没有单独的JVM安装包。</p>
<p>安装JDK的时候：JRE就自动安装了，同时JRE内部的JVM也就自动安装了。</p>
<p>安装JRE的时候：JVM也就自动安装了。</p>
<h3 id="13、java程序从开发到最终运行经历了什么？"><a href="#13、java程序从开发到最终运行经历了什么？" class="headerlink" title="13、java程序从开发到最终运行经历了什么？"></a>13、java程序从开发到最终运行经历了什么？</h3><ul>
<li><p>编译期：（可以在windows上）</p>
<ul>
<li>第一步：在硬盘的某个位置（随意），新建一个xxx.java文件</li>
<li>第二步：使用记事本或者其它文本编辑器例如EditPlus打开xxx.java文件</li>
<li>第三步：在xxx.java文件中编写“符合java语法规则的”源代码。</li>
<li>第四步：保存（一定要将xxx.java文件保存一下）</li>
<li>第五步：使用编译器（javac【JDK安装后自带】）对xxx.java文件进行编译。</li>
<li>第六步：如果xxx.java文件中编写的源代码是符合语法规则的，编译会通过，如果xxx.java文件中编写的源代码违背了语法规则，那么编译器会报错，编译器报错之后class文件是不会生成的，只有编译通过了才会生成class字节码文件。并且一个java源文件是可以生成多个class文件的。（编译实质上是检查语法）</li>
</ul>
</li>
<li><p>运行期（JRE在起作用）：（可以在windows上，也可以在其他的OS上。）</p>
<ul>
<li>第七步：如果是在Linux上运行，需要将windows上生成的class文件拷贝过去不需要拷贝源代码，真正运行的是字节码。（但是源代码也不要删除，有用）</li>
<li>第八步：使用JDK自带的一个命令/工具：java（负责运行的命令/工具）执行字节码</li>
<li>第九步：往下的步骤就全部交给JVM了，就不需要程序员干涉了。<br>JVM会将字节码文件装载进去，然后JVM对字节码进行解释（解释器负责将字节码解释为1010101010..等的二进制）</li>
<li>第十步：JVM会将生成的二进制码交给OS操作系统，操作系统会执行二进制码和硬件进行交互。</li>
</ul>
</li>
<li><p>注意：在以上的过程中，需要使用两个非常重要的命令？</p>
<ul>
<li>javac 命令，负责编译</li>
<li>java 命令，负责运行</li>
</ul>
</li>
<li><p>以上是一个复杂的过程，那么缩减一下，程序员到底要干啥？（编写、编译、运行）</p>
<ul>
<li>新建java文件</li>
<li>打开java文件</li>
<li>写java源代码</li>
<li>保存</li>
<li>javac命令编译</li>
<li>java命令运行</li>
</ul>
</li>
</ul>
<h3 id="14、注释"><a href="#14、注释" class="headerlink" title="14、注释"></a>14、注释</h3><p>1、注释是对java源代码的解释说明。</p>
<p>注释可以帮程序员更好的理解程序。</p>
<p>2、注释信息只保存在java源文件当中，java源文件编译生成的字节码class文件，class文件中是没有这些注释信息的。</p>
<p>3、在实际的开发中，一般项目组都要求积极的编写注释。这也是一个java软件工程师的基本素养。</p>
<p>4、注释不是写的越多越好，精简，主线清晰，每个注释都应该是点睛之笔。</p>
<p>5、注释方法（3种）：</p>
<ul>
<li><p>单行注释<br>  // 这种注释属于单行注释，只注释两个斜杠后面的</p>
</li>
<li><p>多行注释<br>/*<br>在这里可以编写多行注释<br>这是第一行注释<br>这是第二行注释<br>这是第三行注释<br>…….<br>*/</p>
</li>
<li><p>javadoc注释<br>/**</p>
<p>   *javadoc注释</p>
<p>  *javadoc注释</p>
<p>  *javadoc注释</p>
<p>  *javadoc注释</p>
<p>  *javadoc注释<br>*/<br>注意：这种注释是比较专业的注释，该注释信息会被javadoc.exe工具解析提取并生成帮助文档。</p>
</li>
</ul>
<h3 id="15、HelloWorld程序的执行原理"><a href="#15、HelloWorld程序的执行原理" class="headerlink" title="15、HelloWorld程序的执行原理"></a>15、HelloWorld程序的执行原理</h3><ol>
<li>java.exe命令会启动JVM</li>
<li>JVM启动之后会启动类加载器ClassLoader</li>
<li>ClassLoader会在硬盘上的某个位置搜索HelloWorld.class字节码文件</li>
<li>找到该文件则执行</li>
<li>找不到该文件则报错</li>
</ol>
<p>ClassLoader是在哪个位置上搜索HelloWorld.class字节码文件的？</p>
<p>默认情况下，ClassLoader从当前路径下加载xxx.class字节码文件</p>
<p>当然，也可以让ClassLoader去某个指定的路径下加载字节码文件，这时需要配置环境变量classpath</p>
<p>classpath环境变量属于java语言中的环境变量，不属于windows操作系统【PATH环境变量属于操作系统】</p>
<p>classpath是给ClassLoader类加载器指路的。</p>
<p>设置这样的环境变量：classpath=D:\course\JavaProjects\02-JavaSE\day02</p>
<p>打开dos命令窗口在任意位置，都可以执行：java HelloWorld</p>
<p>classpath环境变量没有配置的话，类加载器默认从当前路径下找字节码文件，<br>当classpath环境变量配置为某个指定的路径之后，类加载器只去指定的路径当中加载字节码文件。</p>
<p>综上所述，环境变量classpath不再配置，这样类加载器会自动从当前路径下加载class字节码文件。<br>所以，每一次执行.class程序的时候，需要在DOS命令窗口中先切换到.class字节码文件所在的路径下。<br>然后运行。</p>
<p>当然，classpath也可以这样配置：classpath=.</p>
<p>注意：</p>
<ul>
<li>路径中“..”表示上级目录</li>
<li>路径中“.”表示当前目录</li>
</ul>
<p>对HelloWorld程序进行解释：<br>需要记忆：</p>
<ul>
<li>public</li>
<li>class</li>
<li>static</li>
<li>void</li>
<li>System.out.println(“”); 向控制台输出消息</li>
<li>类体</li>
<li>方法体</li>
<li>类体中不能直接编写java语句【除声明变量之外】</li>
<li>一个java语句必须以“;”结束</li>
<li>方法体中可以编写多条java语句</li>
<li>主方法是程序的入口，固定写法，SUN规定的。</li>
</ul>
<h3 id="16、关于java代码的编写"><a href="#16、关于java代码的编写" class="headerlink" title="16、关于java代码的编写"></a>16、关于java代码的编写</h3><p>在java中任何有效的代码必须写到“类体”当中，最外层必须是一个类的定义。</p>
<p>public表示公开的，class表示定义一个类，Test是一个类名。类名后面必须是一对大括号，这一对大括号被称为“类体”</p>
<p>括号和引号必须是成对的。并且建议都要成对编写，这样才不会丢掉。</p>
<p>代码缩进:</p>
<ul>
<li>我包着你，你就比我低一级。你就需要缩进。</li>
<li>没有合理的缩进，代码可读性很差。</li>
<li>或者也可以这样说，大括号里的都需要缩进。</li>
<li>缩进就是可读性问题，不缩进也不影响程序的编译和执行。</li>
</ul>
<p>类体/public static void main(String[] args){}:</p>
<ul>
<li>程序的入口，SUN公司java语言规定的</li>
<li>也就是说：JVM在执行程序的时候，会主动去找这样一个方法。没有这个规格的方法，程序是无法执行的。</li>
<li>main方法也可以叫做主方法。</li>
<li>注意：<ul>
<li>方法必须放到“类体”中，不能放到“类体”外面。</li>
<li>类体当中应该是方法，而不是直接的java语句。</li>
<li>任何一个程序都要有一个入口，没有入口进不来，无法执行。</li>
<li>程序的入口只有一个，若有一个一模一样的入口，编译器会报错。</li>
<li>一个程序如果没有入口但是没有语法错误的话，编译器不会报错，但运行会报错。</li>
</ul>
</li>
</ul>
<p>方法体/System.out.println():<br>    - 注意：<br>     - 方法体由一行一行的“java语句”构成<br>    - 并且非常重要的是：任何一条java语句必须以“;”结尾，并且这个分号还得是英文的，不能用中文分号。<br>    - “;” 代表一条语句的结束。<br>    - 非常非常重要的是：方法体中的代码遵循自上而下的顺序依次逐行执行。<br>    - System.out.println();这行代码的作用是向控制台输出一句话。就是这个作用。<br>    - 注意：如果println后面小括号里的内容是一个“字符串”的话，必须使用英文双引号括起来。<br>    - 双引号也要成对儿写。</p>
<p>注意的小点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个不加双引号行吗？</span></span><br><span class="line"><span class="comment">// 可以，因为它是数字。</span></span><br><span class="line">System.out.println(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是数字，加双引号行吗？</span></span><br><span class="line">System.out.println(<span class="string">&quot;100&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上性质一样吗？</span></span><br><span class="line"><span class="comment">// 不一样：一个是字符串，一个是数字。</span></span><br><span class="line"><span class="comment">// 但最终输出到控制台上一个样子，没啥区别。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里扩展一下：对于数字来说能进行加减乘除吗？</span></span><br><span class="line"><span class="comment">// + 能用吗？</span></span><br><span class="line"><span class="comment">// - 能用吗？</span></span><br><span class="line"><span class="comment">// / 能用吗？</span></span><br><span class="line"><span class="comment">// * 能用吗？</span></span><br><span class="line"><span class="comment">// 可以</span></span><br><span class="line">System.out.println(<span class="number">100</span> + <span class="number">200</span>); <span class="comment">// 300</span></span><br><span class="line">System.out.println(<span class="number">200</span> - <span class="number">100</span>); <span class="comment">// 100</span></span><br><span class="line">System.out.println(<span class="number">200</span> * <span class="number">100</span>); <span class="comment">// 20000</span></span><br><span class="line">System.out.println(<span class="number">200</span> / <span class="number">100</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>



<h3 id="17、public-class-和-class的区别："><a href="#17、public-class-和-class的区别：" class="headerlink" title="17、public class 和 class的区别："></a>17、public class 和 class的区别：</h3><ul>
<li><p>一个java源文件当中可以定义多个class</p>
</li>
<li><p>一个java源文件当中public的class不是必须的</p>
</li>
<li><p>一个class会定义生成一个xxx.class字节码文件</p>
</li>
<li><p>一个java源文件当中定义公开的类的话，只能有一个，并且该类名称必须和java源文件名称一致。</p>
</li>
<li><p>每一个class当中都可以编写main方法，都可以设定程序的入口，想执行B.class中的main方法：java B，<br>想执行X.class当中的main方法：java X</p>
</li>
<li><p>注意：</p>
</li>
<li><p>当在命令窗口中执行java Hello，那么要求Hello.class当中必须有主方法。没有主方法会出现运行<br>阶段的错误：</p>
<p>D:\course\JavaProjects\02-JavaSE\day02&gt;java Hello<br>错误: 在类 B 中找不到主方法, 请将主方法定义为:<br>public static void main(String[] args)</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/" class="post-title-link" itemprop="url">如何在CentOS的Linux下载jdk、mysql、tomcat、redis、ngiux、rabbitmq</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-08 20:45:56" itemprop="dateCreated datePublished" datetime="2020-11-08T20:45:56+08:00">2020-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-10 01:51:57" itemprop="dateModified" datetime="2020-11-10T01:51:57+08:00">2020-11-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/Linux%E8%BD%AF%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85/" itemprop="url" rel="index"><span itemprop="name">Linux软件下载安装</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Linux上的软件安装的方式大体上说有四种：</p>
<ul>
<li><p>二进制发布包</p>
<p>软件已经针对具体平台编译打包发布，只要解压，修改配置即可。</p>
</li>
<li><p>RPM包</p>
<p>软件已经按照redhat的包管理工具规范RPM进行打包发布，需要获取到相应的软件RPM发布包，然后用RPM命令进行安装。</p>
</li>
<li><p>Yum在线安装</p>
<p>软件已经以RPM规范打包，但发布在了网络上的一些服务器上，可用yum在线安装服务器上的rpm软件，并且会自动解决软件安装过程中的库依赖问题。</p>
</li>
<li><p>源码编译安装</p>
<p>软件以源码工程的形式发布，需要获取到源码工程后用相应开发工具进行编译打包部署。</p>
</li>
</ul>
<p>上传与下载工具介绍（三种）：</p>
<ul>
<li>xftp</li>
</ul>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/1.png" alt="xftp"></p>
<p>可以去<a target="_blank" rel="noopener" href="https://www.netsarang.com/en/xftp/">官网</a>下载（顺手可以把Xshell也下载了）</p>
<ul>
<li><p>lrzsz</p>
<p>我们可以使用yum安装方式安装 yum install lrzsz</p>
<p>注意：必须有网络</p>
<p>可以在crt中设置上传与下载目录</p>
<p> <img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/2.png" alt="lrzsz"></p>
<p>上传：</p>
<p> <img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/3.png" alt="上传"></p>
<p>下载</p>
<p> <img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/4.png" alt="下载"></p>
</li>
<li><p>sftp</p>
<p>使用<code>alt + p</code>组合键打开sftp窗口</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/5.png" alt="sftp"></p>
<p>使用put 命令上传</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/6.png" alt="put"></p>
<p>使用get命令下载</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/7.png" alt="get"></p>
<p>默认下载位置在当前计算的的文档位置</p>
<p> <img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/8.png" alt="文档位置"></p>
</li>
</ul>
<h2 id="教程分六个部分"><a href="#教程分六个部分" class="headerlink" title="教程分六个部分"></a>教程分六个部分</h2><ol>
<li><p>第一部分：下载安装jdk</p>
</li>
<li><p>第二部分：下载安装mysql</p>
</li>
<li><p>第三部分：下载安装tomcat</p>
</li>
<li><p>第四部分：下载安装redis</p>
</li>
<li><p>第五部分：下载安装nginx</p>
</li>
<li><p>第六部分：下载安装rabbitmq（附：配置防火墙）</p>
</li>
</ol>
<h3 id="第一部分：下载安装jdk"><a href="#第一部分：下载安装jdk" class="headerlink" title="第一部分：下载安装jdk"></a>第一部分：下载安装jdk</h3><h4 id="1、在官网下载自己所需版本的jdk（linux版）"><a href="#1、在官网下载自己所需版本的jdk（linux版）" class="headerlink" title="1、在官网下载自己所需版本的jdk（linux版）"></a>1、在官网下载自己所需版本的jdk（linux版）</h4><h4 id="2、卸载linux可能自带的open-JDK"><a href="#2、卸载linux可能自带的open-JDK" class="headerlink" title="2、卸载linux可能自带的open-JDK"></a>2、卸载linux可能自带的open-JDK</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看jdk版本</span></span><br><span class="line">java –version</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看安装的jdk信息</span></span><br><span class="line">rpm -qa | grep java</span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载jdk</span></span><br><span class="line">rpm -e --nodeps java-1.6.0-openjdk-1.6.0.35-1.13.7.1.el6_6.i686</span><br><span class="line">rpm -e --nodeps java-1.7.0-openjdk-1.7.0.79-2.5.5.4.el6.i686</span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次查看安装的jdk信息</span></span><br><span class="line">rpm -qa | grep java</span><br></pre></td></tr></table></figure>

<p>第一次查看安装的jdk信息或最后一次查看安装的jdk信息没有open-jdk后，可以上传下载的jdk</p>
<h4 id="3、上传安装jdk"><a href="#3、上传安装jdk" class="headerlink" title="3、上传安装jdk"></a>3、上传安装jdk</h4><p>我们通常将软件安装到/usr/local，在该目录下新建一个jdk文件夹。用Xftp将下载的jdk上传到jdk文件夹中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">直接解压就可以</span></span><br><span class="line">tar –zxvf  jdk.*****.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看jdk版本</span></span><br><span class="line">java –version</span><br></pre></td></tr></table></figure>

<h4 id="4、配置JDK的环境变量"><a href="#4、配置JDK的环境变量" class="headerlink" title="4、配置JDK的环境变量:"></a>4、配置JDK的环境变量:</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash">按i进行编写，在末尾行添加</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span> java environment</span></span><br><span class="line">JAVA_HOME=/usr/local/jdk/jdk1.7.0_71</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib.tools.jar</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br><span class="line"><span class="meta">#</span><span class="bash">按Esc加:wq回车，保存退出</span></span><br><span class="line"><span class="meta">#</span><span class="bash">使更改的配置立即生效</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h3 id="第二部分：下载安装mysql"><a href="#第二部分：下载安装mysql" class="headerlink" title="第二部分：下载安装mysql"></a>第二部分：下载安装mysql</h3><p>本部分参考开心跳蚤的<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/276d59cbc529">Linux下安装mysql-5.7.24</a>这篇博客，加上遇到的坑和自己的一些补充。</p>
<p>正。</p>
<h4 id="1、注意："><a href="#1、注意：" class="headerlink" title="1、注意："></a>1、注意：</h4><ul>
<li><p>注意1：本文档讲解安装版本为mysql-5.7.24，对于5.7.24之后的版本，不适用此说明文档，主要原因在于之后版本的mysql配置文件的目录位置和结构有所改变，使用此说明可能会出现找不到配置文件或者配置后不生效的情况。</p>
</li>
<li><p>注意2：安装过程中务必保证文件路径的前后统一，否则可能会导致不可预期的结果，推荐直接使用文中的命令进行操作。</p>
</li>
</ul>
<h4 id="2、安装前准备"><a href="#2、安装前准备" class="headerlink" title="2、安装前准备"></a>2、安装前准备</h4><p>1、检查是否已经安装过mysql，执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# rpm -qa | grep mysql</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/9.png" alt="检查"></p>
<p>从执行结果，可以看出我们已经安装了<strong>mysql-libs-5.1.73-5.el6_6.x86_64</strong>，执行删除命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# rpm -e --nodeps mysql-libs-5.1.73-5.el6_6.x86_64</span><br></pre></td></tr></table></figure>

<p>再次执行查询命令，查看是否删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# rpm -qa | grep mysql</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/10.png" alt="检查"></p>
<p>2、查询所有Mysql对应的文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# whereis mysql</span><br><span class="line">mysql: /usr/bin/mysql /usr/include/mysql</span><br><span class="line">[root@localhost lib]# find / -name mysql</span><br><span class="line">/data/mysql</span><br><span class="line">/data/mysql/mysql</span><br></pre></td></tr></table></figure>

<p>删除相关目录或文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]#  rm -rf /usr/bin/mysql /usr/include/mysql /data/mysql /data/mysql/mysql </span><br></pre></td></tr></table></figure>

<p>验证是否删除完毕</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# whereis mysql</span><br><span class="line">mysql:</span><br><span class="line">[root@localhost /]# find / -name mysql</span><br><span class="line">[root@localhost /]# </span><br></pre></td></tr></table></figure>

<p>3、检查mysql用户组和用户是否存在，如果没有，则创建</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# cat /etc/group | grep mysql</span><br><span class="line">[root@localhost /]# cat /etc/passwd |grep mysql</span><br><span class="line">[root@localhost /]# groupadd mysql</span><br><span class="line">[root@localhost /]# useradd -r -g mysql mysql</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure>

<p>4、从官网下载是用于Linux的Mysql安装包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]#  wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<p>也可以直接到 <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://downloads.mysql.com/archives/community/">mysql官网</a> 选择对应版本进行下载。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/11.png" alt="mysql官网"></p>
<h4 id="3、安装Mysql"><a href="#3、安装Mysql" class="headerlink" title="3、安装Mysql"></a>3、安装Mysql</h4><p>1、在执行<strong>wget</strong>命令的目录下或你的上传目录下找到Mysql安装包：<strong>mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</strong><br> 执行解压命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# tar -xzvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">[root@localhost /]# ls</span><br><span class="line">mysql-5.7.24-linux-glibc2.12-x86_64</span><br><span class="line">mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压完成后，可以看到当前目录下多了一个解压文件，移动该文件到**/usr/local/<strong>下，并将文件夹名称修改为</strong>mysql**。</p>
<p>如果**/usr/local/<strong>下已经存在</strong>mysql**，请将已存在mysql文件修改为其他名称或删除，否则后续步骤可能无法正确进行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# mv mysql-5.7.24-linux-glibc2.12-x86_64 /usr/local/</span><br><span class="line">[root@localhost /]# cd /usr/local/</span><br><span class="line">[root@localhost /]# mv mysql-5.7.24-linux-glibc2.12-x86_64 mysql</span><br></pre></td></tr></table></figure>

<p>如果**/usr/local/<strong>下不存在</strong>mysql**文件夹，直接执行如下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# mv mysql-5.7.24-linux-glibc2.12-x86_64 /usr/local/mysql</span><br></pre></td></tr></table></figure>

<p>2、在**/usr/local/mysql**目录下创建data目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# mkdir /usr/local/mysql/data</span><br></pre></td></tr></table></figure>

<p>3、更改mysql目录下所有的目录及文件夹所属的用户组和用户，以及权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# chown -R mysql:mysql /usr/local/mysql</span><br><span class="line">[root@localhost /]# chmod -R 755 /usr/local/mysql</span><br></pre></td></tr></table></figure>

<p>4、编译安装并初始化mysql,<strong>务必记住初始化输出日志末尾的密码（数据库管理员临时密码）</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# cd /usr/local/mysql/bin</span><br><span class="line">[root@localhost bin]# ./mysqld --initialize --user=mysql --datadir=/usr/local/mysql/data --basedir=/usr/local/mysql</span><br></pre></td></tr></table></figure>

<p>第四步可能出现问题：</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/12.png" alt="问题"></p>
<p>出现该问题首先检查该链接库文件有没有安装使用 命令进行核查</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost bin]# rpm -qa|grep libaio   </span><br><span class="line">[root@localhost bin]# </span><br></pre></td></tr></table></figure>

<p>运行命令后发现系统中无该链接库文件，用yum下载libaio-devel.x86_64</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost bin]#  yum install  libaio-devel.x86_64</span><br></pre></td></tr></table></figure>

<p>安装成功后，继续运行数据库的初始化命令，此时可能会出现如下错误：</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/13.png" alt="问题"></p>
<p>用yum下载numactl执行如下命令后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost bin]#  yum -y install numactl</span><br></pre></td></tr></table></figure>

<p>执行无误之后，再重新执行第4步初始化命令，无误之后再进行第5步操作！</p>
<p>5、运行初始化命令成功后，输出日志如下：</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/14.png" alt="输出日志"></p>
<p>记录日志最末尾位置**root@localhost:**后的字符串，此字符串为mysql管理员临时登录密码。</p>
<p>6、编辑配置文件my.cnf，添加配置如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost bin]#  vi /etc/my.cnf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用i进入编辑模式，按Esc加:wq回车，保存退出</span></span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/usr/local/mysql/data</span><br><span class="line">port=3306</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line">symbolic-links=0</span><br><span class="line">max_connections=600</span><br><span class="line">innodb_file_per_table=1</span><br><span class="line">lower_case_table_names=1</span><br><span class="line">character_set_server=utf8</span><br></pre></td></tr></table></figure>

<p><code>lower_case_table_names</code>：是否区分大小写，1表示存储时表名为小写，操作时不区分大小写；0表示区分大小写；不能动态设置，修改后，必须重启才能生效：<br> <code>character_set_server</code>：设置数据库默认字符集，如果不设置默认为latin1<br> <code>innodb_file_per_table</code>：是否将每个表的数据单独存储，1表示单独存储；0表示关闭独立表空间，可以通过查看数据目录，查看文件结构的区别；</p>
<p>7、测试启动mysql服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# /usr/local/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure>

<p>显示如下结果，说明数据库安装并可以正常启动</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/15.png" alt="正常启动"></p>
<h4 id="异常情况"><a href="#异常情况" class="headerlink" title="异常情况"></a>异常情况</h4><p>如果出现如下提示信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Starting MySQL.180306 16:26:49 mysqld_safe error: log-error set to &#x27;/var/lib/mysql/mysql.log&#x27;, however file don&#x27;t exists. Create writable for user &#x27;mysql&#x27;. </span><br><span class="line">ERROR! The server quit without updating PID file</span><br></pre></td></tr></table></figure>

<p>1、查看是否存在mysql和mysqld的服务，如果存在，则结束进程，再重新执行启动命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询服务</span></span><br><span class="line">ps -ef|grep mysql | grep -v grep</span><br><span class="line">ps -ef|grep mysqld | grep -v grep</span><br><span class="line"></span><br><span class="line"><span class="comment">#结束进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 PID</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/16.png" alt="端口"></p>
<p>2、如果不存在，则是因为没有路径也没有权限，所以创建此路径并授权给mysql用户，执行如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建此路径</span></span><br><span class="line">mkdir /var/log/mariadb</span><br><span class="line">touch /var/log/mariadb/mariadb.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户组及用户</span></span><br><span class="line">chown -R mysql:mysql /var/log/mariadb/</span><br><span class="line"><span class="meta">#</span><span class="bash">启动服务</span></span><br><span class="line">/usr/local/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure>

<p>3、此时可能会出现如下错误：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Starting MySQL.170331 10:18:30 mysqld_safe Directory &#x27;/var/lib/mysql&#x27; for UNIX socket file don&#x27;t exists.</span><br><span class="line">ERROR! The server quit without updating PID file </span><br></pre></td></tr></table></figure>

<p>启动MySQL服务时，会优先在/etc/目录下查找my.cnf,可以把/etc/my.cnf重命名，执行如下命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@VMUest ~]<span class="comment"># ll /etc/my.cnf</span></span><br><span class="line">-rw-r--r--. 1 root root 251 Jan 27 05:41 /etc/my.cnf</span><br><span class="line">[root@VMUest ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">user=mysql</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">[root@VMUest ~]<span class="comment"># ll /etc/ |grep my</span></span><br><span class="line">-rw-r--r--.  1 root root    251 Jan 27 05:41 my.cnf</span><br><span class="line">[root@VMUest ~]<span class="comment"># mv /etc/my.cnf /etc/my.cnf.bak</span></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure>

<p>MySQL服务顺利启动。</p>
<p>8、添加软连接，并重启mysql服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]#  ln -s /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql </span><br><span class="line">[root@localhost /]#  ln -s /usr/local/mysql/bin/mysql /usr/bin/mysql</span><br><span class="line">[root@localhost /]#  service mysql restart</span><br></pre></td></tr></table></figure>

<p>9、登录mysql，修改密码(密码为步骤5生成的临时密码)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]#  mysql -u root -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"><span class="built_in">set</span> password <span class="keyword">for</span> root@localhost = password(<span class="string">&#x27;yourpass&#x27;</span>);</span></span><br></pre></td></tr></table></figure>

<p>注意：输入密码时，Enter password 后面不会有任何显示，此时实际是输入成功的，输入完密码后直接回车即可。或使用：mysql -u root -p 密码 ，回车后，即可直接进入数据库</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/17.png" alt="修改密码"></p>
<p>10、开放远程连接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash">use mysql;</span></span><br><span class="line"><span class="meta">msyql&gt;</span><span class="bash">update user <span class="built_in">set</span> user.Host=<span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user.User=<span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">flush privileges;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/18.png" alt="开放远程连接"></p>
<p>11、设置开机自动启动    </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、将服务文件拷贝到<span class="keyword">init</span>.d下，并重命名为mysql</span><br><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span></span><br><span class="line"><span class="number">2</span>、赋予可执行权限</span><br><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># chmod +x /etc/init.d/mysqld</span></span><br><span class="line"><span class="number">3</span>、添加服务</span><br><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># chkconfig --add mysqld</span></span><br><span class="line"><span class="number">4</span>、显示服务列表</span><br><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># chkconfig --list</span></span><br></pre></td></tr></table></figure>

<h3 id="第三部分：下载安装tomcat"><a href="#第三部分：下载安装tomcat" class="headerlink" title="第三部分：下载安装tomcat"></a>第三部分：下载安装tomcat</h3><h4 id="1、在官网下载tomcat"><a href="#1、在官网下载tomcat" class="headerlink" title="1、在官网下载tomcat"></a>1、在<a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-90.cgi">官网</a>下载tomcat</h4><h4 id="2、上传安装tomcat"><a href="#2、上传安装tomcat" class="headerlink" title="2、上传安装tomcat"></a>2、上传安装tomcat</h4><p>将软件安装到/usr/local，在该目录下新建一个tomcat文件夹。用Xftp将下载的tomcat上传到tomcat文件夹中</p>
<p>将上传的tomcat解压</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar –zxvf *****</span><br></pre></td></tr></table></figure>

<p>在tomcat/bin目录下执行 startup.sh（注意防火墙）</p>
<p>在浏览器访问主机对应ip加上8080端口可以访问到tomcat页面（那只猫）</p>
<p>也可以查看Tomcat进程:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep tomcat</span><br></pre></td></tr></table></figure>

<h3 id="第四部分：下载安装redis"><a href="#第四部分：下载安装redis" class="headerlink" title="第四部分：下载安装redis"></a>第四部分：下载安装redis</h3><h4 id="1、安装gcc-c"><a href="#1、安装gcc-c" class="headerlink" title="1、安装gcc-c++"></a>1、安装gcc-c++</h4><p>redis是C语言开发，安装redis需要先将官网下载的源码进行编译，编译依赖gcc环境。</p>
<p>输入命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/19.png" alt="安装gcc-c++"></p>
<p>输入y确认下载</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/20.png" alt="确认下载"></p>
<p>输入y确认安装</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/21.png" alt="确认安装"></p>
<p>安装 gcc 成功！</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/22.png" alt="安装 gcc 成功"></p>
<h4 id="2、在官网下载所需的redis"><a href="#2、在官网下载所需的redis" class="headerlink" title="2、在官网下载所需的redis"></a>2、在<a target="_blank" rel="noopener" href="https://redis.io/download">官网</a>下载所需的redis</h4><h4 id="3、上传编译安装tomcat"><a href="#3、上传编译安装tomcat" class="headerlink" title="3、上传编译安装tomcat"></a>3、上传编译安装tomcat</h4><p>解压上传的tomcat</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf redis-****.tar.gz</span><br></pre></td></tr></table></figure>

<p>编译安装</p>
<p>切换至程序目录，并执行make命令编译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ll</span><br><span class="line">cd redis-***</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>执行安装命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make PREFIX=/usr/local/redis install </span><br></pre></td></tr></table></figure>

<p>make install安装完成后，会在/usr/local/bin目录下生成下面几个可执行文件，它们的作用分别是：</p>
<p>redis-server：Redis服务器端启动程序</p>
<p>redis-cli：Redis客户端操作工具。也可以用telnet根据其纯文本协议来操作</p>
<p>redis-benchmark：Redis性能测试工具</p>
<p>redis-check-aof：数据修复工具</p>
<p>redis-check-dump：检查导出工具</p>
<h4 id="4、配置redis"><a href="#4、配置redis" class="headerlink" title="4、配置redis"></a>4、配置redis</h4><p>复制配置文件到/usr/local/redis/bin目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd redis-***</span><br><span class="line">cp redis.conf /usr/local/redis/bin</span><br></pre></td></tr></table></figure>

<h4 id="5、启动redis"><a href="#5、启动redis" class="headerlink" title="5、启动redis"></a>5、启动redis</h4><p>进入redis/bin目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd redis/bin</span><br></pre></td></tr></table></figure>

<p>启动redis服务端（注意命令前面有<code>.</code>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-server redis.conf</span><br></pre></td></tr></table></figure>

<p>克隆新窗口，启动redis客户端（注意命令前面有<code>.</code>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli</span><br></pre></td></tr></table></figure>

<h3 id="第五部分：下载安装nginx"><a href="#第五部分：下载安装nginx" class="headerlink" title="第五部分：下载安装nginx"></a>第五部分：下载安装nginx</h3><h4 id="1、安装前的准备"><a href="#1、安装前的准备" class="headerlink" title="1、安装前的准备"></a>1、安装前的准备</h4><p>需要安装 gcc 的环境【前面安装redis时安装过，此步省略】</p>
<p>第三方的开发包：</p>
<ul>
<li><p><strong>PCRE</strong></p>
<p>PCRE(Perl Compatible Regular Expressions)是一个 Perl 库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>

<p>注：pcre-devel 是使用 pcre 开发的一个二次开发库。nginx 也需要此库。</p>
<ul>
<li><strong>zlib</strong></li>
</ul>
<p>zlib 库提供了很多种压缩和解压缩的方式，nginx 使用 zlib 对 http 包的内容进行 gzip，所以需要在 linux 上安装 zlib 库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y zlib zlib-devel  </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>OpenSSL</strong></li>
</ul>
<p>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。nginx 不仅支持 http 协议，还支持 https（即在 ssl 协议上传输 http），所以需要在 linux安装 openssl 库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>

<h4 id="2、在官网下载Nginx"><a href="#2、在官网下载Nginx" class="headerlink" title="2、在官网下载Nginx"></a>2、在<a href="nginx%EF%BC%9Ahttp://nginx.org/">官网</a>下载Nginx</h4><h4 id="3、Nginx上传安装"><a href="#3、Nginx上传安装" class="headerlink" title="3、Nginx上传安装"></a>3、Nginx上传安装</h4><p>把 nginx 的源码包上传到 linux 系统的/usr/local/nginx 目录下</p>
<p>解压缩</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf nginx-***.tar.gz</span><br></pre></td></tr></table></figure>

<p>进入nginx-***目录  使用 configure 命令创建一 makeFile 文件（注意命令前面有<code>.</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure \</span><br><span class="line">--prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx \</span><br><span class="line">--pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx&#x2F;nginx.pid \</span><br><span class="line">--lock-path&#x3D;&#x2F;var&#x2F;lock&#x2F;nginx.lock \</span><br><span class="line">--error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log \</span><br><span class="line">--http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--http-client-body-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;client \</span><br><span class="line">--http-proxy-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;proxy \</span><br><span class="line">--http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;fastcgi \</span><br><span class="line">--http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;uwsgi \</span><br><span class="line">--http-scgi-temp-path&#x3D;&#x2F;var&#x2F;temp&#x2F;nginx&#x2F;scgi</span><br></pre></td></tr></table></figure>

<p>执行后可以看到Makefile文件</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/23.png" alt="Makefile文件"></p>
<blockquote>
<p>Makefile是一种配置文件， Makefile 一个工程中的源文件不计数，其按类型、功能、模块分别放在若干个目录中，makefile定义了一系列的规则来指定，哪些文件需要先编译，哪些文件需要后编译，哪些文件需要重新编译，甚至于进行更复杂的功能操作，因为 makefile就像一个Shell脚本一样，其中也可以执行操作系统的命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">configure参数</span><br><span class="line">.&#x2F;configure \</span><br><span class="line">--prefix&#x3D;&#x2F;usr \                                                        指向安装目录</span><br><span class="line">--sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx \                                 指向（执行）程序文件（nginx）</span><br><span class="line">--conf-path&#x3D;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf \                      指向配置文件</span><br><span class="line">--error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log \              指向log</span><br><span class="line">--http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log \            指向http-log</span><br><span class="line">--pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx&#x2F;nginx.pid \                      指向pid</span><br><span class="line">--lock-path&#x3D;&#x2F;var&#x2F;lock&#x2F;nginx.lock \                         （安装文件锁定，防止安装文件被别人利用，或自己误操作。）</span><br><span class="line">--user&#x3D;nginx \</span><br><span class="line">--group&#x3D;nginx \</span><br><span class="line">--with-http_ssl_module \                      启用ngx_http_ssl_module支持（使支持https请求，需已安装</span><br><span class="line">openssl）</span><br><span class="line">--with-http_flv_module \                       启用ngx_http_flv_module支持（提供寻求内存使用基于时间的偏移量文件）</span><br><span class="line">--with-http_stub_status_module \     启用ngx_http_stub_status_module支持（获取nginx自上次启动以来的工作状态）</span><br><span class="line">--with-http_gzip_static_module \   启用ngx_http_gzip_static_module支持（在线实时压缩输出数据流）</span><br><span class="line">--http-client-body-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;client&#x2F; \ 设定http客户端请求临时文件路径</span><br><span class="line">--http-proxy-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;proxy&#x2F; \ 设定http代理临时文件路径</span><br><span class="line">--http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;fcgi&#x2F; \ 设定http fastcgi临时文件路径</span><br><span class="line">--http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;uwsgi \ 设定http uwsgi临时文件路径</span><br><span class="line">--http-scgi-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;scgi \ 设定http scgi临时文件路径</span><br><span class="line">--with-pcre 启用pcre库openssl）</span><br><span class="line">--with-http_flv_module \                       启用ngx_http_flv_module支持（提供寻求内存使用基于时间的偏移量文件）</span><br><span class="line">--with-http_stub_status_module \     启用ngx_http_stub_status_module支持（获取nginx自上次启动以来的工作状态）</span><br><span class="line">--with-http_gzip_static_module \   启用ngx_http_gzip_static_module支持（在线实时压缩输出数据流）</span><br><span class="line">--http-client-body-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;client&#x2F; \ 设定http客户端请求临时文件路径</span><br><span class="line">--http-proxy-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;proxy&#x2F; \ 设定http代理临时文件路径</span><br><span class="line">--http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;fcgi&#x2F; \ 设定http fastcgi临时文件路径</span><br><span class="line">--http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;uwsgi \ 设定http uwsgi临时文件路径</span><br><span class="line">--http-scgi-temp-path&#x3D;&#x2F;var&#x2F;tmp&#x2F;nginx&#x2F;scgi \ 设定http scgi临时文件路径</span><br><span class="line">--with-pcre 启用pcre库</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="4、编译"><a href="#4、编译" class="headerlink" title="4、编译"></a>4、编译</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<h4 id="5、安装"><a href="#5、安装" class="headerlink" title="5、安装"></a>5、安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="6、Nginx启动与访问"><a href="#6、Nginx启动与访问" class="headerlink" title="6、Nginx启动与访问"></a>6、Nginx启动与访问</h4><p>启动nginx 之前，上边将临时文件目录指定为/var/temp/nginx/client， 需要在/var 下创建此 目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/temp/nginx/client -p</span><br></pre></td></tr></table></figure>

<p>进入到Nginx目录下的sbin目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/ngiux/sbin</span><br></pre></td></tr></table></figure>

<p>输入命令启动Nginx（注意命令前面有<code>.</code>）（注意防火墙）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx</span><br></pre></td></tr></table></figure>

<p>在浏览器访问主机对应ip（端口默认是80）可以访问到nginx页面</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/24.png" alt="nginx页面"></p>
<p>也可以查看nginx进程:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux|grep nginx</span><br></pre></td></tr></table></figure>

<ul>
<li><p>关闭 nginx：</p>
<p>./nginx -s stop  </p>
<p>或者</p>
<p>./nginx -s quit  </p>
</li>
<li><p>重启 nginx：</p>
<p>1、先关闭后启动。</p>
<p>2、刷新配置文件：</p>
<p>./nginx -s reload  </p>
</li>
</ul>
<h3 id="第六部分：下载安装rabbitmq"><a href="#第六部分：下载安装rabbitmq" class="headerlink" title="第六部分：下载安装rabbitmq"></a>第六部分：下载安装rabbitmq</h3><h4 id="1、在官网下载rabbitmq"><a href="#1、在官网下载rabbitmq" class="headerlink" title="1、在官网下载rabbitmq"></a>1、在<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/install-rpm.html">官网</a>下载rabbitmq</h4><p>注意要下载rabbitmq对应的Erlang、socat</p>
<h4 id="2、安装依赖环境"><a href="#2、安装依赖环境" class="headerlink" title="2、安装依赖环境"></a>2、安装依赖环境</h4><p>在线安装依赖环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install build-essential openssl openssl-devel unixODBC unixODBC-devel make gcc gcc-c++ kernel-devel m4 ncurses-devel tk tc xz</span><br></pre></td></tr></table></figure>

<h4 id="3、上传（以下按照你们下载的版本为主）"><a href="#3、上传（以下按照你们下载的版本为主）" class="headerlink" title="3、上传（以下按照你们下载的版本为主）"></a>3、上传（以下按照你们下载的版本为主）</h4><p>erlang-18.3-1.el7.centos.x86_64.rpm<br>socat-1.7.3.2-5.el7.lux.x86_64.rpm<br>rabbitmq-server-3.6.5-1.noarch.rpm</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">rpm -ivh erlang-18.3-1.el7.centos.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>如果出现如下错误</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/25.png" alt="错误"></p>
<p>说明gblic 版本太低。我们可以查看当前机器的gblic 版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings /lib64/libc.so.6 | grep GLIBC</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/26.png" alt="gblic 版本"></p>
<p>当前最高版本2.12，需要2.15.所以需要升级glibc</p>
<ul>
<li><p>使用yum更新安装依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make -y</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载rpm包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://copr-be.cloud.fedoraproject.org/results/mosquito/myrepo-el6/epel-6-x86_64/glibc-2.17-55.fc20/glibc-utils-2.17-55.el6.x86_64.rpm &amp;</span><br><span class="line">wget http://copr-be.cloud.fedoraproject.org/results/mosquito/myrepo-el6/epel-6-x86_64/glibc-2.17-55.fc20/glibc-static-2.17-55.el6.x86_64.rpm &amp;</span><br><span class="line">wget http://copr-be.cloud.fedoraproject.org/results/mosquito/myrepo-el6/epel-6-x86_64/glibc-2.17-55.fc20/glibc-2.17-55.el6.x86_64.rpm &amp;</span><br><span class="line">wget http://copr-be.cloud.fedoraproject.org/results/mosquito/myrepo-el6/epel-6-x86_64/glibc-2.17-55.fc20/glibc-common-2.17-55.el6.x86_64.rpm &amp;</span><br><span class="line">wget http://copr-be.cloud.fedoraproject.org/results/mosquito/myrepo-el6/epel-6-x86_64/glibc-2.17-55.fc20/glibc-devel-2.17-55.el6.x86_64.rpm &amp;</span><br><span class="line">wget http://copr-be.cloud.fedoraproject.org/results/mosquito/myrepo-el6/epel-6-x86_64/glibc-2.17-55.fc20/glibc-headers-2.17-55.el6.x86_64.rpm &amp;</span><br><span class="line">wget http://copr-be.cloud.fedoraproject.org/results/mosquito/myrepo-el6/epel-6-x86_64/glibc-2.17-55.fc20/nscd-2.17-55.el6.x86_64.rpm &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装rpm包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -Uvh *-2.17-55.el6.x86_64.rpm --force --nodeps</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装完毕后再查看glibc版本,发现glibc版本已经到2.17了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings /lib64/libc.so.6 | grep GLIBC</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/27.png" alt="查看glibc版本"></p>
<h4 id="4-安装RabbitMQ"><a href="#4-安装RabbitMQ" class="headerlink" title="4. 安装RabbitMQ"></a>4. 安装RabbitMQ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">rpm -ivh socat-1.7.3.2-5.el7.lux.x86_64.rpm</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">rpm -ivh rabbitmq-server-3.6.5-1.noarch.rpm</span><br></pre></td></tr></table></figure>


<h4 id="5-开启管理界面及配置"><a href="#5-开启管理界面及配置" class="headerlink" title="5. 开启管理界面及配置"></a>5. 开启管理界面及配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启管理界面</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br><span class="line"><span class="comment"># 修改默认配置信息</span></span><br><span class="line">vim /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/ebin/rabbit.app </span><br><span class="line"><span class="comment"># 比如修改密码、配置等等，例如：loopback_users 中的 &lt;&lt;&quot;guest&quot;&gt;&gt;,只保留guest</span></span><br></pre></td></tr></table></figure>


<h4 id="6-启动（注意防火墙）"><a href="#6-启动（注意防火墙）" class="headerlink" title="6. 启动（注意防火墙）"></a>6. 启动（注意防火墙）</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service rabbitmq-server start <span class="comment"># 启动服务</span></span><br><span class="line">service rabbitmq-server stop <span class="comment"># 停止服务</span></span><br><span class="line">service rabbitmq-server restart <span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure>

<ul>
<li>设置配置文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/doc/rabbitmq-server-3.6.5/</span><br><span class="line">cp rabbitmq.config.example /etc/rabbitmq/rabbitmq.config</span><br></pre></td></tr></table></figure>

<p>在浏览器访问主机对应ip加上15672端口可以访问到RabbitMQ页面（用户名密码默认为guest）</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/28.png" alt="RabbitMQ页面"></p>
<p>出现访问不到RabbitMQ页面问题</p>
<p>在控制台输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep rabbitmq</span><br></pre></td></tr></table></figure>

<p>命令含义：从当前所有进程中查找是否含有rabbitmq进程</p>
<p>如果有内容显示，则说明 Rabbitmq启动成功</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/29.png" alt="rabbitmq进程"></p>
<p>否则，重新启动 Rabbitmq</p>
<h3 id="2-检查能否从-Linux-本地中访问到-Rabbitmq"><a href="#2-检查能否从-Linux-本地中访问到-Rabbitmq" class="headerlink" title="2. 检查能否从 Linux 本地中访问到 Rabbitmq"></a>2. 检查能否从 Linux 本地中访问到 Rabbitmq</h3><p>从控制台输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;localhost:15672</span><br></pre></td></tr></table></figure>

<p>命令含义：访问 <a target="_blank" rel="noopener" href="http://localhost:15672/">http://localhost:15672</a><br> <img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/30.png" alt="linux访问"></p>
<p>否则，检查 Rabbitmq端口号是否正确</p>
<h3 id="3-检查-Rabbitmq启动端口号"><a href="#3-检查-Rabbitmq启动端口号" class="headerlink" title="3. 检查 Rabbitmq启动端口号"></a>3. 检查 Rabbitmq启动端口号</h3><p>Rabbitmq 默认的启动端口号是 15672，如果你没有对 Rabbitmq 的配置文件做修改的话应该是没有问题的<br>输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep rabbitmq</span><br></pre></td></tr></table></figure>

<p>命令含义：查看 Rabbitmq进程信息</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/31.png" alt=" Rabbitmq进程信息"></p>
<p>查看进程号（图中红色框位置）</p>
<p>接着输入命令：（注：grep 后跟的就是上一步所查的进程号）<br>命令含义：查看 9810进程占用的端口号<br> <img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/32.png" alt="端口号"></p>
<p>图中红色框位置即是你的 Rabbitmq的启动端口号</p>
<h3 id="4-检查远程访问的-ip-地址是否正确"><a href="#4-检查远程访问的-ip-地址是否正确" class="headerlink" title="4. 检查远程访问的 ip 地址是否正确"></a>4. 检查远程访问的 ip 地址是否正确</h3><p>如果从 Linux 本地可以成功访问 Rabbitmq服务器，而从 Windows（主机） 上无法访问，那么首先检查远程访问的 ip 地址是否正确<br>在 Liunx 控制台上输入命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/33.png" alt="查看主机ip"></p>
<p>图中位置即是 Linux 的 ip 地址，若此处没出现ens33的ip地址，可能是网络配置没配置好，解决方法具体请见<a target="_blank" rel="noopener" href="https://www.itdaan.com/link/aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vemlweHpmL3AvMTEyMzcyNjkuaHRtbA==">https://www.cnblogs.com/zipxzf/p/11237269.html</a></p>
<h3 id="5-检查-Linux-防火墙是否开放-Rabbitmq端口号"><a href="#5-检查-Linux-防火墙是否开放-Rabbitmq端口号" class="headerlink" title="5. 检查 Linux 防火墙是否开放 Rabbitmq端口号"></a>5. 检查 Linux 防火墙是否开放 Rabbitmq端口号</h3><p>参考的是zipxzf的<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zipxzf/p/11249846.html">在Centos7中,从主机 Windows 上无法远程访问 Linux 上rabbitmq的解决方法</a>这篇博客，加上自己的一些补充</p>
<p>当window能够ping通linux的ip，而还是不能通过ip在windows上访问linux的一些服务，如tomcat、mysql、nginx、rabbitmq等服务，最可能的原因是linux的防火墙问题。</p>
<p>如果你没有修改过 Linux 防火墙配置的话，那么 Rabbitmq 端口号一定是被禁用了 ，因为 Linux 防火墙默认只开启 22 号端口。</p>
<p>你需要设置防火墙配置，开放 Rabbitmq的端口号 （<strong>注：网上有其他解决方法说直接关闭防火墙，这种方法很不可取</strong>）</p>
<p>我的 Linux 版本是 CentOS 7 ，在CentOS 7或RHEL 7或Fedora中防火墙由firewalld来管理，如果要添加范围例外端口 如 1000-2000</p>
<p>语法命令如下：启用区域端口和协议组合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--zone&#x3D;&lt;zone&gt;] --add-port&#x3D;&lt;port&gt;[-&lt;port&gt;]&#x2F;&lt;protocol&gt; [--timeout&#x3D;&lt;seconds&gt;]</span><br></pre></td></tr></table></figure>

<p>此举将启用端口和协议的组合。端口可以是一个单独的端口 <port> 或者是一个端口范围 <port>-<port> 。协议可以是 tcp 或 udp。</port></port></port></p>
<p>实际命令如下：</p>
<p>　　添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;80&#x2F;tcp --permanent （--permanent永久生效，没有此参数重启后失效）</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;1000-2000&#x2F;tcp --permanent </span><br></pre></td></tr></table></figure>

<p>　　重新载入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>　　查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --query-port&#x3D;80&#x2F;tcp</span><br></pre></td></tr></table></figure>

<p>　　删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --remove-port&#x3D;80&#x2F;tcp --permanent</span><br></pre></td></tr></table></figure>

<p>此处的解决方案是开放 15672端口号只需输入命令：(<strong>注：若python无法连接Rabbitmq，同理，则需要开放5672端口号</strong>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;15672&#x2F;tcp --permanent</span><br></pre></td></tr></table></figure>

<p>然后重启防火墙，即可解决：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p> 成功访问rabbitmq管理页面</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E5%9C%A8CentOS%E7%9A%84Linux%E4%B8%8B%E8%BD%BDjdk%E3%80%81mysql%E3%80%81tomcat%E3%80%81redis%E3%80%81nginx%E3%80%81rabbitmq/34.png" alt="rabbitmq管理页面"></p>
<h3 id="6、配置防火墙"><a href="#6、配置防火墙" class="headerlink" title="6、配置防火墙"></a>6、配置防火墙</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙状态 </span></span><br><span class="line">systemctl status firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭防火墙 </span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动防火墙</span></span><br><span class="line">systemctl start firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启防火墙</span></span><br><span class="line">systemctl restart firewalld.service</span><br><span class="line"> </span><br><span class="line">单独开放端口号：</span><br><span class="line"></span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=8080(端口号)/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --query-port=8080(端口号)/tcp</span><br></pre></td></tr></table></figure>

<p>需要开放的端口号：</p>
<p>mysql：3306</p>
<p>tomcat：8080</p>
<p>redis：6379</p>
<p>nginx：80</p>
<p>RabbitMQ：15672,25672,5672</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" class="post-title-link" itemprop="url">搭建本地博客</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-08 18:25:19" itemprop="dateCreated datePublished" datetime="2020-11-08T18:25:19+08:00">2020-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-19 03:14:36" itemprop="dateModified" datetime="2021-04-19T03:14:36+08:00">2021-04-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" itemprop="url" rel="index"><span itemprop="name">搭建博客</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本人最近心血来潮，想要搭建一个属于自己的个人博客。参考的是Fangzh的<a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_37781304/article/details/82729029">hexo史上最全搭建教程</a>这篇博客，加上自己的一些补充。</p>
<p>搭建博客的方式大体上说有三种：</p>
<ul>
<li>在CSDN，博客园，简书等平台，可以直接在上面发表，用户交互做的好，写的文章百度也能搜索的到。缺点是比较不自由，会受到平台的各种限制和恶心的广告。</li>
<li>自己购买域名和服务器，搭建博客。这样做的成本实在是太高了，不光是说这些购买成本，单单是花力气去自己搭这么一个网站，还要定期的维护它，对于我们大多数人来说，实在是没有这样的精力和时间。</li>
<li>直接在github page平台上托管我们的博客。这样就可以安心的来写作，又不需要定期维护，而且hexo作为一个快速简洁的博客框架，用它来搭建博客真的非常容易。</li>
</ul>
<p>这里我采用的git-Node.js-Hexo的方式构建的博客。</p>
<p>这种方式写博客需要使用到Markdown语法，详情可查看本人的另外一篇博客<a href="https://xgh-user.github.io/2020/11/08/markdown%E8%AF%AD%E6%B3%95/">markdown语法</a>。里面有Markdown的基础语法。</p>
<p>注意：以下在配置.yml配置文件的时候注意<strong>yml的语法</strong>，yml是有严格的规则的。以免出现不必要的错误。</p>
<p>yml的语法</p>
<ul>
<li>k:(空格)v：表示一对键值对（空格必须有）</li>
<li>属性和值也是大小写敏感</li>
</ul>
<h2 id="教程分三个部分"><a href="#教程分三个部分" class="headerlink" title="教程分三个部分"></a>教程分三个部分</h2><ul>
<li>第一部分：hexo的初级搭建还有部署到github page上，以及个人域名的绑定。</li>
<li>第二部分：hexo的基本配置，更换主题，实现多终端工作，以及在coding page部署实现国内外分流</li>
<li>第三部分：hexo添加各种功能，包括搜索的SEO，阅读量统计，访问量统计和评论系统等。</li>
</ul>
<hr>
<h2 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h2><p>hexo的初级搭建还有部署到github page上，以及个人域名的绑定。</p>
<h3 id="Hexo简介"><a href="#Hexo简介" class="headerlink" title="Hexo简介"></a>Hexo简介</h3><p>Hexo是一款基于Node.js的静态博客框架，依赖少易于安装使用，可以方便的生成静态网页托管在GitHub和Coding上，是搭建博客的首选框架。大家可以进入<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">hexo官网</a>进行详细查看，因为Hexo的创建者是台湾人，对中文的支持很友好，可以选择中文进行查看。</p>
<h3 id="Hexo搭建步骤"><a href="#Hexo搭建步骤" class="headerlink" title="Hexo搭建步骤"></a>Hexo搭建步骤</h3><ol>
<li>安装Git</li>
<li>安装Node.js</li>
<li>安装Hexo</li>
<li>GitHub创建个人仓库</li>
<li>生成SSH添加到GitHub</li>
<li>将hexo部署到GitHub</li>
<li>设置个人域名</li>
<li>发布文章</li>
</ol>
<h3 id="1-安装Git"><a href="#1-安装Git" class="headerlink" title="1. 安装Git"></a>1. 安装Git</h3><p>Git是目前世界上最先进的分布式版本控制系统，可以有效、高速的处理从很小到非常大的项目版本管理。也就是用来管理你的hexo博客文章，上传到GitHub的工具。Git非常强大，我觉得建议每个人都去了解一下。廖雪峰老师的Git教程写的非常好，大家可以了解一下。<a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">Git教程</a></p>
<p>windows：到git官网上下载,<a target="_blank" rel="noopener" href="https://gitforwindows.org/">Download git</a>,下载后会有一个Git Bash的命令行工具，以后就用这个工具来使用git。</p>
<p>linux：对linux来说实在是太简单了，因为最早的git就是在linux上编写的，只需要一行代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>

<p>安装好后，用<code>git --version</code> 来查看一下版本</p>
<h3 id="2-安装nodejs"><a href="#2-安装nodejs" class="headerlink" title="2. 安装nodejs"></a>2. 安装nodejs</h3><p>Hexo是基于nodeJS编写的，所以需要安装一下nodeJs和里面的npm工具。</p>
<p>windows：<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">nodejs</a>选择LTS版本就行了。</p>
<p>linux：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br><span class="line">sudo apt-get install npm</span><br></pre></td></tr></table></figure>

<p>安装完后，打开命令行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>

<p>检查一下有没有安装成功</p>
<p>顺便说一下，windows在git安装完后，就可以直接使用git bash来敲命令行了，不用自带的cmd，cmd有点难用。</p>
<h3 id="3-安装hexo"><a href="#3-安装hexo" class="headerlink" title="3. 安装hexo"></a>3. 安装hexo</h3><p>前面git和nodejs安装好后，就可以安装hexo了，你可以先创建一个文件夹blog，然后<code>cd</code>到这个文件夹下（或者在这个文件夹下直接右键git bash打开）。</p>
<p>输入命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>依旧用<code>hexo -v</code>查看一下版本</p>
<p>至此就全部安装完了。</p>
<p>接下来初始化一下hexo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init myblog</span><br></pre></td></tr></table></figure>

<p>这个myblog可以自己取什么名字都行，然后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> myblog //进入这个myblog文件夹</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>新建完成后，指定文件夹目录下有：</p>
<ul>
<li>node_modules: 依赖包</li>
<li>public：存放生成的页面</li>
<li>scaffolds：生成文章的一些模板</li>
<li>source：用来存放你的文章</li>
<li>themes：主题</li>
<li>** _config.yml: 博客的配置文件**</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>

<p>打开hexo的服务，在浏览器输入localhost:4000就可以看到你生成的博客了。</p>
<p>大概长这样：</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/1.jpg" alt="Hexo主页"><br> 使用ctrl+c可以把服务关掉。</p>
<h3 id="4-GitHub创建个人仓库"><a href="#4-GitHub创建个人仓库" class="headerlink" title="4.GitHub创建个人仓库"></a>4.GitHub创建个人仓库</h3><p>首先，你先要有一个GitHub账户，去注册一个吧。</p>
<p>注册完登录后，在GitHub.com中看到一个New repository，新建仓库</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/2.jpg" alt="New repository"></p>
<p>创建一个和你用户名相同的仓库，后面加.github.io，只有这样，将来要部署到GitHub page的时候，才会被识别，也就是xxxx.github.io，其中xxx就是你注册GitHub的用户名。我这里是已经建过了。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/3.png" alt="repository name"></p>
<p>点击create repository。</p>
<h3 id="5-生成SSH添加到GitHub"><a href="#5-生成SSH添加到GitHub" class="headerlink" title="5. 生成SSH添加到GitHub"></a>5. 生成SSH添加到GitHub</h3><p>回到你的git bash中，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;yourname&quot;</span><br><span class="line">git config --global user.email &quot;youremail&quot;</span><br></pre></td></tr></table></figure>

<p>这里的yourname输入你的GitHub用户名，youremail输入你GitHub的邮箱。这样GitHub才能知道你是不是对应它的账户。</p>
<p>可以用以下两条，检查一下你有没有输对</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config user.name</span><br><span class="line">git config user.email</span><br></pre></td></tr></table></figure>

<p>然后创建SSH,一路回车</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;youremail&quot;</span><br></pre></td></tr></table></figure>

<p>创建SSH是会提示你输入保存路径，用默认即可，你只需要指定一个保存文件的名字，比如/c/Users/Amarao/.ssh/0729XGHGitHub（可以不设置，回车就行）</p>
<p>还会提示你输入SSH登陆密码，可以不设置</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/4.png" alt="SSH"></p>
<p>补充：在新生成密钥的时候，经常会报这样的错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The authenticity of host <span class="string">&#x27;github.com (192.30.255.112)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.</span></span><br></pre></td></tr></table></figure>

<p>这是因为少了一个known_hosts文件，本来密钥文件应该是三个，现在是两个，便报了这样的错误，此时选择yes回车之后，便可，同时生成了缺少了的known_hosts文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Are you sure you want to continue connecting (yes&#x2F;no)? &#x2F;&#x2F;输入yes，回车</span><br></pre></td></tr></table></figure>

<p>这个时候它会告诉你已经生成了.ssh的文件夹。在你的电脑中找到这个文件夹。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/5.jpg" alt=".ssh"></p>
<p>ssh，简单来讲，就是一个秘钥，其中，<code>id_rsa</code>是你这台电脑的私人秘钥，不能给别人看的，<code>id_rsa.pub</code>是公共秘钥，可以随便给别人看。把这个公钥放在GitHub上，这样当你链接GitHub自己的账户时，它就会根据公钥匹配你的私钥，当能够相互匹配时，才能够顺利的通过git上传你的文件到GitHub上。</p>
<p>打开公钥文件<code>id_rsa.pub</code></p>
<ul>
<li><p>用<code>win+r</code>打开电脑的控制面板</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/6.png" alt="cmd"></p>
</li>
<li><p>使用cd命令进入id_rsa.pub目录</p>
</li>
<li><p>使用<code>more id_rsa.pub</code>命令查看公钥的内容</p>
</li>
<li><p>复制公钥的内容</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/7.png" alt="id_rsa.pub"></p>
</li>
</ul>
<p>而后在GitHub的setting中，找到SSH keys的设置选项，点击<code>New SSH key</code><br>把你的<code>id_rsa.pub</code>里面的信息复制进去。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/8.jpg" alt="add ssh key"></p>
<p>在gitbash中，查看是否成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<h3 id="6-将hexo部署到GitHub"><a href="#6-将hexo部署到GitHub" class="headerlink" title="6.将hexo部署到GitHub"></a>6.将hexo部署到GitHub</h3><p>这一步，我们就可以将hexo和GitHub关联起来，也就是将hexo生成的文章部署到GitHub上，打开站点配置文件 <code>_config.yml</code>，翻到最后在<code>deploy</code>那里，修改为<br> YourgithubName就是你的GitHub账户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/YourgithubName/YourgithubName.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>这个时候需要先安装deploy-git ，也就是部署的命令,这样你才能用命令部署到GitHub。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<p>其中 <code>hexo clean</code>清除了你之前生成的东西，也可以不加。<br> <code>hexo generate</code> 顾名思义，生成静态文章，可以用 <code>hexo g</code>缩写<br> <code>hexo deploy</code> 部署文章，可以用<code>hexo d</code>缩写</p>
<p>注意deploy时可能要你输入username和password。</p>
<p>得到下图就说明部署成功了，过一会儿就可以在<code>http://yourname.github.io</code> 这个网站看到你的博客了！！<br><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/9.jpg" alt="上传部署"></p>
<h3 id="7-设置个人域名"><a href="#7-设置个人域名" class="headerlink" title="7. 设置个人域名"></a>7. 设置个人域名</h3><p>现在你的个人网站的地址是 <code>yourname.github.io</code>，如果觉得这个网址逼格不太够，这就需要你设置个人域名了。但是需要花钱。</p>
<p>注册一个阿里云账户,在<a target="_blank" rel="noopener" href="https://wanwang.aliyun.com/?spm=5176.8142029.digitalization.2.e9396d3e46JCc5">阿里云</a>上买一个域名，我买的是 <code>fangzh.top</code>，各个后缀的价格不太一样，比如最广泛的.com就比较贵，看个人喜好咯。</p>
<p>你需要先去进行实名认证,然后在域名控制台中，看到你购买的域名。</p>
<p>点<strong>解析</strong>进去，添加解析。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/10.jpg" alt="解析"></p>
<p>其中，192.30.252.153 和 192.30.252.154 是GitHub的服务器地址。<br> <strong>注意，解析线路选择默认</strong>，不要像我一样选境外。这个境外是后面来做国内外分流用的,在后面的博客中会讲到。记得现在选择<strong>默认</strong>！！</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/11.jpg" alt="解析线路"></p>
<p>登录GitHub，进入之前创建的仓库，点击settings，设置Custom domain，输入你的域名<code>fangzh.top</code></p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/12.jpg" alt="域名"></p>
<p>然后在你的博客文件source中创建一个名为CNAME文件，不要后缀。写上你的域名。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/13.jpg" alt="CNAME"></p>
<p>最后，在gitbash中，输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<p>过不了多久，再打开你的浏览器，输入你自己的域名，就可以看到搭建的网站啦！</p>
<p>接下来你就可以正式开始写文章了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new newpapername</span><br></pre></td></tr></table></figure>

<p>然后在source/_post中打开markdown文件，就可以开始编辑了。</p>
<p>当你写完的时候，再</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<p>就可以看到更新了。</p>
<h2 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h2><p>hexo的基本配置，更换主题，实现多终端工作，以及在coding page部署实现国内外分流。</p>
<h3 id="1-hexo基本配置"><a href="#1-hexo基本配置" class="headerlink" title="1. hexo基本配置"></a>1. hexo基本配置</h3><p>在文件根目录下的<code>_config.yml</code>，就是整个hexo框架的配置文件了。可以在里面修改大部分的配置。详细可参考<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/configuration">官方的配置</a>描述。</p>
<h4 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>title</code></td>
<td>网站标题</td>
</tr>
<tr>
<td><code>subtitle</code></td>
<td>网站副标题</td>
</tr>
<tr>
<td><code>description</code></td>
<td>网站描述</td>
</tr>
<tr>
<td><code>author</code></td>
<td>您的名字</td>
</tr>
<tr>
<td><code>language</code></td>
<td>网站使用的语言</td>
</tr>
<tr>
<td><code>timezone</code></td>
<td>网站时区。Hexo 默认使用您电脑的时区。<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">时区列表</a>。比如说：<code>America/New_York</code>, <code>Japan</code>, 和 <code>UTC</code> 。</td>
</tr>
</tbody></table>
<p>其中，<code>description</code>主要用于SEO，告诉搜索引擎一个关于您站点的简单描述，通常建议在其中包含您网站的关键词。<code>author</code>参数用于主题显示文章的作者。</p>
<h4 id="网址"><a href="#网址" class="headerlink" title="网址"></a>网址</h4><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>url</code></td>
<td>网址</td>
</tr>
<tr>
<td><code>root</code></td>
<td>网站根目录</td>
</tr>
<tr>
<td><code>permalink</code></td>
<td>文章的 <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/permalinks">永久链接</a> 格式</td>
</tr>
<tr>
<td><code>permalink_defaults</code></td>
<td>永久链接中各部分的默认值</td>
</tr>
</tbody></table>
<p>在这里，你需要把<code>url</code>改成你的网站域名。</p>
<p>permalink，也就是你生成某个文章时的那个链接格式。</p>
<p>比如我新建一个文章叫<code>temp.md</code>，那么这个时候他自动生成的地址就是<code>http://yoursite.com/2018/09/05/temp</code>。</p>
<p>以下是官方给出的示例，关于链接的变量还有很多，需要的可以去官网上查找 <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/permalinks">永久链接</a> 。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td><code>:year/:month/:day/:title/</code></td>
<td>2013/07/14/hello-world</td>
</tr>
<tr>
<td><code>:year-:month-:day-:title.html</code></td>
<td>2013-07-14-hello-world.html</td>
</tr>
<tr>
<td><code>:category/:title</code></td>
<td>foo/bar/hello-world</td>
</tr>
</tbody></table>
<p>再往下翻，中间这些都默认就好了。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">landscape</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">&lt;repository</span> <span class="string">url&gt;</span></span><br><span class="line">  <span class="attr">branch:</span> [<span class="string">branch</span>]</span><br></pre></td></tr></table></figure>

<p><code>theme</code>就是选择什么主题，也就是在<code>theme</code>这个文件夹下，在官网上有很多个主题，默认给你安装的是<code>lanscape</code>这个主题。当你需要更换主题时，在官网上下载，把主题的文件放在<code>theme</code>文件夹下，再修改这个参数就可以了。</p>
<p>接下来这个<code>deploy</code>就是网站的部署的，<code>repo</code>就是仓库(<code>Repository</code>)的简写。<code>branch</code>选择仓库的哪个分支。这个在之前进行github page部署的时候已经修改过了，不再赘述。而这个在后面进行双平台部署的时候会再次用到。</p>
<h4 id="Front-matter"><a href="#Front-matter" class="headerlink" title="Front-matter"></a>Front-matter</h4><p>Front-matter 是你要书写的blog的Markdown文件的最上方以 <code>---</code> 分隔的区域，用于指定个别文件的变量，举例来说：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">title: Hello World</span><br><span class="line">date: 2013/7/13 20:46:25</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>下是预先定义的参数，您可在模板中使用这些参数值并加以利用。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>layout</code></td>
<td>布局</td>
</tr>
<tr>
<td><code>title</code></td>
<td>标题</td>
</tr>
<tr>
<td><code>date</code></td>
<td>建立日期</td>
</tr>
<tr>
<td><code>updated</code></td>
<td>更新日期</td>
</tr>
<tr>
<td><code>comments</code></td>
<td>开启文章的评论功能</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>标签（不适用于分页）</td>
</tr>
<tr>
<td><code>categories</code></td>
<td>分类（不适用于分页）</td>
</tr>
<tr>
<td><code>permalink</code></td>
<td>覆盖文章网址</td>
</tr>
</tbody></table>
<p>其中，分类和标签需要区别一下，分类具有顺序性和层次性，也就是说 <code>Foo, Bar</code> 不等于 <code>Bar, Foo</code>；而标签没有顺序和层次。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Diary</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">PS3</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Games</span></span><br></pre></td></tr></table></figure>

<h4 id="layout（布局）"><a href="#layout（布局）" class="headerlink" title="layout（布局）"></a>layout（布局）</h4><p>当你每一次使用代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new paper</span><br></pre></td></tr></table></figure>

<p>它其实默认使用的是<code>post</code>这个布局，也就是在<code>source</code>文件夹下的<code>_post</code>里面。</p>
<p>Hexo 有三种默认布局：<code>post</code>、<code>page</code> 和 <code>draft</code>，它们分别对应不同的路径，而您自定义的其他布局和 <code>post</code> 相同，都将储存到 <code>source/_posts</code> 文件夹。</p>
<table>
<thead>
<tr>
<th>布局</th>
<th>路径</th>
</tr>
</thead>
<tbody><tr>
<td><code>post</code></td>
<td><code>source/_posts</code></td>
</tr>
<tr>
<td><code>page</code></td>
<td><code>source</code></td>
</tr>
<tr>
<td><code>draft</code></td>
<td><code>source/_drafts</code></td>
</tr>
</tbody></table>
<p>而new这个命令其实是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure>

<p>只不过这个layout默认是post罢了。</p>
<h4 id="page"><a href="#page" class="headerlink" title="page"></a>page</h4><p>如果你想另起一页，那么可以使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page board</span><br></pre></td></tr></table></figure>

<p>系统会自动给你在source文件夹下创建一个board文件夹，<a target="_blank" rel="noopener" href="http://以及board文件夹中的index.md/">以及board文件夹中的index.md</a>，这样你访问的board对应的链接就是<code>http://xxx.xxx/board</code></p>
<h4 id="draft"><a href="#draft" class="headerlink" title="draft"></a>draft</h4><p>draft是草稿的意思，也就是你如果想写文章，又不希望被看到，那么可以</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new draft newpage</span><br></pre></td></tr></table></figure>

<p>这样会在source/_draft中新建一个newpage.md文件，如果你的草稿文件写的过程中，想要预览一下，那么可以使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server --draft</span><br></pre></td></tr></table></figure>

<p>在本地端口中开启服务预览。</p>
<p>如果你的草稿文件写完了，想要发表到post中，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo publish draft newpage</span><br></pre></td></tr></table></figure>

<p>就会自动把newpage.md发送到post中。</p>
<hr>
<h3 id="2-更换主题"><a href="#2-更换主题" class="headerlink" title="2. 更换主题"></a>2. 更换主题</h3><p>到这一步，如果你觉得默认的<code>landscape</code>主题不好看，那么可以在官网的主题中，选择你喜欢的一个主题进行修改就可以啦。<a target="_blank" rel="noopener" href="https://hexo.io/themes/">点这里</a></p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/14.jpg" alt="theme"></p>
<p>这里有200多个主题可以选。不过最受欢迎的就是那么几个，比如<a target="_blank" rel="noopener" href="https://github.com/theme-next/hexo-theme-next">NexT主题</a>，非常的简洁好看，大多数人都选择这个，关于这个的教程也比较多。不过我选择的是<a target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-hueman">hueman</a>这个主题，好像是从WordPress移植过来的，展示效果如下：</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/15.jpg" alt="hueman"></p>
<p>不管怎么样，至少是符合我个人的审美。</p>
<p>直接在github链接上下载下来，然后放到<code>theme</code>文件夹下就行了，然后再在刚才说的配置文件中把<code>theme</code>换成那个主题文件夹的名字，它就会自动在<code>theme</code>文件夹中搜索你配置的主题。</p>
<p>而后进入<code>hueman</code>这个文件夹，可以看到里面也有一个配置文件<code>_config.yml</code>，貌似它默认是<code>_config.yml.example</code>，把它复制一份，重命名为<code>_config.yml</code>就可以了。这个配置文件是修改你整个主题的配置文件。</p>
<p><code>在hueman的_config.yml</code>里面，有：</p>
<h4 id="menu（菜单栏）"><a href="#menu（菜单栏）" class="headerlink" title="menu（菜单栏）"></a>menu（菜单栏）</h4><p>也就是上面菜单栏上的这些东西。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/16.jpg" alt="menu"></p>
<p>其中，About这个你是找不到网页的，因为你的文章中没有about这个东西。如果你想要的话，可以执行命令</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hexo</span> <span class="string">new</span> <span class="string">page</span> <span class="string">about</span></span><br></pre></td></tr></table></figure>

<p>它就会在根目录下<code>source</code>文件夹中新建了一个<code>about</code>文件夹，<a target="_blank" rel="noopener" href="http://以及index.md/">以及index.md</a>，在index.md中写上你想要写的东西，就可以在网站上展示出来了。</p>
<p>如果你想要自己再自定义一个菜单栏的选项，那么就</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hexo</span> <span class="string">new</span> <span class="string">page</span> <span class="string">yourdiy</span></span><br></pre></td></tr></table></figure>

<p>然后在主题配置文件的menu菜单栏添加一个 <code>Yourdiy : /yourdiy</code>，注意冒号后面要有空格，以及前面的空格要和menu中默认的保持整齐。然后在<code>languages</code>文件夹中，找到<code>zh-CN.yml</code>，在index中添加<code>yourdiy: &#39;中文意思&#39;</code>就可以显示中文了。</p>
<h4 id="customize-定制"><a href="#customize-定制" class="headerlink" title="customize(定制)"></a>customize(定制)</h4><p>在这里可以修改你的个人logo，默认是那个hueman，在<code>source/css/images</code>文件夹中放入自己要的logo，再改一下<code>url</code>的链接名字就可以了。</p>
<p><code>favicon</code>是网站中出现的那个小图标的icon，找一张你喜欢的logo，然后转换成ico格式，放在images文件夹下，配置一下路径就行。</p>
<p><code>social_links</code> ，可以显示你的社交链接，而且是有logo的。</p>
<p><strong>tips:</strong></p>
<p>在这里可以添加一个rss功能，也就是那个符号像wifi一样的东西。</p>
<h4 id="添加RSS"><a href="#添加RSS" class="headerlink" title="添加RSS"></a>添加RSS</h4><p><strong>1. 什么是RSS？</strong></p>
<p>RSS也就是订阅功能，你可以理解为类似与订阅公众号的功能，来订阅各种博客，杂志等等。</p>
<p><strong>2. 为什么要用RSS？</strong></p>
<p>就如同订阅公众号一样，你对某个公众号感兴趣，你总不可能一直时不时搜索这个公众号来看它的文章吧。博客也是一样，如果你喜欢某个博主，或者某个平台的内容，你可以通过RSS订阅它们，然后在RSS阅读器上可以实时推送这些消息。现在网上的垃圾消息太多了，如果你每一天都在看这些消息中度过，漫无目的的浏览，只会让你的时间一点一点的流逝，太不值得了。如果你关注的博主每次都发的消息都是精华，而且不是每一天十几条几十条的轰炸你，那么这个博主就值得你的关注，你就可以通过RSS订阅他。</p>
<p>在我的理解中，如果你不想每天都被那些没有质量的消息轰炸，只想安安静静的关注几个博主，每天看一些有质量的内容也不用太多，那么RSS订阅值得你的拥有。</p>
<p><strong>3. 添加RSS功能</strong></p>
<p>先安装RSS插件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-generator-feed</span><br></pre></td></tr></table></figure>

<p>而后在你整个项目的<code>_config.yml</code>中找到Extensions，添加：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">#RSS订阅</span></span><br><span class="line"><span class="attr">plugin:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">hexo-generator-feed</span></span><br><span class="line"><span class="comment">#Feed Atom</span></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">atom</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">atom.xml</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>这个时候你的RSS链接就是 域名<code>/atom.xml</code>了。</p>
<p>所以，在主题配置文件中的这个<code>social links</code>，开启RSS的页面功能，这样你网站上就有那个像wifi一样符号的RSS logo了，注意空格。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rss:</span> <span class="string">/atom.xml</span></span><br></pre></td></tr></table></figure>

<p><strong>4. 如何关注RSS？</strong></p>
<p>首先，你需要一个RSS阅读器，在这里我推荐<code>inoreader</code>，宇宙第一RSS阅读器，而且中文支持的挺好。不过它没有PC端的程序，只有网页版，chrome上有插件。在官网上用google账号或者自己注册账号登录，就可以开始你的关注之旅了。</p>
<p>每次需要关注某个博主时，就点开他的RSS链接，把链接复制到<code>inoreader</code>上，就能关注了，当然，如果是比较大众化的很厉害的博主，你直接搜名字也可以的，比如每个人都非常佩服的阮一峰大师，直接在阅读器上搜索<code>阮一峰</code>，应该就能出来了。</p>
<p>我关注的比如，阮一峰的网络日志，月光博客，知乎精选等，都很不错。当然，还有我！！赶快关注我吧！你值得拥有：<a target="_blank" rel="noopener" href="http://fangzh.top/atom.xml">http://fangzh.top/atom.xml</a></p>
<p>在安卓端，inoreader也有下载，不过因为国内google是登录不了的，你需要在inoreader官网上把你的密码修改了，然后就可以用账户名和密码登录了。</p>
<p>在IOS端，没用过，好像是reader 3可以支持inoreader账户，还有个readon也不错，可以去试试。</p>
<h4 id="widgets-侧边栏"><a href="#widgets-侧边栏" class="headerlink" title="widgets(侧边栏)"></a>widgets(侧边栏)</h4><p>侧边栏的小标签，如果你想自己增加一个，比如我增加了一个联系方式，那么我把<code>communication</code>写在上面，在<code>zh-CN.yml</code>中的<code>sidebar</code>，添加<code>communication: &#39;中文&#39;</code>。</p>
<p>然后在<code>hueman/layout/widget</code>中添加一个<code>communicaiton.ejs</code>，填入模板：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (site.posts.length) &#123; %&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;widget-wrap widget-list&quot;</span>&gt;</span><br><span class="line">        &lt;h3 <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;widget-title&quot;</span>&gt;&lt;%= __(<span class="string">&#x27;sidebar.communiation&#x27;</span>) %&gt;&lt;/h3&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;widget&quot;</span>&gt;</span><br><span class="line">            &lt;!--这里添加你要写的内容--&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<h4 id="search-搜索框"><a href="#search-搜索框" class="headerlink" title="search(搜索框)"></a>search(搜索框)</h4><p>默认搜索框是不能够用的，</p>
<blockquote>
<p>you need to install <code>hexo-generator-json-content</code> before using Insight Search</p>
</blockquote>
<p>它已经告诉你了，如果想要使用，就安装这个插件。</p>
<ul>
<li>1、在<code>git bash</code>中输入：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-generator-json-content --save</span><br></pre></td></tr></table></figure>

<p>如果这个包已经存在，会报错。</p>
<p>但是你需要在你博客的根目录下，找到<code>node_modules</code>文件夹。如果<code>hexo-generator-json-content</code> 这个包是存在的就OK。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/17.png" alt="hexo-generator-json-content"></p>
<ul>
<li>2、在博客根目录下，找到_config.yml，打开找一个空白地方复制一下配置信息：</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jsonContent:</span></span><br><span class="line">  <span class="attr">meta:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">pages:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">posts:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">date:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">path:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">text:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">raw:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">content:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">slug:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">updated:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">comments:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">link:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">permalink:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">excerpt:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="comment-评论系统"><a href="#comment-评论系统" class="headerlink" title="comment(评论系统)"></a>comment(评论系统)</h4><p>这里的多数都是国外的，基本用不了。这个<code>valine</code>好像不错，还能统计文章阅读量，可以自己试一试，<a target="_blank" rel="noopener" href="https://valine.js.org/quickstart.html#npm">链接</a>。</p>
<h4 id="miscellaneous-其他"><a href="#miscellaneous-其他" class="headerlink" title="miscellaneous(其他)"></a>miscellaneous(其他)</h4><p>这里我就改了一个<code>links</code>，可以添加友链。注意空格要对！不然会报错！</p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>整个主题看起来好像很复杂的样子，但是仔细捋一捋其实也比较流畅，</p>
<ul>
<li>languages: 顾名思义</li>
<li>layout：布局文件，其实后期想要修改自定义网站上的东西，添加各种各样的信息，主要是在这里修改，其中<code>comment</code>是评论系统，<code>common</code>是常规的布局，最常修改的在这里面，比如修改页面<code>head</code>和<code>footer</code>的内容。</li>
<li>scripts：js脚本，暂时没什么用</li>
<li>source：里面放了一些css的样式，以及图片</li>
</ul>
<h3 id="3-git分支进行多终端工作"><a href="#3-git分支进行多终端工作" class="headerlink" title="3. git分支进行多终端工作"></a>3. git分支进行多终端工作</h3><p>问题来了，如果你现在在自己的笔记本上写的博客，部署在了网站上，那么你在家里用台式机，或者实验室的台式机，发现你电脑里面没有博客的文件，或者要换电脑了，最后不知道怎么移动文件，怎么办？</p>
<p>在这里我们就可以利用git的分支系统进行多终端工作了，这样每次打开不一样的电脑，只需要进行简单的配置和在github上把文件同步下来，就可以无缝操作了。</p>
<h4 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h4><p>机制是这样的，由于<code>hexo d</code>上传部署到github的其实是hexo编译后的文件，是用来生成网页的，不包含源文件。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/18.jpg"></p>
<p>也就是上传的是在本地目录里自动生成的<code>.deploy_git</code>里面。</p>
<p>其他文件 ，包括我们写在source 里面的，和配置文件，主题文件，都没有上传到github</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/19.jpg"></p>
<p>所以可以利用git的分支管理，将源文件上传到github的另一个分支即可。</p>
<h4 id="上传分支"><a href="#上传分支" class="headerlink" title="上传分支"></a>上传分支</h4><p>首先，先在github上新建一个hexo分支，如图：</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/20.jpg" alt="hexo分支"></p>
<p>然后在这个仓库的settings中，选择默认分支为hexo分支（这样每次同步的时候就不用指定分支，比较方便）。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/21.jpg" alt="default"></p>
<p>然后在本地的任意目录下，打开git bash，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:ZJUFangzh/ZJUFangzh.github.io.git</span><br></pre></td></tr></table></figure>

<p>将其克隆到本地，因为默认分支已经设成了hexo，所以clone时只clone了hexo。</p>
<p>接下来在克隆到本地的<code>ZJUFangzh.github.io</code>中，把除了.git 文件夹外的所有文件都删掉</p>
<p>把之前我们写的博客源文件全部复制过来，除了<code>.deploy_git</code>。这里应该说一句，复制过来的源文件应该有一个<code>.gitignore</code>，用来忽略一些不需要的文件，如果没有的话，自己新建一个，在里面写上如下，表示这些类型文件不需要git：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">db.json</span><br><span class="line">*.log</span><br><span class="line">node_modules&#x2F;</span><br><span class="line">public&#x2F;</span><br><span class="line">.deploy*&#x2F;</span><br><span class="line">1234567</span><br></pre></td></tr></table></figure>

<p>注意，如果你之前克隆过theme中的主题文件，那么应该把主题文件中的<code>.git</code>文件夹删掉，因为git不能嵌套上传，最好是显示隐藏文件，检查一下有没有，否则上传的时候会出错，导致你的主题文件无法上传，这样你的配置在别的电脑上就用不了了。</p>
<p>而后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit –m &quot;add branch&quot;</span><br><span class="line">git push </span><br></pre></td></tr></table></figure>

<p>这样就上传完了，可以去你的github上看一看hexo分支有没有上传上去，其中<code>node_modules</code>、<code>public</code>、<code>db.json</code>已经被忽略掉了，没有关系，不需要上传的，因为在别的电脑上需要重新输入命令安装 。</p>
<p><img src="/2020/11/08/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/22.jpg"></p>
<p>这样就上传完了。</p>
<h4 id="更换电脑操作"><a href="#更换电脑操作" class="headerlink" title="更换电脑操作"></a>更换电脑操作</h4><p>一样的，跟之前的环境搭建一样，</p>
<ul>
<li>安装git</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>

<ul>
<li>设置git全局邮箱和用户名</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;yourgithubname&quot;</span><br><span class="line">git config --global user.email &quot;yourgithubemail&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置ssh key</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;youremail&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">生成后填到github和coding上（有coding平台的话）</span></span><br><span class="line"><span class="meta">#</span><span class="bash">验证是否成功</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T git@git.coding.net #(有coding平台的话)</span><br></pre></td></tr></table></figure>

<ul>
<li>安装nodejs</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br><span class="line">sudo apt-get install npm</span><br></pre></td></tr></table></figure>

<ul>
<li>安装hexo</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-cli -g</span><br></pre></td></tr></table></figure>

<p>但是已经不需要初始化了，</p>
<p>直接在任意文件夹下，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@………………</span><br></pre></td></tr></table></figure>

<p>然后进入克隆到的文件夹：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd xxx.github.io</span><br><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>生成，部署：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<p>然后就可以开始写你的新博客了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new newpage</span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong></p>
<ol>
<li>不要忘了，每次写完最好都把源文件上传一下</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit –m &quot;xxxx&quot;</span><br><span class="line">git push </span><br></pre></td></tr></table></figure>

<ol>
<li>如果是在已经编辑过的电脑上，已经有clone文件夹了，那么，每次只要和远端同步一下就行了</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure>

<hr>
<p>关于第四步在coding page部署实现国内外分流与第三部分hexo添加各种功能，包括搜索的SEO，阅读量统计，访问量统计和评论系统等。本人没有操作，详情可查看Fangzh的<a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_37781304/article/details/82729029">hexo史上最全搭建教程</a>这篇博客。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xgh-user.github.io/2020/11/08/markdown%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="_little-star_">
      <meta itemprop="description" content="记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_little-star_">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/08/markdown%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">markdown语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-08 16:25:36" itemprop="dateCreated datePublished" datetime="2020-11-08T16:25:36+08:00">2020-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-09 21:05:55" itemprop="dateModified" datetime="2020-11-09T21:05:55+08:00">2020-11-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%90%8E%E5%8F%B0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">java后台学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%90%8E%E5%8F%B0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/markdown/" itemprop="url" rel="index"><span itemprop="name">markdown</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>markdown支持如下的6级标题</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 一级标题</span></span><br><span class="line"><span class="section">## 二级标题</span></span><br><span class="line">...</span><br><span class="line"><span class="section">###### 六级标题</span></span><br></pre></td></tr></table></figure>

<h3 id="字体加粗"><a href="#字体加粗" class="headerlink" title="字体加粗"></a>字体加粗</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">**加粗**</span></span><br></pre></td></tr></table></figure>

<h3 id="字体倾斜"><a href="#字体倾斜" class="headerlink" title="字体倾斜"></a>字体倾斜</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="emphasis">*倾斜*</span></span><br></pre></td></tr></table></figure>

<h3 id="字体加粗并倾斜"><a href="#字体加粗并倾斜" class="headerlink" title="字体加粗并倾斜"></a>字体加粗并倾斜</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">**<span class="emphasis">*加粗倾斜<span class="strong">**<span class="emphasis">*</span></span></span></span></span><br></pre></td></tr></table></figure>

<h3 id="删除线"><a href="#删除线" class="headerlink" title="删除线"></a>删除线</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">~~~删除线~~~</span></span><br></pre></td></tr></table></figure>

<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; 引用的文字</span></span><br></pre></td></tr></table></figure>

<h3 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---</span><br></pre></td></tr></table></figure>

<h3 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> 列表项1</span><br><span class="line"><span class="bullet">*</span> 列表项2</span><br></pre></td></tr></table></figure>

<h3 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 列表项1</span><br><span class="line"><span class="bullet">2.</span> 列表项2</span><br></pre></td></tr></table></figure>

<p>对于无序列表和有序列表来说都是可以嵌套使用的。</p>
<h3 id="行内代码块"><a href="#行内代码块" class="headerlink" title="行内代码块"></a>行内代码块</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">`行内代码`</span> </span><br></pre></td></tr></table></figure>

<p>对于行内代码块来说，是非常方便的，在写技术博客的时候如果提到某个方法或者是某个类，可以直接使用行内代码块，提高可读性。</p>
<h3 id="多行代码块"><a href="#多行代码块" class="headerlink" title="多行代码块"></a>多行代码块</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">```多行代码块 多行代码块```</span></span><br></pre></td></tr></table></figure>

<h3 id="修改文字的颜色"><a href="#修改文字的颜色" class="headerlink" title="修改文字的颜色"></a>修改文字的颜色</h3><p>我在使用富文本的时候经常有一些重点内容会让我标记成特殊的格式，在markdown中支持<code>标签，我们可以直接使用</code>标签来改变文字的一些样式</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;黑体&quot;</span>&gt;</span></span>我是黑体字<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;微软雅黑&quot;</span>&gt;</span></span>我是微软雅黑<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;STCAIYUN&quot;</span>&gt;</span></span>我是华文彩云<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">red</span>&gt;</span></span>我是红色<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">#008000</span>&gt;</span></span>我是绿色<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">Blue</span>&gt;</span></span>我是蓝色<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">5</span>&gt;</span></span>我是尺寸<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;黑体&quot;</span> <span class="attr">color</span>=<span class="string">green</span> <span class="attr">size</span>=<span class="string">5</span>&gt;</span></span>我是黑体，绿色，尺寸为5<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">_little-star_</p>
  <div class="site-description" itemprop="description">记录个人在平时学习的过程中的一些笔记、感受与遇到的坑,例如：java、计算机考研四件套等等。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">_little-star_</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
